(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))_(b);new MutationObserver(b=>{for(const I of b)if(I.type==="childList")for(const S of I.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&_(S)}).observe(document,{childList:!0,subtree:!0});function h(b){const I={};return b.integrity&&(I.integrity=b.integrity),b.referrerPolicy&&(I.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?I.credentials="include":b.crossOrigin==="anonymous"?I.credentials="omit":I.credentials="same-origin",I}function _(b){if(b.ep)return;b.ep=!0;const I=h(b);fetch(b.href,I)}})();var Ww=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vv(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Uv={exports:{}},Qd={},$v={exports:{}},Lt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hc=Symbol.for("react.element"),Xw=Symbol.for("react.portal"),Kw=Symbol.for("react.fragment"),Jw=Symbol.for("react.strict_mode"),Yw=Symbol.for("react.profiler"),Qw=Symbol.for("react.provider"),eb=Symbol.for("react.context"),tb=Symbol.for("react.forward_ref"),rb=Symbol.for("react.suspense"),ib=Symbol.for("react.memo"),nb=Symbol.for("react.lazy"),Py=Symbol.iterator;function sb(i){return i===null||typeof i!="object"?null:(i=Py&&i[Py]||i["@@iterator"],typeof i=="function"?i:null)}var Zv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},qv=Object.assign,Gv={};function Yl(i,a,h){this.props=i,this.context=a,this.refs=Gv,this.updater=h||Zv}Yl.prototype.isReactComponent={};Yl.prototype.setState=function(i,a){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,a,"setState")};Yl.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function Hv(){}Hv.prototype=Yl.prototype;function Jm(i,a,h){this.props=i,this.context=a,this.refs=Gv,this.updater=h||Zv}var Ym=Jm.prototype=new Hv;Ym.constructor=Jm;qv(Ym,Yl.prototype);Ym.isPureReactComponent=!0;var Cy=Array.isArray,Wv=Object.prototype.hasOwnProperty,Qm={current:null},Xv={key:!0,ref:!0,__self:!0,__source:!0};function Kv(i,a,h){var _,b={},I=null,S=null;if(a!=null)for(_ in a.ref!==void 0&&(S=a.ref),a.key!==void 0&&(I=""+a.key),a)Wv.call(a,_)&&!Xv.hasOwnProperty(_)&&(b[_]=a[_]);var d=arguments.length-2;if(d===1)b.children=h;else if(1<d){for(var U=Array(d),ne=0;ne<d;ne++)U[ne]=arguments[ne+2];b.children=U}if(i&&i.defaultProps)for(_ in d=i.defaultProps,d)b[_]===void 0&&(b[_]=d[_]);return{$$typeof:Hc,type:i,key:I,ref:S,props:b,_owner:Qm.current}}function ab(i,a){return{$$typeof:Hc,type:i.type,key:a,ref:i.ref,props:i.props,_owner:i._owner}}function eg(i){return typeof i=="object"&&i!==null&&i.$$typeof===Hc}function ob(i){var a={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(h){return a[h]})}var My=/\/+/g;function zf(i,a){return typeof i=="object"&&i!==null&&i.key!=null?ob(""+i.key):a.toString(36)}function _d(i,a,h,_,b){var I=typeof i;(I==="undefined"||I==="boolean")&&(i=null);var S=!1;if(i===null)S=!0;else switch(I){case"string":case"number":S=!0;break;case"object":switch(i.$$typeof){case Hc:case Xw:S=!0}}if(S)return S=i,b=b(S),i=_===""?"."+zf(S,0):_,Cy(b)?(h="",i!=null&&(h=i.replace(My,"$&/")+"/"),_d(b,a,h,"",function(ne){return ne})):b!=null&&(eg(b)&&(b=ab(b,h+(!b.key||S&&S.key===b.key?"":(""+b.key).replace(My,"$&/")+"/")+i)),a.push(b)),1;if(S=0,_=_===""?".":_+":",Cy(i))for(var d=0;d<i.length;d++){I=i[d];var U=_+zf(I,d);S+=_d(I,a,h,U,b)}else if(U=sb(i),typeof U=="function")for(i=U.call(i),d=0;!(I=i.next()).done;)I=I.value,U=_+zf(I,d++),S+=_d(I,a,h,U,b);else if(I==="object")throw a=String(i),Error("Objects are not valid as a React child (found: "+(a==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":a)+"). If you meant to render a collection of children, use an array instead.");return S}function ed(i,a,h){if(i==null)return i;var _=[],b=0;return _d(i,_,"","",function(I){return a.call(h,I,b++)}),_}function lb(i){if(i._status===-1){var a=i._result;a=a(),a.then(function(h){(i._status===0||i._status===-1)&&(i._status=1,i._result=h)},function(h){(i._status===0||i._status===-1)&&(i._status=2,i._result=h)}),i._status===-1&&(i._status=0,i._result=a)}if(i._status===1)return i._result.default;throw i._result}var $i={current:null},yd={transition:null},ub={ReactCurrentDispatcher:$i,ReactCurrentBatchConfig:yd,ReactCurrentOwner:Qm};function Jv(){throw Error("act(...) is not supported in production builds of React.")}Lt.Children={map:ed,forEach:function(i,a,h){ed(i,function(){a.apply(this,arguments)},h)},count:function(i){var a=0;return ed(i,function(){a++}),a},toArray:function(i){return ed(i,function(a){return a})||[]},only:function(i){if(!eg(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};Lt.Component=Yl;Lt.Fragment=Kw;Lt.Profiler=Yw;Lt.PureComponent=Jm;Lt.StrictMode=Jw;Lt.Suspense=rb;Lt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ub;Lt.act=Jv;Lt.cloneElement=function(i,a,h){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var _=qv({},i.props),b=i.key,I=i.ref,S=i._owner;if(a!=null){if(a.ref!==void 0&&(I=a.ref,S=Qm.current),a.key!==void 0&&(b=""+a.key),i.type&&i.type.defaultProps)var d=i.type.defaultProps;for(U in a)Wv.call(a,U)&&!Xv.hasOwnProperty(U)&&(_[U]=a[U]===void 0&&d!==void 0?d[U]:a[U])}var U=arguments.length-2;if(U===1)_.children=h;else if(1<U){d=Array(U);for(var ne=0;ne<U;ne++)d[ne]=arguments[ne+2];_.children=d}return{$$typeof:Hc,type:i.type,key:b,ref:I,props:_,_owner:S}};Lt.createContext=function(i){return i={$$typeof:eb,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:Qw,_context:i},i.Consumer=i};Lt.createElement=Kv;Lt.createFactory=function(i){var a=Kv.bind(null,i);return a.type=i,a};Lt.createRef=function(){return{current:null}};Lt.forwardRef=function(i){return{$$typeof:tb,render:i}};Lt.isValidElement=eg;Lt.lazy=function(i){return{$$typeof:nb,_payload:{_status:-1,_result:i},_init:lb}};Lt.memo=function(i,a){return{$$typeof:ib,type:i,compare:a===void 0?null:a}};Lt.startTransition=function(i){var a=yd.transition;yd.transition={};try{i()}finally{yd.transition=a}};Lt.unstable_act=Jv;Lt.useCallback=function(i,a){return $i.current.useCallback(i,a)};Lt.useContext=function(i){return $i.current.useContext(i)};Lt.useDebugValue=function(){};Lt.useDeferredValue=function(i){return $i.current.useDeferredValue(i)};Lt.useEffect=function(i,a){return $i.current.useEffect(i,a)};Lt.useId=function(){return $i.current.useId()};Lt.useImperativeHandle=function(i,a,h){return $i.current.useImperativeHandle(i,a,h)};Lt.useInsertionEffect=function(i,a){return $i.current.useInsertionEffect(i,a)};Lt.useLayoutEffect=function(i,a){return $i.current.useLayoutEffect(i,a)};Lt.useMemo=function(i,a){return $i.current.useMemo(i,a)};Lt.useReducer=function(i,a,h){return $i.current.useReducer(i,a,h)};Lt.useRef=function(i){return $i.current.useRef(i)};Lt.useState=function(i){return $i.current.useState(i)};Lt.useSyncExternalStore=function(i,a,h){return $i.current.useSyncExternalStore(i,a,h)};Lt.useTransition=function(){return $i.current.useTransition()};Lt.version="18.3.1";$v.exports=Lt;var kt=$v.exports;const cb=Vv(kt);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hb=kt,db=Symbol.for("react.element"),pb=Symbol.for("react.fragment"),fb=Object.prototype.hasOwnProperty,mb=hb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,gb={key:!0,ref:!0,__self:!0,__source:!0};function Yv(i,a,h){var _,b={},I=null,S=null;h!==void 0&&(I=""+h),a.key!==void 0&&(I=""+a.key),a.ref!==void 0&&(S=a.ref);for(_ in a)fb.call(a,_)&&!gb.hasOwnProperty(_)&&(b[_]=a[_]);if(i&&i.defaultProps)for(_ in a=i.defaultProps,a)b[_]===void 0&&(b[_]=a[_]);return{$$typeof:db,type:i,key:I,ref:S,props:b,_owner:mb.current}}Qd.Fragment=pb;Qd.jsx=Yv;Qd.jsxs=Yv;Uv.exports=Qd;var Re=Uv.exports,nm={},Qv={exports:{}},Tn={},ex={exports:{}},tx={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function a(He,ht){var ut=He.length;He.push(ht);e:for(;0<ut;){var It=ut-1>>>1,Nt=He[It];if(0<b(Nt,ht))He[It]=ht,He[ut]=Nt,ut=It;else break e}}function h(He){return He.length===0?null:He[0]}function _(He){if(He.length===0)return null;var ht=He[0],ut=He.pop();if(ut!==ht){He[0]=ut;e:for(var It=0,Nt=He.length,si=Nt>>>1;It<si;){var er=2*(It+1)-1,Dr=He[er],Gr=er+1,ur=He[Gr];if(0>b(Dr,ut))Gr<Nt&&0>b(ur,Dr)?(He[It]=ur,He[Gr]=ut,It=Gr):(He[It]=Dr,He[er]=ut,It=er);else if(Gr<Nt&&0>b(ur,ut))He[It]=ur,He[Gr]=ut,It=Gr;else break e}}return ht}function b(He,ht){var ut=He.sortIndex-ht.sortIndex;return ut!==0?ut:He.id-ht.id}if(typeof performance=="object"&&typeof performance.now=="function"){var I=performance;i.unstable_now=function(){return I.now()}}else{var S=Date,d=S.now();i.unstable_now=function(){return S.now()-d}}var U=[],ne=[],ye=1,Q=null,W=3,De=!1,Me=!1,Pe=!1,_t=typeof setTimeout=="function"?setTimeout:null,oe=typeof clearTimeout=="function"?clearTimeout:null,ee=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function he(He){for(var ht=h(ne);ht!==null;){if(ht.callback===null)_(ne);else if(ht.startTime<=He)_(ne),ht.sortIndex=ht.expirationTime,a(U,ht);else break;ht=h(ne)}}function Se(He){if(Pe=!1,he(He),!Me)if(h(U)!==null)Me=!0,zi(Ue);else{var ht=h(ne);ht!==null&&jr(Se,ht.startTime-He)}}function Ue(He,ht){Me=!1,Pe&&(Pe=!1,oe(it),it=-1),De=!0;var ut=W;try{for(he(ht),Q=h(U);Q!==null&&(!(Q.expirationTime>ht)||He&&!wt());){var It=Q.callback;if(typeof It=="function"){Q.callback=null,W=Q.priorityLevel;var Nt=It(Q.expirationTime<=ht);ht=i.unstable_now(),typeof Nt=="function"?Q.callback=Nt:Q===h(U)&&_(U),he(ht)}else _(U);Q=h(U)}if(Q!==null)var si=!0;else{var er=h(ne);er!==null&&jr(Se,er.startTime-ht),si=!1}return si}finally{Q=null,W=ut,De=!1}}var Xe=!1,Ge=null,it=-1,Rt=5,vt=-1;function wt(){return!(i.unstable_now()-vt<Rt)}function Mi(){if(Ge!==null){var He=i.unstable_now();vt=He;var ht=!0;try{ht=Ge(!0,He)}finally{ht?Qt():(Xe=!1,Ge=null)}}else Xe=!1}var Qt;if(typeof ee=="function")Qt=function(){ee(Mi)};else if(typeof MessageChannel<"u"){var Ot=new MessageChannel,Tr=Ot.port2;Ot.port1.onmessage=Mi,Qt=function(){Tr.postMessage(null)}}else Qt=function(){_t(Mi,0)};function zi(He){Ge=He,Xe||(Xe=!0,Qt())}function jr(He,ht){it=_t(function(){He(i.unstable_now())},ht)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(He){He.callback=null},i.unstable_continueExecution=function(){Me||De||(Me=!0,zi(Ue))},i.unstable_forceFrameRate=function(He){0>He||125<He?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Rt=0<He?Math.floor(1e3/He):5},i.unstable_getCurrentPriorityLevel=function(){return W},i.unstable_getFirstCallbackNode=function(){return h(U)},i.unstable_next=function(He){switch(W){case 1:case 2:case 3:var ht=3;break;default:ht=W}var ut=W;W=ht;try{return He()}finally{W=ut}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(He,ht){switch(He){case 1:case 2:case 3:case 4:case 5:break;default:He=3}var ut=W;W=He;try{return ht()}finally{W=ut}},i.unstable_scheduleCallback=function(He,ht,ut){var It=i.unstable_now();switch(typeof ut=="object"&&ut!==null?(ut=ut.delay,ut=typeof ut=="number"&&0<ut?It+ut:It):ut=It,He){case 1:var Nt=-1;break;case 2:Nt=250;break;case 5:Nt=1073741823;break;case 4:Nt=1e4;break;default:Nt=5e3}return Nt=ut+Nt,He={id:ye++,callback:ht,priorityLevel:He,startTime:ut,expirationTime:Nt,sortIndex:-1},ut>It?(He.sortIndex=ut,a(ne,He),h(U)===null&&He===h(ne)&&(Pe?(oe(it),it=-1):Pe=!0,jr(Se,ut-It))):(He.sortIndex=Nt,a(U,He),Me||De||(Me=!0,zi(Ue))),He},i.unstable_shouldYield=wt,i.unstable_wrapCallback=function(He){var ht=W;return function(){var ut=W;W=ht;try{return He.apply(this,arguments)}finally{W=ut}}}})(tx);ex.exports=tx;var _b=ex.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yb=kt,Sn=_b;function Ce(i){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+i,h=1;h<arguments.length;h++)a+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+i+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var rx=new Set,Mc={};function Mo(i,a){ql(i,a),ql(i+"Capture",a)}function ql(i,a){for(Mc[i]=a,i=0;i<a.length;i++)rx.add(a[i])}var js=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),sm=Object.prototype.hasOwnProperty,vb=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,zy={},Ay={};function xb(i){return sm.call(Ay,i)?!0:sm.call(zy,i)?!1:vb.test(i)?Ay[i]=!0:(zy[i]=!0,!1)}function wb(i,a,h,_){if(h!==null&&h.type===0)return!1;switch(typeof a){case"function":case"symbol":return!0;case"boolean":return _?!1:h!==null?!h.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function bb(i,a,h,_){if(a===null||typeof a>"u"||wb(i,a,h,_))return!0;if(_)return!1;if(h!==null)switch(h.type){case 3:return!a;case 4:return a===!1;case 5:return isNaN(a);case 6:return isNaN(a)||1>a}return!1}function Zi(i,a,h,_,b,I,S){this.acceptsBooleans=a===2||a===3||a===4,this.attributeName=_,this.attributeNamespace=b,this.mustUseProperty=h,this.propertyName=i,this.type=a,this.sanitizeURL=I,this.removeEmptyString=S}var fi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){fi[i]=new Zi(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var a=i[0];fi[a]=new Zi(a,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){fi[i]=new Zi(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){fi[i]=new Zi(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){fi[i]=new Zi(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){fi[i]=new Zi(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){fi[i]=new Zi(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){fi[i]=new Zi(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){fi[i]=new Zi(i,5,!1,i.toLowerCase(),null,!1,!1)});var tg=/[\-:]([a-z])/g;function rg(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var a=i.replace(tg,rg);fi[a]=new Zi(a,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var a=i.replace(tg,rg);fi[a]=new Zi(a,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var a=i.replace(tg,rg);fi[a]=new Zi(a,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){fi[i]=new Zi(i,1,!1,i.toLowerCase(),null,!1,!1)});fi.xlinkHref=new Zi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){fi[i]=new Zi(i,1,!1,i.toLowerCase(),null,!0,!0)});function ig(i,a,h,_){var b=fi.hasOwnProperty(a)?fi[a]:null;(b!==null?b.type!==0:_||!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(bb(a,h,b,_)&&(h=null),_||b===null?xb(a)&&(h===null?i.removeAttribute(a):i.setAttribute(a,""+h)):b.mustUseProperty?i[b.propertyName]=h===null?b.type===3?!1:"":h:(a=b.attributeName,_=b.attributeNamespace,h===null?i.removeAttribute(a):(b=b.type,h=b===3||b===4&&h===!0?"":""+h,_?i.setAttributeNS(_,a,h):i.setAttribute(a,h))))}var Zs=yb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,td=Symbol.for("react.element"),El=Symbol.for("react.portal"),Pl=Symbol.for("react.fragment"),ng=Symbol.for("react.strict_mode"),am=Symbol.for("react.profiler"),ix=Symbol.for("react.provider"),nx=Symbol.for("react.context"),sg=Symbol.for("react.forward_ref"),om=Symbol.for("react.suspense"),lm=Symbol.for("react.suspense_list"),ag=Symbol.for("react.memo"),ka=Symbol.for("react.lazy"),sx=Symbol.for("react.offscreen"),Dy=Symbol.iterator;function uc(i){return i===null||typeof i!="object"?null:(i=Dy&&i[Dy]||i["@@iterator"],typeof i=="function"?i:null)}var Sr=Object.assign,Af;function _c(i){if(Af===void 0)try{throw Error()}catch(h){var a=h.stack.trim().match(/\n( *(at )?)/);Af=a&&a[1]||""}return`
`+Af+i}var Df=!1;function Lf(i,a){if(!i||Df)return"";Df=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(ne){var _=ne}Reflect.construct(i,[],a)}else{try{a.call()}catch(ne){_=ne}i.call(a.prototype)}else{try{throw Error()}catch(ne){_=ne}i()}}catch(ne){if(ne&&_&&typeof ne.stack=="string"){for(var b=ne.stack.split(`
`),I=_.stack.split(`
`),S=b.length-1,d=I.length-1;1<=S&&0<=d&&b[S]!==I[d];)d--;for(;1<=S&&0<=d;S--,d--)if(b[S]!==I[d]){if(S!==1||d!==1)do if(S--,d--,0>d||b[S]!==I[d]){var U=`
`+b[S].replace(" at new "," at ");return i.displayName&&U.includes("<anonymous>")&&(U=U.replace("<anonymous>",i.displayName)),U}while(1<=S&&0<=d);break}}}finally{Df=!1,Error.prepareStackTrace=h}return(i=i?i.displayName||i.name:"")?_c(i):""}function Sb(i){switch(i.tag){case 5:return _c(i.type);case 16:return _c("Lazy");case 13:return _c("Suspense");case 19:return _c("SuspenseList");case 0:case 2:case 15:return i=Lf(i.type,!1),i;case 11:return i=Lf(i.type.render,!1),i;case 1:return i=Lf(i.type,!0),i;default:return""}}function um(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Pl:return"Fragment";case El:return"Portal";case am:return"Profiler";case ng:return"StrictMode";case om:return"Suspense";case lm:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case nx:return(i.displayName||"Context")+".Consumer";case ix:return(i._context.displayName||"Context")+".Provider";case sg:var a=i.render;return i=i.displayName,i||(i=a.displayName||a.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case ag:return a=i.displayName||null,a!==null?a:um(i.type)||"Memo";case ka:a=i._payload,i=i._init;try{return um(i(a))}catch{}}return null}function Tb(i){var a=i.type;switch(i.tag){case 24:return"Cache";case 9:return(a.displayName||"Context")+".Consumer";case 10:return(a._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=a.render,i=i.displayName||i.name||"",a.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return um(a);case 8:return a===ng?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a}return null}function Na(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function ax(i){var a=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function kb(i){var a=ax(i)?"checked":"value",h=Object.getOwnPropertyDescriptor(i.constructor.prototype,a),_=""+i[a];if(!i.hasOwnProperty(a)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var b=h.get,I=h.set;return Object.defineProperty(i,a,{configurable:!0,get:function(){return b.call(this)},set:function(S){_=""+S,I.call(this,S)}}),Object.defineProperty(i,a,{enumerable:h.enumerable}),{getValue:function(){return _},setValue:function(S){_=""+S},stopTracking:function(){i._valueTracker=null,delete i[a]}}}}function rd(i){i._valueTracker||(i._valueTracker=kb(i))}function ox(i){if(!i)return!1;var a=i._valueTracker;if(!a)return!0;var h=a.getValue(),_="";return i&&(_=ax(i)?i.checked?"true":"false":i.value),i=_,i!==h?(a.setValue(i),!0):!1}function Cd(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function cm(i,a){var h=a.checked;return Sr({},a,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??i._wrapperState.initialChecked})}function Ly(i,a){var h=a.defaultValue==null?"":a.defaultValue,_=a.checked!=null?a.checked:a.defaultChecked;h=Na(a.value!=null?a.value:h),i._wrapperState={initialChecked:_,initialValue:h,controlled:a.type==="checkbox"||a.type==="radio"?a.checked!=null:a.value!=null}}function lx(i,a){a=a.checked,a!=null&&ig(i,"checked",a,!1)}function hm(i,a){lx(i,a);var h=Na(a.value),_=a.type;if(h!=null)_==="number"?(h===0&&i.value===""||i.value!=h)&&(i.value=""+h):i.value!==""+h&&(i.value=""+h);else if(_==="submit"||_==="reset"){i.removeAttribute("value");return}a.hasOwnProperty("value")?dm(i,a.type,h):a.hasOwnProperty("defaultValue")&&dm(i,a.type,Na(a.defaultValue)),a.checked==null&&a.defaultChecked!=null&&(i.defaultChecked=!!a.defaultChecked)}function Ry(i,a,h){if(a.hasOwnProperty("value")||a.hasOwnProperty("defaultValue")){var _=a.type;if(!(_!=="submit"&&_!=="reset"||a.value!==void 0&&a.value!==null))return;a=""+i._wrapperState.initialValue,h||a===i.value||(i.value=a),i.defaultValue=a}h=i.name,h!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,h!==""&&(i.name=h)}function dm(i,a,h){(a!=="number"||Cd(i.ownerDocument)!==i)&&(h==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+h&&(i.defaultValue=""+h))}var yc=Array.isArray;function Nl(i,a,h,_){if(i=i.options,a){a={};for(var b=0;b<h.length;b++)a["$"+h[b]]=!0;for(h=0;h<i.length;h++)b=a.hasOwnProperty("$"+i[h].value),i[h].selected!==b&&(i[h].selected=b),b&&_&&(i[h].defaultSelected=!0)}else{for(h=""+Na(h),a=null,b=0;b<i.length;b++){if(i[b].value===h){i[b].selected=!0,_&&(i[b].defaultSelected=!0);return}a!==null||i[b].disabled||(a=i[b])}a!==null&&(a.selected=!0)}}function pm(i,a){if(a.dangerouslySetInnerHTML!=null)throw Error(Ce(91));return Sr({},a,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function Fy(i,a){var h=a.value;if(h==null){if(h=a.children,a=a.defaultValue,h!=null){if(a!=null)throw Error(Ce(92));if(yc(h)){if(1<h.length)throw Error(Ce(93));h=h[0]}a=h}a==null&&(a=""),h=a}i._wrapperState={initialValue:Na(h)}}function ux(i,a){var h=Na(a.value),_=Na(a.defaultValue);h!=null&&(h=""+h,h!==i.value&&(i.value=h),a.defaultValue==null&&i.defaultValue!==h&&(i.defaultValue=h)),_!=null&&(i.defaultValue=""+_)}function By(i){var a=i.textContent;a===i._wrapperState.initialValue&&a!==""&&a!==null&&(i.value=a)}function cx(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function fm(i,a){return i==null||i==="http://www.w3.org/1999/xhtml"?cx(a):i==="http://www.w3.org/2000/svg"&&a==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var id,hx=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(a,h,_,b){MSApp.execUnsafeLocalFunction(function(){return i(a,h,_,b)})}:i}(function(i,a){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=a;else{for(id=id||document.createElement("div"),id.innerHTML="<svg>"+a.valueOf().toString()+"</svg>",a=id.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;a.firstChild;)i.appendChild(a.firstChild)}});function zc(i,a){if(a){var h=i.firstChild;if(h&&h===i.lastChild&&h.nodeType===3){h.nodeValue=a;return}}i.textContent=a}var wc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ib=["Webkit","ms","Moz","O"];Object.keys(wc).forEach(function(i){Ib.forEach(function(a){a=a+i.charAt(0).toUpperCase()+i.substring(1),wc[a]=wc[i]})});function dx(i,a,h){return a==null||typeof a=="boolean"||a===""?"":h||typeof a!="number"||a===0||wc.hasOwnProperty(i)&&wc[i]?(""+a).trim():a+"px"}function px(i,a){i=i.style;for(var h in a)if(a.hasOwnProperty(h)){var _=h.indexOf("--")===0,b=dx(h,a[h],_);h==="float"&&(h="cssFloat"),_?i.setProperty(h,b):i[h]=b}}var Eb=Sr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function mm(i,a){if(a){if(Eb[i]&&(a.children!=null||a.dangerouslySetInnerHTML!=null))throw Error(Ce(137,i));if(a.dangerouslySetInnerHTML!=null){if(a.children!=null)throw Error(Ce(60));if(typeof a.dangerouslySetInnerHTML!="object"||!("__html"in a.dangerouslySetInnerHTML))throw Error(Ce(61))}if(a.style!=null&&typeof a.style!="object")throw Error(Ce(62))}}function gm(i,a){if(i.indexOf("-")===-1)return typeof a.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _m=null;function og(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var ym=null,jl=null,Vl=null;function Oy(i){if(i=Kc(i)){if(typeof ym!="function")throw Error(Ce(280));var a=i.stateNode;a&&(a=np(a),ym(i.stateNode,i.type,a))}}function fx(i){jl?Vl?Vl.push(i):Vl=[i]:jl=i}function mx(){if(jl){var i=jl,a=Vl;if(Vl=jl=null,Oy(i),a)for(i=0;i<a.length;i++)Oy(a[i])}}function gx(i,a){return i(a)}function _x(){}var Rf=!1;function yx(i,a,h){if(Rf)return i(a,h);Rf=!0;try{return gx(i,a,h)}finally{Rf=!1,(jl!==null||Vl!==null)&&(_x(),mx())}}function Ac(i,a){var h=i.stateNode;if(h===null)return null;var _=np(h);if(_===null)return null;h=_[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(i=i.type,_=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!_;break e;default:i=!1}if(i)return null;if(h&&typeof h!="function")throw Error(Ce(231,a,typeof h));return h}var vm=!1;if(js)try{var cc={};Object.defineProperty(cc,"passive",{get:function(){vm=!0}}),window.addEventListener("test",cc,cc),window.removeEventListener("test",cc,cc)}catch{vm=!1}function Pb(i,a,h,_,b,I,S,d,U){var ne=Array.prototype.slice.call(arguments,3);try{a.apply(h,ne)}catch(ye){this.onError(ye)}}var bc=!1,Md=null,zd=!1,xm=null,Cb={onError:function(i){bc=!0,Md=i}};function Mb(i,a,h,_,b,I,S,d,U){bc=!1,Md=null,Pb.apply(Cb,arguments)}function zb(i,a,h,_,b,I,S,d,U){if(Mb.apply(this,arguments),bc){if(bc){var ne=Md;bc=!1,Md=null}else throw Error(Ce(198));zd||(zd=!0,xm=ne)}}function zo(i){var a=i,h=i;if(i.alternate)for(;a.return;)a=a.return;else{i=a;do a=i,a.flags&4098&&(h=a.return),i=a.return;while(i)}return a.tag===3?h:null}function vx(i){if(i.tag===13){var a=i.memoizedState;if(a===null&&(i=i.alternate,i!==null&&(a=i.memoizedState)),a!==null)return a.dehydrated}return null}function Ny(i){if(zo(i)!==i)throw Error(Ce(188))}function Ab(i){var a=i.alternate;if(!a){if(a=zo(i),a===null)throw Error(Ce(188));return a!==i?null:i}for(var h=i,_=a;;){var b=h.return;if(b===null)break;var I=b.alternate;if(I===null){if(_=b.return,_!==null){h=_;continue}break}if(b.child===I.child){for(I=b.child;I;){if(I===h)return Ny(b),i;if(I===_)return Ny(b),a;I=I.sibling}throw Error(Ce(188))}if(h.return!==_.return)h=b,_=I;else{for(var S=!1,d=b.child;d;){if(d===h){S=!0,h=b,_=I;break}if(d===_){S=!0,_=b,h=I;break}d=d.sibling}if(!S){for(d=I.child;d;){if(d===h){S=!0,h=I,_=b;break}if(d===_){S=!0,_=I,h=b;break}d=d.sibling}if(!S)throw Error(Ce(189))}}if(h.alternate!==_)throw Error(Ce(190))}if(h.tag!==3)throw Error(Ce(188));return h.stateNode.current===h?i:a}function xx(i){return i=Ab(i),i!==null?wx(i):null}function wx(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var a=wx(i);if(a!==null)return a;i=i.sibling}return null}var bx=Sn.unstable_scheduleCallback,jy=Sn.unstable_cancelCallback,Db=Sn.unstable_shouldYield,Lb=Sn.unstable_requestPaint,Ar=Sn.unstable_now,Rb=Sn.unstable_getCurrentPriorityLevel,lg=Sn.unstable_ImmediatePriority,Sx=Sn.unstable_UserBlockingPriority,Ad=Sn.unstable_NormalPriority,Fb=Sn.unstable_LowPriority,Tx=Sn.unstable_IdlePriority,ep=null,ps=null;function Bb(i){if(ps&&typeof ps.onCommitFiberRoot=="function")try{ps.onCommitFiberRoot(ep,i,void 0,(i.current.flags&128)===128)}catch{}}var Yn=Math.clz32?Math.clz32:jb,Ob=Math.log,Nb=Math.LN2;function jb(i){return i>>>=0,i===0?32:31-(Ob(i)/Nb|0)|0}var nd=64,sd=4194304;function vc(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Dd(i,a){var h=i.pendingLanes;if(h===0)return 0;var _=0,b=i.suspendedLanes,I=i.pingedLanes,S=h&268435455;if(S!==0){var d=S&~b;d!==0?_=vc(d):(I&=S,I!==0&&(_=vc(I)))}else S=h&~b,S!==0?_=vc(S):I!==0&&(_=vc(I));if(_===0)return 0;if(a!==0&&a!==_&&!(a&b)&&(b=_&-_,I=a&-a,b>=I||b===16&&(I&4194240)!==0))return a;if(_&4&&(_|=h&16),a=i.entangledLanes,a!==0)for(i=i.entanglements,a&=_;0<a;)h=31-Yn(a),b=1<<h,_|=i[h],a&=~b;return _}function Vb(i,a){switch(i){case 1:case 2:case 4:return a+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ub(i,a){for(var h=i.suspendedLanes,_=i.pingedLanes,b=i.expirationTimes,I=i.pendingLanes;0<I;){var S=31-Yn(I),d=1<<S,U=b[S];U===-1?(!(d&h)||d&_)&&(b[S]=Vb(d,a)):U<=a&&(i.expiredLanes|=d),I&=~d}}function wm(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function kx(){var i=nd;return nd<<=1,!(nd&4194240)&&(nd=64),i}function Ff(i){for(var a=[],h=0;31>h;h++)a.push(i);return a}function Wc(i,a,h){i.pendingLanes|=a,a!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,a=31-Yn(a),i[a]=h}function $b(i,a){var h=i.pendingLanes&~a;i.pendingLanes=a,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=a,i.mutableReadLanes&=a,i.entangledLanes&=a,a=i.entanglements;var _=i.eventTimes;for(i=i.expirationTimes;0<h;){var b=31-Yn(h),I=1<<b;a[b]=0,_[b]=-1,i[b]=-1,h&=~I}}function ug(i,a){var h=i.entangledLanes|=a;for(i=i.entanglements;h;){var _=31-Yn(h),b=1<<_;b&a|i[_]&a&&(i[_]|=a),h&=~b}}var Yt=0;function Ix(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var Ex,cg,Px,Cx,Mx,bm=!1,ad=[],za=null,Aa=null,Da=null,Dc=new Map,Lc=new Map,Ea=[],Zb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Vy(i,a){switch(i){case"focusin":case"focusout":za=null;break;case"dragenter":case"dragleave":Aa=null;break;case"mouseover":case"mouseout":Da=null;break;case"pointerover":case"pointerout":Dc.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lc.delete(a.pointerId)}}function hc(i,a,h,_,b,I){return i===null||i.nativeEvent!==I?(i={blockedOn:a,domEventName:h,eventSystemFlags:_,nativeEvent:I,targetContainers:[b]},a!==null&&(a=Kc(a),a!==null&&cg(a)),i):(i.eventSystemFlags|=_,a=i.targetContainers,b!==null&&a.indexOf(b)===-1&&a.push(b),i)}function qb(i,a,h,_,b){switch(a){case"focusin":return za=hc(za,i,a,h,_,b),!0;case"dragenter":return Aa=hc(Aa,i,a,h,_,b),!0;case"mouseover":return Da=hc(Da,i,a,h,_,b),!0;case"pointerover":var I=b.pointerId;return Dc.set(I,hc(Dc.get(I)||null,i,a,h,_,b)),!0;case"gotpointercapture":return I=b.pointerId,Lc.set(I,hc(Lc.get(I)||null,i,a,h,_,b)),!0}return!1}function zx(i){var a=xo(i.target);if(a!==null){var h=zo(a);if(h!==null){if(a=h.tag,a===13){if(a=vx(h),a!==null){i.blockedOn=a,Mx(i.priority,function(){Px(h)});return}}else if(a===3&&h.stateNode.current.memoizedState.isDehydrated){i.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}i.blockedOn=null}function vd(i){if(i.blockedOn!==null)return!1;for(var a=i.targetContainers;0<a.length;){var h=Sm(i.domEventName,i.eventSystemFlags,a[0],i.nativeEvent);if(h===null){h=i.nativeEvent;var _=new h.constructor(h.type,h);_m=_,h.target.dispatchEvent(_),_m=null}else return a=Kc(h),a!==null&&cg(a),i.blockedOn=h,!1;a.shift()}return!0}function Uy(i,a,h){vd(i)&&h.delete(a)}function Gb(){bm=!1,za!==null&&vd(za)&&(za=null),Aa!==null&&vd(Aa)&&(Aa=null),Da!==null&&vd(Da)&&(Da=null),Dc.forEach(Uy),Lc.forEach(Uy)}function dc(i,a){i.blockedOn===a&&(i.blockedOn=null,bm||(bm=!0,Sn.unstable_scheduleCallback(Sn.unstable_NormalPriority,Gb)))}function Rc(i){function a(b){return dc(b,i)}if(0<ad.length){dc(ad[0],i);for(var h=1;h<ad.length;h++){var _=ad[h];_.blockedOn===i&&(_.blockedOn=null)}}for(za!==null&&dc(za,i),Aa!==null&&dc(Aa,i),Da!==null&&dc(Da,i),Dc.forEach(a),Lc.forEach(a),h=0;h<Ea.length;h++)_=Ea[h],_.blockedOn===i&&(_.blockedOn=null);for(;0<Ea.length&&(h=Ea[0],h.blockedOn===null);)zx(h),h.blockedOn===null&&Ea.shift()}var Ul=Zs.ReactCurrentBatchConfig,Ld=!0;function Hb(i,a,h,_){var b=Yt,I=Ul.transition;Ul.transition=null;try{Yt=1,hg(i,a,h,_)}finally{Yt=b,Ul.transition=I}}function Wb(i,a,h,_){var b=Yt,I=Ul.transition;Ul.transition=null;try{Yt=4,hg(i,a,h,_)}finally{Yt=b,Ul.transition=I}}function hg(i,a,h,_){if(Ld){var b=Sm(i,a,h,_);if(b===null)Gf(i,a,_,Rd,h),Vy(i,_);else if(qb(b,i,a,h,_))_.stopPropagation();else if(Vy(i,_),a&4&&-1<Zb.indexOf(i)){for(;b!==null;){var I=Kc(b);if(I!==null&&Ex(I),I=Sm(i,a,h,_),I===null&&Gf(i,a,_,Rd,h),I===b)break;b=I}b!==null&&_.stopPropagation()}else Gf(i,a,_,null,h)}}var Rd=null;function Sm(i,a,h,_){if(Rd=null,i=og(_),i=xo(i),i!==null)if(a=zo(i),a===null)i=null;else if(h=a.tag,h===13){if(i=vx(a),i!==null)return i;i=null}else if(h===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null);return Rd=i,null}function Ax(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Rb()){case lg:return 1;case Sx:return 4;case Ad:case Fb:return 16;case Tx:return 536870912;default:return 16}default:return 16}}var Ca=null,dg=null,xd=null;function Dx(){if(xd)return xd;var i,a=dg,h=a.length,_,b="value"in Ca?Ca.value:Ca.textContent,I=b.length;for(i=0;i<h&&a[i]===b[i];i++);var S=h-i;for(_=1;_<=S&&a[h-_]===b[I-_];_++);return xd=b.slice(i,1<_?1-_:void 0)}function wd(i){var a=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&a===13&&(i=13)):i=a,i===10&&(i=13),32<=i||i===13?i:0}function od(){return!0}function $y(){return!1}function kn(i){function a(h,_,b,I,S){this._reactName=h,this._targetInst=b,this.type=_,this.nativeEvent=I,this.target=S,this.currentTarget=null;for(var d in i)i.hasOwnProperty(d)&&(h=i[d],this[d]=h?h(I):I[d]);return this.isDefaultPrevented=(I.defaultPrevented!=null?I.defaultPrevented:I.returnValue===!1)?od:$y,this.isPropagationStopped=$y,this}return Sr(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=od)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=od)},persist:function(){},isPersistent:od}),a}var Ql={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pg=kn(Ql),Xc=Sr({},Ql,{view:0,detail:0}),Xb=kn(Xc),Bf,Of,pc,tp=Sr({},Xc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fg,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==pc&&(pc&&i.type==="mousemove"?(Bf=i.screenX-pc.screenX,Of=i.screenY-pc.screenY):Of=Bf=0,pc=i),Bf)},movementY:function(i){return"movementY"in i?i.movementY:Of}}),Zy=kn(tp),Kb=Sr({},tp,{dataTransfer:0}),Jb=kn(Kb),Yb=Sr({},Xc,{relatedTarget:0}),Nf=kn(Yb),Qb=Sr({},Ql,{animationName:0,elapsedTime:0,pseudoElement:0}),e2=kn(Qb),t2=Sr({},Ql,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),r2=kn(t2),i2=Sr({},Ql,{data:0}),qy=kn(i2),n2={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},s2={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},a2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function o2(i){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(i):(i=a2[i])?!!a[i]:!1}function fg(){return o2}var l2=Sr({},Xc,{key:function(i){if(i.key){var a=n2[i.key]||i.key;if(a!=="Unidentified")return a}return i.type==="keypress"?(i=wd(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?s2[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fg,charCode:function(i){return i.type==="keypress"?wd(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?wd(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),u2=kn(l2),c2=Sr({},tp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Gy=kn(c2),h2=Sr({},Xc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fg}),d2=kn(h2),p2=Sr({},Ql,{propertyName:0,elapsedTime:0,pseudoElement:0}),f2=kn(p2),m2=Sr({},tp,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),g2=kn(m2),_2=[9,13,27,32],mg=js&&"CompositionEvent"in window,Sc=null;js&&"documentMode"in document&&(Sc=document.documentMode);var y2=js&&"TextEvent"in window&&!Sc,Lx=js&&(!mg||Sc&&8<Sc&&11>=Sc),Hy=" ",Wy=!1;function Rx(i,a){switch(i){case"keyup":return _2.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fx(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Cl=!1;function v2(i,a){switch(i){case"compositionend":return Fx(a);case"keypress":return a.which!==32?null:(Wy=!0,Hy);case"textInput":return i=a.data,i===Hy&&Wy?null:i;default:return null}}function x2(i,a){if(Cl)return i==="compositionend"||!mg&&Rx(i,a)?(i=Dx(),xd=dg=Ca=null,Cl=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Lx&&a.locale!=="ko"?null:a.data;default:return null}}var w2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Xy(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a==="input"?!!w2[i.type]:a==="textarea"}function Bx(i,a,h,_){fx(_),a=Fd(a,"onChange"),0<a.length&&(h=new pg("onChange","change",null,h,_),i.push({event:h,listeners:a}))}var Tc=null,Fc=null;function b2(i){Wx(i,0)}function rp(i){var a=Al(i);if(ox(a))return i}function S2(i,a){if(i==="change")return a}var Ox=!1;if(js){var jf;if(js){var Vf="oninput"in document;if(!Vf){var Ky=document.createElement("div");Ky.setAttribute("oninput","return;"),Vf=typeof Ky.oninput=="function"}jf=Vf}else jf=!1;Ox=jf&&(!document.documentMode||9<document.documentMode)}function Jy(){Tc&&(Tc.detachEvent("onpropertychange",Nx),Fc=Tc=null)}function Nx(i){if(i.propertyName==="value"&&rp(Fc)){var a=[];Bx(a,Fc,i,og(i)),yx(b2,a)}}function T2(i,a,h){i==="focusin"?(Jy(),Tc=a,Fc=h,Tc.attachEvent("onpropertychange",Nx)):i==="focusout"&&Jy()}function k2(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return rp(Fc)}function I2(i,a){if(i==="click")return rp(a)}function E2(i,a){if(i==="input"||i==="change")return rp(a)}function P2(i,a){return i===a&&(i!==0||1/i===1/a)||i!==i&&a!==a}var es=typeof Object.is=="function"?Object.is:P2;function Bc(i,a){if(es(i,a))return!0;if(typeof i!="object"||i===null||typeof a!="object"||a===null)return!1;var h=Object.keys(i),_=Object.keys(a);if(h.length!==_.length)return!1;for(_=0;_<h.length;_++){var b=h[_];if(!sm.call(a,b)||!es(i[b],a[b]))return!1}return!0}function Yy(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Qy(i,a){var h=Yy(i);i=0;for(var _;h;){if(h.nodeType===3){if(_=i+h.textContent.length,i<=a&&_>=a)return{node:h,offset:a-i};i=_}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=Yy(h)}}function jx(i,a){return i&&a?i===a?!0:i&&i.nodeType===3?!1:a&&a.nodeType===3?jx(i,a.parentNode):"contains"in i?i.contains(a):i.compareDocumentPosition?!!(i.compareDocumentPosition(a)&16):!1:!1}function Vx(){for(var i=window,a=Cd();a instanceof i.HTMLIFrameElement;){try{var h=typeof a.contentWindow.location.href=="string"}catch{h=!1}if(h)i=a.contentWindow;else break;a=Cd(i.document)}return a}function gg(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a&&(a==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||a==="textarea"||i.contentEditable==="true")}function C2(i){var a=Vx(),h=i.focusedElem,_=i.selectionRange;if(a!==h&&h&&h.ownerDocument&&jx(h.ownerDocument.documentElement,h)){if(_!==null&&gg(h)){if(a=_.start,i=_.end,i===void 0&&(i=a),"selectionStart"in h)h.selectionStart=a,h.selectionEnd=Math.min(i,h.value.length);else if(i=(a=h.ownerDocument||document)&&a.defaultView||window,i.getSelection){i=i.getSelection();var b=h.textContent.length,I=Math.min(_.start,b);_=_.end===void 0?I:Math.min(_.end,b),!i.extend&&I>_&&(b=_,_=I,I=b),b=Qy(h,I);var S=Qy(h,_);b&&S&&(i.rangeCount!==1||i.anchorNode!==b.node||i.anchorOffset!==b.offset||i.focusNode!==S.node||i.focusOffset!==S.offset)&&(a=a.createRange(),a.setStart(b.node,b.offset),i.removeAllRanges(),I>_?(i.addRange(a),i.extend(S.node,S.offset)):(a.setEnd(S.node,S.offset),i.addRange(a)))}}for(a=[],i=h;i=i.parentNode;)i.nodeType===1&&a.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<a.length;h++)i=a[h],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var M2=js&&"documentMode"in document&&11>=document.documentMode,Ml=null,Tm=null,kc=null,km=!1;function ev(i,a,h){var _=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;km||Ml==null||Ml!==Cd(_)||(_=Ml,"selectionStart"in _&&gg(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),kc&&Bc(kc,_)||(kc=_,_=Fd(Tm,"onSelect"),0<_.length&&(a=new pg("onSelect","select",null,a,h),i.push({event:a,listeners:_}),a.target=Ml)))}function ld(i,a){var h={};return h[i.toLowerCase()]=a.toLowerCase(),h["Webkit"+i]="webkit"+a,h["Moz"+i]="moz"+a,h}var zl={animationend:ld("Animation","AnimationEnd"),animationiteration:ld("Animation","AnimationIteration"),animationstart:ld("Animation","AnimationStart"),transitionend:ld("Transition","TransitionEnd")},Uf={},Ux={};js&&(Ux=document.createElement("div").style,"AnimationEvent"in window||(delete zl.animationend.animation,delete zl.animationiteration.animation,delete zl.animationstart.animation),"TransitionEvent"in window||delete zl.transitionend.transition);function ip(i){if(Uf[i])return Uf[i];if(!zl[i])return i;var a=zl[i],h;for(h in a)if(a.hasOwnProperty(h)&&h in Ux)return Uf[i]=a[h];return i}var $x=ip("animationend"),Zx=ip("animationiteration"),qx=ip("animationstart"),Gx=ip("transitionend"),Hx=new Map,tv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Va(i,a){Hx.set(i,a),Mo(a,[i])}for(var $f=0;$f<tv.length;$f++){var Zf=tv[$f],z2=Zf.toLowerCase(),A2=Zf[0].toUpperCase()+Zf.slice(1);Va(z2,"on"+A2)}Va($x,"onAnimationEnd");Va(Zx,"onAnimationIteration");Va(qx,"onAnimationStart");Va("dblclick","onDoubleClick");Va("focusin","onFocus");Va("focusout","onBlur");Va(Gx,"onTransitionEnd");ql("onMouseEnter",["mouseout","mouseover"]);ql("onMouseLeave",["mouseout","mouseover"]);ql("onPointerEnter",["pointerout","pointerover"]);ql("onPointerLeave",["pointerout","pointerover"]);Mo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Mo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Mo("onBeforeInput",["compositionend","keypress","textInput","paste"]);Mo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Mo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Mo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),D2=new Set("cancel close invalid load scroll toggle".split(" ").concat(xc));function rv(i,a,h){var _=i.type||"unknown-event";i.currentTarget=h,zb(_,a,void 0,i),i.currentTarget=null}function Wx(i,a){a=(a&4)!==0;for(var h=0;h<i.length;h++){var _=i[h],b=_.event;_=_.listeners;e:{var I=void 0;if(a)for(var S=_.length-1;0<=S;S--){var d=_[S],U=d.instance,ne=d.currentTarget;if(d=d.listener,U!==I&&b.isPropagationStopped())break e;rv(b,d,ne),I=U}else for(S=0;S<_.length;S++){if(d=_[S],U=d.instance,ne=d.currentTarget,d=d.listener,U!==I&&b.isPropagationStopped())break e;rv(b,d,ne),I=U}}}if(zd)throw i=xm,zd=!1,xm=null,i}function dr(i,a){var h=a[Mm];h===void 0&&(h=a[Mm]=new Set);var _=i+"__bubble";h.has(_)||(Xx(a,i,2,!1),h.add(_))}function qf(i,a,h){var _=0;a&&(_|=4),Xx(h,i,_,a)}var ud="_reactListening"+Math.random().toString(36).slice(2);function Oc(i){if(!i[ud]){i[ud]=!0,rx.forEach(function(h){h!=="selectionchange"&&(D2.has(h)||qf(h,!1,i),qf(h,!0,i))});var a=i.nodeType===9?i:i.ownerDocument;a===null||a[ud]||(a[ud]=!0,qf("selectionchange",!1,a))}}function Xx(i,a,h,_){switch(Ax(a)){case 1:var b=Hb;break;case 4:b=Wb;break;default:b=hg}h=b.bind(null,a,h,i),b=void 0,!vm||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(b=!0),_?b!==void 0?i.addEventListener(a,h,{capture:!0,passive:b}):i.addEventListener(a,h,!0):b!==void 0?i.addEventListener(a,h,{passive:b}):i.addEventListener(a,h,!1)}function Gf(i,a,h,_,b){var I=_;if(!(a&1)&&!(a&2)&&_!==null)e:for(;;){if(_===null)return;var S=_.tag;if(S===3||S===4){var d=_.stateNode.containerInfo;if(d===b||d.nodeType===8&&d.parentNode===b)break;if(S===4)for(S=_.return;S!==null;){var U=S.tag;if((U===3||U===4)&&(U=S.stateNode.containerInfo,U===b||U.nodeType===8&&U.parentNode===b))return;S=S.return}for(;d!==null;){if(S=xo(d),S===null)return;if(U=S.tag,U===5||U===6){_=I=S;continue e}d=d.parentNode}}_=_.return}yx(function(){var ne=I,ye=og(h),Q=[];e:{var W=Hx.get(i);if(W!==void 0){var De=pg,Me=i;switch(i){case"keypress":if(wd(h)===0)break e;case"keydown":case"keyup":De=u2;break;case"focusin":Me="focus",De=Nf;break;case"focusout":Me="blur",De=Nf;break;case"beforeblur":case"afterblur":De=Nf;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":De=Zy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":De=Jb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":De=d2;break;case $x:case Zx:case qx:De=e2;break;case Gx:De=f2;break;case"scroll":De=Xb;break;case"wheel":De=g2;break;case"copy":case"cut":case"paste":De=r2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":De=Gy}var Pe=(a&4)!==0,_t=!Pe&&i==="scroll",oe=Pe?W!==null?W+"Capture":null:W;Pe=[];for(var ee=ne,he;ee!==null;){he=ee;var Se=he.stateNode;if(he.tag===5&&Se!==null&&(he=Se,oe!==null&&(Se=Ac(ee,oe),Se!=null&&Pe.push(Nc(ee,Se,he)))),_t)break;ee=ee.return}0<Pe.length&&(W=new De(W,Me,null,h,ye),Q.push({event:W,listeners:Pe}))}}if(!(a&7)){e:{if(W=i==="mouseover"||i==="pointerover",De=i==="mouseout"||i==="pointerout",W&&h!==_m&&(Me=h.relatedTarget||h.fromElement)&&(xo(Me)||Me[Vs]))break e;if((De||W)&&(W=ye.window===ye?ye:(W=ye.ownerDocument)?W.defaultView||W.parentWindow:window,De?(Me=h.relatedTarget||h.toElement,De=ne,Me=Me?xo(Me):null,Me!==null&&(_t=zo(Me),Me!==_t||Me.tag!==5&&Me.tag!==6)&&(Me=null)):(De=null,Me=ne),De!==Me)){if(Pe=Zy,Se="onMouseLeave",oe="onMouseEnter",ee="mouse",(i==="pointerout"||i==="pointerover")&&(Pe=Gy,Se="onPointerLeave",oe="onPointerEnter",ee="pointer"),_t=De==null?W:Al(De),he=Me==null?W:Al(Me),W=new Pe(Se,ee+"leave",De,h,ye),W.target=_t,W.relatedTarget=he,Se=null,xo(ye)===ne&&(Pe=new Pe(oe,ee+"enter",Me,h,ye),Pe.target=he,Pe.relatedTarget=_t,Se=Pe),_t=Se,De&&Me)t:{for(Pe=De,oe=Me,ee=0,he=Pe;he;he=Il(he))ee++;for(he=0,Se=oe;Se;Se=Il(Se))he++;for(;0<ee-he;)Pe=Il(Pe),ee--;for(;0<he-ee;)oe=Il(oe),he--;for(;ee--;){if(Pe===oe||oe!==null&&Pe===oe.alternate)break t;Pe=Il(Pe),oe=Il(oe)}Pe=null}else Pe=null;De!==null&&iv(Q,W,De,Pe,!1),Me!==null&&_t!==null&&iv(Q,_t,Me,Pe,!0)}}e:{if(W=ne?Al(ne):window,De=W.nodeName&&W.nodeName.toLowerCase(),De==="select"||De==="input"&&W.type==="file")var Ue=S2;else if(Xy(W))if(Ox)Ue=E2;else{Ue=k2;var Xe=T2}else(De=W.nodeName)&&De.toLowerCase()==="input"&&(W.type==="checkbox"||W.type==="radio")&&(Ue=I2);if(Ue&&(Ue=Ue(i,ne))){Bx(Q,Ue,h,ye);break e}Xe&&Xe(i,W,ne),i==="focusout"&&(Xe=W._wrapperState)&&Xe.controlled&&W.type==="number"&&dm(W,"number",W.value)}switch(Xe=ne?Al(ne):window,i){case"focusin":(Xy(Xe)||Xe.contentEditable==="true")&&(Ml=Xe,Tm=ne,kc=null);break;case"focusout":kc=Tm=Ml=null;break;case"mousedown":km=!0;break;case"contextmenu":case"mouseup":case"dragend":km=!1,ev(Q,h,ye);break;case"selectionchange":if(M2)break;case"keydown":case"keyup":ev(Q,h,ye)}var Ge;if(mg)e:{switch(i){case"compositionstart":var it="onCompositionStart";break e;case"compositionend":it="onCompositionEnd";break e;case"compositionupdate":it="onCompositionUpdate";break e}it=void 0}else Cl?Rx(i,h)&&(it="onCompositionEnd"):i==="keydown"&&h.keyCode===229&&(it="onCompositionStart");it&&(Lx&&h.locale!=="ko"&&(Cl||it!=="onCompositionStart"?it==="onCompositionEnd"&&Cl&&(Ge=Dx()):(Ca=ye,dg="value"in Ca?Ca.value:Ca.textContent,Cl=!0)),Xe=Fd(ne,it),0<Xe.length&&(it=new qy(it,i,null,h,ye),Q.push({event:it,listeners:Xe}),Ge?it.data=Ge:(Ge=Fx(h),Ge!==null&&(it.data=Ge)))),(Ge=y2?v2(i,h):x2(i,h))&&(ne=Fd(ne,"onBeforeInput"),0<ne.length&&(ye=new qy("onBeforeInput","beforeinput",null,h,ye),Q.push({event:ye,listeners:ne}),ye.data=Ge))}Wx(Q,a)})}function Nc(i,a,h){return{instance:i,listener:a,currentTarget:h}}function Fd(i,a){for(var h=a+"Capture",_=[];i!==null;){var b=i,I=b.stateNode;b.tag===5&&I!==null&&(b=I,I=Ac(i,h),I!=null&&_.unshift(Nc(i,I,b)),I=Ac(i,a),I!=null&&_.push(Nc(i,I,b))),i=i.return}return _}function Il(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function iv(i,a,h,_,b){for(var I=a._reactName,S=[];h!==null&&h!==_;){var d=h,U=d.alternate,ne=d.stateNode;if(U!==null&&U===_)break;d.tag===5&&ne!==null&&(d=ne,b?(U=Ac(h,I),U!=null&&S.unshift(Nc(h,U,d))):b||(U=Ac(h,I),U!=null&&S.push(Nc(h,U,d)))),h=h.return}S.length!==0&&i.push({event:a,listeners:S})}var L2=/\r\n?/g,R2=/\u0000|\uFFFD/g;function nv(i){return(typeof i=="string"?i:""+i).replace(L2,`
`).replace(R2,"")}function cd(i,a,h){if(a=nv(a),nv(i)!==a&&h)throw Error(Ce(425))}function Bd(){}var Im=null,Em=null;function Pm(i,a){return i==="textarea"||i==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Cm=typeof setTimeout=="function"?setTimeout:void 0,F2=typeof clearTimeout=="function"?clearTimeout:void 0,sv=typeof Promise=="function"?Promise:void 0,B2=typeof queueMicrotask=="function"?queueMicrotask:typeof sv<"u"?function(i){return sv.resolve(null).then(i).catch(O2)}:Cm;function O2(i){setTimeout(function(){throw i})}function Hf(i,a){var h=a,_=0;do{var b=h.nextSibling;if(i.removeChild(h),b&&b.nodeType===8)if(h=b.data,h==="/$"){if(_===0){i.removeChild(b),Rc(a);return}_--}else h!=="$"&&h!=="$?"&&h!=="$!"||_++;h=b}while(h);Rc(a)}function La(i){for(;i!=null;i=i.nextSibling){var a=i.nodeType;if(a===1||a===3)break;if(a===8){if(a=i.data,a==="$"||a==="$!"||a==="$?")break;if(a==="/$")return null}}return i}function av(i){i=i.previousSibling;for(var a=0;i;){if(i.nodeType===8){var h=i.data;if(h==="$"||h==="$!"||h==="$?"){if(a===0)return i;a--}else h==="/$"&&a++}i=i.previousSibling}return null}var eu=Math.random().toString(36).slice(2),ds="__reactFiber$"+eu,jc="__reactProps$"+eu,Vs="__reactContainer$"+eu,Mm="__reactEvents$"+eu,N2="__reactListeners$"+eu,j2="__reactHandles$"+eu;function xo(i){var a=i[ds];if(a)return a;for(var h=i.parentNode;h;){if(a=h[Vs]||h[ds]){if(h=a.alternate,a.child!==null||h!==null&&h.child!==null)for(i=av(i);i!==null;){if(h=i[ds])return h;i=av(i)}return a}i=h,h=i.parentNode}return null}function Kc(i){return i=i[ds]||i[Vs],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Al(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(Ce(33))}function np(i){return i[jc]||null}var zm=[],Dl=-1;function Ua(i){return{current:i}}function pr(i){0>Dl||(i.current=zm[Dl],zm[Dl]=null,Dl--)}function lr(i,a){Dl++,zm[Dl]=i.current,i.current=a}var ja={},Ci=Ua(ja),rn=Ua(!1),ko=ja;function Gl(i,a){var h=i.type.contextTypes;if(!h)return ja;var _=i.stateNode;if(_&&_.__reactInternalMemoizedUnmaskedChildContext===a)return _.__reactInternalMemoizedMaskedChildContext;var b={},I;for(I in h)b[I]=a[I];return _&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=a,i.__reactInternalMemoizedMaskedChildContext=b),b}function nn(i){return i=i.childContextTypes,i!=null}function Od(){pr(rn),pr(Ci)}function ov(i,a,h){if(Ci.current!==ja)throw Error(Ce(168));lr(Ci,a),lr(rn,h)}function Kx(i,a,h){var _=i.stateNode;if(a=a.childContextTypes,typeof _.getChildContext!="function")return h;_=_.getChildContext();for(var b in _)if(!(b in a))throw Error(Ce(108,Tb(i)||"Unknown",b));return Sr({},h,_)}function Nd(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||ja,ko=Ci.current,lr(Ci,i),lr(rn,rn.current),!0}function lv(i,a,h){var _=i.stateNode;if(!_)throw Error(Ce(169));h?(i=Kx(i,a,ko),_.__reactInternalMemoizedMergedChildContext=i,pr(rn),pr(Ci),lr(Ci,i)):pr(rn),lr(rn,h)}var Fs=null,sp=!1,Wf=!1;function Jx(i){Fs===null?Fs=[i]:Fs.push(i)}function V2(i){sp=!0,Jx(i)}function $a(){if(!Wf&&Fs!==null){Wf=!0;var i=0,a=Yt;try{var h=Fs;for(Yt=1;i<h.length;i++){var _=h[i];do _=_(!0);while(_!==null)}Fs=null,sp=!1}catch(b){throw Fs!==null&&(Fs=Fs.slice(i+1)),bx(lg,$a),b}finally{Yt=a,Wf=!1}}return null}var Ll=[],Rl=0,jd=null,Vd=0,Ln=[],Rn=0,Io=null,Bs=1,Os="";function yo(i,a){Ll[Rl++]=Vd,Ll[Rl++]=jd,jd=i,Vd=a}function Yx(i,a,h){Ln[Rn++]=Bs,Ln[Rn++]=Os,Ln[Rn++]=Io,Io=i;var _=Bs;i=Os;var b=32-Yn(_)-1;_&=~(1<<b),h+=1;var I=32-Yn(a)+b;if(30<I){var S=b-b%5;I=(_&(1<<S)-1).toString(32),_>>=S,b-=S,Bs=1<<32-Yn(a)+b|h<<b|_,Os=I+i}else Bs=1<<I|h<<b|_,Os=i}function _g(i){i.return!==null&&(yo(i,1),Yx(i,1,0))}function yg(i){for(;i===jd;)jd=Ll[--Rl],Ll[Rl]=null,Vd=Ll[--Rl],Ll[Rl]=null;for(;i===Io;)Io=Ln[--Rn],Ln[Rn]=null,Os=Ln[--Rn],Ln[Rn]=null,Bs=Ln[--Rn],Ln[Rn]=null}var bn=null,wn=null,_r=!1,Jn=null;function Qx(i,a){var h=Fn(5,null,null,0);h.elementType="DELETED",h.stateNode=a,h.return=i,a=i.deletions,a===null?(i.deletions=[h],i.flags|=16):a.push(h)}function uv(i,a){switch(i.tag){case 5:var h=i.type;return a=a.nodeType!==1||h.toLowerCase()!==a.nodeName.toLowerCase()?null:a,a!==null?(i.stateNode=a,bn=i,wn=La(a.firstChild),!0):!1;case 6:return a=i.pendingProps===""||a.nodeType!==3?null:a,a!==null?(i.stateNode=a,bn=i,wn=null,!0):!1;case 13:return a=a.nodeType!==8?null:a,a!==null?(h=Io!==null?{id:Bs,overflow:Os}:null,i.memoizedState={dehydrated:a,treeContext:h,retryLane:1073741824},h=Fn(18,null,null,0),h.stateNode=a,h.return=i,i.child=h,bn=i,wn=null,!0):!1;default:return!1}}function Am(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Dm(i){if(_r){var a=wn;if(a){var h=a;if(!uv(i,a)){if(Am(i))throw Error(Ce(418));a=La(h.nextSibling);var _=bn;a&&uv(i,a)?Qx(_,h):(i.flags=i.flags&-4097|2,_r=!1,bn=i)}}else{if(Am(i))throw Error(Ce(418));i.flags=i.flags&-4097|2,_r=!1,bn=i}}}function cv(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;bn=i}function hd(i){if(i!==bn)return!1;if(!_r)return cv(i),_r=!0,!1;var a;if((a=i.tag!==3)&&!(a=i.tag!==5)&&(a=i.type,a=a!=="head"&&a!=="body"&&!Pm(i.type,i.memoizedProps)),a&&(a=wn)){if(Am(i))throw e0(),Error(Ce(418));for(;a;)Qx(i,a),a=La(a.nextSibling)}if(cv(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Ce(317));e:{for(i=i.nextSibling,a=0;i;){if(i.nodeType===8){var h=i.data;if(h==="/$"){if(a===0){wn=La(i.nextSibling);break e}a--}else h!=="$"&&h!=="$!"&&h!=="$?"||a++}i=i.nextSibling}wn=null}}else wn=bn?La(i.stateNode.nextSibling):null;return!0}function e0(){for(var i=wn;i;)i=La(i.nextSibling)}function Hl(){wn=bn=null,_r=!1}function vg(i){Jn===null?Jn=[i]:Jn.push(i)}var U2=Zs.ReactCurrentBatchConfig;function fc(i,a,h){if(i=h.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(Ce(309));var _=h.stateNode}if(!_)throw Error(Ce(147,i));var b=_,I=""+i;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===I?a.ref:(a=function(S){var d=b.refs;S===null?delete d[I]:d[I]=S},a._stringRef=I,a)}if(typeof i!="string")throw Error(Ce(284));if(!h._owner)throw Error(Ce(290,i))}return i}function dd(i,a){throw i=Object.prototype.toString.call(a),Error(Ce(31,i==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":i))}function hv(i){var a=i._init;return a(i._payload)}function t0(i){function a(oe,ee){if(i){var he=oe.deletions;he===null?(oe.deletions=[ee],oe.flags|=16):he.push(ee)}}function h(oe,ee){if(!i)return null;for(;ee!==null;)a(oe,ee),ee=ee.sibling;return null}function _(oe,ee){for(oe=new Map;ee!==null;)ee.key!==null?oe.set(ee.key,ee):oe.set(ee.index,ee),ee=ee.sibling;return oe}function b(oe,ee){return oe=Oa(oe,ee),oe.index=0,oe.sibling=null,oe}function I(oe,ee,he){return oe.index=he,i?(he=oe.alternate,he!==null?(he=he.index,he<ee?(oe.flags|=2,ee):he):(oe.flags|=2,ee)):(oe.flags|=1048576,ee)}function S(oe){return i&&oe.alternate===null&&(oe.flags|=2),oe}function d(oe,ee,he,Se){return ee===null||ee.tag!==6?(ee=tm(he,oe.mode,Se),ee.return=oe,ee):(ee=b(ee,he),ee.return=oe,ee)}function U(oe,ee,he,Se){var Ue=he.type;return Ue===Pl?ye(oe,ee,he.props.children,Se,he.key):ee!==null&&(ee.elementType===Ue||typeof Ue=="object"&&Ue!==null&&Ue.$$typeof===ka&&hv(Ue)===ee.type)?(Se=b(ee,he.props),Se.ref=fc(oe,ee,he),Se.return=oe,Se):(Se=Pd(he.type,he.key,he.props,null,oe.mode,Se),Se.ref=fc(oe,ee,he),Se.return=oe,Se)}function ne(oe,ee,he,Se){return ee===null||ee.tag!==4||ee.stateNode.containerInfo!==he.containerInfo||ee.stateNode.implementation!==he.implementation?(ee=rm(he,oe.mode,Se),ee.return=oe,ee):(ee=b(ee,he.children||[]),ee.return=oe,ee)}function ye(oe,ee,he,Se,Ue){return ee===null||ee.tag!==7?(ee=To(he,oe.mode,Se,Ue),ee.return=oe,ee):(ee=b(ee,he),ee.return=oe,ee)}function Q(oe,ee,he){if(typeof ee=="string"&&ee!==""||typeof ee=="number")return ee=tm(""+ee,oe.mode,he),ee.return=oe,ee;if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case td:return he=Pd(ee.type,ee.key,ee.props,null,oe.mode,he),he.ref=fc(oe,null,ee),he.return=oe,he;case El:return ee=rm(ee,oe.mode,he),ee.return=oe,ee;case ka:var Se=ee._init;return Q(oe,Se(ee._payload),he)}if(yc(ee)||uc(ee))return ee=To(ee,oe.mode,he,null),ee.return=oe,ee;dd(oe,ee)}return null}function W(oe,ee,he,Se){var Ue=ee!==null?ee.key:null;if(typeof he=="string"&&he!==""||typeof he=="number")return Ue!==null?null:d(oe,ee,""+he,Se);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case td:return he.key===Ue?U(oe,ee,he,Se):null;case El:return he.key===Ue?ne(oe,ee,he,Se):null;case ka:return Ue=he._init,W(oe,ee,Ue(he._payload),Se)}if(yc(he)||uc(he))return Ue!==null?null:ye(oe,ee,he,Se,null);dd(oe,he)}return null}function De(oe,ee,he,Se,Ue){if(typeof Se=="string"&&Se!==""||typeof Se=="number")return oe=oe.get(he)||null,d(ee,oe,""+Se,Ue);if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case td:return oe=oe.get(Se.key===null?he:Se.key)||null,U(ee,oe,Se,Ue);case El:return oe=oe.get(Se.key===null?he:Se.key)||null,ne(ee,oe,Se,Ue);case ka:var Xe=Se._init;return De(oe,ee,he,Xe(Se._payload),Ue)}if(yc(Se)||uc(Se))return oe=oe.get(he)||null,ye(ee,oe,Se,Ue,null);dd(ee,Se)}return null}function Me(oe,ee,he,Se){for(var Ue=null,Xe=null,Ge=ee,it=ee=0,Rt=null;Ge!==null&&it<he.length;it++){Ge.index>it?(Rt=Ge,Ge=null):Rt=Ge.sibling;var vt=W(oe,Ge,he[it],Se);if(vt===null){Ge===null&&(Ge=Rt);break}i&&Ge&&vt.alternate===null&&a(oe,Ge),ee=I(vt,ee,it),Xe===null?Ue=vt:Xe.sibling=vt,Xe=vt,Ge=Rt}if(it===he.length)return h(oe,Ge),_r&&yo(oe,it),Ue;if(Ge===null){for(;it<he.length;it++)Ge=Q(oe,he[it],Se),Ge!==null&&(ee=I(Ge,ee,it),Xe===null?Ue=Ge:Xe.sibling=Ge,Xe=Ge);return _r&&yo(oe,it),Ue}for(Ge=_(oe,Ge);it<he.length;it++)Rt=De(Ge,oe,it,he[it],Se),Rt!==null&&(i&&Rt.alternate!==null&&Ge.delete(Rt.key===null?it:Rt.key),ee=I(Rt,ee,it),Xe===null?Ue=Rt:Xe.sibling=Rt,Xe=Rt);return i&&Ge.forEach(function(wt){return a(oe,wt)}),_r&&yo(oe,it),Ue}function Pe(oe,ee,he,Se){var Ue=uc(he);if(typeof Ue!="function")throw Error(Ce(150));if(he=Ue.call(he),he==null)throw Error(Ce(151));for(var Xe=Ue=null,Ge=ee,it=ee=0,Rt=null,vt=he.next();Ge!==null&&!vt.done;it++,vt=he.next()){Ge.index>it?(Rt=Ge,Ge=null):Rt=Ge.sibling;var wt=W(oe,Ge,vt.value,Se);if(wt===null){Ge===null&&(Ge=Rt);break}i&&Ge&&wt.alternate===null&&a(oe,Ge),ee=I(wt,ee,it),Xe===null?Ue=wt:Xe.sibling=wt,Xe=wt,Ge=Rt}if(vt.done)return h(oe,Ge),_r&&yo(oe,it),Ue;if(Ge===null){for(;!vt.done;it++,vt=he.next())vt=Q(oe,vt.value,Se),vt!==null&&(ee=I(vt,ee,it),Xe===null?Ue=vt:Xe.sibling=vt,Xe=vt);return _r&&yo(oe,it),Ue}for(Ge=_(oe,Ge);!vt.done;it++,vt=he.next())vt=De(Ge,oe,it,vt.value,Se),vt!==null&&(i&&vt.alternate!==null&&Ge.delete(vt.key===null?it:vt.key),ee=I(vt,ee,it),Xe===null?Ue=vt:Xe.sibling=vt,Xe=vt);return i&&Ge.forEach(function(Mi){return a(oe,Mi)}),_r&&yo(oe,it),Ue}function _t(oe,ee,he,Se){if(typeof he=="object"&&he!==null&&he.type===Pl&&he.key===null&&(he=he.props.children),typeof he=="object"&&he!==null){switch(he.$$typeof){case td:e:{for(var Ue=he.key,Xe=ee;Xe!==null;){if(Xe.key===Ue){if(Ue=he.type,Ue===Pl){if(Xe.tag===7){h(oe,Xe.sibling),ee=b(Xe,he.props.children),ee.return=oe,oe=ee;break e}}else if(Xe.elementType===Ue||typeof Ue=="object"&&Ue!==null&&Ue.$$typeof===ka&&hv(Ue)===Xe.type){h(oe,Xe.sibling),ee=b(Xe,he.props),ee.ref=fc(oe,Xe,he),ee.return=oe,oe=ee;break e}h(oe,Xe);break}else a(oe,Xe);Xe=Xe.sibling}he.type===Pl?(ee=To(he.props.children,oe.mode,Se,he.key),ee.return=oe,oe=ee):(Se=Pd(he.type,he.key,he.props,null,oe.mode,Se),Se.ref=fc(oe,ee,he),Se.return=oe,oe=Se)}return S(oe);case El:e:{for(Xe=he.key;ee!==null;){if(ee.key===Xe)if(ee.tag===4&&ee.stateNode.containerInfo===he.containerInfo&&ee.stateNode.implementation===he.implementation){h(oe,ee.sibling),ee=b(ee,he.children||[]),ee.return=oe,oe=ee;break e}else{h(oe,ee);break}else a(oe,ee);ee=ee.sibling}ee=rm(he,oe.mode,Se),ee.return=oe,oe=ee}return S(oe);case ka:return Xe=he._init,_t(oe,ee,Xe(he._payload),Se)}if(yc(he))return Me(oe,ee,he,Se);if(uc(he))return Pe(oe,ee,he,Se);dd(oe,he)}return typeof he=="string"&&he!==""||typeof he=="number"?(he=""+he,ee!==null&&ee.tag===6?(h(oe,ee.sibling),ee=b(ee,he),ee.return=oe,oe=ee):(h(oe,ee),ee=tm(he,oe.mode,Se),ee.return=oe,oe=ee),S(oe)):h(oe,ee)}return _t}var Wl=t0(!0),r0=t0(!1),Ud=Ua(null),$d=null,Fl=null,xg=null;function wg(){xg=Fl=$d=null}function bg(i){var a=Ud.current;pr(Ud),i._currentValue=a}function Lm(i,a,h){for(;i!==null;){var _=i.alternate;if((i.childLanes&a)!==a?(i.childLanes|=a,_!==null&&(_.childLanes|=a)):_!==null&&(_.childLanes&a)!==a&&(_.childLanes|=a),i===h)break;i=i.return}}function $l(i,a){$d=i,xg=Fl=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&a&&(tn=!0),i.firstContext=null)}function On(i){var a=i._currentValue;if(xg!==i)if(i={context:i,memoizedValue:a,next:null},Fl===null){if($d===null)throw Error(Ce(308));Fl=i,$d.dependencies={lanes:0,firstContext:i}}else Fl=Fl.next=i;return a}var wo=null;function Sg(i){wo===null?wo=[i]:wo.push(i)}function i0(i,a,h,_){var b=a.interleaved;return b===null?(h.next=h,Sg(a)):(h.next=b.next,b.next=h),a.interleaved=h,Us(i,_)}function Us(i,a){i.lanes|=a;var h=i.alternate;for(h!==null&&(h.lanes|=a),h=i,i=i.return;i!==null;)i.childLanes|=a,h=i.alternate,h!==null&&(h.childLanes|=a),h=i,i=i.return;return h.tag===3?h.stateNode:null}var Ia=!1;function Tg(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function n0(i,a){i=i.updateQueue,a.updateQueue===i&&(a.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Ns(i,a){return{eventTime:i,lane:a,tag:0,payload:null,callback:null,next:null}}function Ra(i,a,h){var _=i.updateQueue;if(_===null)return null;if(_=_.shared,$t&2){var b=_.pending;return b===null?a.next=a:(a.next=b.next,b.next=a),_.pending=a,Us(i,h)}return b=_.interleaved,b===null?(a.next=a,Sg(_)):(a.next=b.next,b.next=a),_.interleaved=a,Us(i,h)}function bd(i,a,h){if(a=a.updateQueue,a!==null&&(a=a.shared,(h&4194240)!==0)){var _=a.lanes;_&=i.pendingLanes,h|=_,a.lanes=h,ug(i,h)}}function dv(i,a){var h=i.updateQueue,_=i.alternate;if(_!==null&&(_=_.updateQueue,h===_)){var b=null,I=null;if(h=h.firstBaseUpdate,h!==null){do{var S={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};I===null?b=I=S:I=I.next=S,h=h.next}while(h!==null);I===null?b=I=a:I=I.next=a}else b=I=a;h={baseState:_.baseState,firstBaseUpdate:b,lastBaseUpdate:I,shared:_.shared,effects:_.effects},i.updateQueue=h;return}i=h.lastBaseUpdate,i===null?h.firstBaseUpdate=a:i.next=a,h.lastBaseUpdate=a}function Zd(i,a,h,_){var b=i.updateQueue;Ia=!1;var I=b.firstBaseUpdate,S=b.lastBaseUpdate,d=b.shared.pending;if(d!==null){b.shared.pending=null;var U=d,ne=U.next;U.next=null,S===null?I=ne:S.next=ne,S=U;var ye=i.alternate;ye!==null&&(ye=ye.updateQueue,d=ye.lastBaseUpdate,d!==S&&(d===null?ye.firstBaseUpdate=ne:d.next=ne,ye.lastBaseUpdate=U))}if(I!==null){var Q=b.baseState;S=0,ye=ne=U=null,d=I;do{var W=d.lane,De=d.eventTime;if((_&W)===W){ye!==null&&(ye=ye.next={eventTime:De,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var Me=i,Pe=d;switch(W=a,De=h,Pe.tag){case 1:if(Me=Pe.payload,typeof Me=="function"){Q=Me.call(De,Q,W);break e}Q=Me;break e;case 3:Me.flags=Me.flags&-65537|128;case 0:if(Me=Pe.payload,W=typeof Me=="function"?Me.call(De,Q,W):Me,W==null)break e;Q=Sr({},Q,W);break e;case 2:Ia=!0}}d.callback!==null&&d.lane!==0&&(i.flags|=64,W=b.effects,W===null?b.effects=[d]:W.push(d))}else De={eventTime:De,lane:W,tag:d.tag,payload:d.payload,callback:d.callback,next:null},ye===null?(ne=ye=De,U=Q):ye=ye.next=De,S|=W;if(d=d.next,d===null){if(d=b.shared.pending,d===null)break;W=d,d=W.next,W.next=null,b.lastBaseUpdate=W,b.shared.pending=null}}while(!0);if(ye===null&&(U=Q),b.baseState=U,b.firstBaseUpdate=ne,b.lastBaseUpdate=ye,a=b.shared.interleaved,a!==null){b=a;do S|=b.lane,b=b.next;while(b!==a)}else I===null&&(b.shared.lanes=0);Po|=S,i.lanes=S,i.memoizedState=Q}}function pv(i,a,h){if(i=a.effects,a.effects=null,i!==null)for(a=0;a<i.length;a++){var _=i[a],b=_.callback;if(b!==null){if(_.callback=null,_=h,typeof b!="function")throw Error(Ce(191,b));b.call(_)}}}var Jc={},fs=Ua(Jc),Vc=Ua(Jc),Uc=Ua(Jc);function bo(i){if(i===Jc)throw Error(Ce(174));return i}function kg(i,a){switch(lr(Uc,a),lr(Vc,i),lr(fs,Jc),i=a.nodeType,i){case 9:case 11:a=(a=a.documentElement)?a.namespaceURI:fm(null,"");break;default:i=i===8?a.parentNode:a,a=i.namespaceURI||null,i=i.tagName,a=fm(a,i)}pr(fs),lr(fs,a)}function Xl(){pr(fs),pr(Vc),pr(Uc)}function s0(i){bo(Uc.current);var a=bo(fs.current),h=fm(a,i.type);a!==h&&(lr(Vc,i),lr(fs,h))}function Ig(i){Vc.current===i&&(pr(fs),pr(Vc))}var wr=Ua(0);function qd(i){for(var a=i;a!==null;){if(a.tag===13){var h=a.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if(a.flags&128)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var Xf=[];function Eg(){for(var i=0;i<Xf.length;i++)Xf[i]._workInProgressVersionPrimary=null;Xf.length=0}var Sd=Zs.ReactCurrentDispatcher,Kf=Zs.ReactCurrentBatchConfig,Eo=0,br=null,Zr=null,ii=null,Gd=!1,Ic=!1,$c=0,$2=0;function Ii(){throw Error(Ce(321))}function Pg(i,a){if(a===null)return!1;for(var h=0;h<a.length&&h<i.length;h++)if(!es(i[h],a[h]))return!1;return!0}function Cg(i,a,h,_,b,I){if(Eo=I,br=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Sd.current=i===null||i.memoizedState===null?H2:W2,i=h(_,b),Ic){I=0;do{if(Ic=!1,$c=0,25<=I)throw Error(Ce(301));I+=1,ii=Zr=null,a.updateQueue=null,Sd.current=X2,i=h(_,b)}while(Ic)}if(Sd.current=Hd,a=Zr!==null&&Zr.next!==null,Eo=0,ii=Zr=br=null,Gd=!1,a)throw Error(Ce(300));return i}function Mg(){var i=$c!==0;return $c=0,i}function hs(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ii===null?br.memoizedState=ii=i:ii=ii.next=i,ii}function Nn(){if(Zr===null){var i=br.alternate;i=i!==null?i.memoizedState:null}else i=Zr.next;var a=ii===null?br.memoizedState:ii.next;if(a!==null)ii=a,Zr=i;else{if(i===null)throw Error(Ce(310));Zr=i,i={memoizedState:Zr.memoizedState,baseState:Zr.baseState,baseQueue:Zr.baseQueue,queue:Zr.queue,next:null},ii===null?br.memoizedState=ii=i:ii=ii.next=i}return ii}function Zc(i,a){return typeof a=="function"?a(i):a}function Jf(i){var a=Nn(),h=a.queue;if(h===null)throw Error(Ce(311));h.lastRenderedReducer=i;var _=Zr,b=_.baseQueue,I=h.pending;if(I!==null){if(b!==null){var S=b.next;b.next=I.next,I.next=S}_.baseQueue=b=I,h.pending=null}if(b!==null){I=b.next,_=_.baseState;var d=S=null,U=null,ne=I;do{var ye=ne.lane;if((Eo&ye)===ye)U!==null&&(U=U.next={lane:0,action:ne.action,hasEagerState:ne.hasEagerState,eagerState:ne.eagerState,next:null}),_=ne.hasEagerState?ne.eagerState:i(_,ne.action);else{var Q={lane:ye,action:ne.action,hasEagerState:ne.hasEagerState,eagerState:ne.eagerState,next:null};U===null?(d=U=Q,S=_):U=U.next=Q,br.lanes|=ye,Po|=ye}ne=ne.next}while(ne!==null&&ne!==I);U===null?S=_:U.next=d,es(_,a.memoizedState)||(tn=!0),a.memoizedState=_,a.baseState=S,a.baseQueue=U,h.lastRenderedState=_}if(i=h.interleaved,i!==null){b=i;do I=b.lane,br.lanes|=I,Po|=I,b=b.next;while(b!==i)}else b===null&&(h.lanes=0);return[a.memoizedState,h.dispatch]}function Yf(i){var a=Nn(),h=a.queue;if(h===null)throw Error(Ce(311));h.lastRenderedReducer=i;var _=h.dispatch,b=h.pending,I=a.memoizedState;if(b!==null){h.pending=null;var S=b=b.next;do I=i(I,S.action),S=S.next;while(S!==b);es(I,a.memoizedState)||(tn=!0),a.memoizedState=I,a.baseQueue===null&&(a.baseState=I),h.lastRenderedState=I}return[I,_]}function a0(){}function o0(i,a){var h=br,_=Nn(),b=a(),I=!es(_.memoizedState,b);if(I&&(_.memoizedState=b,tn=!0),_=_.queue,zg(c0.bind(null,h,_,i),[i]),_.getSnapshot!==a||I||ii!==null&&ii.memoizedState.tag&1){if(h.flags|=2048,qc(9,u0.bind(null,h,_,b,a),void 0,null),ni===null)throw Error(Ce(349));Eo&30||l0(h,a,b)}return b}function l0(i,a,h){i.flags|=16384,i={getSnapshot:a,value:h},a=br.updateQueue,a===null?(a={lastEffect:null,stores:null},br.updateQueue=a,a.stores=[i]):(h=a.stores,h===null?a.stores=[i]:h.push(i))}function u0(i,a,h,_){a.value=h,a.getSnapshot=_,h0(a)&&d0(i)}function c0(i,a,h){return h(function(){h0(a)&&d0(i)})}function h0(i){var a=i.getSnapshot;i=i.value;try{var h=a();return!es(i,h)}catch{return!0}}function d0(i){var a=Us(i,1);a!==null&&Qn(a,i,1,-1)}function fv(i){var a=hs();return typeof i=="function"&&(i=i()),a.memoizedState=a.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Zc,lastRenderedState:i},a.queue=i,i=i.dispatch=G2.bind(null,br,i),[a.memoizedState,i]}function qc(i,a,h,_){return i={tag:i,create:a,destroy:h,deps:_,next:null},a=br.updateQueue,a===null?(a={lastEffect:null,stores:null},br.updateQueue=a,a.lastEffect=i.next=i):(h=a.lastEffect,h===null?a.lastEffect=i.next=i:(_=h.next,h.next=i,i.next=_,a.lastEffect=i)),i}function p0(){return Nn().memoizedState}function Td(i,a,h,_){var b=hs();br.flags|=i,b.memoizedState=qc(1|a,h,void 0,_===void 0?null:_)}function ap(i,a,h,_){var b=Nn();_=_===void 0?null:_;var I=void 0;if(Zr!==null){var S=Zr.memoizedState;if(I=S.destroy,_!==null&&Pg(_,S.deps)){b.memoizedState=qc(a,h,I,_);return}}br.flags|=i,b.memoizedState=qc(1|a,h,I,_)}function mv(i,a){return Td(8390656,8,i,a)}function zg(i,a){return ap(2048,8,i,a)}function f0(i,a){return ap(4,2,i,a)}function m0(i,a){return ap(4,4,i,a)}function g0(i,a){if(typeof a=="function")return i=i(),a(i),function(){a(null)};if(a!=null)return i=i(),a.current=i,function(){a.current=null}}function _0(i,a,h){return h=h!=null?h.concat([i]):null,ap(4,4,g0.bind(null,a,i),h)}function Ag(){}function y0(i,a){var h=Nn();a=a===void 0?null:a;var _=h.memoizedState;return _!==null&&a!==null&&Pg(a,_[1])?_[0]:(h.memoizedState=[i,a],i)}function v0(i,a){var h=Nn();a=a===void 0?null:a;var _=h.memoizedState;return _!==null&&a!==null&&Pg(a,_[1])?_[0]:(i=i(),h.memoizedState=[i,a],i)}function x0(i,a,h){return Eo&21?(es(h,a)||(h=kx(),br.lanes|=h,Po|=h,i.baseState=!0),a):(i.baseState&&(i.baseState=!1,tn=!0),i.memoizedState=h)}function Z2(i,a){var h=Yt;Yt=h!==0&&4>h?h:4,i(!0);var _=Kf.transition;Kf.transition={};try{i(!1),a()}finally{Yt=h,Kf.transition=_}}function w0(){return Nn().memoizedState}function q2(i,a,h){var _=Ba(i);if(h={lane:_,action:h,hasEagerState:!1,eagerState:null,next:null},b0(i))S0(a,h);else if(h=i0(i,a,h,_),h!==null){var b=Ui();Qn(h,i,_,b),T0(h,a,_)}}function G2(i,a,h){var _=Ba(i),b={lane:_,action:h,hasEagerState:!1,eagerState:null,next:null};if(b0(i))S0(a,b);else{var I=i.alternate;if(i.lanes===0&&(I===null||I.lanes===0)&&(I=a.lastRenderedReducer,I!==null))try{var S=a.lastRenderedState,d=I(S,h);if(b.hasEagerState=!0,b.eagerState=d,es(d,S)){var U=a.interleaved;U===null?(b.next=b,Sg(a)):(b.next=U.next,U.next=b),a.interleaved=b;return}}catch{}finally{}h=i0(i,a,b,_),h!==null&&(b=Ui(),Qn(h,i,_,b),T0(h,a,_))}}function b0(i){var a=i.alternate;return i===br||a!==null&&a===br}function S0(i,a){Ic=Gd=!0;var h=i.pending;h===null?a.next=a:(a.next=h.next,h.next=a),i.pending=a}function T0(i,a,h){if(h&4194240){var _=a.lanes;_&=i.pendingLanes,h|=_,a.lanes=h,ug(i,h)}}var Hd={readContext:On,useCallback:Ii,useContext:Ii,useEffect:Ii,useImperativeHandle:Ii,useInsertionEffect:Ii,useLayoutEffect:Ii,useMemo:Ii,useReducer:Ii,useRef:Ii,useState:Ii,useDebugValue:Ii,useDeferredValue:Ii,useTransition:Ii,useMutableSource:Ii,useSyncExternalStore:Ii,useId:Ii,unstable_isNewReconciler:!1},H2={readContext:On,useCallback:function(i,a){return hs().memoizedState=[i,a===void 0?null:a],i},useContext:On,useEffect:mv,useImperativeHandle:function(i,a,h){return h=h!=null?h.concat([i]):null,Td(4194308,4,g0.bind(null,a,i),h)},useLayoutEffect:function(i,a){return Td(4194308,4,i,a)},useInsertionEffect:function(i,a){return Td(4,2,i,a)},useMemo:function(i,a){var h=hs();return a=a===void 0?null:a,i=i(),h.memoizedState=[i,a],i},useReducer:function(i,a,h){var _=hs();return a=h!==void 0?h(a):a,_.memoizedState=_.baseState=a,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:a},_.queue=i,i=i.dispatch=q2.bind(null,br,i),[_.memoizedState,i]},useRef:function(i){var a=hs();return i={current:i},a.memoizedState=i},useState:fv,useDebugValue:Ag,useDeferredValue:function(i){return hs().memoizedState=i},useTransition:function(){var i=fv(!1),a=i[0];return i=Z2.bind(null,i[1]),hs().memoizedState=i,[a,i]},useMutableSource:function(){},useSyncExternalStore:function(i,a,h){var _=br,b=hs();if(_r){if(h===void 0)throw Error(Ce(407));h=h()}else{if(h=a(),ni===null)throw Error(Ce(349));Eo&30||l0(_,a,h)}b.memoizedState=h;var I={value:h,getSnapshot:a};return b.queue=I,mv(c0.bind(null,_,I,i),[i]),_.flags|=2048,qc(9,u0.bind(null,_,I,h,a),void 0,null),h},useId:function(){var i=hs(),a=ni.identifierPrefix;if(_r){var h=Os,_=Bs;h=(_&~(1<<32-Yn(_)-1)).toString(32)+h,a=":"+a+"R"+h,h=$c++,0<h&&(a+="H"+h.toString(32)),a+=":"}else h=$2++,a=":"+a+"r"+h.toString(32)+":";return i.memoizedState=a},unstable_isNewReconciler:!1},W2={readContext:On,useCallback:y0,useContext:On,useEffect:zg,useImperativeHandle:_0,useInsertionEffect:f0,useLayoutEffect:m0,useMemo:v0,useReducer:Jf,useRef:p0,useState:function(){return Jf(Zc)},useDebugValue:Ag,useDeferredValue:function(i){var a=Nn();return x0(a,Zr.memoizedState,i)},useTransition:function(){var i=Jf(Zc)[0],a=Nn().memoizedState;return[i,a]},useMutableSource:a0,useSyncExternalStore:o0,useId:w0,unstable_isNewReconciler:!1},X2={readContext:On,useCallback:y0,useContext:On,useEffect:zg,useImperativeHandle:_0,useInsertionEffect:f0,useLayoutEffect:m0,useMemo:v0,useReducer:Yf,useRef:p0,useState:function(){return Yf(Zc)},useDebugValue:Ag,useDeferredValue:function(i){var a=Nn();return Zr===null?a.memoizedState=i:x0(a,Zr.memoizedState,i)},useTransition:function(){var i=Yf(Zc)[0],a=Nn().memoizedState;return[i,a]},useMutableSource:a0,useSyncExternalStore:o0,useId:w0,unstable_isNewReconciler:!1};function Xn(i,a){if(i&&i.defaultProps){a=Sr({},a),i=i.defaultProps;for(var h in i)a[h]===void 0&&(a[h]=i[h]);return a}return a}function Rm(i,a,h,_){a=i.memoizedState,h=h(_,a),h=h==null?a:Sr({},a,h),i.memoizedState=h,i.lanes===0&&(i.updateQueue.baseState=h)}var op={isMounted:function(i){return(i=i._reactInternals)?zo(i)===i:!1},enqueueSetState:function(i,a,h){i=i._reactInternals;var _=Ui(),b=Ba(i),I=Ns(_,b);I.payload=a,h!=null&&(I.callback=h),a=Ra(i,I,b),a!==null&&(Qn(a,i,b,_),bd(a,i,b))},enqueueReplaceState:function(i,a,h){i=i._reactInternals;var _=Ui(),b=Ba(i),I=Ns(_,b);I.tag=1,I.payload=a,h!=null&&(I.callback=h),a=Ra(i,I,b),a!==null&&(Qn(a,i,b,_),bd(a,i,b))},enqueueForceUpdate:function(i,a){i=i._reactInternals;var h=Ui(),_=Ba(i),b=Ns(h,_);b.tag=2,a!=null&&(b.callback=a),a=Ra(i,b,_),a!==null&&(Qn(a,i,_,h),bd(a,i,_))}};function gv(i,a,h,_,b,I,S){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(_,I,S):a.prototype&&a.prototype.isPureReactComponent?!Bc(h,_)||!Bc(b,I):!0}function k0(i,a,h){var _=!1,b=ja,I=a.contextType;return typeof I=="object"&&I!==null?I=On(I):(b=nn(a)?ko:Ci.current,_=a.contextTypes,I=(_=_!=null)?Gl(i,b):ja),a=new a(h,I),i.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=op,i.stateNode=a,a._reactInternals=i,_&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=b,i.__reactInternalMemoizedMaskedChildContext=I),a}function _v(i,a,h,_){i=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(h,_),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(h,_),a.state!==i&&op.enqueueReplaceState(a,a.state,null)}function Fm(i,a,h,_){var b=i.stateNode;b.props=h,b.state=i.memoizedState,b.refs={},Tg(i);var I=a.contextType;typeof I=="object"&&I!==null?b.context=On(I):(I=nn(a)?ko:Ci.current,b.context=Gl(i,I)),b.state=i.memoizedState,I=a.getDerivedStateFromProps,typeof I=="function"&&(Rm(i,a,I,h),b.state=i.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(a=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),a!==b.state&&op.enqueueReplaceState(b,b.state,null),Zd(i,h,b,_),b.state=i.memoizedState),typeof b.componentDidMount=="function"&&(i.flags|=4194308)}function Kl(i,a){try{var h="",_=a;do h+=Sb(_),_=_.return;while(_);var b=h}catch(I){b=`
Error generating stack: `+I.message+`
`+I.stack}return{value:i,source:a,stack:b,digest:null}}function Qf(i,a,h){return{value:i,source:null,stack:h??null,digest:a??null}}function Bm(i,a){try{console.error(a.value)}catch(h){setTimeout(function(){throw h})}}var K2=typeof WeakMap=="function"?WeakMap:Map;function I0(i,a,h){h=Ns(-1,h),h.tag=3,h.payload={element:null};var _=a.value;return h.callback=function(){Xd||(Xd=!0,Hm=_),Bm(i,a)},h}function E0(i,a,h){h=Ns(-1,h),h.tag=3;var _=i.type.getDerivedStateFromError;if(typeof _=="function"){var b=a.value;h.payload=function(){return _(b)},h.callback=function(){Bm(i,a)}}var I=i.stateNode;return I!==null&&typeof I.componentDidCatch=="function"&&(h.callback=function(){Bm(i,a),typeof _!="function"&&(Fa===null?Fa=new Set([this]):Fa.add(this));var S=a.stack;this.componentDidCatch(a.value,{componentStack:S!==null?S:""})}),h}function yv(i,a,h){var _=i.pingCache;if(_===null){_=i.pingCache=new K2;var b=new Set;_.set(a,b)}else b=_.get(a),b===void 0&&(b=new Set,_.set(a,b));b.has(h)||(b.add(h),i=cS.bind(null,i,a,h),a.then(i,i))}function vv(i){do{var a;if((a=i.tag===13)&&(a=i.memoizedState,a=a!==null?a.dehydrated!==null:!0),a)return i;i=i.return}while(i!==null);return null}function xv(i,a,h,_,b){return i.mode&1?(i.flags|=65536,i.lanes=b,i):(i===a?i.flags|=65536:(i.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(a=Ns(-1,1),a.tag=2,Ra(h,a,1))),h.lanes|=1),i)}var J2=Zs.ReactCurrentOwner,tn=!1;function Vi(i,a,h,_){a.child=i===null?r0(a,null,h,_):Wl(a,i.child,h,_)}function wv(i,a,h,_,b){h=h.render;var I=a.ref;return $l(a,b),_=Cg(i,a,h,_,I,b),h=Mg(),i!==null&&!tn?(a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~b,$s(i,a,b)):(_r&&h&&_g(a),a.flags|=1,Vi(i,a,_,b),a.child)}function bv(i,a,h,_,b){if(i===null){var I=h.type;return typeof I=="function"&&!jg(I)&&I.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(a.tag=15,a.type=I,P0(i,a,I,_,b)):(i=Pd(h.type,null,_,a,a.mode,b),i.ref=a.ref,i.return=a,a.child=i)}if(I=i.child,!(i.lanes&b)){var S=I.memoizedProps;if(h=h.compare,h=h!==null?h:Bc,h(S,_)&&i.ref===a.ref)return $s(i,a,b)}return a.flags|=1,i=Oa(I,_),i.ref=a.ref,i.return=a,a.child=i}function P0(i,a,h,_,b){if(i!==null){var I=i.memoizedProps;if(Bc(I,_)&&i.ref===a.ref)if(tn=!1,a.pendingProps=_=I,(i.lanes&b)!==0)i.flags&131072&&(tn=!0);else return a.lanes=i.lanes,$s(i,a,b)}return Om(i,a,h,_,b)}function C0(i,a,h){var _=a.pendingProps,b=_.children,I=i!==null?i.memoizedState:null;if(_.mode==="hidden")if(!(a.mode&1))a.memoizedState={baseLanes:0,cachePool:null,transitions:null},lr(Ol,xn),xn|=h;else{if(!(h&1073741824))return i=I!==null?I.baseLanes|h:h,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:i,cachePool:null,transitions:null},a.updateQueue=null,lr(Ol,xn),xn|=i,null;a.memoizedState={baseLanes:0,cachePool:null,transitions:null},_=I!==null?I.baseLanes:h,lr(Ol,xn),xn|=_}else I!==null?(_=I.baseLanes|h,a.memoizedState=null):_=h,lr(Ol,xn),xn|=_;return Vi(i,a,b,h),a.child}function M0(i,a){var h=a.ref;(i===null&&h!==null||i!==null&&i.ref!==h)&&(a.flags|=512,a.flags|=2097152)}function Om(i,a,h,_,b){var I=nn(h)?ko:Ci.current;return I=Gl(a,I),$l(a,b),h=Cg(i,a,h,_,I,b),_=Mg(),i!==null&&!tn?(a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~b,$s(i,a,b)):(_r&&_&&_g(a),a.flags|=1,Vi(i,a,h,b),a.child)}function Sv(i,a,h,_,b){if(nn(h)){var I=!0;Nd(a)}else I=!1;if($l(a,b),a.stateNode===null)kd(i,a),k0(a,h,_),Fm(a,h,_,b),_=!0;else if(i===null){var S=a.stateNode,d=a.memoizedProps;S.props=d;var U=S.context,ne=h.contextType;typeof ne=="object"&&ne!==null?ne=On(ne):(ne=nn(h)?ko:Ci.current,ne=Gl(a,ne));var ye=h.getDerivedStateFromProps,Q=typeof ye=="function"||typeof S.getSnapshotBeforeUpdate=="function";Q||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==_||U!==ne)&&_v(a,S,_,ne),Ia=!1;var W=a.memoizedState;S.state=W,Zd(a,_,S,b),U=a.memoizedState,d!==_||W!==U||rn.current||Ia?(typeof ye=="function"&&(Rm(a,h,ye,_),U=a.memoizedState),(d=Ia||gv(a,h,d,_,W,U,ne))?(Q||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(a.flags|=4194308)):(typeof S.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=_,a.memoizedState=U),S.props=_,S.state=U,S.context=ne,_=d):(typeof S.componentDidMount=="function"&&(a.flags|=4194308),_=!1)}else{S=a.stateNode,n0(i,a),d=a.memoizedProps,ne=a.type===a.elementType?d:Xn(a.type,d),S.props=ne,Q=a.pendingProps,W=S.context,U=h.contextType,typeof U=="object"&&U!==null?U=On(U):(U=nn(h)?ko:Ci.current,U=Gl(a,U));var De=h.getDerivedStateFromProps;(ye=typeof De=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==Q||W!==U)&&_v(a,S,_,U),Ia=!1,W=a.memoizedState,S.state=W,Zd(a,_,S,b);var Me=a.memoizedState;d!==Q||W!==Me||rn.current||Ia?(typeof De=="function"&&(Rm(a,h,De,_),Me=a.memoizedState),(ne=Ia||gv(a,h,ne,_,W,Me,U)||!1)?(ye||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(_,Me,U),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(_,Me,U)),typeof S.componentDidUpdate=="function"&&(a.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof S.componentDidUpdate!="function"||d===i.memoizedProps&&W===i.memoizedState||(a.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===i.memoizedProps&&W===i.memoizedState||(a.flags|=1024),a.memoizedProps=_,a.memoizedState=Me),S.props=_,S.state=Me,S.context=U,_=ne):(typeof S.componentDidUpdate!="function"||d===i.memoizedProps&&W===i.memoizedState||(a.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===i.memoizedProps&&W===i.memoizedState||(a.flags|=1024),_=!1)}return Nm(i,a,h,_,I,b)}function Nm(i,a,h,_,b,I){M0(i,a);var S=(a.flags&128)!==0;if(!_&&!S)return b&&lv(a,h,!1),$s(i,a,I);_=a.stateNode,J2.current=a;var d=S&&typeof h.getDerivedStateFromError!="function"?null:_.render();return a.flags|=1,i!==null&&S?(a.child=Wl(a,i.child,null,I),a.child=Wl(a,null,d,I)):Vi(i,a,d,I),a.memoizedState=_.state,b&&lv(a,h,!0),a.child}function z0(i){var a=i.stateNode;a.pendingContext?ov(i,a.pendingContext,a.pendingContext!==a.context):a.context&&ov(i,a.context,!1),kg(i,a.containerInfo)}function Tv(i,a,h,_,b){return Hl(),vg(b),a.flags|=256,Vi(i,a,h,_),a.child}var jm={dehydrated:null,treeContext:null,retryLane:0};function Vm(i){return{baseLanes:i,cachePool:null,transitions:null}}function A0(i,a,h){var _=a.pendingProps,b=wr.current,I=!1,S=(a.flags&128)!==0,d;if((d=S)||(d=i!==null&&i.memoizedState===null?!1:(b&2)!==0),d?(I=!0,a.flags&=-129):(i===null||i.memoizedState!==null)&&(b|=1),lr(wr,b&1),i===null)return Dm(a),i=a.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(a.mode&1?i.data==="$!"?a.lanes=8:a.lanes=1073741824:a.lanes=1,null):(S=_.children,i=_.fallback,I?(_=a.mode,I=a.child,S={mode:"hidden",children:S},!(_&1)&&I!==null?(I.childLanes=0,I.pendingProps=S):I=cp(S,_,0,null),i=To(i,_,h,null),I.return=a,i.return=a,I.sibling=i,a.child=I,a.child.memoizedState=Vm(h),a.memoizedState=jm,i):Dg(a,S));if(b=i.memoizedState,b!==null&&(d=b.dehydrated,d!==null))return Y2(i,a,S,_,d,b,h);if(I){I=_.fallback,S=a.mode,b=i.child,d=b.sibling;var U={mode:"hidden",children:_.children};return!(S&1)&&a.child!==b?(_=a.child,_.childLanes=0,_.pendingProps=U,a.deletions=null):(_=Oa(b,U),_.subtreeFlags=b.subtreeFlags&14680064),d!==null?I=Oa(d,I):(I=To(I,S,h,null),I.flags|=2),I.return=a,_.return=a,_.sibling=I,a.child=_,_=I,I=a.child,S=i.child.memoizedState,S=S===null?Vm(h):{baseLanes:S.baseLanes|h,cachePool:null,transitions:S.transitions},I.memoizedState=S,I.childLanes=i.childLanes&~h,a.memoizedState=jm,_}return I=i.child,i=I.sibling,_=Oa(I,{mode:"visible",children:_.children}),!(a.mode&1)&&(_.lanes=h),_.return=a,_.sibling=null,i!==null&&(h=a.deletions,h===null?(a.deletions=[i],a.flags|=16):h.push(i)),a.child=_,a.memoizedState=null,_}function Dg(i,a){return a=cp({mode:"visible",children:a},i.mode,0,null),a.return=i,i.child=a}function pd(i,a,h,_){return _!==null&&vg(_),Wl(a,i.child,null,h),i=Dg(a,a.pendingProps.children),i.flags|=2,a.memoizedState=null,i}function Y2(i,a,h,_,b,I,S){if(h)return a.flags&256?(a.flags&=-257,_=Qf(Error(Ce(422))),pd(i,a,S,_)):a.memoizedState!==null?(a.child=i.child,a.flags|=128,null):(I=_.fallback,b=a.mode,_=cp({mode:"visible",children:_.children},b,0,null),I=To(I,b,S,null),I.flags|=2,_.return=a,I.return=a,_.sibling=I,a.child=_,a.mode&1&&Wl(a,i.child,null,S),a.child.memoizedState=Vm(S),a.memoizedState=jm,I);if(!(a.mode&1))return pd(i,a,S,null);if(b.data==="$!"){if(_=b.nextSibling&&b.nextSibling.dataset,_)var d=_.dgst;return _=d,I=Error(Ce(419)),_=Qf(I,_,void 0),pd(i,a,S,_)}if(d=(S&i.childLanes)!==0,tn||d){if(_=ni,_!==null){switch(S&-S){case 4:b=2;break;case 16:b=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:b=32;break;case 536870912:b=268435456;break;default:b=0}b=b&(_.suspendedLanes|S)?0:b,b!==0&&b!==I.retryLane&&(I.retryLane=b,Us(i,b),Qn(_,i,b,-1))}return Ng(),_=Qf(Error(Ce(421))),pd(i,a,S,_)}return b.data==="$?"?(a.flags|=128,a.child=i.child,a=hS.bind(null,i),b._reactRetry=a,null):(i=I.treeContext,wn=La(b.nextSibling),bn=a,_r=!0,Jn=null,i!==null&&(Ln[Rn++]=Bs,Ln[Rn++]=Os,Ln[Rn++]=Io,Bs=i.id,Os=i.overflow,Io=a),a=Dg(a,_.children),a.flags|=4096,a)}function kv(i,a,h){i.lanes|=a;var _=i.alternate;_!==null&&(_.lanes|=a),Lm(i.return,a,h)}function em(i,a,h,_,b){var I=i.memoizedState;I===null?i.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:_,tail:h,tailMode:b}:(I.isBackwards=a,I.rendering=null,I.renderingStartTime=0,I.last=_,I.tail=h,I.tailMode=b)}function D0(i,a,h){var _=a.pendingProps,b=_.revealOrder,I=_.tail;if(Vi(i,a,_.children,h),_=wr.current,_&2)_=_&1|2,a.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=a.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&kv(i,h,a);else if(i.tag===19)kv(i,h,a);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===a)break e;for(;i.sibling===null;){if(i.return===null||i.return===a)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}_&=1}if(lr(wr,_),!(a.mode&1))a.memoizedState=null;else switch(b){case"forwards":for(h=a.child,b=null;h!==null;)i=h.alternate,i!==null&&qd(i)===null&&(b=h),h=h.sibling;h=b,h===null?(b=a.child,a.child=null):(b=h.sibling,h.sibling=null),em(a,!1,b,h,I);break;case"backwards":for(h=null,b=a.child,a.child=null;b!==null;){if(i=b.alternate,i!==null&&qd(i)===null){a.child=b;break}i=b.sibling,b.sibling=h,h=b,b=i}em(a,!0,h,null,I);break;case"together":em(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function kd(i,a){!(a.mode&1)&&i!==null&&(i.alternate=null,a.alternate=null,a.flags|=2)}function $s(i,a,h){if(i!==null&&(a.dependencies=i.dependencies),Po|=a.lanes,!(h&a.childLanes))return null;if(i!==null&&a.child!==i.child)throw Error(Ce(153));if(a.child!==null){for(i=a.child,h=Oa(i,i.pendingProps),a.child=h,h.return=a;i.sibling!==null;)i=i.sibling,h=h.sibling=Oa(i,i.pendingProps),h.return=a;h.sibling=null}return a.child}function Q2(i,a,h){switch(a.tag){case 3:z0(a),Hl();break;case 5:s0(a);break;case 1:nn(a.type)&&Nd(a);break;case 4:kg(a,a.stateNode.containerInfo);break;case 10:var _=a.type._context,b=a.memoizedProps.value;lr(Ud,_._currentValue),_._currentValue=b;break;case 13:if(_=a.memoizedState,_!==null)return _.dehydrated!==null?(lr(wr,wr.current&1),a.flags|=128,null):h&a.child.childLanes?A0(i,a,h):(lr(wr,wr.current&1),i=$s(i,a,h),i!==null?i.sibling:null);lr(wr,wr.current&1);break;case 19:if(_=(h&a.childLanes)!==0,i.flags&128){if(_)return D0(i,a,h);a.flags|=128}if(b=a.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),lr(wr,wr.current),_)break;return null;case 22:case 23:return a.lanes=0,C0(i,a,h)}return $s(i,a,h)}var L0,Um,R0,F0;L0=function(i,a){for(var h=a.child;h!==null;){if(h.tag===5||h.tag===6)i.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===a)break;for(;h.sibling===null;){if(h.return===null||h.return===a)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};Um=function(){};R0=function(i,a,h,_){var b=i.memoizedProps;if(b!==_){i=a.stateNode,bo(fs.current);var I=null;switch(h){case"input":b=cm(i,b),_=cm(i,_),I=[];break;case"select":b=Sr({},b,{value:void 0}),_=Sr({},_,{value:void 0}),I=[];break;case"textarea":b=pm(i,b),_=pm(i,_),I=[];break;default:typeof b.onClick!="function"&&typeof _.onClick=="function"&&(i.onclick=Bd)}mm(h,_);var S;h=null;for(ne in b)if(!_.hasOwnProperty(ne)&&b.hasOwnProperty(ne)&&b[ne]!=null)if(ne==="style"){var d=b[ne];for(S in d)d.hasOwnProperty(S)&&(h||(h={}),h[S]="")}else ne!=="dangerouslySetInnerHTML"&&ne!=="children"&&ne!=="suppressContentEditableWarning"&&ne!=="suppressHydrationWarning"&&ne!=="autoFocus"&&(Mc.hasOwnProperty(ne)?I||(I=[]):(I=I||[]).push(ne,null));for(ne in _){var U=_[ne];if(d=b!=null?b[ne]:void 0,_.hasOwnProperty(ne)&&U!==d&&(U!=null||d!=null))if(ne==="style")if(d){for(S in d)!d.hasOwnProperty(S)||U&&U.hasOwnProperty(S)||(h||(h={}),h[S]="");for(S in U)U.hasOwnProperty(S)&&d[S]!==U[S]&&(h||(h={}),h[S]=U[S])}else h||(I||(I=[]),I.push(ne,h)),h=U;else ne==="dangerouslySetInnerHTML"?(U=U?U.__html:void 0,d=d?d.__html:void 0,U!=null&&d!==U&&(I=I||[]).push(ne,U)):ne==="children"?typeof U!="string"&&typeof U!="number"||(I=I||[]).push(ne,""+U):ne!=="suppressContentEditableWarning"&&ne!=="suppressHydrationWarning"&&(Mc.hasOwnProperty(ne)?(U!=null&&ne==="onScroll"&&dr("scroll",i),I||d===U||(I=[])):(I=I||[]).push(ne,U))}h&&(I=I||[]).push("style",h);var ne=I;(a.updateQueue=ne)&&(a.flags|=4)}};F0=function(i,a,h,_){h!==_&&(a.flags|=4)};function mc(i,a){if(!_r)switch(i.tailMode){case"hidden":a=i.tail;for(var h=null;a!==null;)a.alternate!==null&&(h=a),a=a.sibling;h===null?i.tail=null:h.sibling=null;break;case"collapsed":h=i.tail;for(var _=null;h!==null;)h.alternate!==null&&(_=h),h=h.sibling;_===null?a||i.tail===null?i.tail=null:i.tail.sibling=null:_.sibling=null}}function Ei(i){var a=i.alternate!==null&&i.alternate.child===i.child,h=0,_=0;if(a)for(var b=i.child;b!==null;)h|=b.lanes|b.childLanes,_|=b.subtreeFlags&14680064,_|=b.flags&14680064,b.return=i,b=b.sibling;else for(b=i.child;b!==null;)h|=b.lanes|b.childLanes,_|=b.subtreeFlags,_|=b.flags,b.return=i,b=b.sibling;return i.subtreeFlags|=_,i.childLanes=h,a}function eS(i,a,h){var _=a.pendingProps;switch(yg(a),a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ei(a),null;case 1:return nn(a.type)&&Od(),Ei(a),null;case 3:return _=a.stateNode,Xl(),pr(rn),pr(Ci),Eg(),_.pendingContext&&(_.context=_.pendingContext,_.pendingContext=null),(i===null||i.child===null)&&(hd(a)?a.flags|=4:i===null||i.memoizedState.isDehydrated&&!(a.flags&256)||(a.flags|=1024,Jn!==null&&(Km(Jn),Jn=null))),Um(i,a),Ei(a),null;case 5:Ig(a);var b=bo(Uc.current);if(h=a.type,i!==null&&a.stateNode!=null)R0(i,a,h,_,b),i.ref!==a.ref&&(a.flags|=512,a.flags|=2097152);else{if(!_){if(a.stateNode===null)throw Error(Ce(166));return Ei(a),null}if(i=bo(fs.current),hd(a)){_=a.stateNode,h=a.type;var I=a.memoizedProps;switch(_[ds]=a,_[jc]=I,i=(a.mode&1)!==0,h){case"dialog":dr("cancel",_),dr("close",_);break;case"iframe":case"object":case"embed":dr("load",_);break;case"video":case"audio":for(b=0;b<xc.length;b++)dr(xc[b],_);break;case"source":dr("error",_);break;case"img":case"image":case"link":dr("error",_),dr("load",_);break;case"details":dr("toggle",_);break;case"input":Ly(_,I),dr("invalid",_);break;case"select":_._wrapperState={wasMultiple:!!I.multiple},dr("invalid",_);break;case"textarea":Fy(_,I),dr("invalid",_)}mm(h,I),b=null;for(var S in I)if(I.hasOwnProperty(S)){var d=I[S];S==="children"?typeof d=="string"?_.textContent!==d&&(I.suppressHydrationWarning!==!0&&cd(_.textContent,d,i),b=["children",d]):typeof d=="number"&&_.textContent!==""+d&&(I.suppressHydrationWarning!==!0&&cd(_.textContent,d,i),b=["children",""+d]):Mc.hasOwnProperty(S)&&d!=null&&S==="onScroll"&&dr("scroll",_)}switch(h){case"input":rd(_),Ry(_,I,!0);break;case"textarea":rd(_),By(_);break;case"select":case"option":break;default:typeof I.onClick=="function"&&(_.onclick=Bd)}_=b,a.updateQueue=_,_!==null&&(a.flags|=4)}else{S=b.nodeType===9?b:b.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=cx(h)),i==="http://www.w3.org/1999/xhtml"?h==="script"?(i=S.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof _.is=="string"?i=S.createElement(h,{is:_.is}):(i=S.createElement(h),h==="select"&&(S=i,_.multiple?S.multiple=!0:_.size&&(S.size=_.size))):i=S.createElementNS(i,h),i[ds]=a,i[jc]=_,L0(i,a,!1,!1),a.stateNode=i;e:{switch(S=gm(h,_),h){case"dialog":dr("cancel",i),dr("close",i),b=_;break;case"iframe":case"object":case"embed":dr("load",i),b=_;break;case"video":case"audio":for(b=0;b<xc.length;b++)dr(xc[b],i);b=_;break;case"source":dr("error",i),b=_;break;case"img":case"image":case"link":dr("error",i),dr("load",i),b=_;break;case"details":dr("toggle",i),b=_;break;case"input":Ly(i,_),b=cm(i,_),dr("invalid",i);break;case"option":b=_;break;case"select":i._wrapperState={wasMultiple:!!_.multiple},b=Sr({},_,{value:void 0}),dr("invalid",i);break;case"textarea":Fy(i,_),b=pm(i,_),dr("invalid",i);break;default:b=_}mm(h,b),d=b;for(I in d)if(d.hasOwnProperty(I)){var U=d[I];I==="style"?px(i,U):I==="dangerouslySetInnerHTML"?(U=U?U.__html:void 0,U!=null&&hx(i,U)):I==="children"?typeof U=="string"?(h!=="textarea"||U!=="")&&zc(i,U):typeof U=="number"&&zc(i,""+U):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&(Mc.hasOwnProperty(I)?U!=null&&I==="onScroll"&&dr("scroll",i):U!=null&&ig(i,I,U,S))}switch(h){case"input":rd(i),Ry(i,_,!1);break;case"textarea":rd(i),By(i);break;case"option":_.value!=null&&i.setAttribute("value",""+Na(_.value));break;case"select":i.multiple=!!_.multiple,I=_.value,I!=null?Nl(i,!!_.multiple,I,!1):_.defaultValue!=null&&Nl(i,!!_.multiple,_.defaultValue,!0);break;default:typeof b.onClick=="function"&&(i.onclick=Bd)}switch(h){case"button":case"input":case"select":case"textarea":_=!!_.autoFocus;break e;case"img":_=!0;break e;default:_=!1}}_&&(a.flags|=4)}a.ref!==null&&(a.flags|=512,a.flags|=2097152)}return Ei(a),null;case 6:if(i&&a.stateNode!=null)F0(i,a,i.memoizedProps,_);else{if(typeof _!="string"&&a.stateNode===null)throw Error(Ce(166));if(h=bo(Uc.current),bo(fs.current),hd(a)){if(_=a.stateNode,h=a.memoizedProps,_[ds]=a,(I=_.nodeValue!==h)&&(i=bn,i!==null))switch(i.tag){case 3:cd(_.nodeValue,h,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&cd(_.nodeValue,h,(i.mode&1)!==0)}I&&(a.flags|=4)}else _=(h.nodeType===9?h:h.ownerDocument).createTextNode(_),_[ds]=a,a.stateNode=_}return Ei(a),null;case 13:if(pr(wr),_=a.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(_r&&wn!==null&&a.mode&1&&!(a.flags&128))e0(),Hl(),a.flags|=98560,I=!1;else if(I=hd(a),_!==null&&_.dehydrated!==null){if(i===null){if(!I)throw Error(Ce(318));if(I=a.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(Ce(317));I[ds]=a}else Hl(),!(a.flags&128)&&(a.memoizedState=null),a.flags|=4;Ei(a),I=!1}else Jn!==null&&(Km(Jn),Jn=null),I=!0;if(!I)return a.flags&65536?a:null}return a.flags&128?(a.lanes=h,a):(_=_!==null,_!==(i!==null&&i.memoizedState!==null)&&_&&(a.child.flags|=8192,a.mode&1&&(i===null||wr.current&1?qr===0&&(qr=3):Ng())),a.updateQueue!==null&&(a.flags|=4),Ei(a),null);case 4:return Xl(),Um(i,a),i===null&&Oc(a.stateNode.containerInfo),Ei(a),null;case 10:return bg(a.type._context),Ei(a),null;case 17:return nn(a.type)&&Od(),Ei(a),null;case 19:if(pr(wr),I=a.memoizedState,I===null)return Ei(a),null;if(_=(a.flags&128)!==0,S=I.rendering,S===null)if(_)mc(I,!1);else{if(qr!==0||i!==null&&i.flags&128)for(i=a.child;i!==null;){if(S=qd(i),S!==null){for(a.flags|=128,mc(I,!1),_=S.updateQueue,_!==null&&(a.updateQueue=_,a.flags|=4),a.subtreeFlags=0,_=h,h=a.child;h!==null;)I=h,i=_,I.flags&=14680066,S=I.alternate,S===null?(I.childLanes=0,I.lanes=i,I.child=null,I.subtreeFlags=0,I.memoizedProps=null,I.memoizedState=null,I.updateQueue=null,I.dependencies=null,I.stateNode=null):(I.childLanes=S.childLanes,I.lanes=S.lanes,I.child=S.child,I.subtreeFlags=0,I.deletions=null,I.memoizedProps=S.memoizedProps,I.memoizedState=S.memoizedState,I.updateQueue=S.updateQueue,I.type=S.type,i=S.dependencies,I.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),h=h.sibling;return lr(wr,wr.current&1|2),a.child}i=i.sibling}I.tail!==null&&Ar()>Jl&&(a.flags|=128,_=!0,mc(I,!1),a.lanes=4194304)}else{if(!_)if(i=qd(S),i!==null){if(a.flags|=128,_=!0,h=i.updateQueue,h!==null&&(a.updateQueue=h,a.flags|=4),mc(I,!0),I.tail===null&&I.tailMode==="hidden"&&!S.alternate&&!_r)return Ei(a),null}else 2*Ar()-I.renderingStartTime>Jl&&h!==1073741824&&(a.flags|=128,_=!0,mc(I,!1),a.lanes=4194304);I.isBackwards?(S.sibling=a.child,a.child=S):(h=I.last,h!==null?h.sibling=S:a.child=S,I.last=S)}return I.tail!==null?(a=I.tail,I.rendering=a,I.tail=a.sibling,I.renderingStartTime=Ar(),a.sibling=null,h=wr.current,lr(wr,_?h&1|2:h&1),a):(Ei(a),null);case 22:case 23:return Og(),_=a.memoizedState!==null,i!==null&&i.memoizedState!==null!==_&&(a.flags|=8192),_&&a.mode&1?xn&1073741824&&(Ei(a),a.subtreeFlags&6&&(a.flags|=8192)):Ei(a),null;case 24:return null;case 25:return null}throw Error(Ce(156,a.tag))}function tS(i,a){switch(yg(a),a.tag){case 1:return nn(a.type)&&Od(),i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 3:return Xl(),pr(rn),pr(Ci),Eg(),i=a.flags,i&65536&&!(i&128)?(a.flags=i&-65537|128,a):null;case 5:return Ig(a),null;case 13:if(pr(wr),i=a.memoizedState,i!==null&&i.dehydrated!==null){if(a.alternate===null)throw Error(Ce(340));Hl()}return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 19:return pr(wr),null;case 4:return Xl(),null;case 10:return bg(a.type._context),null;case 22:case 23:return Og(),null;case 24:return null;default:return null}}var fd=!1,Pi=!1,rS=typeof WeakSet=="function"?WeakSet:Set,rt=null;function Bl(i,a){var h=i.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(_){Cr(i,a,_)}else h.current=null}function $m(i,a,h){try{h()}catch(_){Cr(i,a,_)}}var Iv=!1;function iS(i,a){if(Im=Ld,i=Vx(),gg(i)){if("selectionStart"in i)var h={start:i.selectionStart,end:i.selectionEnd};else e:{h=(h=i.ownerDocument)&&h.defaultView||window;var _=h.getSelection&&h.getSelection();if(_&&_.rangeCount!==0){h=_.anchorNode;var b=_.anchorOffset,I=_.focusNode;_=_.focusOffset;try{h.nodeType,I.nodeType}catch{h=null;break e}var S=0,d=-1,U=-1,ne=0,ye=0,Q=i,W=null;t:for(;;){for(var De;Q!==h||b!==0&&Q.nodeType!==3||(d=S+b),Q!==I||_!==0&&Q.nodeType!==3||(U=S+_),Q.nodeType===3&&(S+=Q.nodeValue.length),(De=Q.firstChild)!==null;)W=Q,Q=De;for(;;){if(Q===i)break t;if(W===h&&++ne===b&&(d=S),W===I&&++ye===_&&(U=S),(De=Q.nextSibling)!==null)break;Q=W,W=Q.parentNode}Q=De}h=d===-1||U===-1?null:{start:d,end:U}}else h=null}h=h||{start:0,end:0}}else h=null;for(Em={focusedElem:i,selectionRange:h},Ld=!1,rt=a;rt!==null;)if(a=rt,i=a.child,(a.subtreeFlags&1028)!==0&&i!==null)i.return=a,rt=i;else for(;rt!==null;){a=rt;try{var Me=a.alternate;if(a.flags&1024)switch(a.tag){case 0:case 11:case 15:break;case 1:if(Me!==null){var Pe=Me.memoizedProps,_t=Me.memoizedState,oe=a.stateNode,ee=oe.getSnapshotBeforeUpdate(a.elementType===a.type?Pe:Xn(a.type,Pe),_t);oe.__reactInternalSnapshotBeforeUpdate=ee}break;case 3:var he=a.stateNode.containerInfo;he.nodeType===1?he.textContent="":he.nodeType===9&&he.documentElement&&he.removeChild(he.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ce(163))}}catch(Se){Cr(a,a.return,Se)}if(i=a.sibling,i!==null){i.return=a.return,rt=i;break}rt=a.return}return Me=Iv,Iv=!1,Me}function Ec(i,a,h){var _=a.updateQueue;if(_=_!==null?_.lastEffect:null,_!==null){var b=_=_.next;do{if((b.tag&i)===i){var I=b.destroy;b.destroy=void 0,I!==void 0&&$m(a,h,I)}b=b.next}while(b!==_)}}function lp(i,a){if(a=a.updateQueue,a=a!==null?a.lastEffect:null,a!==null){var h=a=a.next;do{if((h.tag&i)===i){var _=h.create;h.destroy=_()}h=h.next}while(h!==a)}}function Zm(i){var a=i.ref;if(a!==null){var h=i.stateNode;switch(i.tag){case 5:i=h;break;default:i=h}typeof a=="function"?a(i):a.current=i}}function B0(i){var a=i.alternate;a!==null&&(i.alternate=null,B0(a)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(a=i.stateNode,a!==null&&(delete a[ds],delete a[jc],delete a[Mm],delete a[N2],delete a[j2])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function O0(i){return i.tag===5||i.tag===3||i.tag===4}function Ev(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||O0(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function qm(i,a,h){var _=i.tag;if(_===5||_===6)i=i.stateNode,a?h.nodeType===8?h.parentNode.insertBefore(i,a):h.insertBefore(i,a):(h.nodeType===8?(a=h.parentNode,a.insertBefore(i,h)):(a=h,a.appendChild(i)),h=h._reactRootContainer,h!=null||a.onclick!==null||(a.onclick=Bd));else if(_!==4&&(i=i.child,i!==null))for(qm(i,a,h),i=i.sibling;i!==null;)qm(i,a,h),i=i.sibling}function Gm(i,a,h){var _=i.tag;if(_===5||_===6)i=i.stateNode,a?h.insertBefore(i,a):h.appendChild(i);else if(_!==4&&(i=i.child,i!==null))for(Gm(i,a,h),i=i.sibling;i!==null;)Gm(i,a,h),i=i.sibling}var di=null,Kn=!1;function Ta(i,a,h){for(h=h.child;h!==null;)N0(i,a,h),h=h.sibling}function N0(i,a,h){if(ps&&typeof ps.onCommitFiberUnmount=="function")try{ps.onCommitFiberUnmount(ep,h)}catch{}switch(h.tag){case 5:Pi||Bl(h,a);case 6:var _=di,b=Kn;di=null,Ta(i,a,h),di=_,Kn=b,di!==null&&(Kn?(i=di,h=h.stateNode,i.nodeType===8?i.parentNode.removeChild(h):i.removeChild(h)):di.removeChild(h.stateNode));break;case 18:di!==null&&(Kn?(i=di,h=h.stateNode,i.nodeType===8?Hf(i.parentNode,h):i.nodeType===1&&Hf(i,h),Rc(i)):Hf(di,h.stateNode));break;case 4:_=di,b=Kn,di=h.stateNode.containerInfo,Kn=!0,Ta(i,a,h),di=_,Kn=b;break;case 0:case 11:case 14:case 15:if(!Pi&&(_=h.updateQueue,_!==null&&(_=_.lastEffect,_!==null))){b=_=_.next;do{var I=b,S=I.destroy;I=I.tag,S!==void 0&&(I&2||I&4)&&$m(h,a,S),b=b.next}while(b!==_)}Ta(i,a,h);break;case 1:if(!Pi&&(Bl(h,a),_=h.stateNode,typeof _.componentWillUnmount=="function"))try{_.props=h.memoizedProps,_.state=h.memoizedState,_.componentWillUnmount()}catch(d){Cr(h,a,d)}Ta(i,a,h);break;case 21:Ta(i,a,h);break;case 22:h.mode&1?(Pi=(_=Pi)||h.memoizedState!==null,Ta(i,a,h),Pi=_):Ta(i,a,h);break;default:Ta(i,a,h)}}function Pv(i){var a=i.updateQueue;if(a!==null){i.updateQueue=null;var h=i.stateNode;h===null&&(h=i.stateNode=new rS),a.forEach(function(_){var b=dS.bind(null,i,_);h.has(_)||(h.add(_),_.then(b,b))})}}function Wn(i,a){var h=a.deletions;if(h!==null)for(var _=0;_<h.length;_++){var b=h[_];try{var I=i,S=a,d=S;e:for(;d!==null;){switch(d.tag){case 5:di=d.stateNode,Kn=!1;break e;case 3:di=d.stateNode.containerInfo,Kn=!0;break e;case 4:di=d.stateNode.containerInfo,Kn=!0;break e}d=d.return}if(di===null)throw Error(Ce(160));N0(I,S,b),di=null,Kn=!1;var U=b.alternate;U!==null&&(U.return=null),b.return=null}catch(ne){Cr(b,a,ne)}}if(a.subtreeFlags&12854)for(a=a.child;a!==null;)j0(a,i),a=a.sibling}function j0(i,a){var h=i.alternate,_=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Wn(a,i),cs(i),_&4){try{Ec(3,i,i.return),lp(3,i)}catch(Pe){Cr(i,i.return,Pe)}try{Ec(5,i,i.return)}catch(Pe){Cr(i,i.return,Pe)}}break;case 1:Wn(a,i),cs(i),_&512&&h!==null&&Bl(h,h.return);break;case 5:if(Wn(a,i),cs(i),_&512&&h!==null&&Bl(h,h.return),i.flags&32){var b=i.stateNode;try{zc(b,"")}catch(Pe){Cr(i,i.return,Pe)}}if(_&4&&(b=i.stateNode,b!=null)){var I=i.memoizedProps,S=h!==null?h.memoizedProps:I,d=i.type,U=i.updateQueue;if(i.updateQueue=null,U!==null)try{d==="input"&&I.type==="radio"&&I.name!=null&&lx(b,I),gm(d,S);var ne=gm(d,I);for(S=0;S<U.length;S+=2){var ye=U[S],Q=U[S+1];ye==="style"?px(b,Q):ye==="dangerouslySetInnerHTML"?hx(b,Q):ye==="children"?zc(b,Q):ig(b,ye,Q,ne)}switch(d){case"input":hm(b,I);break;case"textarea":ux(b,I);break;case"select":var W=b._wrapperState.wasMultiple;b._wrapperState.wasMultiple=!!I.multiple;var De=I.value;De!=null?Nl(b,!!I.multiple,De,!1):W!==!!I.multiple&&(I.defaultValue!=null?Nl(b,!!I.multiple,I.defaultValue,!0):Nl(b,!!I.multiple,I.multiple?[]:"",!1))}b[jc]=I}catch(Pe){Cr(i,i.return,Pe)}}break;case 6:if(Wn(a,i),cs(i),_&4){if(i.stateNode===null)throw Error(Ce(162));b=i.stateNode,I=i.memoizedProps;try{b.nodeValue=I}catch(Pe){Cr(i,i.return,Pe)}}break;case 3:if(Wn(a,i),cs(i),_&4&&h!==null&&h.memoizedState.isDehydrated)try{Rc(a.containerInfo)}catch(Pe){Cr(i,i.return,Pe)}break;case 4:Wn(a,i),cs(i);break;case 13:Wn(a,i),cs(i),b=i.child,b.flags&8192&&(I=b.memoizedState!==null,b.stateNode.isHidden=I,!I||b.alternate!==null&&b.alternate.memoizedState!==null||(Fg=Ar())),_&4&&Pv(i);break;case 22:if(ye=h!==null&&h.memoizedState!==null,i.mode&1?(Pi=(ne=Pi)||ye,Wn(a,i),Pi=ne):Wn(a,i),cs(i),_&8192){if(ne=i.memoizedState!==null,(i.stateNode.isHidden=ne)&&!ye&&i.mode&1)for(rt=i,ye=i.child;ye!==null;){for(Q=rt=ye;rt!==null;){switch(W=rt,De=W.child,W.tag){case 0:case 11:case 14:case 15:Ec(4,W,W.return);break;case 1:Bl(W,W.return);var Me=W.stateNode;if(typeof Me.componentWillUnmount=="function"){_=W,h=W.return;try{a=_,Me.props=a.memoizedProps,Me.state=a.memoizedState,Me.componentWillUnmount()}catch(Pe){Cr(_,h,Pe)}}break;case 5:Bl(W,W.return);break;case 22:if(W.memoizedState!==null){Mv(Q);continue}}De!==null?(De.return=W,rt=De):Mv(Q)}ye=ye.sibling}e:for(ye=null,Q=i;;){if(Q.tag===5){if(ye===null){ye=Q;try{b=Q.stateNode,ne?(I=b.style,typeof I.setProperty=="function"?I.setProperty("display","none","important"):I.display="none"):(d=Q.stateNode,U=Q.memoizedProps.style,S=U!=null&&U.hasOwnProperty("display")?U.display:null,d.style.display=dx("display",S))}catch(Pe){Cr(i,i.return,Pe)}}}else if(Q.tag===6){if(ye===null)try{Q.stateNode.nodeValue=ne?"":Q.memoizedProps}catch(Pe){Cr(i,i.return,Pe)}}else if((Q.tag!==22&&Q.tag!==23||Q.memoizedState===null||Q===i)&&Q.child!==null){Q.child.return=Q,Q=Q.child;continue}if(Q===i)break e;for(;Q.sibling===null;){if(Q.return===null||Q.return===i)break e;ye===Q&&(ye=null),Q=Q.return}ye===Q&&(ye=null),Q.sibling.return=Q.return,Q=Q.sibling}}break;case 19:Wn(a,i),cs(i),_&4&&Pv(i);break;case 21:break;default:Wn(a,i),cs(i)}}function cs(i){var a=i.flags;if(a&2){try{e:{for(var h=i.return;h!==null;){if(O0(h)){var _=h;break e}h=h.return}throw Error(Ce(160))}switch(_.tag){case 5:var b=_.stateNode;_.flags&32&&(zc(b,""),_.flags&=-33);var I=Ev(i);Gm(i,I,b);break;case 3:case 4:var S=_.stateNode.containerInfo,d=Ev(i);qm(i,d,S);break;default:throw Error(Ce(161))}}catch(U){Cr(i,i.return,U)}i.flags&=-3}a&4096&&(i.flags&=-4097)}function nS(i,a,h){rt=i,V0(i)}function V0(i,a,h){for(var _=(i.mode&1)!==0;rt!==null;){var b=rt,I=b.child;if(b.tag===22&&_){var S=b.memoizedState!==null||fd;if(!S){var d=b.alternate,U=d!==null&&d.memoizedState!==null||Pi;d=fd;var ne=Pi;if(fd=S,(Pi=U)&&!ne)for(rt=b;rt!==null;)S=rt,U=S.child,S.tag===22&&S.memoizedState!==null?zv(b):U!==null?(U.return=S,rt=U):zv(b);for(;I!==null;)rt=I,V0(I),I=I.sibling;rt=b,fd=d,Pi=ne}Cv(i)}else b.subtreeFlags&8772&&I!==null?(I.return=b,rt=I):Cv(i)}}function Cv(i){for(;rt!==null;){var a=rt;if(a.flags&8772){var h=a.alternate;try{if(a.flags&8772)switch(a.tag){case 0:case 11:case 15:Pi||lp(5,a);break;case 1:var _=a.stateNode;if(a.flags&4&&!Pi)if(h===null)_.componentDidMount();else{var b=a.elementType===a.type?h.memoizedProps:Xn(a.type,h.memoizedProps);_.componentDidUpdate(b,h.memoizedState,_.__reactInternalSnapshotBeforeUpdate)}var I=a.updateQueue;I!==null&&pv(a,I,_);break;case 3:var S=a.updateQueue;if(S!==null){if(h=null,a.child!==null)switch(a.child.tag){case 5:h=a.child.stateNode;break;case 1:h=a.child.stateNode}pv(a,S,h)}break;case 5:var d=a.stateNode;if(h===null&&a.flags&4){h=d;var U=a.memoizedProps;switch(a.type){case"button":case"input":case"select":case"textarea":U.autoFocus&&h.focus();break;case"img":U.src&&(h.src=U.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(a.memoizedState===null){var ne=a.alternate;if(ne!==null){var ye=ne.memoizedState;if(ye!==null){var Q=ye.dehydrated;Q!==null&&Rc(Q)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ce(163))}Pi||a.flags&512&&Zm(a)}catch(W){Cr(a,a.return,W)}}if(a===i){rt=null;break}if(h=a.sibling,h!==null){h.return=a.return,rt=h;break}rt=a.return}}function Mv(i){for(;rt!==null;){var a=rt;if(a===i){rt=null;break}var h=a.sibling;if(h!==null){h.return=a.return,rt=h;break}rt=a.return}}function zv(i){for(;rt!==null;){var a=rt;try{switch(a.tag){case 0:case 11:case 15:var h=a.return;try{lp(4,a)}catch(U){Cr(a,h,U)}break;case 1:var _=a.stateNode;if(typeof _.componentDidMount=="function"){var b=a.return;try{_.componentDidMount()}catch(U){Cr(a,b,U)}}var I=a.return;try{Zm(a)}catch(U){Cr(a,I,U)}break;case 5:var S=a.return;try{Zm(a)}catch(U){Cr(a,S,U)}}}catch(U){Cr(a,a.return,U)}if(a===i){rt=null;break}var d=a.sibling;if(d!==null){d.return=a.return,rt=d;break}rt=a.return}}var sS=Math.ceil,Wd=Zs.ReactCurrentDispatcher,Lg=Zs.ReactCurrentOwner,Bn=Zs.ReactCurrentBatchConfig,$t=0,ni=null,Nr=null,pi=0,xn=0,Ol=Ua(0),qr=0,Gc=null,Po=0,up=0,Rg=0,Pc=null,en=null,Fg=0,Jl=1/0,Rs=null,Xd=!1,Hm=null,Fa=null,md=!1,Ma=null,Kd=0,Cc=0,Wm=null,Id=-1,Ed=0;function Ui(){return $t&6?Ar():Id!==-1?Id:Id=Ar()}function Ba(i){return i.mode&1?$t&2&&pi!==0?pi&-pi:U2.transition!==null?(Ed===0&&(Ed=kx()),Ed):(i=Yt,i!==0||(i=window.event,i=i===void 0?16:Ax(i.type)),i):1}function Qn(i,a,h,_){if(50<Cc)throw Cc=0,Wm=null,Error(Ce(185));Wc(i,h,_),(!($t&2)||i!==ni)&&(i===ni&&(!($t&2)&&(up|=h),qr===4&&Pa(i,pi)),sn(i,_),h===1&&$t===0&&!(a.mode&1)&&(Jl=Ar()+500,sp&&$a()))}function sn(i,a){var h=i.callbackNode;Ub(i,a);var _=Dd(i,i===ni?pi:0);if(_===0)h!==null&&jy(h),i.callbackNode=null,i.callbackPriority=0;else if(a=_&-_,i.callbackPriority!==a){if(h!=null&&jy(h),a===1)i.tag===0?V2(Av.bind(null,i)):Jx(Av.bind(null,i)),B2(function(){!($t&6)&&$a()}),h=null;else{switch(Ix(_)){case 1:h=lg;break;case 4:h=Sx;break;case 16:h=Ad;break;case 536870912:h=Tx;break;default:h=Ad}h=X0(h,U0.bind(null,i))}i.callbackPriority=a,i.callbackNode=h}}function U0(i,a){if(Id=-1,Ed=0,$t&6)throw Error(Ce(327));var h=i.callbackNode;if(Zl()&&i.callbackNode!==h)return null;var _=Dd(i,i===ni?pi:0);if(_===0)return null;if(_&30||_&i.expiredLanes||a)a=Jd(i,_);else{a=_;var b=$t;$t|=2;var I=Z0();(ni!==i||pi!==a)&&(Rs=null,Jl=Ar()+500,So(i,a));do try{lS();break}catch(d){$0(i,d)}while(!0);wg(),Wd.current=I,$t=b,Nr!==null?a=0:(ni=null,pi=0,a=qr)}if(a!==0){if(a===2&&(b=wm(i),b!==0&&(_=b,a=Xm(i,b))),a===1)throw h=Gc,So(i,0),Pa(i,_),sn(i,Ar()),h;if(a===6)Pa(i,_);else{if(b=i.current.alternate,!(_&30)&&!aS(b)&&(a=Jd(i,_),a===2&&(I=wm(i),I!==0&&(_=I,a=Xm(i,I))),a===1))throw h=Gc,So(i,0),Pa(i,_),sn(i,Ar()),h;switch(i.finishedWork=b,i.finishedLanes=_,a){case 0:case 1:throw Error(Ce(345));case 2:vo(i,en,Rs);break;case 3:if(Pa(i,_),(_&130023424)===_&&(a=Fg+500-Ar(),10<a)){if(Dd(i,0)!==0)break;if(b=i.suspendedLanes,(b&_)!==_){Ui(),i.pingedLanes|=i.suspendedLanes&b;break}i.timeoutHandle=Cm(vo.bind(null,i,en,Rs),a);break}vo(i,en,Rs);break;case 4:if(Pa(i,_),(_&4194240)===_)break;for(a=i.eventTimes,b=-1;0<_;){var S=31-Yn(_);I=1<<S,S=a[S],S>b&&(b=S),_&=~I}if(_=b,_=Ar()-_,_=(120>_?120:480>_?480:1080>_?1080:1920>_?1920:3e3>_?3e3:4320>_?4320:1960*sS(_/1960))-_,10<_){i.timeoutHandle=Cm(vo.bind(null,i,en,Rs),_);break}vo(i,en,Rs);break;case 5:vo(i,en,Rs);break;default:throw Error(Ce(329))}}}return sn(i,Ar()),i.callbackNode===h?U0.bind(null,i):null}function Xm(i,a){var h=Pc;return i.current.memoizedState.isDehydrated&&(So(i,a).flags|=256),i=Jd(i,a),i!==2&&(a=en,en=h,a!==null&&Km(a)),i}function Km(i){en===null?en=i:en.push.apply(en,i)}function aS(i){for(var a=i;;){if(a.flags&16384){var h=a.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var _=0;_<h.length;_++){var b=h[_],I=b.getSnapshot;b=b.value;try{if(!es(I(),b))return!1}catch{return!1}}}if(h=a.child,a.subtreeFlags&16384&&h!==null)h.return=a,a=h;else{if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Pa(i,a){for(a&=~Rg,a&=~up,i.suspendedLanes|=a,i.pingedLanes&=~a,i=i.expirationTimes;0<a;){var h=31-Yn(a),_=1<<h;i[h]=-1,a&=~_}}function Av(i){if($t&6)throw Error(Ce(327));Zl();var a=Dd(i,0);if(!(a&1))return sn(i,Ar()),null;var h=Jd(i,a);if(i.tag!==0&&h===2){var _=wm(i);_!==0&&(a=_,h=Xm(i,_))}if(h===1)throw h=Gc,So(i,0),Pa(i,a),sn(i,Ar()),h;if(h===6)throw Error(Ce(345));return i.finishedWork=i.current.alternate,i.finishedLanes=a,vo(i,en,Rs),sn(i,Ar()),null}function Bg(i,a){var h=$t;$t|=1;try{return i(a)}finally{$t=h,$t===0&&(Jl=Ar()+500,sp&&$a())}}function Co(i){Ma!==null&&Ma.tag===0&&!($t&6)&&Zl();var a=$t;$t|=1;var h=Bn.transition,_=Yt;try{if(Bn.transition=null,Yt=1,i)return i()}finally{Yt=_,Bn.transition=h,$t=a,!($t&6)&&$a()}}function Og(){xn=Ol.current,pr(Ol)}function So(i,a){i.finishedWork=null,i.finishedLanes=0;var h=i.timeoutHandle;if(h!==-1&&(i.timeoutHandle=-1,F2(h)),Nr!==null)for(h=Nr.return;h!==null;){var _=h;switch(yg(_),_.tag){case 1:_=_.type.childContextTypes,_!=null&&Od();break;case 3:Xl(),pr(rn),pr(Ci),Eg();break;case 5:Ig(_);break;case 4:Xl();break;case 13:pr(wr);break;case 19:pr(wr);break;case 10:bg(_.type._context);break;case 22:case 23:Og()}h=h.return}if(ni=i,Nr=i=Oa(i.current,null),pi=xn=a,qr=0,Gc=null,Rg=up=Po=0,en=Pc=null,wo!==null){for(a=0;a<wo.length;a++)if(h=wo[a],_=h.interleaved,_!==null){h.interleaved=null;var b=_.next,I=h.pending;if(I!==null){var S=I.next;I.next=b,_.next=S}h.pending=_}wo=null}return i}function $0(i,a){do{var h=Nr;try{if(wg(),Sd.current=Hd,Gd){for(var _=br.memoizedState;_!==null;){var b=_.queue;b!==null&&(b.pending=null),_=_.next}Gd=!1}if(Eo=0,ii=Zr=br=null,Ic=!1,$c=0,Lg.current=null,h===null||h.return===null){qr=1,Gc=a,Nr=null;break}e:{var I=i,S=h.return,d=h,U=a;if(a=pi,d.flags|=32768,U!==null&&typeof U=="object"&&typeof U.then=="function"){var ne=U,ye=d,Q=ye.tag;if(!(ye.mode&1)&&(Q===0||Q===11||Q===15)){var W=ye.alternate;W?(ye.updateQueue=W.updateQueue,ye.memoizedState=W.memoizedState,ye.lanes=W.lanes):(ye.updateQueue=null,ye.memoizedState=null)}var De=vv(S);if(De!==null){De.flags&=-257,xv(De,S,d,I,a),De.mode&1&&yv(I,ne,a),a=De,U=ne;var Me=a.updateQueue;if(Me===null){var Pe=new Set;Pe.add(U),a.updateQueue=Pe}else Me.add(U);break e}else{if(!(a&1)){yv(I,ne,a),Ng();break e}U=Error(Ce(426))}}else if(_r&&d.mode&1){var _t=vv(S);if(_t!==null){!(_t.flags&65536)&&(_t.flags|=256),xv(_t,S,d,I,a),vg(Kl(U,d));break e}}I=U=Kl(U,d),qr!==4&&(qr=2),Pc===null?Pc=[I]:Pc.push(I),I=S;do{switch(I.tag){case 3:I.flags|=65536,a&=-a,I.lanes|=a;var oe=I0(I,U,a);dv(I,oe);break e;case 1:d=U;var ee=I.type,he=I.stateNode;if(!(I.flags&128)&&(typeof ee.getDerivedStateFromError=="function"||he!==null&&typeof he.componentDidCatch=="function"&&(Fa===null||!Fa.has(he)))){I.flags|=65536,a&=-a,I.lanes|=a;var Se=E0(I,d,a);dv(I,Se);break e}}I=I.return}while(I!==null)}G0(h)}catch(Ue){a=Ue,Nr===h&&h!==null&&(Nr=h=h.return);continue}break}while(!0)}function Z0(){var i=Wd.current;return Wd.current=Hd,i===null?Hd:i}function Ng(){(qr===0||qr===3||qr===2)&&(qr=4),ni===null||!(Po&268435455)&&!(up&268435455)||Pa(ni,pi)}function Jd(i,a){var h=$t;$t|=2;var _=Z0();(ni!==i||pi!==a)&&(Rs=null,So(i,a));do try{oS();break}catch(b){$0(i,b)}while(!0);if(wg(),$t=h,Wd.current=_,Nr!==null)throw Error(Ce(261));return ni=null,pi=0,qr}function oS(){for(;Nr!==null;)q0(Nr)}function lS(){for(;Nr!==null&&!Db();)q0(Nr)}function q0(i){var a=W0(i.alternate,i,xn);i.memoizedProps=i.pendingProps,a===null?G0(i):Nr=a,Lg.current=null}function G0(i){var a=i;do{var h=a.alternate;if(i=a.return,a.flags&32768){if(h=tS(h,a),h!==null){h.flags&=32767,Nr=h;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{qr=6,Nr=null;return}}else if(h=eS(h,a,xn),h!==null){Nr=h;return}if(a=a.sibling,a!==null){Nr=a;return}Nr=a=i}while(a!==null);qr===0&&(qr=5)}function vo(i,a,h){var _=Yt,b=Bn.transition;try{Bn.transition=null,Yt=1,uS(i,a,h,_)}finally{Bn.transition=b,Yt=_}return null}function uS(i,a,h,_){do Zl();while(Ma!==null);if($t&6)throw Error(Ce(327));h=i.finishedWork;var b=i.finishedLanes;if(h===null)return null;if(i.finishedWork=null,i.finishedLanes=0,h===i.current)throw Error(Ce(177));i.callbackNode=null,i.callbackPriority=0;var I=h.lanes|h.childLanes;if($b(i,I),i===ni&&(Nr=ni=null,pi=0),!(h.subtreeFlags&2064)&&!(h.flags&2064)||md||(md=!0,X0(Ad,function(){return Zl(),null})),I=(h.flags&15990)!==0,h.subtreeFlags&15990||I){I=Bn.transition,Bn.transition=null;var S=Yt;Yt=1;var d=$t;$t|=4,Lg.current=null,iS(i,h),j0(h,i),C2(Em),Ld=!!Im,Em=Im=null,i.current=h,nS(h),Lb(),$t=d,Yt=S,Bn.transition=I}else i.current=h;if(md&&(md=!1,Ma=i,Kd=b),I=i.pendingLanes,I===0&&(Fa=null),Bb(h.stateNode),sn(i,Ar()),a!==null)for(_=i.onRecoverableError,h=0;h<a.length;h++)b=a[h],_(b.value,{componentStack:b.stack,digest:b.digest});if(Xd)throw Xd=!1,i=Hm,Hm=null,i;return Kd&1&&i.tag!==0&&Zl(),I=i.pendingLanes,I&1?i===Wm?Cc++:(Cc=0,Wm=i):Cc=0,$a(),null}function Zl(){if(Ma!==null){var i=Ix(Kd),a=Bn.transition,h=Yt;try{if(Bn.transition=null,Yt=16>i?16:i,Ma===null)var _=!1;else{if(i=Ma,Ma=null,Kd=0,$t&6)throw Error(Ce(331));var b=$t;for($t|=4,rt=i.current;rt!==null;){var I=rt,S=I.child;if(rt.flags&16){var d=I.deletions;if(d!==null){for(var U=0;U<d.length;U++){var ne=d[U];for(rt=ne;rt!==null;){var ye=rt;switch(ye.tag){case 0:case 11:case 15:Ec(8,ye,I)}var Q=ye.child;if(Q!==null)Q.return=ye,rt=Q;else for(;rt!==null;){ye=rt;var W=ye.sibling,De=ye.return;if(B0(ye),ye===ne){rt=null;break}if(W!==null){W.return=De,rt=W;break}rt=De}}}var Me=I.alternate;if(Me!==null){var Pe=Me.child;if(Pe!==null){Me.child=null;do{var _t=Pe.sibling;Pe.sibling=null,Pe=_t}while(Pe!==null)}}rt=I}}if(I.subtreeFlags&2064&&S!==null)S.return=I,rt=S;else e:for(;rt!==null;){if(I=rt,I.flags&2048)switch(I.tag){case 0:case 11:case 15:Ec(9,I,I.return)}var oe=I.sibling;if(oe!==null){oe.return=I.return,rt=oe;break e}rt=I.return}}var ee=i.current;for(rt=ee;rt!==null;){S=rt;var he=S.child;if(S.subtreeFlags&2064&&he!==null)he.return=S,rt=he;else e:for(S=ee;rt!==null;){if(d=rt,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:lp(9,d)}}catch(Ue){Cr(d,d.return,Ue)}if(d===S){rt=null;break e}var Se=d.sibling;if(Se!==null){Se.return=d.return,rt=Se;break e}rt=d.return}}if($t=b,$a(),ps&&typeof ps.onPostCommitFiberRoot=="function")try{ps.onPostCommitFiberRoot(ep,i)}catch{}_=!0}return _}finally{Yt=h,Bn.transition=a}}return!1}function Dv(i,a,h){a=Kl(h,a),a=I0(i,a,1),i=Ra(i,a,1),a=Ui(),i!==null&&(Wc(i,1,a),sn(i,a))}function Cr(i,a,h){if(i.tag===3)Dv(i,i,h);else for(;a!==null;){if(a.tag===3){Dv(a,i,h);break}else if(a.tag===1){var _=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(Fa===null||!Fa.has(_))){i=Kl(h,i),i=E0(a,i,1),a=Ra(a,i,1),i=Ui(),a!==null&&(Wc(a,1,i),sn(a,i));break}}a=a.return}}function cS(i,a,h){var _=i.pingCache;_!==null&&_.delete(a),a=Ui(),i.pingedLanes|=i.suspendedLanes&h,ni===i&&(pi&h)===h&&(qr===4||qr===3&&(pi&130023424)===pi&&500>Ar()-Fg?So(i,0):Rg|=h),sn(i,a)}function H0(i,a){a===0&&(i.mode&1?(a=sd,sd<<=1,!(sd&130023424)&&(sd=4194304)):a=1);var h=Ui();i=Us(i,a),i!==null&&(Wc(i,a,h),sn(i,h))}function hS(i){var a=i.memoizedState,h=0;a!==null&&(h=a.retryLane),H0(i,h)}function dS(i,a){var h=0;switch(i.tag){case 13:var _=i.stateNode,b=i.memoizedState;b!==null&&(h=b.retryLane);break;case 19:_=i.stateNode;break;default:throw Error(Ce(314))}_!==null&&_.delete(a),H0(i,h)}var W0;W0=function(i,a,h){if(i!==null)if(i.memoizedProps!==a.pendingProps||rn.current)tn=!0;else{if(!(i.lanes&h)&&!(a.flags&128))return tn=!1,Q2(i,a,h);tn=!!(i.flags&131072)}else tn=!1,_r&&a.flags&1048576&&Yx(a,Vd,a.index);switch(a.lanes=0,a.tag){case 2:var _=a.type;kd(i,a),i=a.pendingProps;var b=Gl(a,Ci.current);$l(a,h),b=Cg(null,a,_,i,b,h);var I=Mg();return a.flags|=1,typeof b=="object"&&b!==null&&typeof b.render=="function"&&b.$$typeof===void 0?(a.tag=1,a.memoizedState=null,a.updateQueue=null,nn(_)?(I=!0,Nd(a)):I=!1,a.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,Tg(a),b.updater=op,a.stateNode=b,b._reactInternals=a,Fm(a,_,i,h),a=Nm(null,a,_,!0,I,h)):(a.tag=0,_r&&I&&_g(a),Vi(null,a,b,h),a=a.child),a;case 16:_=a.elementType;e:{switch(kd(i,a),i=a.pendingProps,b=_._init,_=b(_._payload),a.type=_,b=a.tag=fS(_),i=Xn(_,i),b){case 0:a=Om(null,a,_,i,h);break e;case 1:a=Sv(null,a,_,i,h);break e;case 11:a=wv(null,a,_,i,h);break e;case 14:a=bv(null,a,_,Xn(_.type,i),h);break e}throw Error(Ce(306,_,""))}return a;case 0:return _=a.type,b=a.pendingProps,b=a.elementType===_?b:Xn(_,b),Om(i,a,_,b,h);case 1:return _=a.type,b=a.pendingProps,b=a.elementType===_?b:Xn(_,b),Sv(i,a,_,b,h);case 3:e:{if(z0(a),i===null)throw Error(Ce(387));_=a.pendingProps,I=a.memoizedState,b=I.element,n0(i,a),Zd(a,_,null,h);var S=a.memoizedState;if(_=S.element,I.isDehydrated)if(I={element:_,isDehydrated:!1,cache:S.cache,pendingSuspenseBoundaries:S.pendingSuspenseBoundaries,transitions:S.transitions},a.updateQueue.baseState=I,a.memoizedState=I,a.flags&256){b=Kl(Error(Ce(423)),a),a=Tv(i,a,_,h,b);break e}else if(_!==b){b=Kl(Error(Ce(424)),a),a=Tv(i,a,_,h,b);break e}else for(wn=La(a.stateNode.containerInfo.firstChild),bn=a,_r=!0,Jn=null,h=r0(a,null,_,h),a.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Hl(),_===b){a=$s(i,a,h);break e}Vi(i,a,_,h)}a=a.child}return a;case 5:return s0(a),i===null&&Dm(a),_=a.type,b=a.pendingProps,I=i!==null?i.memoizedProps:null,S=b.children,Pm(_,b)?S=null:I!==null&&Pm(_,I)&&(a.flags|=32),M0(i,a),Vi(i,a,S,h),a.child;case 6:return i===null&&Dm(a),null;case 13:return A0(i,a,h);case 4:return kg(a,a.stateNode.containerInfo),_=a.pendingProps,i===null?a.child=Wl(a,null,_,h):Vi(i,a,_,h),a.child;case 11:return _=a.type,b=a.pendingProps,b=a.elementType===_?b:Xn(_,b),wv(i,a,_,b,h);case 7:return Vi(i,a,a.pendingProps,h),a.child;case 8:return Vi(i,a,a.pendingProps.children,h),a.child;case 12:return Vi(i,a,a.pendingProps.children,h),a.child;case 10:e:{if(_=a.type._context,b=a.pendingProps,I=a.memoizedProps,S=b.value,lr(Ud,_._currentValue),_._currentValue=S,I!==null)if(es(I.value,S)){if(I.children===b.children&&!rn.current){a=$s(i,a,h);break e}}else for(I=a.child,I!==null&&(I.return=a);I!==null;){var d=I.dependencies;if(d!==null){S=I.child;for(var U=d.firstContext;U!==null;){if(U.context===_){if(I.tag===1){U=Ns(-1,h&-h),U.tag=2;var ne=I.updateQueue;if(ne!==null){ne=ne.shared;var ye=ne.pending;ye===null?U.next=U:(U.next=ye.next,ye.next=U),ne.pending=U}}I.lanes|=h,U=I.alternate,U!==null&&(U.lanes|=h),Lm(I.return,h,a),d.lanes|=h;break}U=U.next}}else if(I.tag===10)S=I.type===a.type?null:I.child;else if(I.tag===18){if(S=I.return,S===null)throw Error(Ce(341));S.lanes|=h,d=S.alternate,d!==null&&(d.lanes|=h),Lm(S,h,a),S=I.sibling}else S=I.child;if(S!==null)S.return=I;else for(S=I;S!==null;){if(S===a){S=null;break}if(I=S.sibling,I!==null){I.return=S.return,S=I;break}S=S.return}I=S}Vi(i,a,b.children,h),a=a.child}return a;case 9:return b=a.type,_=a.pendingProps.children,$l(a,h),b=On(b),_=_(b),a.flags|=1,Vi(i,a,_,h),a.child;case 14:return _=a.type,b=Xn(_,a.pendingProps),b=Xn(_.type,b),bv(i,a,_,b,h);case 15:return P0(i,a,a.type,a.pendingProps,h);case 17:return _=a.type,b=a.pendingProps,b=a.elementType===_?b:Xn(_,b),kd(i,a),a.tag=1,nn(_)?(i=!0,Nd(a)):i=!1,$l(a,h),k0(a,_,b),Fm(a,_,b,h),Nm(null,a,_,!0,i,h);case 19:return D0(i,a,h);case 22:return C0(i,a,h)}throw Error(Ce(156,a.tag))};function X0(i,a){return bx(i,a)}function pS(i,a,h,_){this.tag=i,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fn(i,a,h,_){return new pS(i,a,h,_)}function jg(i){return i=i.prototype,!(!i||!i.isReactComponent)}function fS(i){if(typeof i=="function")return jg(i)?1:0;if(i!=null){if(i=i.$$typeof,i===sg)return 11;if(i===ag)return 14}return 2}function Oa(i,a){var h=i.alternate;return h===null?(h=Fn(i.tag,a,i.key,i.mode),h.elementType=i.elementType,h.type=i.type,h.stateNode=i.stateNode,h.alternate=i,i.alternate=h):(h.pendingProps=a,h.type=i.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=i.flags&14680064,h.childLanes=i.childLanes,h.lanes=i.lanes,h.child=i.child,h.memoizedProps=i.memoizedProps,h.memoizedState=i.memoizedState,h.updateQueue=i.updateQueue,a=i.dependencies,h.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},h.sibling=i.sibling,h.index=i.index,h.ref=i.ref,h}function Pd(i,a,h,_,b,I){var S=2;if(_=i,typeof i=="function")jg(i)&&(S=1);else if(typeof i=="string")S=5;else e:switch(i){case Pl:return To(h.children,b,I,a);case ng:S=8,b|=8;break;case am:return i=Fn(12,h,a,b|2),i.elementType=am,i.lanes=I,i;case om:return i=Fn(13,h,a,b),i.elementType=om,i.lanes=I,i;case lm:return i=Fn(19,h,a,b),i.elementType=lm,i.lanes=I,i;case sx:return cp(h,b,I,a);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case ix:S=10;break e;case nx:S=9;break e;case sg:S=11;break e;case ag:S=14;break e;case ka:S=16,_=null;break e}throw Error(Ce(130,i==null?i:typeof i,""))}return a=Fn(S,h,a,b),a.elementType=i,a.type=_,a.lanes=I,a}function To(i,a,h,_){return i=Fn(7,i,_,a),i.lanes=h,i}function cp(i,a,h,_){return i=Fn(22,i,_,a),i.elementType=sx,i.lanes=h,i.stateNode={isHidden:!1},i}function tm(i,a,h){return i=Fn(6,i,null,a),i.lanes=h,i}function rm(i,a,h){return a=Fn(4,i.children!==null?i.children:[],i.key,a),a.lanes=h,a.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},a}function mS(i,a,h,_,b){this.tag=a,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ff(0),this.expirationTimes=Ff(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ff(0),this.identifierPrefix=_,this.onRecoverableError=b,this.mutableSourceEagerHydrationData=null}function Vg(i,a,h,_,b,I,S,d,U){return i=new mS(i,a,h,d,U),a===1?(a=1,I===!0&&(a|=8)):a=0,I=Fn(3,null,null,a),i.current=I,I.stateNode=i,I.memoizedState={element:_,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},Tg(I),i}function gS(i,a,h){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:El,key:_==null?null:""+_,children:i,containerInfo:a,implementation:h}}function K0(i){if(!i)return ja;i=i._reactInternals;e:{if(zo(i)!==i||i.tag!==1)throw Error(Ce(170));var a=i;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(nn(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(Ce(171))}if(i.tag===1){var h=i.type;if(nn(h))return Kx(i,h,a)}return a}function J0(i,a,h,_,b,I,S,d,U){return i=Vg(h,_,!0,i,b,I,S,d,U),i.context=K0(null),h=i.current,_=Ui(),b=Ba(h),I=Ns(_,b),I.callback=a??null,Ra(h,I,b),i.current.lanes=b,Wc(i,b,_),sn(i,_),i}function hp(i,a,h,_){var b=a.current,I=Ui(),S=Ba(b);return h=K0(h),a.context===null?a.context=h:a.pendingContext=h,a=Ns(I,S),a.payload={element:i},_=_===void 0?null:_,_!==null&&(a.callback=_),i=Ra(b,a,S),i!==null&&(Qn(i,b,S,I),bd(i,b,S)),S}function Yd(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function Lv(i,a){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var h=i.retryLane;i.retryLane=h!==0&&h<a?h:a}}function Ug(i,a){Lv(i,a),(i=i.alternate)&&Lv(i,a)}function _S(){return null}var Y0=typeof reportError=="function"?reportError:function(i){console.error(i)};function $g(i){this._internalRoot=i}dp.prototype.render=$g.prototype.render=function(i){var a=this._internalRoot;if(a===null)throw Error(Ce(409));hp(i,a,null,null)};dp.prototype.unmount=$g.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var a=i.containerInfo;Co(function(){hp(null,i,null,null)}),a[Vs]=null}};function dp(i){this._internalRoot=i}dp.prototype.unstable_scheduleHydration=function(i){if(i){var a=Cx();i={blockedOn:null,target:i,priority:a};for(var h=0;h<Ea.length&&a!==0&&a<Ea[h].priority;h++);Ea.splice(h,0,i),h===0&&zx(i)}};function Zg(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function pp(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function Rv(){}function yS(i,a,h,_,b){if(b){if(typeof _=="function"){var I=_;_=function(){var ne=Yd(S);I.call(ne)}}var S=J0(a,_,i,0,null,!1,!1,"",Rv);return i._reactRootContainer=S,i[Vs]=S.current,Oc(i.nodeType===8?i.parentNode:i),Co(),S}for(;b=i.lastChild;)i.removeChild(b);if(typeof _=="function"){var d=_;_=function(){var ne=Yd(U);d.call(ne)}}var U=Vg(i,0,!1,null,null,!1,!1,"",Rv);return i._reactRootContainer=U,i[Vs]=U.current,Oc(i.nodeType===8?i.parentNode:i),Co(function(){hp(a,U,h,_)}),U}function fp(i,a,h,_,b){var I=h._reactRootContainer;if(I){var S=I;if(typeof b=="function"){var d=b;b=function(){var U=Yd(S);d.call(U)}}hp(a,S,i,b)}else S=yS(h,a,i,b,_);return Yd(S)}Ex=function(i){switch(i.tag){case 3:var a=i.stateNode;if(a.current.memoizedState.isDehydrated){var h=vc(a.pendingLanes);h!==0&&(ug(a,h|1),sn(a,Ar()),!($t&6)&&(Jl=Ar()+500,$a()))}break;case 13:Co(function(){var _=Us(i,1);if(_!==null){var b=Ui();Qn(_,i,1,b)}}),Ug(i,1)}};cg=function(i){if(i.tag===13){var a=Us(i,134217728);if(a!==null){var h=Ui();Qn(a,i,134217728,h)}Ug(i,134217728)}};Px=function(i){if(i.tag===13){var a=Ba(i),h=Us(i,a);if(h!==null){var _=Ui();Qn(h,i,a,_)}Ug(i,a)}};Cx=function(){return Yt};Mx=function(i,a){var h=Yt;try{return Yt=i,a()}finally{Yt=h}};ym=function(i,a,h){switch(a){case"input":if(hm(i,h),a=h.name,h.type==="radio"&&a!=null){for(h=i;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+a)+'][type="radio"]'),a=0;a<h.length;a++){var _=h[a];if(_!==i&&_.form===i.form){var b=np(_);if(!b)throw Error(Ce(90));ox(_),hm(_,b)}}}break;case"textarea":ux(i,h);break;case"select":a=h.value,a!=null&&Nl(i,!!h.multiple,a,!1)}};gx=Bg;_x=Co;var vS={usingClientEntryPoint:!1,Events:[Kc,Al,np,fx,mx,Bg]},gc={findFiberByHostInstance:xo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},xS={bundleType:gc.bundleType,version:gc.version,rendererPackageName:gc.rendererPackageName,rendererConfig:gc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Zs.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=xx(i),i===null?null:i.stateNode},findFiberByHostInstance:gc.findFiberByHostInstance||_S,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var gd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gd.isDisabled&&gd.supportsFiber)try{ep=gd.inject(xS),ps=gd}catch{}}Tn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vS;Tn.createPortal=function(i,a){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Zg(a))throw Error(Ce(200));return gS(i,a,null,h)};Tn.createRoot=function(i,a){if(!Zg(i))throw Error(Ce(299));var h=!1,_="",b=Y0;return a!=null&&(a.unstable_strictMode===!0&&(h=!0),a.identifierPrefix!==void 0&&(_=a.identifierPrefix),a.onRecoverableError!==void 0&&(b=a.onRecoverableError)),a=Vg(i,1,!1,null,null,h,!1,_,b),i[Vs]=a.current,Oc(i.nodeType===8?i.parentNode:i),new $g(a)};Tn.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var a=i._reactInternals;if(a===void 0)throw typeof i.render=="function"?Error(Ce(188)):(i=Object.keys(i).join(","),Error(Ce(268,i)));return i=xx(a),i=i===null?null:i.stateNode,i};Tn.flushSync=function(i){return Co(i)};Tn.hydrate=function(i,a,h){if(!pp(a))throw Error(Ce(200));return fp(null,i,a,!0,h)};Tn.hydrateRoot=function(i,a,h){if(!Zg(i))throw Error(Ce(405));var _=h!=null&&h.hydratedSources||null,b=!1,I="",S=Y0;if(h!=null&&(h.unstable_strictMode===!0&&(b=!0),h.identifierPrefix!==void 0&&(I=h.identifierPrefix),h.onRecoverableError!==void 0&&(S=h.onRecoverableError)),a=J0(a,null,i,1,h??null,b,!1,I,S),i[Vs]=a.current,Oc(i),_)for(i=0;i<_.length;i++)h=_[i],b=h._getVersion,b=b(h._source),a.mutableSourceEagerHydrationData==null?a.mutableSourceEagerHydrationData=[h,b]:a.mutableSourceEagerHydrationData.push(h,b);return new dp(a)};Tn.render=function(i,a,h){if(!pp(a))throw Error(Ce(200));return fp(null,i,a,!1,h)};Tn.unmountComponentAtNode=function(i){if(!pp(i))throw Error(Ce(40));return i._reactRootContainer?(Co(function(){fp(null,null,i,!1,function(){i._reactRootContainer=null,i[Vs]=null})}),!0):!1};Tn.unstable_batchedUpdates=Bg;Tn.unstable_renderSubtreeIntoContainer=function(i,a,h,_){if(!pp(h))throw Error(Ce(200));if(i==null||i._reactInternals===void 0)throw Error(Ce(38));return fp(i,a,h,!1,_)};Tn.version="18.3.1-next-f1338f8080-20240426";function Q0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Q0)}catch(i){console.error(i)}}Q0(),Qv.exports=Tn;var wS=Qv.exports,Fv=wS;nm.createRoot=Fv.createRoot,nm.hydrateRoot=Fv.hydrateRoot;const bS="modulepreload",SS=function(i){return"/map-webapp/"+i},Bv={},TS=function(a,h,_){let b=Promise.resolve();if(h&&h.length>0){document.getElementsByTagName("link");const S=document.querySelector("meta[property=csp-nonce]"),d=(S==null?void 0:S.nonce)||(S==null?void 0:S.getAttribute("nonce"));b=Promise.allSettled(h.map(U=>{if(U=SS(U),U in Bv)return;Bv[U]=!0;const ne=U.endsWith(".css"),ye=ne?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${U}"]${ye}`))return;const Q=document.createElement("link");if(Q.rel=ne?"stylesheet":bS,ne||(Q.as="script"),Q.crossOrigin="",Q.href=U,d&&Q.setAttribute("nonce",d),document.head.appendChild(Q),ne)return new Promise((W,De)=>{Q.addEventListener("load",W),Q.addEventListener("error",()=>De(new Error(`Unable to preload CSS for ${U}`)))})}))}function I(S){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=S,window.dispatchEvent(d),!d.defaultPrevented)throw S}return b.then(S=>{for(const d of S||[])d.status==="rejected"&&I(d.reason);return a().catch(I)})};function kS(i={}){const{immediate:a=!1,onNeedRefresh:h,onOfflineReady:_,onRegistered:b,onRegisteredSW:I,onRegisterError:S}=i;let d,U;const ne=async(Q=!0)=>{await U};async function ye(){if("serviceWorker"in navigator){if(d=await TS(async()=>{const{Workbox:Q}=await import("./workbox-window.prod.es5-vqzQaGvo.js");return{Workbox:Q}},[]).then(({Workbox:Q})=>new Q("/map-webapp/sw.js",{scope:"/map-webapp/",type:"classic"})).catch(Q=>{S==null||S(Q)}),!d)return;d.addEventListener("activated",Q=>{(Q.isUpdate||Q.isExternal)&&window.location.reload()}),d.addEventListener("installed",Q=>{Q.isUpdate||_==null||_()}),d.register({immediate:a}).then(Q=>{I?I("/map-webapp/sw.js",Q):b==null||b(Q)}).catch(Q=>{S==null||S(Q)})}}return U=ye(),ne}var e1={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(i,a){(function(h,_){i.exports=_()})(Ww,function(){var h={},_={};function b(S,d,U){if(_[S]=U,S==="index"){var ne="var sharedModule = {}; ("+_.shared+")(sharedModule); ("+_.worker+")(sharedModule);",ye={};return _.shared(ye),_.index(h,ye),typeof window<"u"&&h.setWorkerUrl(window.URL.createObjectURL(new Blob([ne],{type:"text/javascript"}))),h}}b("shared",["exports"],function(S){function d(r,t,n,o){return new(n||(n=Promise))(function(c,m){function g(k){try{x(o.next(k))}catch(E){m(E)}}function y(k){try{x(o.throw(k))}catch(E){m(E)}}function x(k){var E;k.done?c(k.value):(E=k.value,E instanceof n?E:new n(function(C){C(E)})).then(g,y)}x((o=o.apply(r,t||[])).next())})}function U(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var ne=ye;function ye(r,t){this.x=r,this.y=t}ye.prototype={clone:function(){return new ye(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,t){return this.clone()._rotateAround(r,t)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var t=r.x-this.x,n=r.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult:function(r){var t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var t=Math.cos(r),n=Math.sin(r),o=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=o,this},_rotateAround:function(r,t){var n=Math.cos(r),o=Math.sin(r),c=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-o*(this.y-t.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ye.convert=function(r){return r instanceof ye?r:Array.isArray(r)?new ye(r[0],r[1]):r};var Q=U(ne),W=De;function De(r,t,n,o){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=n,this.p2y=o}De.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,o=0;o<8;o++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<t)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var g=0,y=1;for(n=r,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<t));o++)r>c?g=n:y=n,n=.5*(y-g)+g;return n},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var Me=U(W);let Pe,_t;function oe(){return Pe==null&&(Pe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Pe}function ee(){if(_t==null&&(_t=!1,oe())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<5*5;o++){const c=4*o;t.fillStyle=`rgb(${c},${c+1},${c+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&n[o]!==o){_t=!0;break}}}return _t||!1}function he(r,t,n,o){const c=new Me(r,t,n,o);return m=>c.solve(m)}const Se=he(.25,.1,.25,1);function Ue(r,t,n){return Math.min(n,Math.max(t,r))}function Xe(r,t,n){const o=n-t,c=((r-t)%o+o)%o+t;return c===t?n:c}function Ge(r,...t){for(const n of t)for(const o in n)r[o]=n[o];return r}let it=1;function Rt(r,t,n){const o={};for(const c in r)o[c]=t.call(this,r[c],c,r);return o}function vt(r,t,n){const o={};for(const c in r)t.call(this,r[c],c,r)&&(o[c]=r[c]);return o}function wt(r){return Array.isArray(r)?r.map(wt):typeof r=="object"&&r?Rt(r,wt):r}const Mi={};function Qt(r){Mi[r]||(typeof console<"u"&&console.warn(r),Mi[r]=!0)}function Ot(r,t,n){return(n.y-r.y)*(t.x-r.x)>(t.y-r.y)*(n.x-r.x)}function Tr(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let zi=null;function jr(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const He="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ht(r,t,n,o,c){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(r,{timestamp:0});try{const g=m==null?void 0:m.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const y=g.startsWith("BGR"),x=new Uint8ClampedArray(o*c*4);if(yield m.copyTo(x,function(k,E,C,A,R){const B=4*Math.max(-E,0),N=(Math.max(0,C)-C)*A*4+B,G=4*A,X=Math.max(0,E),de=Math.max(0,C);return{rect:{x:X,y:de,width:Math.min(k.width,E+A)-X,height:Math.min(k.height,C+R)-de},layout:[{offset:N,stride:G}]}}(r,t,n,o,c)),y)for(let k=0;k<x.length;k+=4){const E=x[k];x[k]=x[k+2],x[k+2]=E}return x}finally{m.close()}})}let ut,It;const Nt="AbortError";function si(){return new Error(Nt)}const er={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Dr(r){return er.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const Gr="global-dispatcher";class ur extends Error{constructor(t,n,o,c){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=c}}const mi=()=>Tr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,at=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const o=Dr(r.url);if(o)return o(r,t);if(Tr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:Gr},t)}if(!(/^file:/.test(n=r.url)||/^file:/.test(mi())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,c){return d(this,void 0,void 0,function*(){const m=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:mi(),signal:c.signal});o.type!=="json"||m.headers.has("Accept")||m.headers.set("Accept","application/json");const g=yield fetch(m);if(!g.ok){const k=yield g.blob();throw new ur(g.status,g.statusText,o.url,k)}let y;y=o.type==="arrayBuffer"||o.type==="image"?g.arrayBuffer():o.type==="json"?g.json():g.text();const x=yield y;if(c.signal.aborted)throw si();return{data:x,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}})}(r,t);if(Tr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:Gr},t)}var n;return function(o,c){return new Promise((m,g)=>{var y;const x=new XMLHttpRequest;x.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(x.responseType="arraybuffer");for(const k in o.headers)x.setRequestHeader(k,o.headers[k]);o.type==="json"&&(x.responseType="text",!((y=o.headers)===null||y===void 0)&&y.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=o.credentials==="include",x.onerror=()=>{g(new Error(x.statusText))},x.onload=()=>{if(!c.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let k=x.response;if(o.type==="json")try{k=JSON.parse(x.response)}catch(E){return void g(E)}m({data:k,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const k=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});g(new ur(x.status,x.statusText,o.url,k))}},c.signal.addEventListener("abort",()=>{x.abort(),g(si())}),x.send(o.body)})}(r,t)};function qi(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const t=new URL(r),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function ms(r,t,n){n[r]&&n[r].indexOf(t)!==-1||(n[r]=n[r]||[],n[r].push(t))}function Hr(r,t,n){if(n&&n[r]){const o=n[r].indexOf(t);o!==-1&&n[r].splice(o,1)}}class ai{constructor(t,n={}){Ge(this,n),this.type=t}}class In extends ai{constructor(t,n={}){super("error",Ge({error:t},n))}}class ts{on(t,n){return this._listeners=this._listeners||{},ms(t,n,this._listeners),this}off(t,n){return Hr(t,n,this._listeners),Hr(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},ms(t,n,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,n){typeof t=="string"&&(t=new ai(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const y of c)y.call(this,t);const m=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const y of m)Hr(o,y,this._oneTimeListeners),y.call(this,t);const g=this._eventedParent;g&&(Ge(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof In&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const jn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Vn(r,t){const n={};for(const o in r)o!=="ref"&&(n[o]=r[o]);return jn.forEach(o=>{o in t&&(n[o]=t[o])}),n}function Ct(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(!Ct(r[n],t[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(const n in r)if(!Ct(r[n],t[n]))return!1;return!0}return r===t}function tr(r,t){r.push(t)}function En(r,t,n){tr(n,{command:"addSource",args:[r,t[r]]})}function Ai(r,t,n){tr(t,{command:"removeSource",args:[r]}),n[r]=!0}function Wr(r,t,n,o){Ai(r,n,o),En(r,t,n)}function Un(r,t,n){let o;for(o in r[n])if(Object.prototype.hasOwnProperty.call(r[n],o)&&o!=="data"&&!Ct(r[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!Ct(r[n][o],t[n][o]))return!1;return!0}function Mr(r,t,n,o,c,m){r=r||{},t=t||{};for(const g in r)Object.prototype.hasOwnProperty.call(r,g)&&(Ct(r[g],t[g])||n.push({command:m,args:[o,g,t[g],c]}));for(const g in t)Object.prototype.hasOwnProperty.call(t,g)&&!Object.prototype.hasOwnProperty.call(r,g)&&(Ct(r[g],t[g])||n.push({command:m,args:[o,g,t[g],c]}))}function gs(r){return r.id}function _s(r,t){return r[t.id]=t,r}class ke{constructor(t,n,o,c){this.message=(t?`${t}: `:"")+o,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function an(r,...t){for(const n of t)for(const o in n)r[o]=n[o];return r}class kr extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class yr{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,c]of n)this.bindings[o]=c}concat(t){return new yr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const gi={kind:"null"},Ee={kind:"number"},yt={kind:"string"},lt={kind:"boolean"},Lr={kind:"color"},_i={kind:"object"},mt={kind:"value"},Ie={kind:"collator"},ct={kind:"formatted"},bt={kind:"padding"},Ut={kind:"resolvedImage"},$={kind:"variableAnchorOffsetCollection"};function D(r,t){return{kind:"array",itemType:r,N:t}}function L(r){if(r.kind==="array"){const t=L(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const O=[gi,Ee,yt,lt,Lr,ct,_i,D(mt),bt,Ut,$];function Z(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Z(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const n of O)if(!Z(n,t))return null}}return`Expected ${L(r)} but found ${L(t)} instead.`}function te(r,t){return t.some(n=>n.kind===r.kind)}function se(r,t){return t.some(n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r)}function ce(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}const Y=.96422,_e=.82521,we=4/29,fe=6/29,ze=3*fe*fe,tt=fe*fe*fe,nt=Math.PI/180,At=180/Math.PI;function gt(r){return(r%=360)<0&&(r+=360),r}function Dt([r,t,n,o]){let c,m;const g=Ir((.2225045*(r=Et(r))+.7168786*(t=Et(t))+.0606169*(n=Et(n)))/1);r===t&&t===n?c=m=g:(c=Ir((.4360747*r+.3850649*t+.1430804*n)/Y),m=Ir((.0139322*r+.0971045*t+.7141733*n)/_e));const y=116*g-16;return[y<0?0:y,500*(c-g),200*(g-m),o]}function Et(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Ir(r){return r>tt?Math.pow(r,1/3):r/ze+we}function cr([r,t,n,o]){let c=(r+16)/116,m=isNaN(t)?c:c+t/500,g=isNaN(n)?c:c-n/200;return c=1*Zt(c),m=Y*Zt(m),g=_e*Zt(g),[St(3.1338561*m-1.6168667*c-.4906146*g),St(-.9787684*m+1.9161415*c+.033454*g),St(.0719453*m-.2289914*c+1.4052427*g),o]}function St(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Zt(r){return r>fe?r*r*r:ze*(r-we)}function or(r){return parseInt(r.padEnd(2,r),16)/255}function Rr(r,t){return Vr(t?r/100:r,0,1)}function Vr(r,t,n){return Math.min(Math.max(t,r),n)}function oi(r){return!r.some(Number.isNaN)}const qs={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class qt{constructor(t,n,o,c=1,m=!0){this.r=t,this.g=n,this.b=o,this.a=c,m||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[t,n,o,c]))}static parse(t){if(t instanceof qt)return t;if(typeof t!="string")return;const n=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=qs[o];if(c){const[g,y,x]=c;return[g/255,y/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const g=o.length<6?1:2;let y=1;return[or(o.slice(y,y+=g)),or(o.slice(y,y+=g)),or(o.slice(y,y+=g)),or(o.slice(y,y+g)||"ff")]}if(o.startsWith("rgb")){const g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[y,x,k,E,C,A,R,B,N,G,X,de]=g,ie=[E||" ",R||" ",G].join("");if(ie==="  "||ie==="  /"||ie===",,"||ie===",,,"){const ue=[k,A,N].join(""),ge=ue==="%%%"?100:ue===""?255:0;if(ge){const be=[Vr(+x/ge,0,1),Vr(+C/ge,0,1),Vr(+B/ge,0,1),X?Rr(+X,de):1];if(oi(be))return be}}return}}const m=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[g,y,x,k,E,C,A,R,B]=m,N=[x||" ",E||" ",A].join("");if(N==="  "||N==="  /"||N===",,"||N===",,,"){const G=[+y,Vr(+k,0,100),Vr(+C,0,100),R?Rr(+R,B):1];if(oi(G))return function([X,de,ie,ue]){function ge(be){const Ve=(be+X/30)%12,st=de*Math.min(ie,1-ie);return ie-st*Math.max(-1,Math.min(Ve-3,9-Ve,1))}return X=gt(X),de/=100,ie/=100,[ge(0),ge(8),ge(4),ue]}(G)}}}(t);return n?new qt(...n,!1):void 0}get rgb(){const{r:t,g:n,b:o,a:c}=this,m=c||1/0;return this.overwriteGetter("rgb",[t/m,n/m,o/m,c])}get hcl(){return this.overwriteGetter("hcl",function(t){const[n,o,c,m]=Dt(t),g=Math.sqrt(o*o+c*c);return[Math.round(1e4*g)?gt(Math.atan2(c,o)*At):NaN,g,n,m]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Dt(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,o,c]=this.rgb;return`rgba(${[t,n,o].map(m=>Math.round(255*m)).join(",")},${c})`}}qt.black=new qt(0,0,0,1),qt.white=new qt(1,1,1,1),qt.transparent=new qt(0,0,0,0),qt.red=new qt(1,0,0,1);class tu{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ru{constructor(t,n,o,c,m){this.text=t,this.image=n,this.scale=o,this.fontStack=c,this.textColor=m}}class Di{constructor(t){this.sections=t}static fromString(t){return new Di([new ru(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Di?t:Di.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Li{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Li)return t;if(typeof t=="number")return new Li([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Li(t)}}toString(){return JSON.stringify(this.values)}}const mp=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Gi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Gi)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const o=t[n],c=t[n+1];if(typeof o!="string"||!mp.has(o)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new Gi(t)}}toString(){return JSON.stringify(this.values)}}class Ri{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Ri({name:t,available:!1}):null}}function Gs(r,t,n,o){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,t,n,o]:[r,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ys(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof qt||r instanceof tu||r instanceof Di||r instanceof Li||r instanceof Gi||r instanceof Ri)return!0;if(Array.isArray(r)){for(const t of r)if(!ys(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!ys(r[t]))return!1;return!0}return!1}function Er(r){if(r===null)return gi;if(typeof r=="string")return yt;if(typeof r=="boolean")return lt;if(typeof r=="number")return Ee;if(r instanceof qt)return Lr;if(r instanceof tu)return Ie;if(r instanceof Di)return ct;if(r instanceof Li)return bt;if(r instanceof Gi)return $;if(r instanceof Ri)return Ut;if(Array.isArray(r)){const t=r.length;let n;for(const o of r){const c=Er(o);if(n){if(n===c)continue;n=mt;break}n=c}return D(n||mt,t)}return _i}function Za(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof qt||r instanceof Di||r instanceof Li||r instanceof Gi||r instanceof Ri?r.toString():JSON.stringify(r)}class on{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ys(t[1]))return n.error("invalid value");const o=t[1];let c=Er(o);const m=n.expectedType;return c.kind!=="array"||c.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(c=m),new on(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class vr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Ao={string:yt,number:Ee,boolean:lt,object:_i};class ln{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,c=1;const m=t[0];if(m==="array"){let y,x;if(t.length>2){const k=t[1];if(typeof k!="string"||!(k in Ao)||k==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);y=Ao[k],c++}else y=mt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=t[2],c++}o=D(y,x)}else{if(!Ao[m])throw new Error(`Types doesn't contain name = ${m}`);o=Ao[m]}const g=[];for(;c<t.length;c++){const y=n.parse(t[c],c,mt);if(!y)return null;g.push(y)}return new ln(o,g)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!Z(this.type,Er(o)))return o;if(n===this.args.length-1)throw new vr(`Expected value to be of type ${L(this.type)}, but found ${L(Er(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const iu={"to-boolean":lt,"to-color":Lr,"to-number":Ee,"to-string":yt};class un{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!iu[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const c=iu[o],m=[];for(let g=1;g<t.length;g++){const y=n.parse(t[g],g,mt);if(!y)return null;m.push(y)}return new un(c,m)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,o;for(const c of this.args){if(n=c.evaluate(t),o=null,n instanceof qt)return n;if(typeof n=="string"){const m=t.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Gs(n[0],n[1],n[2],n[3]),!o))return new qt(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new vr(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(t);const c=Li.parse(n);if(c)return c}throw new vr(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(t);const c=Gi.parse(n);if(c)return c}throw new vr(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new vr(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Di.fromString(Za(this.args[0].evaluate(t)));case"resolvedImage":return Ri.fromString(Za(this.args[0].evaluate(t)));default:return Za(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const gp=["Unknown","Point","LineString","Polygon"];class Do{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?gp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=qt.parse(t)),n}}class vs{constructor(t,n,o=[],c,m=new yr,g=[]){this.registry=t,this.path=o,this.key=o.map(y=>`[${y}]`).join(""),this.scope=m,this.errors=g,this.expectedType=c,this._isConstant=n}parse(t,n,o,c,m={}){return n?this.concat(n,o,c)._parse(t,m):this._parse(t,m)}_parse(t,n){function o(c,m,g){return g==="assert"?new ln(m,[c]):g==="coerce"?new un(m,[c]):c}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=t[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[c];if(m){let g=m.parse(t,this);if(!g)return null;if(this.expectedType){const y=this.expectedType,x=g.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string")if(y.kind!=="padding"||x.kind!=="value"&&x.kind!=="number"&&x.kind!=="array")if(y.kind!=="variableAnchorOffsetCollection"||x.kind!=="value"&&x.kind!=="array"){if(this.checkSubtype(y,x))return null}else g=o(g,y,n.typeAnnotation||"coerce");else g=o(g,y,n.typeAnnotation||"coerce");else g=o(g,y,n.typeAnnotation||"coerce");else g=o(g,y,n.typeAnnotation||"assert")}if(!(g instanceof on)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const y=new Do;try{g=new on(g.type,g.evaluate(y))}catch(x){return this.error(x.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const c=typeof t=="number"?this.path.concat(t):this.path,m=o?this.scope.concat(o):this.scope;return new vs(this.registry,this._isConstant,c,n||null,m,this.errors)}error(t,...n){const o=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new kr(o,t))}checkSubtype(t,n){const o=Z(t,n);return o&&this.error(o),o}}class rs{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let m=1;m<t.length-1;m+=2){const g=t[m];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);const y=n.parse(t[m+1],m+1);if(!y)return null;o.push([g,y])}const c=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return c?new rs(o,c):null}outputDefined(){return this.result.outputDefined()}}class jt{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new jt(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class nu{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Ee),c=n.parse(t[2],2,D(n.expectedType||mt));return o&&c?new nu(c.type.itemType,o,c):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new vr(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new vr(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new vr(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class su{constructor(t,n){this.type=lt,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,mt),c=n.parse(t[2],2,mt);return o&&c?te(o.type,[lt,yt,Ee,gi,mt])?new su(o,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${L(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!se(n,["boolean","string","number","null"]))throw new vr(`Expected first argument to be of type boolean, string, number or null, but found ${L(Er(n))} instead.`);if(!se(o,["string","array"]))throw new vr(`Expected second argument to be of type array or string, but found ${L(Er(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Hs{constructor(t,n,o){this.type=Ee,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,mt),c=n.parse(t[2],2,mt);if(!o||!c)return null;if(!te(o.type,[lt,yt,Ee,gi,mt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${L(o.type)} instead`);if(t.length===4){const m=n.parse(t[3],3,Ee);return m?new Hs(o,c,m):null}return new Hs(o,c)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!se(n,["boolean","string","number","null"]))throw new vr(`Expected first argument to be of type boolean, string, number or null, but found ${L(Er(n))} instead.`);let c;if(this.fromIndex&&(c=this.fromIndex.evaluate(t)),se(o,["string"])){const m=o.indexOf(n,c);return m===-1?-1:[...o.slice(0,m)].length}if(se(o,["array"]))return o.indexOf(n,c);throw new vr(`Expected second argument to be of type array or string, but found ${L(Er(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class au{constructor(t,n,o,c,m,g){this.inputType=t,this.type=n,this.input=o,this.cases=c,this.outputs=m,this.otherwise=g}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const m={},g=[];for(let k=2;k<t.length-1;k+=2){let E=t[k];const C=t[k+1];Array.isArray(E)||(E=[E]);const A=n.concat(k);if(E.length===0)return A.error("Expected at least one branch label.");for(const B of E){if(typeof B!="number"&&typeof B!="string")return A.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return A.error("Numeric branch labels must be integer values.");if(o){if(A.checkSubtype(o,Er(B)))return null}else o=Er(B);if(m[String(B)]!==void 0)return A.error("Branch labels must be unique.");m[String(B)]=g.length}const R=n.parse(C,k,c);if(!R)return null;c=c||R.type,g.push(R)}const y=n.parse(t[1],1,mt);if(!y)return null;const x=n.parse(t[t.length-1],t.length-1,c);return x?y.type.kind!=="value"&&n.concat(1).checkSubtype(o,y.type)?null:new au(o,c,y,m,g,x):null}evaluate(t){const n=this.input.evaluate(t);return(Er(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Lo{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const c=[];for(let g=1;g<t.length-1;g+=2){const y=n.parse(t[g],g,lt);if(!y)return null;const x=n.parse(t[g+1],g+1,o);if(!x)return null;c.push([y,x]),o=o||x.type}const m=n.parse(t[t.length-1],t.length-1,o);if(!m)return null;if(!o)throw new Error("Can't infer output type");return new Lo(o,c,m)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class qa{constructor(t,n,o,c){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=c}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,mt),c=n.parse(t[2],2,Ee);if(!o||!c)return null;if(!te(o.type,[D(mt),yt,mt]))return n.error(`Expected first argument to be of type array or string, but found ${L(o.type)} instead`);if(t.length===4){const m=n.parse(t[3],3,Ee);return m?new qa(o.type,o,c,m):null}return new qa(o.type,o,c)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let c;if(this.endIndex&&(c=this.endIndex.evaluate(t)),se(n,["string"]))return[...n].slice(o,c).join("");if(se(n,["array"]))return n.slice(o,c);throw new vr(`Expected first argument to be of type array or string, but found ${L(Er(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ro(r,t){const n=r.length-1;let o,c,m=0,g=n,y=0;for(;m<=g;)if(y=Math.floor((m+g)/2),o=r[y],c=r[y+1],o<=t){if(y===n||t<c)return y;m=y+1}else{if(!(o>t))throw new vr("Input is not a number.");g=y-1}return 0}class Ws{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[c,m]of o)this.labels.push(c),this.outputs.push(m)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,Ee);if(!o)return null;const c=[];let m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let g=1;g<t.length;g+=2){const y=g===1?-1/0:t[g],x=t[g+1],k=g,E=g+1;if(typeof y!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(c.length&&c[c.length-1][0]>=y)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const C=n.parse(x,E,m);if(!C)return null;m=m||C.type,c.push([y,C])}return new Ws(m,o,c)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const c=this.input.evaluate(t);if(c<=n[0])return o[0].evaluate(t);const m=n.length;return c>=n[m-1]?o[m-1].evaluate(t):o[Ro(n,c)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Yc(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var _p=Qc;function Qc(r,t,n,o){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=n,this.p2y=o}Qc.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,o=0;o<8;o++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<t)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var g=0,y=1;for(n=r,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<t));o++)r>c?g=n:y=n,n=.5*(y-g)+g;return n},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var yp=Yc(_p);function xs(r,t,n){return r+n*(t-r)}function Ga(r,t,n){return r.map((o,c)=>xs(o,t[c],n))}const yi={number:xs,color:function(r,t,n,o="rgb"){switch(o){case"rgb":{const[c,m,g,y]=Ga(r.rgb,t.rgb,n);return new qt(c,m,g,y,!1)}case"hcl":{const[c,m,g,y]=r.hcl,[x,k,E,C]=t.hcl;let A,R;if(isNaN(c)||isNaN(x))isNaN(c)?isNaN(x)?A=NaN:(A=x,g!==1&&g!==0||(R=k)):(A=c,E!==1&&E!==0||(R=m));else{let de=x-c;x>c&&de>180?de-=360:x<c&&c-x>180&&(de+=360),A=c+n*de}const[B,N,G,X]=function([de,ie,ue,ge]){return de=isNaN(de)?0:de*nt,cr([ue,Math.cos(de)*ie,Math.sin(de)*ie,ge])}([A,R??xs(m,k,n),xs(g,E,n),xs(y,C,n)]);return new qt(B,N,G,X,!1)}case"lab":{const[c,m,g,y]=cr(Ga(r.lab,t.lab,n));return new qt(c,m,g,y,!1)}}},array:Ga,padding:function(r,t,n){return new Li(Ga(r.values,t.values,n))},variableAnchorOffsetCollection:function(r,t,n){const o=r.values,c=t.values;if(o.length!==c.length)throw new vr(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${t.toString()}`);const m=[];for(let g=0;g<o.length;g+=2){if(o[g]!==c[g])throw new vr(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${o[g]}, to[${g}]: ${c[g]}`);m.push(o[g]);const[y,x]=o[g+1],[k,E]=c[g+1];m.push([xs(y,k,n),xs(x,E,n)])}return new Gi(m)}};class vi{constructor(t,n,o,c,m){this.type=t,this.operator=n,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[g,y]of m)this.labels.push(g),this.outputs.push(y)}static interpolationFactor(t,n,o,c){let m=0;if(t.name==="exponential")m=Fo(n,t.base,o,c);else if(t.name==="linear")m=Fo(n,1,o,c);else if(t.name==="cubic-bezier"){const g=t.controlPoints;m=new yp(g[0],g[1],g[2],g[3]).solve(Fo(n,1,o,c))}return m}static parse(t,n){let[o,c,m,...g]=t;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const k=c[1];if(typeof k!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:k}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const k=c.slice(1);if(k.length!==4||k.some(E=>typeof E!="number"||E<0||E>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:k}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,Ee),!m)return null;const y=[];let x=null;o==="interpolate-hcl"||o==="interpolate-lab"?x=Lr:n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType);for(let k=0;k<g.length;k+=2){const E=g[k],C=g[k+1],A=k+3,R=k+4;if(typeof E!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(y.length&&y[y.length-1][0]>=E)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const B=n.parse(C,R,x);if(!B)return null;x=x||B.type,y.push([E,B])}return ce(x,Ee)||ce(x,Lr)||ce(x,bt)||ce(x,$)||ce(x,D(Ee))?new vi(x,o,c,m,y):n.error(`Type ${L(x)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const c=this.input.evaluate(t);if(c<=n[0])return o[0].evaluate(t);const m=n.length;if(c>=n[m-1])return o[m-1].evaluate(t);const g=Ro(n,c),y=vi.interpolationFactor(this.interpolation,c,n[g],n[g+1]),x=o[g].evaluate(t),k=o[g+1].evaluate(t);switch(this.operator){case"interpolate":return yi[this.type.kind](x,k,y);case"interpolate-hcl":return yi.color(x,k,y,"hcl");case"interpolate-lab":return yi.color(x,k,y,"lab")}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Fo(r,t,n,o){const c=o-n,m=r-n;return c===0?0:t===1?m/c:(Math.pow(t,m)-1)/(Math.pow(t,c)-1)}class Bo{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let o=null;const c=n.expectedType;c&&c.kind!=="value"&&(o=c);const m=[];for(const y of t.slice(1)){const x=n.parse(y,1+m.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,m.push(x)}if(!o)throw new Error("No output type");const g=c&&m.some(y=>Z(c,y.type));return new Bo(g?mt:o,m)}evaluate(t){let n,o=null,c=0;for(const m of this.args)if(c++,o=m.evaluate(t),o&&o instanceof Ri&&!o.available&&(n||(n=o.name),o=null,c===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Oo(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function eh(r,t,n,o){return o.compare(t,n)===0}function Xs(r,t,n){const o=r!=="=="&&r!=="!=";return class t1{constructor(m,g,y){this.type=lt,this.lhs=m,this.rhs=g,this.collator=y,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const y=m[0];let x=g.parse(m[1],1,mt);if(!x)return null;if(!Oo(y,x.type))return g.concat(1).error(`"${y}" comparisons are not supported for type '${L(x.type)}'.`);let k=g.parse(m[2],2,mt);if(!k)return null;if(!Oo(y,k.type))return g.concat(2).error(`"${y}" comparisons are not supported for type '${L(k.type)}'.`);if(x.type.kind!==k.type.kind&&x.type.kind!=="value"&&k.type.kind!=="value")return g.error(`Cannot compare types '${L(x.type)}' and '${L(k.type)}'.`);o&&(x.type.kind==="value"&&k.type.kind!=="value"?x=new ln(k.type,[x]):x.type.kind!=="value"&&k.type.kind==="value"&&(k=new ln(x.type,[k])));let E=null;if(m.length===4){if(x.type.kind!=="string"&&k.type.kind!=="string"&&x.type.kind!=="value"&&k.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(E=g.parse(m[3],3,Ie),!E)return null}return new t1(x,k,E)}evaluate(m){const g=this.lhs.evaluate(m),y=this.rhs.evaluate(m);if(o&&this.hasUntypedArgument){const x=Er(g),k=Er(y);if(x.kind!==k.kind||x.kind!=="string"&&x.kind!=="number")throw new vr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${x.kind}, ${k.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=Er(g),k=Er(y);if(x.kind!=="string"||k.kind!=="string")return t(m,g,y)}return this.collator?n(m,g,y,this.collator.evaluate(m)):t(m,g,y)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const vp=Xs("==",function(r,t,n){return t===n},eh),th=Xs("!=",function(r,t,n){return t!==n},function(r,t,n,o){return!eh(0,t,n,o)}),rh=Xs("<",function(r,t,n){return t<n},function(r,t,n,o){return o.compare(t,n)<0}),xp=Xs(">",function(r,t,n){return t>n},function(r,t,n,o){return o.compare(t,n)>0}),wp=Xs("<=",function(r,t,n){return t<=n},function(r,t,n,o){return o.compare(t,n)<=0}),ih=Xs(">=",function(r,t,n){return t>=n},function(r,t,n,o){return o.compare(t,n)>=0});class Ha{constructor(t,n,o){this.type=Ie,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const c=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,lt);if(!c)return null;const m=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,lt);if(!m)return null;let g=null;return o.locale&&(g=n.parse(o.locale,1,yt),!g)?null:new Ha(c,m,g)}evaluate(t){return new tu(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class ou{constructor(t,n,o,c,m){this.type=yt,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=c,this.maxFractionDigits=m}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,Ee);if(!o)return null;const c=t[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let m=null;if(c.locale&&(m=n.parse(c.locale,1,yt),!m))return null;let g=null;if(c.currency&&(g=n.parse(c.currency,1,yt),!g))return null;let y=null;if(c["min-fraction-digits"]&&(y=n.parse(c["min-fraction-digits"],1,Ee),!y))return null;let x=null;return c["max-fraction-digits"]&&(x=n.parse(c["max-fraction-digits"],1,Ee),!x)?null:new ou(o,m,g,y,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class No{constructor(t){this.type=ct,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const c=[];let m=!1;for(let g=1;g<=t.length-1;++g){const y=t[g];if(m&&typeof y=="object"&&!Array.isArray(y)){m=!1;let x=null;if(y["font-scale"]&&(x=n.parse(y["font-scale"],1,Ee),!x))return null;let k=null;if(y["text-font"]&&(k=n.parse(y["text-font"],1,D(yt)),!k))return null;let E=null;if(y["text-color"]&&(E=n.parse(y["text-color"],1,Lr),!E))return null;const C=c[c.length-1];C.scale=x,C.font=k,C.textColor=E}else{const x=n.parse(t[g],1,mt);if(!x)return null;const k=x.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new No(c)}evaluate(t){return new Di(this.sections.map(n=>{const o=n.content.evaluate(t);return Er(o)===Ut?new ru("",o,null,null,null):new ru(Za(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}}class lu{constructor(t){this.type=Ut,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,yt);return o?new lu(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=Ri.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class uu{constructor(t){this.type=Ee,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${L(o.type)} instead.`):new uu(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new vr(`Expected value to be of type string or array, but found ${L(Er(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Pn=8192;function bp(r,t){const n=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,c=Math.pow(2,t.z);return[Math.round(n*c*Pn),Math.round(o*c*Pn)]}function cu(r,t){const n=Math.pow(2,t.z);return[(c=(r[0]/Pn+t.x)/n,360*c-180),(o=(r[1]/Pn+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,c}function ws(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function is(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function Vt(r,t,n){const o=r[0]-t[0],c=r[1]-t[1],m=r[0]-n[0],g=r[1]-n[1];return o*g-m*c==0&&o*m<=0&&c*g<=0}function jo(r,t,n,o){return(c=[o[0]-n[0],o[1]-n[1]])[0]*(m=[t[0]-r[0],t[1]-r[1]])[1]-c[1]*m[0]!=0&&!(!sh(r,t,n,o)||!sh(n,o,r,t));var c,m}function Sp(r,t,n){for(const o of n)for(let c=0;c<o.length-1;++c)if(jo(r,t,o[c],o[c+1]))return!0;return!1}function Ks(r,t,n=!1){let o=!1;for(const y of t)for(let x=0;x<y.length-1;x++){if(Vt(r,y[x],y[x+1]))return n;(m=y[x])[1]>(c=r)[1]!=(g=y[x+1])[1]>c[1]&&c[0]<(g[0]-m[0])*(c[1]-m[1])/(g[1]-m[1])+m[0]&&(o=!o)}var c,m,g;return o}function Tp(r,t){for(const n of t)if(Ks(r,n))return!0;return!1}function nh(r,t){for(const n of r)if(!Ks(n,t))return!1;for(let n=0;n<r.length-1;++n)if(Sp(r[n],r[n+1],t))return!1;return!0}function kp(r,t){for(const n of t)if(nh(r,n))return!0;return!1}function sh(r,t,n,o){const c=o[0]-n[0],m=o[1]-n[1],g=(r[0]-n[0])*m-c*(r[1]-n[1]),y=(t[0]-n[0])*m-c*(t[1]-n[1]);return g>0&&y<0||g<0&&y>0}function hu(r,t,n){const o=[];for(let c=0;c<r.length;c++){const m=[];for(let g=0;g<r[c].length;g++){const y=bp(r[c][g],n);ws(t,y),m.push(y)}o.push(m)}return o}function ah(r,t,n){const o=[];for(let c=0;c<r.length;c++){const m=hu(r[c],t,n);o.push(m)}return o}function oh(r,t,n,o){if(r[0]<n[0]||r[0]>n[2]){const c=.5*o;let m=r[0]-n[0]>c?-o:n[0]-r[0]>c?o:0;m===0&&(m=r[0]-n[2]>c?-o:n[2]-r[0]>c?o:0),r[0]+=m}ws(t,r)}function lh(r,t,n,o){const c=Math.pow(2,o.z)*Pn,m=[o.x*Pn,o.y*Pn],g=[];for(const y of r)for(const x of y){const k=[x.x+m[0],x.y+m[1]];oh(k,t,n,c),g.push(k)}return g}function uh(r,t,n,o){const c=Math.pow(2,o.z)*Pn,m=[o.x*Pn,o.y*Pn],g=[];for(const x of r){const k=[];for(const E of x){const C=[E.x+m[0],E.y+m[1]];ws(t,C),k.push(C)}g.push(k)}if(t[2]-t[0]<=c/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of g)for(const k of x)oh(k,t,n,c)}var y;return g}class bs{constructor(t,n){this.type=lt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ys(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const c=[];for(const m of o.features){const{type:g,coordinates:y}=m.geometry;g==="Polygon"&&c.push(y),g==="MultiPolygon"&&c.push(...y)}if(c.length)return new bs(o,{type:"MultiPolygon",coordinates:c})}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new bs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new bs(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const y=hu(o.coordinates,m,g),x=lh(n.geometry(),c,m,g);if(!is(c,m))return!1;for(const k of x)if(!Ks(k,y))return!1}if(o.type==="MultiPolygon"){const y=ah(o.coordinates,m,g),x=lh(n.geometry(),c,m,g);if(!is(c,m))return!1;for(const k of x)if(!Tp(k,y))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const y=hu(o.coordinates,m,g),x=uh(n.geometry(),c,m,g);if(!is(c,m))return!1;for(const k of x)if(!nh(k,y))return!1}if(o.type==="MultiPolygon"){const y=ah(o.coordinates,m,g),x=uh(n.geometry(),c,m,g);if(!is(c,m))return!1;for(const k of x)if(!kp(k,y))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ch=class{constructor(r=[],t=(n,o)=>n<o?-1:n>o?1:0){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:n}=this,o=t[r];for(;r>0;){const c=r-1>>1,m=t[c];if(n(o,m)>=0)break;t[r]=m,r=c}t[r]=o}_down(r){const{data:t,compare:n}=this,o=this.length>>1,c=t[r];for(;r<o;){let m=1+(r<<1);const g=m+1;if(g<this.length&&n(t[g],t[m])<0&&(m=g),n(t[m],c)>=0)break;t[r]=t[m],r=m}t[r]=c}};function Ip(r,t,n,o,c){hh(r,t,n,o||r.length-1,c||Ep)}function hh(r,t,n,o,c){for(;o>n;){if(o-n>600){var m=o-n+1,g=t-n+1,y=Math.log(m),x=.5*Math.exp(2*y/3),k=.5*Math.sqrt(y*x*(m-x)/m)*(g-m/2<0?-1:1);hh(r,t,Math.max(n,Math.floor(t-g*x/m+k)),Math.min(o,Math.floor(t+(m-g)*x/m+k)),c)}var E=r[t],C=n,A=o;for(Wa(r,n,t),c(r[o],E)>0&&Wa(r,n,o);C<A;){for(Wa(r,C,A),C++,A--;c(r[C],E)<0;)C++;for(;c(r[A],E)>0;)A--}c(r[n],E)===0?Wa(r,n,A):Wa(r,++A,o),A<=t&&(n=A+1),t<=A&&(o=A-1)}}function Wa(r,t,n){var o=r[t];r[t]=r[n],r[n]=o}function Ep(r,t){return r<t?-1:r>t?1:0}function Vo(r,t){if(r.length<=1)return[r];const n=[];let o,c;for(const m of r){const g=Cp(m);g!==0&&(m.area=Math.abs(g),c===void 0&&(c=g<0),c===g<0?(o&&n.push(o),o=[m]):o.push(m))}if(o&&n.push(o),t>1)for(let m=0;m<n.length;m++)n[m].length<=t||(Ip(n[m],t,1,n[m].length-1,Pp),n[m]=n[m].slice(0,t));return n}function Pp(r,t){return t.area-r.area}function Cp(r){let t=0;for(let n,o,c=0,m=r.length,g=m-1;c<m;g=c++)n=r[c],o=r[g],t+=(o.x-n.x)*(n.y+o.y);return t}const dh=1/298.257223563,ph=dh*(2-dh),fh=Math.PI/180;class du{constructor(t){const n=6378.137*fh*1e3,o=Math.cos(t*fh),c=1/(1-ph*(1-o*o)),m=Math.sqrt(c);this.kx=n*m*o,this.ky=n*m*c*(1-ph)}distance(t,n){const o=this.wrap(t[0]-n[0])*this.kx,c=(t[1]-n[1])*this.ky;return Math.sqrt(o*o+c*c)}pointOnLine(t,n){let o,c,m,g,y=1/0;for(let x=0;x<t.length-1;x++){let k=t[x][0],E=t[x][1],C=this.wrap(t[x+1][0]-k)*this.kx,A=(t[x+1][1]-E)*this.ky,R=0;C===0&&A===0||(R=(this.wrap(n[0]-k)*this.kx*C+(n[1]-E)*this.ky*A)/(C*C+A*A),R>1?(k=t[x+1][0],E=t[x+1][1]):R>0&&(k+=C/this.kx*R,E+=A/this.ky*R)),C=this.wrap(n[0]-k)*this.kx,A=(n[1]-E)*this.ky;const B=C*C+A*A;B<y&&(y=B,o=k,c=E,m=x,g=R)}return{point:[o,c],index:m,t:Math.max(0,Math.min(1,g))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function mh(r,t){return t[0]-r[0]}function Uo(r){return r[1]-r[0]+1}function $n(r,t){return r[1]>=r[0]&&r[1]<t}function pu(r,t){if(r[0]>r[1])return[null,null];const n=Uo(r);if(t){if(n===2)return[r,null];const c=Math.floor(n/2);return[[r[0],r[0]+c],[r[0]+c,r[1]]]}if(n===1)return[r,null];const o=Math.floor(n/2)-1;return[[r[0],r[0]+o],[r[0]+o+1,r[1]]]}function fu(r,t){if(!$n(t,r.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)ws(n,r[o]);return n}function mu(r){const t=[1/0,1/0,-1/0,-1/0];for(const n of r)for(const o of n)ws(t,o);return t}function $o(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function gu(r,t,n){if(!$o(r)||!$o(t))return NaN;let o=0,c=0;return r[2]<t[0]&&(o=t[0]-r[2]),r[0]>t[2]&&(o=r[0]-t[2]),r[1]>t[3]&&(c=r[1]-t[3]),r[3]<t[1]&&(c=t[1]-r[3]),n.distance([0,0],[o,c])}function Ss(r,t,n){const o=n.pointOnLine(t,r);return n.distance(r,o.point)}function _u(r,t,n,o,c){const m=Math.min(Ss(r,[n,o],c),Ss(t,[n,o],c)),g=Math.min(Ss(n,[r,t],c),Ss(o,[r,t],c));return Math.min(m,g)}function Mp(r,t,n,o,c){if(!$n(t,r.length)||!$n(o,n.length))return 1/0;let m=1/0;for(let g=t[0];g<t[1];++g){const y=r[g],x=r[g+1];for(let k=o[0];k<o[1];++k){const E=n[k],C=n[k+1];if(jo(y,x,E,C))return 0;m=Math.min(m,_u(y,x,E,C,c))}}return m}function fr(r,t,n,o,c){if(!$n(t,r.length)||!$n(o,n.length))return NaN;let m=1/0;for(let g=t[0];g<=t[1];++g)for(let y=o[0];y<=o[1];++y)if(m=Math.min(m,c.distance(r[g],n[y])),m===0)return m;return m}function zp(r,t,n){if(Ks(r,t,!0))return 0;let o=1/0;for(const c of t){const m=c[0],g=c[c.length-1];if(m!==g&&(o=Math.min(o,Ss(r,[g,m],n)),o===0))return o;const y=n.pointOnLine(c,r);if(o=Math.min(o,n.distance(r,y.point)),o===0)return o}return o}function Tt(r,t,n,o){if(!$n(t,r.length))return NaN;for(let m=t[0];m<=t[1];++m)if(Ks(r[m],n,!0))return 0;let c=1/0;for(let m=t[0];m<t[1];++m){const g=r[m],y=r[m+1];for(const x of n)for(let k=0,E=x.length,C=E-1;k<E;C=k++){const A=x[C],R=x[k];if(jo(g,y,A,R))return 0;c=Math.min(c,_u(g,y,A,R,o))}}return c}function Zo(r,t){for(const n of r)for(const o of n)if(Ks(o,t,!0))return!0;return!1}function Kt(r,t,n,o=1/0){const c=mu(r),m=mu(t);if(o!==1/0&&gu(c,m,n)>=o)return o;if(is(c,m)){if(Zo(r,t))return 0}else if(Zo(t,r))return 0;let g=1/0;for(const y of r)for(let x=0,k=y.length,E=k-1;x<k;E=x++){const C=y[E],A=y[x];for(const R of t)for(let B=0,N=R.length,G=N-1;B<N;G=B++){const X=R[G],de=R[B];if(jo(C,A,X,de))return 0;g=Math.min(g,_u(C,A,X,de,n))}}return g}function Gt(r,t,n,o,c,m){if(!m)return;const g=gu(fu(o,m),c,n);g<t&&r.push([g,m,[0,0]])}function Ts(r,t,n,o,c,m,g){if(!m||!g)return;const y=gu(fu(o,m),fu(c,g),n);y<t&&r.push([y,m,g])}function Xa(r,t,n,o,c=1/0){let m=Math.min(o.distance(r[0],n[0][0]),c);if(m===0)return m;const g=new ch([[0,[0,r.length-1],[0,0]]],mh),y=mu(n);for(;g.length>0;){const x=g.pop();if(x[0]>=m)continue;const k=x[1],E=t?50:100;if(Uo(k)<=E){if(!$n(k,r.length))return NaN;if(t){const C=Tt(r,k,n,o);if(isNaN(C)||C===0)return C;m=Math.min(m,C)}else for(let C=k[0];C<=k[1];++C){const A=zp(r[C],n,o);if(m=Math.min(m,A),m===0)return 0}}else{const C=pu(k,t);Gt(g,m,o,r,y,C[0]),Gt(g,m,o,r,y,C[1])}}return m}function Ka(r,t,n,o,c,m=1/0){let g=Math.min(m,c.distance(r[0],n[0]));if(g===0)return g;const y=new ch([[0,[0,r.length-1],[0,n.length-1]]],mh);for(;y.length>0;){const x=y.pop();if(x[0]>=g)continue;const k=x[1],E=x[2],C=t?50:100,A=o?50:100;if(Uo(k)<=C&&Uo(E)<=A){if(!$n(k,r.length)&&$n(E,n.length))return NaN;let R;if(t&&o)R=Mp(r,k,n,E,c),g=Math.min(g,R);else if(t&&!o){const B=r.slice(k[0],k[1]+1);for(let N=E[0];N<=E[1];++N)if(R=Ss(n[N],B,c),g=Math.min(g,R),g===0)return g}else if(!t&&o){const B=n.slice(E[0],E[1]+1);for(let N=k[0];N<=k[1];++N)if(R=Ss(r[N],B,c),g=Math.min(g,R),g===0)return g}else R=fr(r,k,n,E,c),g=Math.min(g,R)}else{const R=pu(k,t),B=pu(E,o);Ts(y,g,c,r,n,R[0],B[0]),Ts(y,g,c,r,n,R[0],B[1]),Ts(y,g,c,r,n,R[1],B[0]),Ts(y,g,c,r,n,R[1],B[1])}}return g}function yu(r){return r.type==="MultiPolygon"?r.coordinates.map(t=>({type:"Polygon",coordinates:t})):r.type==="MultiLineString"?r.coordinates.map(t=>({type:"LineString",coordinates:t})):r.type==="MultiPoint"?r.coordinates.map(t=>({type:"Point",coordinates:t})):[r]}class ks{constructor(t,n){this.type=Ee,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ys(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new ks(o,o.features.map(c=>yu(c.geometry)).flat());if(o.type==="Feature")return new ks(o,yu(o.geometry));if("type"in o&&"coordinates"in o)return new ks(o,yu(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const c=n.geometry(),m=c.flat().map(x=>cu([x.x,x.y],n.canonical));if(c.length===0)return NaN;const g=new du(m[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,Ka(m,!1,[x.coordinates],!1,g,y));break;case"LineString":y=Math.min(y,Ka(m,!1,x.coordinates,!0,g,y));break;case"Polygon":y=Math.min(y,Xa(m,!1,x.coordinates,g,y))}if(y===0)return y}return y}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const c=n.geometry(),m=c.flat().map(x=>cu([x.x,x.y],n.canonical));if(c.length===0)return NaN;const g=new du(m[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,Ka(m,!0,[x.coordinates],!1,g,y));break;case"LineString":y=Math.min(y,Ka(m,!0,x.coordinates,!0,g,y));break;case"Polygon":y=Math.min(y,Xa(m,!0,x.coordinates,g,y))}if(y===0)return y}return y}(t,this.geometries);if(t.geometryType()==="Polygon")return function(n,o){const c=n.geometry();if(c.length===0||c[0].length===0)return NaN;const m=Vo(c,0).map(x=>x.map(k=>k.map(E=>cu([E.x,E.y],n.canonical)))),g=new du(m[0][0][0][1]);let y=1/0;for(const x of o)for(const k of m){switch(x.type){case"Point":y=Math.min(y,Xa([x.coordinates],!1,k,g,y));break;case"LineString":y=Math.min(y,Xa(x.coordinates,!0,k,g,y));break;case"Polygon":y=Math.min(y,Kt(k,x.coordinates,g,y))}if(y===0)return y}return y}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Js={"==":vp,"!=":th,">":xp,"<":rh,">=":ih,"<=":wp,array:ln,at:nu,boolean:ln,case:Lo,coalesce:Bo,collator:Ha,format:No,image:lu,in:su,"index-of":Hs,interpolate:vi,"interpolate-hcl":vi,"interpolate-lab":vi,length:uu,let:rs,literal:on,match:au,number:ln,"number-format":ou,object:ln,slice:qa,step:Ws,string:ln,"to-boolean":un,"to-color":un,"to-number":un,"to-string":un,var:jt,within:bs,distance:ks};class Hi{constructor(t,n,o,c){this.name=t,this.type=n,this._evaluate=o,this.args=c}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],c=Hi.definitions[o];if(!c)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,y=g.filter(([k])=>!Array.isArray(k)||k.length===t.length-1);let x=null;for(const[k,E]of y){x=new vs(n.registry,Ja,n.path,null,n.scope);const C=[];let A=!1;for(let R=1;R<t.length;R++){const B=t[R],N=Array.isArray(k)?k[R-1]:k.type,G=x.parse(B,1+C.length,N);if(!G){A=!0;break}C.push(G)}if(!A)if(Array.isArray(k)&&k.length!==C.length)x.error(`Expected ${k.length} arguments, but found ${C.length} instead.`);else{for(let R=0;R<C.length;R++){const B=Array.isArray(k)?k[R]:k.type,N=C[R];x.concat(R+1).checkSubtype(B,N.type)}if(x.errors.length===0)return new Hi(o,m,E,C)}}if(y.length===1)n.errors.push(...x.errors);else{const k=(y.length?y:g).map(([C])=>{return A=C,Array.isArray(A)?`(${A.map(L).join(", ")})`:`(${L(A.type)}...)`;var A}).join(" | "),E=[];for(let C=1;C<t.length;C++){const A=n.parse(t[C],1+E.length);if(!A)return null;E.push(L(A.type))}n.error(`Expected arguments of type ${k}, but found (${E.join(", ")}) instead.`)}return null}static register(t,n){Hi.definitions=n;for(const o in n)t[o]=Hi}}function vu(r,[t,n,o,c]){t=t.evaluate(r),n=n.evaluate(r),o=o.evaluate(r);const m=c?c.evaluate(r):1,g=Gs(t,n,o,m);if(g)throw new vr(g);return new qt(t/255,n/255,o/255,m,!1)}function xu(r,t){return r in t}function wu(r,t){const n=t[r];return n===void 0?null:n}function Is(r){return{type:r}}function Ja(r){if(r instanceof jt)return Ja(r.boundExpression);if(r instanceof Hi&&r.name==="error"||r instanceof Ha||r instanceof bs||r instanceof ks)return!1;const t=r instanceof un||r instanceof ln;let n=!0;return r.eachChild(o=>{n=t?n&&Ja(o):n&&o instanceof on}),!!n&&Ya(r)&&Qa(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ya(r){if(r instanceof Hi&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof bs||r instanceof ks)return!1;let t=!0;return r.eachChild(n=>{t&&!Ya(n)&&(t=!1)}),t}function Ys(r){if(r instanceof Hi&&r.name==="feature-state")return!1;let t=!0;return r.eachChild(n=>{t&&!Ys(n)&&(t=!1)}),t}function Qa(r,t){if(r instanceof Hi&&t.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild(o=>{n&&!Qa(o,t)&&(n=!1)}),n}function qo(r){return{result:"success",value:r}}function Qs(r){return{result:"error",value:r}}function ea(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function gh(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function bu(r){return!!r.expression&&r.expression.interpolated}function Ft(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Go(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Ap(r){return r}function _h(r,t){const n=t.type==="color",o=r.stops&&typeof r.stops[0][0]=="object",c=o||!(o||r.property!==void 0),m=r.type||(bu(t)?"exponential":"interval");if(n||t.type==="padding"){const E=n?qt.parse:Li.parse;(r=an({},r)).stops&&(r.stops=r.stops.map(C=>[C[0],E(C[1])])),r.default=E(r.default?r.default:t.default)}if(r.colorSpace&&(g=r.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var g;let y,x,k;if(m==="exponential")y=vh;else if(m==="interval")y=Ho;else if(m==="categorical"){y=yh,x=Object.create(null);for(const E of r.stops)x[E[0]]=E[1];k=typeof r.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);y=xh}if(o){const E={},C=[];for(let B=0;B<r.stops.length;B++){const N=r.stops[B],G=N[0].zoom;E[G]===void 0&&(E[G]={zoom:G,type:r.type,property:r.property,default:r.default,stops:[]},C.push(G)),E[G].stops.push([N[0].value,N[1]])}const A=[];for(const B of C)A.push([E[B].zoom,_h(E[B],t)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:vi.interpolationFactor.bind(void 0,R),zoomStops:A.map(B=>B[0]),evaluate:({zoom:B},N)=>vh({stops:A,base:r.base},t,B).evaluate(B,N)}}if(c){const E=m==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:vi.interpolationFactor.bind(void 0,E),zoomStops:r.stops.map(C=>C[0]),evaluate:({zoom:C})=>y(r,t,C,x,k)}}return{kind:"source",evaluate(E,C){const A=C&&C.properties?C.properties[r.property]:void 0;return A===void 0?ta(r.default,t.default):y(r,t,A,x,k)}}}function ta(r,t,n){return r!==void 0?r:t!==void 0?t:n!==void 0?n:void 0}function yh(r,t,n,o,c){return ta(typeof n===c?o[n]:void 0,r.default,t.default)}function Ho(r,t,n){if(Ft(n)!=="number")return ta(r.default,t.default);const o=r.stops.length;if(o===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[o-1][0])return r.stops[o-1][1];const c=Ro(r.stops.map(m=>m[0]),n);return r.stops[c][1]}function vh(r,t,n){const o=r.base!==void 0?r.base:1;if(Ft(n)!=="number")return ta(r.default,t.default);const c=r.stops.length;if(c===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[c-1][0])return r.stops[c-1][1];const m=Ro(r.stops.map(E=>E[0]),n),g=function(E,C,A,R){const B=R-A,N=E-A;return B===0?0:C===1?N/B:(Math.pow(C,N)-1)/(Math.pow(C,B)-1)}(n,o,r.stops[m][0],r.stops[m+1][0]),y=r.stops[m][1],x=r.stops[m+1][1],k=yi[t.type]||Ap;return typeof y.evaluate=="function"?{evaluate(...E){const C=y.evaluate.apply(void 0,E),A=x.evaluate.apply(void 0,E);if(C!==void 0&&A!==void 0)return k(C,A,g,r.colorSpace)}}:k(y,x,g,r.colorSpace)}function xh(r,t,n){switch(t.type){case"color":n=qt.parse(n);break;case"formatted":n=Di.fromString(n.toString());break;case"resolvedImage":n=Ri.fromString(n.toString());break;case"padding":n=Li.parse(n);break;default:Ft(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return ta(n,r.default,t.default)}Hi.register(Js,{error:[{kind:"error"},[yt],(r,[t])=>{throw new vr(t.evaluate(r))}],typeof:[yt,[mt],(r,[t])=>L(Er(t.evaluate(r)))],"to-rgba":[D(Ee,4),[Lr],(r,[t])=>{const[n,o,c,m]=t.evaluate(r).rgb;return[255*n,255*o,255*c,m]}],rgb:[Lr,[Ee,Ee,Ee],vu],rgba:[Lr,[Ee,Ee,Ee,Ee],vu],has:{type:lt,overloads:[[[yt],(r,[t])=>xu(t.evaluate(r),r.properties())],[[yt,_i],(r,[t,n])=>xu(t.evaluate(r),n.evaluate(r))]]},get:{type:mt,overloads:[[[yt],(r,[t])=>wu(t.evaluate(r),r.properties())],[[yt,_i],(r,[t,n])=>wu(t.evaluate(r),n.evaluate(r))]]},"feature-state":[mt,[yt],(r,[t])=>wu(t.evaluate(r),r.featureState||{})],properties:[_i,[],r=>r.properties()],"geometry-type":[yt,[],r=>r.geometryType()],id:[mt,[],r=>r.id()],zoom:[Ee,[],r=>r.globals.zoom],"heatmap-density":[Ee,[],r=>r.globals.heatmapDensity||0],"line-progress":[Ee,[],r=>r.globals.lineProgress||0],accumulated:[mt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Ee,Is(Ee),(r,t)=>{let n=0;for(const o of t)n+=o.evaluate(r);return n}],"*":[Ee,Is(Ee),(r,t)=>{let n=1;for(const o of t)n*=o.evaluate(r);return n}],"-":{type:Ee,overloads:[[[Ee,Ee],(r,[t,n])=>t.evaluate(r)-n.evaluate(r)],[[Ee],(r,[t])=>-t.evaluate(r)]]},"/":[Ee,[Ee,Ee],(r,[t,n])=>t.evaluate(r)/n.evaluate(r)],"%":[Ee,[Ee,Ee],(r,[t,n])=>t.evaluate(r)%n.evaluate(r)],ln2:[Ee,[],()=>Math.LN2],pi:[Ee,[],()=>Math.PI],e:[Ee,[],()=>Math.E],"^":[Ee,[Ee,Ee],(r,[t,n])=>Math.pow(t.evaluate(r),n.evaluate(r))],sqrt:[Ee,[Ee],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[Ee,[Ee],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[Ee,[Ee],(r,[t])=>Math.log(t.evaluate(r))],log2:[Ee,[Ee],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[Ee,[Ee],(r,[t])=>Math.sin(t.evaluate(r))],cos:[Ee,[Ee],(r,[t])=>Math.cos(t.evaluate(r))],tan:[Ee,[Ee],(r,[t])=>Math.tan(t.evaluate(r))],asin:[Ee,[Ee],(r,[t])=>Math.asin(t.evaluate(r))],acos:[Ee,[Ee],(r,[t])=>Math.acos(t.evaluate(r))],atan:[Ee,[Ee],(r,[t])=>Math.atan(t.evaluate(r))],min:[Ee,Is(Ee),(r,t)=>Math.min(...t.map(n=>n.evaluate(r)))],max:[Ee,Is(Ee),(r,t)=>Math.max(...t.map(n=>n.evaluate(r)))],abs:[Ee,[Ee],(r,[t])=>Math.abs(t.evaluate(r))],round:[Ee,[Ee],(r,[t])=>{const n=t.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ee,[Ee],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[Ee,[Ee],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[lt,[yt,mt],(r,[t,n])=>r.properties()[t.value]===n.value],"filter-id-==":[lt,[mt],(r,[t])=>r.id()===t.value],"filter-type-==":[lt,[yt],(r,[t])=>r.geometryType()===t.value],"filter-<":[lt,[yt,mt],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o<c}],"filter-id-<":[lt,[mt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[lt,[yt,mt],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o>c}],"filter-id->":[lt,[mt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[lt,[yt,mt],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[lt,[mt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[lt,[yt,mt],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[lt,[mt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[lt,[mt],(r,[t])=>t.value in r.properties()],"filter-has-id":[lt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[lt,[D(yt)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[lt,[D(mt)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[lt,[yt,D(mt)],(r,[t,n])=>n.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[lt,[yt,D(mt)],(r,[t,n])=>function(o,c,m,g){for(;m<=g;){const y=m+g>>1;if(c[y]===o)return!0;c[y]>o?g=y-1:m=y+1}return!1}(r.properties()[t.value],n.value,0,n.value.length-1)],all:{type:lt,overloads:[[[lt,lt],(r,[t,n])=>t.evaluate(r)&&n.evaluate(r)],[Is(lt),(r,t)=>{for(const n of t)if(!n.evaluate(r))return!1;return!0}]]},any:{type:lt,overloads:[[[lt,lt],(r,[t,n])=>t.evaluate(r)||n.evaluate(r)],[Is(lt),(r,t)=>{for(const n of t)if(n.evaluate(r))return!0;return!1}]]},"!":[lt,[lt],(r,[t])=>!t.evaluate(r)],"is-supported-script":[lt,[yt],(r,[t])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(t.evaluate(r))}],upcase:[yt,[yt],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[yt,[yt],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[yt,Is(mt),(r,t)=>t.map(n=>Za(n.evaluate(r))).join("")],"resolved-locale":[yt,[Ie],(r,[t])=>t.evaluate(r).resolvedLocale()]});class Wo{constructor(t,n){var o;this.expression=t,this._warningHistory={},this._evaluator=new Do,this._defaultValue=n?(o=n).type==="color"&&Go(o.default)?new qt(0,0,0,0):o.type==="color"?qt.parse(o.default)||null:o.type==="padding"?Li.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?Gi.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,o,c,m,g){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,c,m,g){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new vr(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function Xo(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Js}function ra(r,t){const n=new vs(Js,Ja,[],t?function(c){const m={color:Lr,string:yt,number:Ee,enum:yt,boolean:lt,formatted:ct,padding:bt,resolvedImage:Ut,variableAnchorOffsetCollection:$};return c.type==="array"?D(m[c.value]||mt,c.length):m[c.type]}(t):void 0),o=n.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?qo(new Wo(o,t)):Qs(n.errors)}class ia{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!Ys(n.expression)}evaluateWithoutErrorHandling(t,n,o,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,c,m,g)}evaluate(t,n,o,c,m,g){return this._styleExpression.evaluate(t,n,o,c,m,g)}}class na{constructor(t,n,o,c){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Ys(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(t,n,o,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,c,m,g)}evaluate(t,n,o,c,m,g){return this._styleExpression.evaluate(t,n,o,c,m,g)}interpolationFactor(t,n,o){return this.interpolationType?vi.interpolationFactor(this.interpolationType,t,n,o):0}}function Su(r,t){const n=ra(r,t);if(n.result==="error")return n;const o=n.value.expression,c=Ya(o);if(!c&&!ea(t))return Qs([new kr("","data expressions not supported")]);const m=Qa(o,["zoom"]);if(!m&&!gh(t))return Qs([new kr("","zoom expressions not supported")]);const g=eo(o);return g||m?g instanceof kr?Qs([g]):g instanceof vi&&!bu(t)?Qs([new kr("",'"interpolate" expressions cannot be used with this property')]):qo(g?new na(c?"camera":"composite",n.value,g.labels,g instanceof vi?g.interpolation:void 0):new ia(c?"constant":"source",n.value)):Qs([new kr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class sa{constructor(t,n){this._parameters=t,this._specification=n,an(this,_h(this._parameters,this._specification))}static deserialize(t){return new sa(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function eo(r){let t=null;if(r instanceof rs)t=eo(r.result);else if(r instanceof Bo){for(const n of r.args)if(t=eo(n),t)break}else(r instanceof Ws||r instanceof vi)&&r.input instanceof Hi&&r.input.name==="zoom"&&(t=r);return t instanceof kr||r.eachChild(n=>{const o=eo(n);o instanceof kr?t=o:!t&&o?t=new kr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new kr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Ko(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!Ko(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Jo={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Tu(r){if(r==null)return{filter:()=>!0,needGeometry:!1};Ko(r)||(r=Yo(r));const t=ra(r,Jo);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,c)=>t.value.evaluate(n,o,{},c),needGeometry:wh(r)}}function Dp(r,t){return r<t?-1:r>t?1:0}function wh(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(wh(r[t]))return!0;return!1}function Yo(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?ku(r[1],r[2],"=="):t==="!="?Xr(ku(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?ku(r[1],r[2],t):t==="any"?(n=r.slice(1),["any"].concat(n.map(Yo))):t==="all"?["all"].concat(r.slice(1).map(Yo)):t==="none"?["all"].concat(r.slice(1).map(Yo).map(Xr)):t==="in"?to(r[1],r.slice(2)):t==="!in"?Xr(to(r[1],r.slice(2))):t==="has"?ro(r[1]):t!=="!has"||Xr(ro(r[1]));var n}function ku(r,t,n){switch(r){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,r,t]}}function to(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",r,["literal",t.sort(Dp)]]:["filter-in-small",r,["literal",t]]}}function ro(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Xr(r){return["!",r]}function Es(r){const t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let c="[";for(const m of r)c+=`${Es(m)},`;return`${c}]`}const n=Object.keys(r).sort();let o="{";for(let c=0;c<n.length;c++)o+=`${JSON.stringify(n[c])}:${Es(r[n[c]])},`;return`${o}}`}function bh(r){let t="";for(const n of jn)t+=`/${Es(r[n])}`;return t}function Sh(r){const t=r.value;return t?[new ke(r.key,t,"constants have been deprecated as of v8")]:[]}function mr(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function cn(r){if(Array.isArray(r))return r.map(cn);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const n in r)t[n]=cn(r[n]);return t}return mr(r)}function Fi(r){const t=r.key,n=r.value,o=r.valueSpec||{},c=r.objectElementValidators||{},m=r.style,g=r.styleSpec,y=r.validateSpec;let x=[];const k=Ft(n);if(k!=="object")return[new ke(t,n,`object expected, ${k} found`)];for(const E in n){const C=E.split(".")[0],A=o[C]||o["*"];let R;if(c[C])R=c[C];else if(o[C])R=y;else if(c["*"])R=c["*"];else{if(!o["*"]){x.push(new ke(t,n[E],`unknown property "${E}"`));continue}R=y}x=x.concat(R({key:(t&&`${t}.`)+E,value:n[E],valueSpec:A,style:m,styleSpec:g,object:n,objectKey:E,validateSpec:y},n))}for(const E in o)c[E]||o[E].required&&o[E].default===void 0&&n[E]===void 0&&x.push(new ke(t,n,`missing required property "${E}"`));return x}function io(r){const t=r.value,n=r.valueSpec,o=r.style,c=r.styleSpec,m=r.key,g=r.arrayElementValidator||r.validateSpec;if(Ft(t)!=="array")return[new ke(m,t,`array expected, ${Ft(t)} found`)];if(n.length&&t.length!==n.length)return[new ke(m,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new ke(m,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let y={type:n.value,values:n.values};c.$version<7&&(y.function=n.function),Ft(n.value)==="object"&&(y=n.value);let x=[];for(let k=0;k<t.length;k++)x=x.concat(g({array:t,arrayIndex:k,value:t[k],valueSpec:y,validateSpec:r.validateSpec,style:o,styleSpec:c,key:`${m}[${k}]`}));return x}function Iu(r){const t=r.key,n=r.value,o=r.valueSpec;let c=Ft(n);return c==="number"&&n!=n&&(c="NaN"),c!=="number"?[new ke(t,n,`number expected, ${c} found`)]:"minimum"in o&&n<o.minimum?[new ke(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new ke(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function Qo(r){const t=r.valueSpec,n=mr(r.value.type);let o,c,m,g={};const y=n!=="categorical"&&r.value.property===void 0,x=!y,k=Ft(r.value.stops)==="array"&&Ft(r.value.stops[0])==="array"&&Ft(r.value.stops[0][0])==="object",E=Fi({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(R){if(n==="identity")return[new ke(R.key,R.value,'identity function may not have a "stops" property')];let B=[];const N=R.value;return B=B.concat(io({key:R.key,value:N,valueSpec:R.valueSpec,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:C})),Ft(N)==="array"&&N.length===0&&B.push(new ke(R.key,N,"array must have at least one stop")),B},default:function(R){return R.validateSpec({key:R.key,value:R.value,valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec})}}});return n==="identity"&&y&&E.push(new ke(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||E.push(new ke(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!bu(r.valueSpec)&&E.push(new ke(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(x&&!ea(r.valueSpec)?E.push(new ke(r.key,r.value,"property functions not supported")):y&&!gh(r.valueSpec)&&E.push(new ke(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!k||r.value.property!==void 0||E.push(new ke(r.key,r.value,'"property" property is required')),E;function C(R){let B=[];const N=R.value,G=R.key;if(Ft(N)!=="array")return[new ke(G,N,`array expected, ${Ft(N)} found`)];if(N.length!==2)return[new ke(G,N,`array length 2 expected, length ${N.length} found`)];if(k){if(Ft(N[0])!=="object")return[new ke(G,N,`object expected, ${Ft(N[0])} found`)];if(N[0].zoom===void 0)return[new ke(G,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new ke(G,N,"object stop key must have value")];if(m&&m>mr(N[0].zoom))return[new ke(G,N[0].zoom,"stop zoom values must appear in ascending order")];mr(N[0].zoom)!==m&&(m=mr(N[0].zoom),c=void 0,g={}),B=B.concat(Fi({key:`${G}[0]`,value:N[0],valueSpec:{zoom:{}},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:Iu,value:A}}))}else B=B.concat(A({key:`${G}[0]`,value:N[0],validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec},N));return Xo(cn(N[1]))?B.concat([new ke(`${G}[1]`,N[1],"expressions are not allowed in function stops.")]):B.concat(R.validateSpec({key:`${G}[1]`,value:N[1],valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec}))}function A(R,B){const N=Ft(R.value),G=mr(R.value),X=R.value!==null?R.value:B;if(o){if(N!==o)return[new ke(R.key,X,`${N} stop domain type must match previous stop domain type ${o}`)]}else o=N;if(N!=="number"&&N!=="string"&&N!=="boolean")return[new ke(R.key,X,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&n!=="categorical"){let de=`number expected, ${N} found`;return ea(t)&&n===void 0&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ke(R.key,X,de)]}return n!=="categorical"||N!=="number"||isFinite(G)&&Math.floor(G)===G?n!=="categorical"&&N==="number"&&c!==void 0&&G<c?[new ke(R.key,X,"stop domain values must appear in ascending order")]:(c=G,n==="categorical"&&G in g?[new ke(R.key,X,"stop domain values must be unique")]:(g[G]=!0,[])):[new ke(R.key,X,`integer expected, found ${G}`)]}}function aa(r){const t=(r.expressionContext==="property"?Su:ra)(cn(r.value),r.valueSpec);if(t.result==="error")return t.value.map(o=>new ke(`${r.key}${o.key}`,r.value,o.message));const n=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new ke(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Ys(n))return[new ke(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Ys(n))return[new ke(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Qa(n,["zoom","feature-state"]))return[new ke(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Ya(n))return[new ke(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zn(r){const t=r.key,n=r.value,o=r.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(mr(n))===-1&&c.push(new ke(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(mr(n))===-1&&c.push(new ke(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function Eu(r){return Ko(cn(r.value))?aa(an({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):el(r)}function el(r){const t=r.value,n=r.key;if(Ft(t)!=="array")return[new ke(n,t,`array expected, ${Ft(t)} found`)];const o=r.styleSpec;let c,m=[];if(t.length<1)return[new ke(n,t,"filter array must have at least 1 element")];switch(m=m.concat(Zn({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:r.style,styleSpec:r.styleSpec})),mr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&mr(t[1])==="$type"&&m.push(new ke(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new ke(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(c=Ft(t[1]),c!=="string"&&m.push(new ke(`${n}[1]`,t[1],`string expected, ${c} found`)));for(let g=2;g<t.length;g++)c=Ft(t[g]),mr(t[1])==="$type"?m=m.concat(Zn({key:`${n}[${g}]`,value:t[g],valueSpec:o.geometry_type,style:r.style,styleSpec:r.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&m.push(new ke(`${n}[${g}]`,t[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)m=m.concat(el({key:`${n}[${g}]`,value:t[g],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":c=Ft(t[1]),t.length!==2?m.push(new ke(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):c!=="string"&&m.push(new ke(`${n}[1]`,t[1],`string expected, ${c} found`))}return m}function Pu(r,t){const n=r.key,o=r.validateSpec,c=r.style,m=r.styleSpec,g=r.value,y=r.objectKey,x=m[`${t}_${r.layerType}`];if(!x)return[];const k=y.match(/^(.*)-transition$/);if(t==="paint"&&k&&x[k[1]]&&x[k[1]].transition)return o({key:n,value:g,valueSpec:m.transition,style:c,styleSpec:m});const E=r.valueSpec||x[y];if(!E)return[new ke(n,g,`unknown property "${y}"`)];let C;if(Ft(g)==="string"&&ea(E)&&!E.tokens&&(C=/^{([^}]+)}$/.exec(g)))return[new ke(n,g,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const A=[];return r.layerType==="symbol"&&(y==="text-field"&&c&&!c.glyphs&&A.push(new ke(n,g,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&Go(cn(g))&&mr(g.type)==="identity"&&A.push(new ke(n,g,'"text-font" does not support identity functions'))),A.concat(o({key:r.key,value:g,valueSpec:E,style:c,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:y}))}function tl(r){return Pu(r,"paint")}function Cu(r){return Pu(r,"layout")}function Mu(r){let t=[];const n=r.value,o=r.key,c=r.style,m=r.styleSpec;n.type||n.ref||t.push(new ke(o,n,'either "type" or "ref" is required'));let g=mr(n.type);const y=mr(n.ref);if(n.id){const x=mr(n.id);for(let k=0;k<r.arrayIndex;k++){const E=c.layers[k];mr(E.id)===x&&t.push(new ke(o,n.id,`duplicate layer id "${n.id}", previously used at line ${E.id.__line__}`))}}if("ref"in n){let x;["type","source","source-layer","filter","layout"].forEach(k=>{k in n&&t.push(new ke(o,n[k],`"${k}" is prohibited for ref layers`))}),c.layers.forEach(k=>{mr(k.id)===y&&(x=k)}),x?x.ref?t.push(new ke(o,n.ref,"ref cannot reference another ref layer")):g=mr(x.type):t.push(new ke(o,n.ref,`ref layer "${y}" not found`))}else if(g!=="background")if(n.source){const x=c.sources&&c.sources[n.source],k=x&&mr(x.type);x?k==="vector"&&g==="raster"?t.push(new ke(o,n.source,`layer "${n.id}" requires a raster source`)):k!=="raster-dem"&&g==="hillshade"?t.push(new ke(o,n.source,`layer "${n.id}" requires a raster-dem source`)):k==="raster"&&g!=="raster"?t.push(new ke(o,n.source,`layer "${n.id}" requires a vector source`)):k!=="vector"||n["source-layer"]?k==="raster-dem"&&g!=="hillshade"?t.push(new ke(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!n.paint||!n.paint["line-gradient"]||k==="geojson"&&x.lineMetrics||t.push(new ke(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ke(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new ke(o,n.source,`source "${n.source}" not found`))}else t.push(new ke(o,n,'missing required property "source"'));return t=t.concat(Fi({key:o,value:n,valueSpec:m.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${o}.type`,value:n.type,valueSpec:m.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:Eu,layout:x=>Fi({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":k=>Cu(an({layerType:g},k))}}),paint:x=>Fi({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":k=>tl(an({layerType:g},k))}})}})),t}function Ps(r){const t=r.value,n=r.key,o=Ft(t);return o!=="string"?[new ke(n,t,`string expected, ${o} found`)]:[]}const rl={promoteId:function({key:r,value:t}){if(Ft(t)==="string")return Ps({key:r,value:t});{const n=[];for(const o in t)n.push(...Ps({key:`${r}.${o}`,value:t[o]}));return n}}};function no(r){const t=r.value,n=r.key,o=r.styleSpec,c=r.style,m=r.validateSpec;if(!t.type)return[new ke(n,t,'"type" is required')];const g=mr(t.type);let y;switch(g){case"vector":case"raster":return y=Fi({key:n,value:t,valueSpec:o[`source_${g.replace("-","_")}`],style:r.style,styleSpec:o,objectElementValidators:rl,validateSpec:m}),y;case"raster-dem":return y=function(x){var k;const E=(k=x.sourceName)!==null&&k!==void 0?k:"",C=x.value,A=x.styleSpec,R=A.source_raster_dem,B=x.style;let N=[];const G=Ft(C);if(C===void 0)return N;if(G!=="object")return N.push(new ke("source_raster_dem",C,`object expected, ${G} found`)),N;const X=mr(C.encoding)==="custom",de=["redFactor","greenFactor","blueFactor","baseShift"],ie=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const ue in C)!X&&de.includes(ue)?N.push(new ke(ue,C[ue],`In "${E}": "${ue}" is only valid when "encoding" is set to "custom". ${ie} encoding found`)):R[ue]?N=N.concat(x.validateSpec({key:ue,value:C[ue],valueSpec:R[ue],validateSpec:x.validateSpec,style:B,styleSpec:A})):N.push(new ke(ue,C[ue],`unknown property "${ue}"`));return N}({sourceName:n,value:t,style:r.style,styleSpec:o,validateSpec:m}),y;case"geojson":if(y=Fi({key:n,value:t,valueSpec:o.source_geojson,style:c,styleSpec:o,validateSpec:m,objectElementValidators:rl}),t.cluster)for(const x in t.clusterProperties){const[k,E]=t.clusterProperties[x],C=typeof k=="string"?[k,["accumulated"],["get",x]]:k;y.push(...aa({key:`${n}.${x}.map`,value:E,expressionContext:"cluster-map"})),y.push(...aa({key:`${n}.${x}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return y;case"video":return Fi({key:n,value:t,valueSpec:o.source_video,style:c,validateSpec:m,styleSpec:o});case"image":return Fi({key:n,value:t,valueSpec:o.source_image,style:c,validateSpec:m,styleSpec:o});case"canvas":return[new ke(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Zn({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function zu(r){const t=r.value,n=r.styleSpec,o=n.light,c=r.style;let m=[];const g=Ft(t);if(t===void 0)return m;if(g!=="object")return m=m.concat([new ke("light",t,`object expected, ${g} found`)]),m;for(const y in t){const x=y.match(/^(.*)-transition$/);m=m.concat(x&&o[x[1]]&&o[x[1]].transition?r.validateSpec({key:y,value:t[y],valueSpec:n.transition,validateSpec:r.validateSpec,style:c,styleSpec:n}):o[y]?r.validateSpec({key:y,value:t[y],valueSpec:o[y],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new ke(y,t[y],`unknown property "${y}"`)])}return m}function Au(r){const t=r.value,n=r.styleSpec,o=n.sky,c=r.style,m=Ft(t);if(t===void 0)return[];if(m!=="object")return[new ke("sky",t,`object expected, ${m} found`)];let g=[];for(const y in t)g=g.concat(o[y]?r.validateSpec({key:y,value:t[y],valueSpec:o[y],style:c,styleSpec:n}):[new ke(y,t[y],`unknown property "${y}"`)]);return g}function Du(r){const t=r.value,n=r.styleSpec,o=n.terrain,c=r.style;let m=[];const g=Ft(t);if(t===void 0)return m;if(g!=="object")return m=m.concat([new ke("terrain",t,`object expected, ${g} found`)]),m;for(const y in t)m=m.concat(o[y]?r.validateSpec({key:y,value:t[y],valueSpec:o[y],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new ke(y,t[y],`unknown property "${y}"`)]);return m}function Lu(r){let t=[];const n=r.value,o=r.key;if(Array.isArray(n)){const c=[],m=[];for(const g in n)n[g].id&&c.includes(n[g].id)&&t.push(new ke(o,n,`all the sprites' ids must be unique, but ${n[g].id} is duplicated`)),c.push(n[g].id),n[g].url&&m.includes(n[g].url)&&t.push(new ke(o,n,`all the sprites' URLs must be unique, but ${n[g].url} is duplicated`)),m.push(n[g].url),t=t.concat(Fi({key:`${o}[${g}]`,value:n[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return Ps({key:o,value:n})}const il={"*":()=>[],array:io,boolean:function(r){const t=r.value,n=r.key,o=Ft(t);return o!=="boolean"?[new ke(n,t,`boolean expected, ${o} found`)]:[]},number:Iu,color:function(r){const t=r.key,n=r.value,o=Ft(n);return o!=="string"?[new ke(t,n,`color expected, ${o} found`)]:qt.parse(String(n))?[]:[new ke(t,n,`color expected, "${n}" found`)]},constants:Sh,enum:Zn,filter:Eu,function:Qo,layer:Mu,object:Fi,source:no,light:zu,sky:Au,terrain:Du,projection:function(r){const t=r.value,n=r.styleSpec,o=n.projection,c=r.style,m=Ft(t);if(t===void 0)return[];if(m!=="object")return[new ke("projection",t,`object expected, ${m} found`)];let g=[];for(const y in t)g=g.concat(o[y]?r.validateSpec({key:y,value:t[y],valueSpec:o[y],style:c,styleSpec:n}):[new ke(y,t[y],`unknown property "${y}"`)]);return g},string:Ps,formatted:function(r){return Ps(r).length===0?[]:aa(r)},resolvedImage:function(r){return Ps(r).length===0?[]:aa(r)},padding:function(r){const t=r.key,n=r.value;if(Ft(n)==="array"){if(n.length<1||n.length>4)return[new ke(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let c=[];for(let m=0;m<n.length;m++)c=c.concat(r.validateSpec({key:`${t}[${m}]`,value:n[m],validateSpec:r.validateSpec,valueSpec:o}));return c}return Iu({key:t,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const t=r.key,n=r.value,o=Ft(n),c=r.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new ke(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let g=0;g<n.length;g+=2)m=m.concat(Zn({key:`${t}[${g}]`,value:n[g],valueSpec:c.layout_symbol["text-anchor"]})),m=m.concat(io({key:`${t}[${g+1}]`,value:n[g+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:c}));return m},sprite:Lu};function so(r){const t=r.value,n=r.valueSpec,o=r.styleSpec;return r.validateSpec=so,n.expression&&Go(mr(t))?Qo(r):n.expression&&Xo(cn(t))?aa(r):n.type&&il[n.type]?il[n.type](r):Fi(an({},r,{valueSpec:n.type?o[n.type]:n}))}function Th(r){const t=r.value,n=r.key,o=Ps(r);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new ke(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new ke(n,t,'"glyphs" url must include a "{range}" token'))),o}function Wi(r,t=me){let n=[];return n=n.concat(so({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:so,objectElementValidators:{glyphs:Th,"*":()=>[]}})),r.constants&&(n=n.concat(Sh({key:"constants",value:r.constants}))),Ru(n)}function Cn(r){return function(t){return r({...t,validateSpec:so})}}function Ru(r){return[].concat(r).sort((t,n)=>t.line-n.line)}function hn(r){return function(...t){return Ru(r.apply(this,t))}}Wi.source=hn(Cn(no)),Wi.sprite=hn(Cn(Lu)),Wi.glyphs=hn(Cn(Th)),Wi.light=hn(Cn(zu)),Wi.sky=hn(Cn(Au)),Wi.terrain=hn(Cn(Du)),Wi.layer=hn(Cn(Mu)),Wi.filter=hn(Cn(Eu)),Wi.paintProperty=hn(Cn(tl)),Wi.layoutProperty=hn(Cn(Cu));const Cs=Wi,Lp=Cs.light,Rp=Cs.sky,kh=Cs.paintProperty,Ih=Cs.layoutProperty;function Fu(r,t){let n=!1;if(t&&t.length)for(const o of t)r.fire(new In(new Error(o.message))),n=!0;return n}class oa{constructor(t,n,o){const c=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const g=new Int32Array(this.arrayBuffer);t=g[0],this.d=(n=g[1])+2*(o=g[2]);for(let x=0;x<this.d*this.d;x++){const k=g[3+x],E=g[3+x+1];c.push(k===E?null:g.subarray(k,E))}const y=g[3+c.length+1];this.keys=g.subarray(g[3+c.length],y),this.bboxes=g.subarray(y),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let g=0;g<this.d*this.d;g++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const m=o/n*t;this.min=-m,this.max=t+m}insert(t,n,o,c,m){this._forEachCell(n,o,c,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,c,m,g){this.cells[m].push(g)}query(t,n,o,c,m){const g=this.min,y=this.max;if(t<=g&&n<=g&&y<=o&&y<=c&&!m)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,n,o,c,this._queryCell,x,{},m),x}}_queryCell(t,n,o,c,m,g,y,x){const k=this.cells[m];if(k!==null){const E=this.keys,C=this.bboxes;for(let A=0;A<k.length;A++){const R=k[A];if(y[R]===void 0){const B=4*R;(x?x(C[B+0],C[B+1],C[B+2],C[B+3]):t<=C[B+2]&&n<=C[B+3]&&o>=C[B+0]&&c>=C[B+1])?(y[R]=!0,g.push(E[R])):y[R]=!1}}}}_forEachCell(t,n,o,c,m,g,y,x){const k=this._convertToCellCoord(t),E=this._convertToCellCoord(n),C=this._convertToCellCoord(o),A=this._convertToCellCoord(c);for(let R=k;R<=C;R++)for(let B=E;B<=A;B++){const N=this.d*B+R;if((!x||x(this._convertFromCellCoord(R),this._convertFromCellCoord(B),this._convertFromCellCoord(R+1),this._convertFromCellCoord(B+1)))&&m.call(this,t,n,o,c,N,g,y,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;const c=new Int32Array(n+o+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let m=n;for(let g=0;g<t.length;g++){const y=t[g];c[3+g]=m,c.set(y,m),m+=y.length}return c[3+t.length]=m,c.set(this.keys,m),m+=this.keys.length,c[3+t.length+1]=m,c.set(this.bboxes,m),m+=this.bboxes.length,c.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new oa(t.buffer)}}const Xi={};function qe(r,t,n={}){if(Xi[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),Xi[r]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}qe("Object",Object),qe("TransferableGridIndex",oa),qe("Color",qt),qe("Error",Error),qe("AJAXError",ur),qe("ResolvedImage",Ri),qe("StylePropertyFunction",sa),qe("StyleExpression",Wo,{omit:["_evaluator"]}),qe("ZoomDependentExpression",na),qe("ZoomConstantExpression",ia),qe("CompoundExpression",Hi,{omit:["_evaluate"]});for(const r in Js)Js[r]._classRegistryKey||qe(`Expression_${r}`,Js[r]);function nl(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Bu(r){return r.$name||r.constructor._classRegistryKey}function Eh(r){return!function(t){if(t===null||typeof t!="object")return!1;const n=Bu(t);return!(!n||n==="Object")}(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||nl(r)||jr(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function la(r,t){if(Eh(r))return(nl(r)||jr(r))&&t&&t.push(r),ArrayBuffer.isView(r)&&t&&t.push(r.buffer),r instanceof ImageData&&t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const m=[];for(const g of r)m.push(la(g,t));return m}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const n=Bu(r);if(!n)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!Xi[n])throw new Error(`${n} is not registered.`);const{klass:o}=Xi[n],c=o.serialize?o.serialize(r,t):{};if(o.serialize){if(t&&c===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in r){if(!r.hasOwnProperty(m)||Xi[n].omit.indexOf(m)>=0)continue;const g=r[m];c[m]=Xi[n].shallow.indexOf(m)>=0?g:la(g,t)}r instanceof Error&&(c.message=r.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(c.$name=n),c}function ua(r){if(Eh(r))return r;if(Array.isArray(r))return r.map(ua);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const t=Bu(r)||"Object";if(!Xi[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=Xi[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(r);const o=Object.create(n.prototype);for(const c of Object.keys(r)){if(c==="$name")continue;const m=r[c];o[c]=Xi[t].shallow.indexOf(c)>=0?m:ua(m)}return o}class Ou{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const Mt={"Latin-1 Supplement":r=>r>=128&&r<=255,"Hangul Jamo":r=>r>=4352&&r<=4607,Khmer:r=>r>=6016&&r<=6143,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Katakana:r=>r>=12448&&r<=12543,Kanbun:r=>r>=12688&&r<=12703,"CJK Strokes":r=>r>=12736&&r<=12783,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"Private Use Area":r=>r>=57344&&r<=63743,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Nu(r){for(const t of r)if(Vu(t.charCodeAt(0)))return!0;return!1}function Fp(r){for(const t of r)if(!ca(t.charCodeAt(0)))return!1;return!0}function ju(r){const t=r.map(n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}}).filter(n=>n);return new RegExp(t.join("|"),"u")}const Bp=ju(["Arab","Dupl","Mong","Ougr","Syrc"]);function ca(r){return!Bp.test(String.fromCodePoint(r))}const Ph=ju(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Vu(r){return!(r!==746&&r!==747&&(r<4352||!(Mt["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Mt["CJK Compatibility"](r)||Mt["CJK Strokes"](r)||!(!Mt["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Mt["Enclosed CJK Letters and Months"](r)||Mt["Ideographic Description Characters"](r)||Mt.Kanbun(r)||Mt.Katakana(r)&&r!==12540||!(!Mt["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Mt["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Mt["Vertical Forms"](r)||Mt["Yijing Hexagram Symbols"](r)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(r))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(r))||Ph.test(String.fromCodePoint(r)))))}function Ch(r){return!(Vu(r)||function(t){return!!(Mt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Mt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Mt["Letterlike Symbols"](t)||Mt["Number Forms"](t)||Mt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Mt["Control Pictures"](t)&&t!==9251||Mt["Optical Character Recognition"](t)||Mt["Enclosed Alphanumerics"](t)||Mt["Geometric Shapes"](t)||Mt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Mt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Mt["CJK Symbols and Punctuation"](t)||Mt.Katakana(t)||Mt["Private Use Area"](t)||Mt["CJK Compatibility Forms"](t)||Mt["Small Form Variants"](t)||Mt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(r))}const Op=ju(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Uu(r){return Op.test(String.fromCodePoint(r))}function Np(r,t){return!(!t&&Uu(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Mt.Khmer(r))}function jp(r){for(const t of r)if(Uu(t.charCodeAt(0)))return!0;return!1}const Bi=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class rr{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ou,this.transition={})}isSupportedScript(t){return function(n,o){for(const c of n)if(!Np(c.charCodeAt(0),o))return!1;return!0}(t,Bi.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class ha{constructor(t,n){this.property=t,this.value=n,this.expression=function(o,c){if(Go(o))return new sa(o,c);if(Xo(o)){const m=Su(o,c);if(m.result==="error")throw new Error(m.value.map(g=>`${g.key}: ${g.message}`).join(", "));return m.value}{let m=o;return c.type==="color"&&typeof o=="string"?m=qt.parse(o):c.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(m=Gi.parse(o)):m=Li.parse(o),{kind:"constant",evaluate:()=>m}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class sl{constructor(t){this.property=t,this.value=new ha(t,void 0)}transitioned(t,n){return new Mh(this.property,this.value,n,Ge({},t.transition,this.transition),t.now)}untransitioned(){return new Mh(this.property,this.value,null,{},0)}}class al{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return wt(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new sl(this._values[t].property)),this._values[t].value=new ha(this._values[t].property,n===null?void 0:wt(n))}getTransition(t){return wt(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new sl(this._values[t].property)),this._values[t].transition=wt(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const c=this.getTransition(n);c!==void 0&&(t[`${n}-transition`]=c)}return t}transitioned(t,n){const o=new ao(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(t,n._values[c]);return o}untransitioned(){const t=new ao(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class Mh{constructor(t,n,o,c,m){this.property=t,this.value=n,this.begin=m+c.delay||0,this.end=this.begin+c.duration||0,t.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const c=t.now||0,m=this.value.possiblyEvaluate(t,n,o),g=this.prior;if(g){if(c>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(c<this.begin)return g.possiblyEvaluate(t,n,o);{const y=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,n,o),m,function(x){if(x<=0)return 0;if(x>=1)return 1;const k=x*x,E=k*x;return 4*(x<.5?E:3*(x-k)+E-.75)}(y))}}return m}}class ao{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const c=new lo(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(t,n,o);return c}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class oo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return wt(this._values[t].value)}setValue(t,n){this._values[t]=new ha(this._values[t].property,n===null?void 0:wt(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const c=new lo(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(t,n,o);return c}}class Mn{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,c){return this.property.evaluate(this.value,this.parameters,t,n,o,c)}}class lo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ke{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const c=yi[this.specification.type];return c?c(t,n,o):t}}class ot{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,c){return new Mn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,c)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new Mn(this,{kind:"constant",value:void 0},t.parameters);const c=yi[this.specification.type];if(c){const m=c(t.value.value,n.value.value,o);return new Mn(this,{kind:"constant",value:m},t.parameters)}return t}evaluate(t,n,o,c,m,g){return t.kind==="constant"?t.value:t.evaluate(n,o,c,m,g)}}class ol extends ot{possiblyEvaluate(t,n,o,c){if(t.value===void 0)return new Mn(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const m=t.expression.evaluate(n,null,{},o,c),g=t.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,y=this._calculate(g,g,g,n);return new Mn(this,{kind:"constant",value:y},n)}if(t.expression.kind==="camera"){const m=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new Mn(this,{kind:"constant",value:m},n)}return new Mn(this,t.expression,n)}evaluate(t,n,o,c,m,g){if(t.kind==="source"){const y=t.evaluate(n,o,c,m,g);return this._calculate(y,y,y,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,c),t.evaluate({zoom:Math.floor(n.zoom)},o,c),t.evaluate({zoom:Math.floor(n.zoom)+1},o,c),n):t.value}_calculate(t,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class ll{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,c){if(t.value!==void 0){if(t.expression.kind==="constant"){const m=t.expression.evaluate(n,null,{},o,c);return this._calculate(m,m,m,n)}return this._calculate(t.expression.evaluate(new rr(Math.floor(n.zoom-1),n)),t.expression.evaluate(new rr(Math.floor(n.zoom),n)),t.expression.evaluate(new rr(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class $u{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,c){return!!t.expression.evaluate(n,null,{},o,c)}interpolate(){return!1}}class f{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new ha(o,void 0),m=this.defaultTransitionablePropertyValues[n]=new sl(o);this.defaultTransitioningPropertyValues[n]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate({})}}}qe("DataDrivenProperty",ot),qe("DataConstantProperty",Ke),qe("CrossFadedDataDrivenProperty",ol),qe("CrossFadedProperty",ll),qe("ColorRampProperty",$u);const e="-transition";class s extends ts{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new oo(n.layout)),n.paint)){this._transitionablePaint=new al(n.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new lo(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,o={}){n!=null&&this._validate(Ih,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(kh,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const c=this._transitionablePaint._values[t],m=c.property.specification["property-type"]==="cross-faded-data-driven",g=c.value.isDataDriven(),y=c.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(t,y,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),vt(t,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(t,n,o,c,m={}){return(!m||m.validate!==!1)&&Fu(this,t.call(Cs,{key:n,layerType:this.type,objectKey:o,value:c,styleSpec:me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof Mn&&ea(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const l={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class u{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class p{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function v(r,t=1){let n=0,o=0;return{members:r.map(c=>{const m=l[c.type].BYTES_PER_ELEMENT,g=n=w(n,Math.max(t,m)),y=c.components||1;return o=Math.max(o,m),n+=m*y,{name:c.name,type:c.type,components:y,offset:g}}),size:w(n,Math.max(o,t)),alignment:t}}function w(r,t){return Math.ceil(r/t)*t}class T extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const c=2*t;return this.int16[c+0]=n,this.int16[c+1]=o,t}}T.prototype.bytesPerElement=4,qe("StructArrayLayout2i4",T);class P extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.int16[m+0]=n,this.int16[m+1]=o,this.int16[m+2]=c,t}}P.prototype.bytesPerElement=6,qe("StructArrayLayout3i6",P);class M extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,o,c)}emplace(t,n,o,c,m){const g=4*t;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=c,this.int16[g+3]=m,t}}M.prototype.bytesPerElement=8,qe("StructArrayLayout4i8",M);class z extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,y){const x=6*t;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=c,this.int16[x+3]=m,this.int16[x+4]=g,this.int16[x+5]=y,t}}z.prototype.bytesPerElement=12,qe("StructArrayLayout2i4i12",z);class F extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,y){const x=4*t,k=8*t;return this.int16[x+0]=n,this.int16[x+1]=o,this.uint8[k+4]=c,this.uint8[k+5]=m,this.uint8[k+6]=g,this.uint8[k+7]=y,t}}F.prototype.bytesPerElement=8,qe("StructArrayLayout2i4ub8",F);class j extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const c=2*t;return this.float32[c+0]=n,this.float32[c+1]=o,t}}j.prototype.bytesPerElement=8,qe("StructArrayLayout2f8",j);class V extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,y,x,k,E){const C=this.length;return this.resize(C+1),this.emplace(C,t,n,o,c,m,g,y,x,k,E)}emplace(t,n,o,c,m,g,y,x,k,E,C){const A=10*t;return this.uint16[A+0]=n,this.uint16[A+1]=o,this.uint16[A+2]=c,this.uint16[A+3]=m,this.uint16[A+4]=g,this.uint16[A+5]=y,this.uint16[A+6]=x,this.uint16[A+7]=k,this.uint16[A+8]=E,this.uint16[A+9]=C,t}}V.prototype.bytesPerElement=20,qe("StructArrayLayout10ui20",V);class H extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,y,x,k,E,C,A){const R=this.length;return this.resize(R+1),this.emplace(R,t,n,o,c,m,g,y,x,k,E,C,A)}emplace(t,n,o,c,m,g,y,x,k,E,C,A,R){const B=12*t;return this.int16[B+0]=n,this.int16[B+1]=o,this.int16[B+2]=c,this.int16[B+3]=m,this.uint16[B+4]=g,this.uint16[B+5]=y,this.uint16[B+6]=x,this.uint16[B+7]=k,this.int16[B+8]=E,this.int16[B+9]=C,this.int16[B+10]=A,this.int16[B+11]=R,t}}H.prototype.bytesPerElement=24,qe("StructArrayLayout4i4ui4i24",H);class K extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.float32[m+0]=n,this.float32[m+1]=o,this.float32[m+2]=c,t}}K.prototype.bytesPerElement=12,qe("StructArrayLayout3f12",K);class J extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}J.prototype.bytesPerElement=4,qe("StructArrayLayout1ul4",J);class re extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,y,x,k){const E=this.length;return this.resize(E+1),this.emplace(E,t,n,o,c,m,g,y,x,k)}emplace(t,n,o,c,m,g,y,x,k,E){const C=10*t,A=5*t;return this.int16[C+0]=n,this.int16[C+1]=o,this.int16[C+2]=c,this.int16[C+3]=m,this.int16[C+4]=g,this.int16[C+5]=y,this.uint32[A+3]=x,this.uint16[C+8]=k,this.uint16[C+9]=E,t}}re.prototype.bytesPerElement=20,qe("StructArrayLayout6i1ul2ui20",re);class q extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,y){const x=6*t;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=c,this.int16[x+3]=m,this.int16[x+4]=g,this.int16[x+5]=y,t}}q.prototype.bytesPerElement=12,qe("StructArrayLayout2i2i2i12",q);class ae extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,o,c,m)}emplace(t,n,o,c,m,g){const y=4*t,x=8*t;return this.float32[y+0]=n,this.float32[y+1]=o,this.float32[y+2]=c,this.int16[x+6]=m,this.int16[x+7]=g,t}}ae.prototype.bytesPerElement=16,qe("StructArrayLayout2f1f2i16",ae);class le extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,y){const x=16*t,k=4*t,E=8*t;return this.uint8[x+0]=n,this.uint8[x+1]=o,this.float32[k+1]=c,this.float32[k+2]=m,this.int16[E+6]=g,this.int16[E+7]=y,t}}le.prototype.bytesPerElement=16,qe("StructArrayLayout2ub2f2i16",le);class pe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.uint16[m+0]=n,this.uint16[m+1]=o,this.uint16[m+2]=c,t}}pe.prototype.bytesPerElement=6,qe("StructArrayLayout3ui6",pe);class xe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,y,x,k,E,C,A,R,B,N,G,X){const de=this.length;return this.resize(de+1),this.emplace(de,t,n,o,c,m,g,y,x,k,E,C,A,R,B,N,G,X)}emplace(t,n,o,c,m,g,y,x,k,E,C,A,R,B,N,G,X,de){const ie=24*t,ue=12*t,ge=48*t;return this.int16[ie+0]=n,this.int16[ie+1]=o,this.uint16[ie+2]=c,this.uint16[ie+3]=m,this.uint32[ue+2]=g,this.uint32[ue+3]=y,this.uint32[ue+4]=x,this.uint16[ie+10]=k,this.uint16[ie+11]=E,this.uint16[ie+12]=C,this.float32[ue+7]=A,this.float32[ue+8]=R,this.uint8[ge+36]=B,this.uint8[ge+37]=N,this.uint8[ge+38]=G,this.uint32[ue+10]=X,this.int16[ie+22]=de,t}}xe.prototype.bytesPerElement=48,qe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",xe);class Te extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,y,x,k,E,C,A,R,B,N,G,X,de,ie,ue,ge,be,Ve,st,Ne,Be,Qe,We){const Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,t,n,o,c,m,g,y,x,k,E,C,A,R,B,N,G,X,de,ie,ue,ge,be,Ve,st,Ne,Be,Qe,We)}emplace(t,n,o,c,m,g,y,x,k,E,C,A,R,B,N,G,X,de,ie,ue,ge,be,Ve,st,Ne,Be,Qe,We,Ze){const ve=32*t,et=16*t;return this.int16[ve+0]=n,this.int16[ve+1]=o,this.int16[ve+2]=c,this.int16[ve+3]=m,this.int16[ve+4]=g,this.int16[ve+5]=y,this.int16[ve+6]=x,this.int16[ve+7]=k,this.uint16[ve+8]=E,this.uint16[ve+9]=C,this.uint16[ve+10]=A,this.uint16[ve+11]=R,this.uint16[ve+12]=B,this.uint16[ve+13]=N,this.uint16[ve+14]=G,this.uint16[ve+15]=X,this.uint16[ve+16]=de,this.uint16[ve+17]=ie,this.uint16[ve+18]=ue,this.uint16[ve+19]=ge,this.uint16[ve+20]=be,this.uint16[ve+21]=Ve,this.uint16[ve+22]=st,this.uint32[et+12]=Ne,this.float32[et+13]=Be,this.float32[et+14]=Qe,this.uint16[ve+30]=We,this.uint16[ve+31]=Ze,t}}Te.prototype.bytesPerElement=64,qe("StructArrayLayout8i15ui1ul2f2ui64",Te);class Oe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}Oe.prototype.bytesPerElement=4,qe("StructArrayLayout1f4",Oe);class $e extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.uint16[6*t+0]=n,this.float32[m+1]=o,this.float32[m+2]=c,t}}$e.prototype.bytesPerElement=12,qe("StructArrayLayout1ui2f12",$e);class Le extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=4*t;return this.uint32[2*t+0]=n,this.uint16[m+2]=o,this.uint16[m+3]=c,t}}Le.prototype.bytesPerElement=8,qe("StructArrayLayout1ul2ui8",Le);class Ae extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const c=2*t;return this.uint16[c+0]=n,this.uint16[c+1]=o,t}}Ae.prototype.bytesPerElement=4,qe("StructArrayLayout2ui4",Ae);class Je extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}Je.prototype.bytesPerElement=2,qe("StructArrayLayout1ui2",Je);class ft extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,o,c)}emplace(t,n,o,c,m){const g=4*t;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=c,this.float32[g+3]=m,t}}ft.prototype.bytesPerElement=16,qe("StructArrayLayout4f16",ft);class Fe extends u{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Q(this.anchorPointX,this.anchorPointY)}}Fe.prototype.size=20;class je extends re{get(t){return new Fe(this,t)}}qe("CollisionBoxArray",je);class dt extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}dt.prototype.size=48;class ir extends xe{get(t){return new dt(this,t)}}qe("PlacedSymbolArray",ir);class xt extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}xt.prototype.size=64;class Pt extends Te{get(t){return new xt(this,t)}}qe("SymbolInstanceArray",Pt);class nr extends Oe{getoffsetX(t){return this.float32[1*t+0]}}qe("GlyphOffsetArray",nr);class Kr extends P{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}qe("SymbolLineVertexArray",Kr);class dn extends u{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}dn.prototype.size=12;class sr extends $e{get(t){return new dn(this,t)}}qe("TextAnchorOffsetArray",sr);class xi extends u{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}xi.prototype.size=8;class li extends Le{get(t){return new xi(this,t)}}qe("FeatureIndexArray",li);class Jr extends T{}class ui extends T{}class zn extends T{}class da extends z{}class ul extends F{}class pa extends j{}class Ki extends V{}class cl extends H{}class Zu extends K{}class Ji extends J{}class Yi extends q{}class ns extends le{}class pn extends pe{}class Ur extends Ae{}const Yr=v([{name:"a_pos",components:2,type:"Int16"}],4),{members:Oi}=Yr;class zt{constructor(t=[]){this.segments=t}prepareSegment(t,n,o,c){let m=this.segments[this.segments.length-1];return t>zt.MAX_VERTEX_ARRAY_LENGTH&&Qt(`Max vertices per segment is ${zt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!m||m.vertexLength+t>zt.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==c)&&(m={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},c!==void 0&&(m.sortKey=c),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,c){return new zt([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function Ms(r,t){return 256*(r=Ue(Math.floor(r),0,255))+Ue(Math.floor(t),0,255)}zt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qe("SegmentVector",zt);const fa=v([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ma={exports:{}},zh={exports:{}};zh.exports=function(r,t){var n,o,c,m,g,y,x,k;for(o=r.length-(n=3&r.length),c=t,g=3432918353,y=461845907,k=0;k<o;)x=255&r.charCodeAt(k)|(255&r.charCodeAt(++k))<<8|(255&r.charCodeAt(++k))<<16|(255&r.charCodeAt(++k))<<24,++k,c=27492+(65535&(m=5*(65535&(c=(c^=x=(65535&(x=(x=(65535&x)*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(x=0,n){case 3:x^=(255&r.charCodeAt(k+2))<<16;case 2:x^=(255&r.charCodeAt(k+1))<<8;case 1:c^=x=(65535&(x=(x=(65535&(x^=255&r.charCodeAt(k)))*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return c^=r.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var Vp=zh.exports,Ah={exports:{}};Ah.exports=function(r,t){for(var n,o=r.length,c=t^o,m=0;o>=4;)n=1540483477*(65535&(n=255&r.charCodeAt(m)|(255&r.charCodeAt(++m))<<8|(255&r.charCodeAt(++m))<<16|(255&r.charCodeAt(++m))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++m;switch(o){case 3:c^=(255&r.charCodeAt(m+2))<<16;case 2:c^=(255&r.charCodeAt(m+1))<<8;case 1:c=1540483477*(65535&(c^=255&r.charCodeAt(m)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var ss=Vp,Dh=Ah.exports;ma.exports=ss,ma.exports.murmur3=ss,ma.exports.murmur2=Dh;var hl=U(ma.exports);class uo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,c){this.ids.push(dl(t)),this.positions.push(n,o,c)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=dl(t);let o=0,c=this.ids.length-1;for(;o<c;){const g=o+c>>1;this.ids[g]>=n?c=g:o=g+1}const m=[];for(;this.ids[o]===n;)m.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return m}static serialize(t,n){const o=new Float64Array(t.ids),c=new Uint32Array(t.positions);return pl(o,c,0,o.length-1),n&&n.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(t){const n=new uo;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function dl(r){const t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:hl(String(r))}function pl(r,t,n,o){for(;n<o;){const c=r[n+o>>1];let m=n-1,g=o+1;for(;;){do m++;while(r[m]<c);do g--;while(r[g]>c);if(m>=g)break;ga(r,m,g),ga(t,3*m,3*g),ga(t,3*m+1,3*g+1),ga(t,3*m+2,3*g+2)}g-n<o-g?(pl(r,t,n,g),n=g+1):(pl(r,t,g+1,o),o=g)}}function ga(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}qe("FeaturePositionMap",uo);class co{constructor(t,n){this.gl=t.gl,this.location=n}}class Lh extends co{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class qg extends co{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Gg extends co{constructor(t,n){super(t,n),this.current=qt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const r1=new Float32Array(16);function Up(r){return[Ms(255*r.r,255*r.g),Ms(255*r.b,255*r.a)]}class qu{constructor(t,n,o){this.value=t,this.uniformNames=n.map(c=>`u_${c}`),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new Gg(t,n):new Lh(t,n)}}class fl{constructor(t,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,o,c){const m=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&t.set(m)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"?new qg(t,n):new Lh(t,n)}}class zs{constructor(t,n,o,c){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(t,n,o,c,m){const g=this.paintVertexArray.length,y=this.expression.evaluate(new rr(0),n,{},c,[],m);this.paintVertexArray.resize(t),this._setPaintValue(g,t,y)}updatePaintArray(t,n,o,c){const m=this.expression.evaluate({zoom:0},o,c);this._setPaintValue(t,n,m)}_setPaintValue(t,n,o){if(this.type==="color"){const c=Up(o);for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,c[0],c[1])}else{for(let c=t;c<n;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class qn{constructor(t,n,o,c,m,g){this.expression=t,this.uniformNames=n.map(y=>`u_${y}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=n.map(y=>({name:`a_${y}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,n,o,c,m){const g=this.expression.evaluate(new rr(this.zoom),n,{},c,[],m),y=this.expression.evaluate(new rr(this.zoom+1),n,{},c,[],m),x=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(x,t,g,y)}updatePaintArray(t,n,o,c){const m=this.expression.evaluate({zoom:this.zoom},o,c),g=this.expression.evaluate({zoom:this.zoom+1},o,c);this._setPaintValue(t,n,m,g)}_setPaintValue(t,n,o,c){if(this.type==="color"){const m=Up(o),g=Up(c);for(let y=t;y<n;y++)this.paintVertexArray.emplace(y,m[0],m[1],g[0],g[1])}else{for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,c=Ue(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(c)}getBinding(t,n,o){return new Lh(t,n)}}class _a{constructor(t,n,o,c,m,g){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=c,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(t,n,o){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(c,t,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(t,n,o,c,m){this._setPaintValues(t,n,o.patterns&&o.patterns[this.layerId],m)}_setPaintValues(t,n,o,c){if(!c||!o)return;const{min:m,mid:g,max:y}=o,x=c[m],k=c[g],E=c[y];if(x&&k&&E)for(let C=t;C<n;C++)this.zoomInPaintVertexArray.emplace(C,k.tl[0],k.tl[1],k.br[0],k.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],k.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(C,k.tl[0],k.tl[1],k.br[0],k.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],k.pixelRatio,E.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,fa.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,fa.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Hg{constructor(t,n,o){this.binders={},this._buffers=[];const c=[];for(const m in t.paint._values){if(!o(m))continue;const g=t.paint.get(m);if(!(g instanceof Mn&&ea(g.property.specification)))continue;const y=i1(m,t.type),x=g.value,k=g.property.specification.type,E=g.property.useIntegerZoom,C=g.property.specification["property-type"],A=C==="cross-faded"||C==="cross-faded-data-driven";if(x.kind==="constant")this.binders[m]=A?new fl(x.value,y):new qu(x.value,y,k),c.push(`/u_${m}`);else if(x.kind==="source"||A){const R=Wg(m,k,"source");this.binders[m]=A?new _a(x,k,E,n,R,t.id):new zs(x,y,k,R),c.push(`/a_${m}`)}else{const R=Wg(m,k,"composite");this.binders[m]=new qn(x,y,k,E,n,R),c.push(`/z_${m}`)}}this.cacheKey=c.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof zs||n instanceof qn?n.maxValue:0}populatePaintArrays(t,n,o,c,m){for(const g in this.binders){const y=this.binders[g];(y instanceof zs||y instanceof qn||y instanceof _a)&&y.populatePaintArray(t,n,o,c,m)}}setConstantPatternPositions(t,n){for(const o in this.binders){const c=this.binders[o];c instanceof fl&&c.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,o,c,m){let g=!1;for(const y in t){const x=n.getPositions(y);for(const k of x){const E=o.feature(k.index);for(const C in this.binders){const A=this.binders[C];if((A instanceof zs||A instanceof qn||A instanceof _a)&&A.expression.isStateDependent===!0){const R=c.paint.get(C);A.expression=R.value,A.updatePaintArray(k.start,k.end,E,t[y],m),g=!0}}}}return g}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof qu||o instanceof fl)&&t.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof zs||o instanceof qn)for(let c=0;c<o.paintVertexAttributes.length;c++)t.push(o.paintVertexAttributes[c].name);else if(o instanceof _a)for(let c=0;c<fa.members.length;c++)t.push(fa.members[c].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof qu||o instanceof fl||o instanceof qn)for(const c of o.uniformNames)t.push(c)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const c in this.binders){const m=this.binders[c];if(m instanceof qu||m instanceof fl||m instanceof qn){for(const g of m.uniformNames)if(n[g]){const y=m.getBinding(t,n[g],g);o.push({name:g,property:c,binding:y})}}}return o}setUniforms(t,n,o,c){for(const{name:m,property:g,binding:y}of n)this.binders[g].setUniform(y,c,o.get(g),m)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof _a){const c=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof zs||o instanceof qn)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof zs||o instanceof qn||o instanceof _a)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof zs||n instanceof qn||n instanceof _a)&&n.destroy()}}}class ho{constructor(t,n,o=()=>!0){this.programConfigurations={};for(const c of t)this.programConfigurations[c.id]=new Hg(c,n,o);this.needsUpload=!1,this._featureMap=new uo,this._bufferOffset=0}populatePaintArrays(t,n,o,c,m,g){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(t,n,c,m,g);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,c){for(const m of o)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(t,this._featureMap,n,m,c)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function i1(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function Wg(r,t,n){const o={color:{source:j,composite:ft},number:{source:Oe,composite:j}},c=function(m){return{"line-pattern":{source:Ki,composite:Ki},"fill-pattern":{source:Ki,composite:Ki},"fill-extrusion-pattern":{source:Ki,composite:Ki}}[m]}(r);return c&&c[n]||o[t][n]}qe("ConstantBinder",qu),qe("CrossFadedConstantBinder",fl),qe("SourceExpressionBinder",zs),qe("CrossFadedCompositeBinder",_a),qe("CompositeExpressionBinder",qn),qe("ProgramConfiguration",Hg,{omit:["_buffers"]}),qe("ProgramConfigurationSet",ho);const Pr=8192,$p=Math.pow(2,14)-1,Xg=-$p-1;function po(r){const t=Pr/r.extent,n=r.loadGeometry();for(let o=0;o<n.length;o++){const c=n[o];for(let m=0;m<c.length;m++){const g=c[m],y=Math.round(g.x*t),x=Math.round(g.y*t);g.x=Ue(y,Xg,$p),g.y=Ue(x,Xg,$p),(y<g.x||y>g.x+1||x<g.y||x>g.y+1)&&Qt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function fo(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?po(r):[]}}function Rh(r,t,n,o,c){r.emplaceBack(2*t+(o+1)/2,2*n+(c+1)/2)}class Zp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ui,this.indexArray=new pn,this.segments=new zt,this.programConfigurations=new ho(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){const c=this.layers[0],m=[];let g=null,y=!1;c.type==="circle"&&(g=c.layout.get("circle-sort-key"),y=!g.isConstant());for(const{feature:x,id:k,index:E,sourceLayerIndex:C}of t){const A=this.layers[0]._featureFilter.needGeometry,R=fo(x,A);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),R,o))continue;const B=y?g.evaluate(R,{},o):void 0,N={id:k,properties:x.properties,type:x.type,sourceLayerIndex:C,index:E,geometry:A?R.geometry:po(x),patterns:{},sortKey:B};m.push(N)}y&&m.sort((x,k)=>x.sortKey-k.sortKey);for(const x of m){const{geometry:k,index:E,sourceLayerIndex:C}=x,A=t[E].feature;this.addFeature(x,k,E,o),n.featureIndex.insert(A,k,E,C,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Oi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,c){for(const m of n)for(const g of m){const y=g.x,x=g.y;if(y<0||y>=Pr||x<0||x>=Pr)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),E=k.vertexLength;Rh(this.layoutVertexArray,y,x,-1,-1),Rh(this.layoutVertexArray,y,x,1,-1),Rh(this.layoutVertexArray,y,x,1,1),Rh(this.layoutVertexArray,y,x,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+3,E+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},c)}}function Kg(r,t){for(let n=0;n<r.length;n++)if(ml(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(ml(r,t[n]))return!0;return!!qp(r,t)}function n1(r,t,n){return!!ml(r,t)||!!Gp(t,r,n)}function Jg(r,t){if(r.length===1)return Qg(t,r[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let c=0;c<o.length;c++)if(ml(r,o[c]))return!0}for(let n=0;n<r.length;n++)if(Qg(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(qp(r,t[n]))return!0;return!1}function s1(r,t,n){if(r.length>1){if(qp(r,t))return!0;for(let o=0;o<t.length;o++)if(Gp(t[o],r,n))return!0}for(let o=0;o<r.length;o++)if(Gp(r[o],t,n))return!0;return!1}function qp(r,t){if(r.length===0||t.length===0)return!1;for(let n=0;n<r.length-1;n++){const o=r[n],c=r[n+1];for(let m=0;m<t.length-1;m++)if(a1(o,c,t[m],t[m+1]))return!0}return!1}function a1(r,t,n,o){return Ot(r,n,o)!==Ot(t,n,o)&&Ot(r,t,n)!==Ot(r,t,o)}function Gp(r,t,n){const o=n*n;if(t.length===1)return r.distSqr(t[0])<o;for(let c=1;c<t.length;c++)if(Yg(r,t[c-1],t[c])<o)return!0;return!1}function Yg(r,t,n){const o=t.distSqr(n);if(o===0)return r.distSqr(t);const c=((r.x-t.x)*(n.x-t.x)+(r.y-t.y)*(n.y-t.y))/o;return r.distSqr(c<0?t:c>1?n:n.sub(t)._mult(c)._add(t))}function Qg(r,t){let n,o,c,m=!1;for(let g=0;g<r.length;g++){n=r[g];for(let y=0,x=n.length-1;y<n.length;x=y++)o=n[y],c=n[x],o.y>t.y!=c.y>t.y&&t.x<(c.x-o.x)*(t.y-o.y)/(c.y-o.y)+o.x&&(m=!m)}return m}function ml(r,t){let n=!1;for(let o=0,c=r.length-1;o<r.length;c=o++){const m=r[o],g=r[c];m.y>t.y!=g.y>t.y&&t.x<(g.x-m.x)*(t.y-m.y)/(g.y-m.y)+m.x&&(n=!n)}return n}function o1(r,t,n){const o=n[0],c=n[2];if(r.x<o.x&&t.x<o.x||r.x>c.x&&t.x>c.x||r.y<o.y&&t.y<o.y||r.y>c.y&&t.y>c.y)return!1;const m=Ot(r,t,n[0]);return m!==Ot(r,t,n[1])||m!==Ot(r,t,n[2])||m!==Ot(r,t,n[3])}function Gu(r,t,n){const o=t.paint.get(r).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(r)}function Fh(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Bh(r,t,n,o,c){if(!t[0]&&!t[1])return r;const m=Q.convert(t)._mult(c);n==="viewport"&&m._rotate(-o);const g=[];for(let y=0;y<r.length;y++)g.push(r[y].sub(m));return g}let e_,t_;qe("CircleBucket",Zp,{omit:["layers"]});var l1={get paint(){return t_=t_||new f({"circle-radius":new ot(me.paint_circle["circle-radius"]),"circle-color":new ot(me.paint_circle["circle-color"]),"circle-blur":new ot(me.paint_circle["circle-blur"]),"circle-opacity":new ot(me.paint_circle["circle-opacity"]),"circle-translate":new Ke(me.paint_circle["circle-translate"]),"circle-translate-anchor":new Ke(me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ke(me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ke(me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ot(me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ot(me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ot(me.paint_circle["circle-stroke-opacity"])})},get layout(){return e_=e_||new f({"circle-sort-key":new ot(me.layout_circle["circle-sort-key"])})}},wi=1e-6,gl=typeof Float32Array<"u"?Float32Array:Array;function Hp(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function r_(r,t,n){var o=t[0],c=t[1],m=t[2],g=t[3],y=t[4],x=t[5],k=t[6],E=t[7],C=t[8],A=t[9],R=t[10],B=t[11],N=t[12],G=t[13],X=t[14],de=t[15],ie=n[0],ue=n[1],ge=n[2],be=n[3];return r[0]=ie*o+ue*y+ge*C+be*N,r[1]=ie*c+ue*x+ge*A+be*G,r[2]=ie*m+ue*k+ge*R+be*X,r[3]=ie*g+ue*E+ge*B+be*de,r[4]=(ie=n[4])*o+(ue=n[5])*y+(ge=n[6])*C+(be=n[7])*N,r[5]=ie*c+ue*x+ge*A+be*G,r[6]=ie*m+ue*k+ge*R+be*X,r[7]=ie*g+ue*E+ge*B+be*de,r[8]=(ie=n[8])*o+(ue=n[9])*y+(ge=n[10])*C+(be=n[11])*N,r[9]=ie*c+ue*x+ge*A+be*G,r[10]=ie*m+ue*k+ge*R+be*X,r[11]=ie*g+ue*E+ge*B+be*de,r[12]=(ie=n[12])*o+(ue=n[13])*y+(ge=n[14])*C+(be=n[15])*N,r[13]=ie*c+ue*x+ge*A+be*G,r[14]=ie*m+ue*k+ge*R+be*X,r[15]=ie*g+ue*E+ge*B+be*de,r}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var Hu,u1=r_;function Oh(r,t,n){var o=t[0],c=t[1],m=t[2],g=t[3];return r[0]=n[0]*o+n[4]*c+n[8]*m+n[12]*g,r[1]=n[1]*o+n[5]*c+n[9]*m+n[13]*g,r[2]=n[2]*o+n[6]*c+n[10]*m+n[14]*g,r[3]=n[3]*o+n[7]*c+n[11]*m+n[15]*g,r}Hu=new gl(4),gl!=Float32Array&&(Hu[0]=0,Hu[1]=0,Hu[2]=0,Hu[3]=0);class c1 extends s{constructor(t){super(t,l1)}createBucket(t){return new Zp(t)}queryRadius(t){const n=t;return Gu("circle-radius",this,n)+Gu("circle-stroke-width",this,n)+Fh(this.paint.get("circle-translate"))}queryIntersectsFeature(t,n,o,c,m,g,y,x){const k=Bh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,y),E=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),C=this.paint.get("circle-pitch-alignment")==="map",A=C?k:function(B,N){return B.map(G=>i_(G,N))}(k,x),R=C?E*y:E;for(const B of c)for(const N of B){const G=C?N:i_(N,x);let X=R;const de=Oh([],[N.x,N.y,0,1],x);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?X*=de[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(X*=g.cameraToCenterDistance/de[3]),n1(A,G,X))return!0}return!1}}function i_(r,t){const n=Oh([],[r.x,r.y,0,1],t);return new Q(n[0]/n[3],n[1]/n[3])}class n_ extends Zp{}let s_;qe("HeatmapBucket",n_,{omit:["layers"]});var h1={get paint(){return s_=s_||new f({"heatmap-radius":new ot(me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ot(me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ke(me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new $u(me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ke(me.paint_heatmap["heatmap-opacity"])})}};function Wp(r,{width:t,height:n},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${t*n*o}`)}else c=new Uint8Array(t*n*o);return r.width=t,r.height=n,r.data=c,r}function a_(r,{width:t,height:n},o){if(t===r.width&&n===r.height)return;const c=Wp({},{width:t,height:n},o);Xp(r,c,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,n)},o),r.width=t,r.height=n,r.data=c.data}function Xp(r,t,n,o,c,m){if(c.width===0||c.height===0)return t;if(c.width>r.width||c.height>r.height||n.x>r.width-c.width||n.y>r.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>t.width||c.height>t.height||o.x>t.width-c.width||o.y>t.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=r.data,y=t.data;if(g===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<c.height;x++){const k=((n.y+x)*r.width+n.x)*m,E=((o.y+x)*t.width+o.x)*m;for(let C=0;C<c.width*m;C++)y[E+C]=g[k+C]}return t}class Wu{constructor(t,n){Wp(this,t,1,n)}resize(t){a_(this,t,1)}clone(){return new Wu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,c,m){Xp(t,n,o,c,m,1)}}class fn{constructor(t,n){Wp(this,t,4,n)}resize(t){a_(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new fn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,c,m){Xp(t,n,o,c,m,4)}}function o_(r){const t={},n=r.resolution||256,o=r.clips?r.clips.length:1,c=r.image||new fn({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const m=(g,y,x)=>{t[r.evaluationKey]=x;const k=r.expression.evaluate(t);c.data[g+y+0]=Math.floor(255*k.r/k.a),c.data[g+y+1]=Math.floor(255*k.g/k.a),c.data[g+y+2]=Math.floor(255*k.b/k.a),c.data[g+y+3]=Math.floor(255*k.a)};if(r.clips)for(let g=0,y=0;g<o;++g,y+=4*n)for(let x=0,k=0;x<n;x++,k+=4){const E=x/(n-1),{start:C,end:A}=r.clips[g];m(y,k,C*(1-E)+A*E)}else for(let g=0,y=0;g<n;g++,y+=4)m(0,y,g/(n-1));return c}qe("AlphaImage",Wu),qe("RGBAImage",fn);const Kp="big-fb";class d1 extends s{createBucket(t){return new n_(t)}constructor(t){super(t,h1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=o_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Kp)&&this.heatmapFbos.delete(Kp)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let l_;var p1={get paint(){return l_=l_||new f({"hillshade-illumination-direction":new Ke(me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ke(me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ke(me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ke(me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ke(me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ke(me.paint_hillshade["hillshade-accent-color"])})}};class f1 extends s{constructor(t){super(t,p1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const m1=v([{name:"a_pos",components:2,type:"Int16"}],4),{members:g1}=m1;function u_(r,t,n=2){const o=t&&t.length,c=o?t[0]*n:r.length;let m=c_(r,0,c,n,!0);const g=[];if(!m||m.next===m.prev)return g;let y,x,k;if(o&&(m=function(E,C,A,R){const B=[];for(let N=0,G=C.length;N<G;N++){const X=c_(E,C[N]*R,N<G-1?C[N+1]*R:E.length,R,!1);X===X.next&&(X.steiner=!0),B.push(T1(X))}B.sort(w1);for(let N=0;N<B.length;N++)A=b1(B[N],A);return A}(r,t,m,n)),r.length>80*n){y=1/0,x=1/0;let E=-1/0,C=-1/0;for(let A=n;A<c;A+=n){const R=r[A],B=r[A+1];R<y&&(y=R),B<x&&(x=B),R>E&&(E=R),B>C&&(C=B)}k=Math.max(E-y,C-x),k=k!==0?32767/k:0}return Xu(m,g,n,y,x,k,0),g}function c_(r,t,n,o,c){let m;if(c===function(g,y,x,k){let E=0;for(let C=y,A=x-k;C<x;C+=k)E+=(g[A]-g[C])*(g[C+1]+g[A+1]),A=C;return E}(r,t,n,o)>0)for(let g=t;g<n;g+=o)m=p_(g/o|0,r[g],r[g+1],m);else for(let g=n-o;g>=t;g-=o)m=p_(g/o|0,r[g],r[g+1],m);return m&&Nh(m,m.next)&&(Ju(m),m=m.next),m}function mo(r,t){if(!r)return r;t||(t=r);let n,o=r;do if(n=!1,o.steiner||!Nh(o,o.next)&&xr(o.prev,o,o.next)!==0)o=o.next;else{if(Ju(o),o=t=o.prev,o===o.next)break;n=!0}while(n||o!==t);return t}function Xu(r,t,n,o,c,m,g){if(!r)return;!g&&m&&function(x,k,E,C){let A=x;do A.z===0&&(A.z=Jp(A.x,A.y,k,E,C)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==x);A.prevZ.nextZ=null,A.prevZ=null,function(R){let B,N=1;do{let G,X=R;R=null;let de=null;for(B=0;X;){B++;let ie=X,ue=0;for(let be=0;be<N&&(ue++,ie=ie.nextZ,ie);be++);let ge=N;for(;ue>0||ge>0&&ie;)ue!==0&&(ge===0||!ie||X.z<=ie.z)?(G=X,X=X.nextZ,ue--):(G=ie,ie=ie.nextZ,ge--),de?de.nextZ=G:R=G,G.prevZ=de,de=G;X=ie}de.nextZ=null,N*=2}while(B>1)}(A)}(r,o,c,m);let y=r;for(;r.prev!==r.next;){const x=r.prev,k=r.next;if(m?y1(r,o,c,m):_1(r))t.push(x.i,r.i,k.i),Ju(r),r=k.next,y=k.next;else if((r=k)===y){g?g===1?Xu(r=v1(mo(r),t),t,n,o,c,m,2):g===2&&x1(r,t,n,o,c,m):Xu(mo(r),t,n,o,c,m,1);break}}}function _1(r){const t=r.prev,n=r,o=r.next;if(xr(t,n,o)>=0)return!1;const c=t.x,m=n.x,g=o.x,y=t.y,x=n.y,k=o.y,E=c<m?c<g?c:g:m<g?m:g,C=y<x?y<k?y:k:x<k?x:k,A=c>m?c>g?c:g:m>g?m:g,R=y>x?y>k?y:k:x>k?x:k;let B=o.next;for(;B!==t;){if(B.x>=E&&B.x<=A&&B.y>=C&&B.y<=R&&_l(c,y,m,x,g,k,B.x,B.y)&&xr(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function y1(r,t,n,o){const c=r.prev,m=r,g=r.next;if(xr(c,m,g)>=0)return!1;const y=c.x,x=m.x,k=g.x,E=c.y,C=m.y,A=g.y,R=y<x?y<k?y:k:x<k?x:k,B=E<C?E<A?E:A:C<A?C:A,N=y>x?y>k?y:k:x>k?x:k,G=E>C?E>A?E:A:C>A?C:A,X=Jp(R,B,t,n,o),de=Jp(N,G,t,n,o);let ie=r.prevZ,ue=r.nextZ;for(;ie&&ie.z>=X&&ue&&ue.z<=de;){if(ie.x>=R&&ie.x<=N&&ie.y>=B&&ie.y<=G&&ie!==c&&ie!==g&&_l(y,E,x,C,k,A,ie.x,ie.y)&&xr(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,ue.x>=R&&ue.x<=N&&ue.y>=B&&ue.y<=G&&ue!==c&&ue!==g&&_l(y,E,x,C,k,A,ue.x,ue.y)&&xr(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;ie&&ie.z>=X;){if(ie.x>=R&&ie.x<=N&&ie.y>=B&&ie.y<=G&&ie!==c&&ie!==g&&_l(y,E,x,C,k,A,ie.x,ie.y)&&xr(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;ue&&ue.z<=de;){if(ue.x>=R&&ue.x<=N&&ue.y>=B&&ue.y<=G&&ue!==c&&ue!==g&&_l(y,E,x,C,k,A,ue.x,ue.y)&&xr(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function v1(r,t){let n=r;do{const o=n.prev,c=n.next.next;!Nh(o,c)&&h_(o,n,n.next,c)&&Ku(o,c)&&Ku(c,o)&&(t.push(o.i,n.i,c.i),Ju(n),Ju(n.next),n=r=c),n=n.next}while(n!==r);return mo(n)}function x1(r,t,n,o,c,m){let g=r;do{let y=g.next.next;for(;y!==g.prev;){if(g.i!==y.i&&k1(g,y)){let x=d_(g,y);return g=mo(g,g.next),x=mo(x,x.next),Xu(g,t,n,o,c,m,0),void Xu(x,t,n,o,c,m,0)}y=y.next}g=g.next}while(g!==r)}function w1(r,t){return r.x-t.x}function b1(r,t){const n=function(c,m){let g=m;const y=c.x,x=c.y;let k,E=-1/0;do{if(x<=g.y&&x>=g.next.y&&g.next.y!==g.y){const N=g.x+(x-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(N<=y&&N>E&&(E=N,k=g.x<g.next.x?g:g.next,N===y))return k}g=g.next}while(g!==m);if(!k)return null;const C=k,A=k.x,R=k.y;let B=1/0;g=k;do{if(y>=g.x&&g.x>=A&&y!==g.x&&_l(x<R?y:E,x,A,R,x<R?E:y,x,g.x,g.y)){const N=Math.abs(x-g.y)/(y-g.x);Ku(g,c)&&(N<B||N===B&&(g.x>k.x||g.x===k.x&&S1(k,g)))&&(k=g,B=N)}g=g.next}while(g!==C);return k}(r,t);if(!n)return t;const o=d_(n,r);return mo(o,o.next),mo(n,n.next)}function S1(r,t){return xr(r.prev,r,t.prev)<0&&xr(t.next,r,r.next)<0}function Jp(r,t,n,o,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*c|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function T1(r){let t=r,n=r;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==r);return n}function _l(r,t,n,o,c,m,g,y){return(c-g)*(t-y)>=(r-g)*(m-y)&&(r-g)*(o-y)>=(n-g)*(t-y)&&(n-g)*(m-y)>=(c-g)*(o-y)}function k1(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!function(n,o){let c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==o.i&&c.next.i!==o.i&&h_(c,c.next,n,o))return!0;c=c.next}while(c!==n);return!1}(r,t)&&(Ku(r,t)&&Ku(t,r)&&function(n,o){let c=n,m=!1;const g=(n.x+o.x)/2,y=(n.y+o.y)/2;do c.y>y!=c.next.y>y&&c.next.y!==c.y&&g<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(m=!m),c=c.next;while(c!==n);return m}(r,t)&&(xr(r.prev,r,t.prev)||xr(r,t.prev,t))||Nh(r,t)&&xr(r.prev,r,r.next)>0&&xr(t.prev,t,t.next)>0)}function xr(r,t,n){return(t.y-r.y)*(n.x-t.x)-(t.x-r.x)*(n.y-t.y)}function Nh(r,t){return r.x===t.x&&r.y===t.y}function h_(r,t,n,o){const c=Vh(xr(r,t,n)),m=Vh(xr(r,t,o)),g=Vh(xr(n,o,r)),y=Vh(xr(n,o,t));return c!==m&&g!==y||!(c!==0||!jh(r,n,t))||!(m!==0||!jh(r,o,t))||!(g!==0||!jh(n,r,o))||!(y!==0||!jh(n,t,o))}function jh(r,t,n){return t.x<=Math.max(r.x,n.x)&&t.x>=Math.min(r.x,n.x)&&t.y<=Math.max(r.y,n.y)&&t.y>=Math.min(r.y,n.y)}function Vh(r){return r>0?1:r<0?-1:0}function Ku(r,t){return xr(r.prev,r,r.next)<0?xr(r,t,r.next)>=0&&xr(r,r.prev,t)>=0:xr(r,t,r.prev)<0||xr(r,r.next,t)<0}function d_(r,t){const n=Yp(r.i,r.x,r.y),o=Yp(t.i,t.x,t.y),c=r.next,m=t.prev;return r.next=t,t.prev=r,n.next=c,c.prev=n,o.next=n,n.prev=o,m.next=o,o.prev=m,o}function p_(r,t,n,o){const c=Yp(r,t,n);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function Ju(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Yp(r,t,n){return{i:r,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Qp(r,t,n){const o=n.patternDependencies;let c=!1;for(const m of t){const g=m.paint.get(`${r}-pattern`);g.isConstant()||(c=!0);const y=g.constantOr(null);y&&(c=!0,o[y.to]=!0,o[y.from]=!0)}return c}function ef(r,t,n,o,c){const m=c.patternDependencies;for(const g of t){const y=g.paint.get(`${r}-pattern`).value;if(y.kind!=="constant"){let x=y.evaluate({zoom:o-1},n,{},c.availableImages),k=y.evaluate({zoom:o},n,{},c.availableImages),E=y.evaluate({zoom:o+1},n,{},c.availableImages);x=x&&x.name?x.name:x,k=k&&k.name?k.name:k,E=E&&E.name?E.name:E,m[x]=!0,m[k]=!0,m[E]=!0,n.patterns[g.id]={min:x,mid:k,max:E}}}return n}class tf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new zn,this.indexArray=new pn,this.indexArray2=new Ur,this.programConfigurations=new ho(t.layers,t.zoom),this.segments=new zt,this.segments2=new zt,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=Qp("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),m=!c.isConstant(),g=[];for(const{feature:y,id:x,index:k,sourceLayerIndex:E}of t){const C=this.layers[0]._featureFilter.needGeometry,A=fo(y,C);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),A,o))continue;const R=m?c.evaluate(A,{},o,n.availableImages):void 0,B={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:k,geometry:C?A.geometry:po(y),patterns:{},sortKey:R};g.push(B)}m&&g.sort((y,x)=>y.sortKey-x.sortKey);for(const y of g){const{geometry:x,index:k,sourceLayerIndex:E}=y;if(this.hasPattern){const C=ef("fill",this.layers,y,this.zoom,n);this.patternFeatures.push(C)}else this.addFeature(y,x,k,o,{});n.featureIndex.insert(t[k].feature,x,k,E,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,g1),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,c,m){for(const g of Vo(n,500)){let y=0;for(const R of g)y+=R.length;const x=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),k=x.vertexLength,E=[],C=[];for(const R of g){if(R.length===0)continue;R!==g[0]&&C.push(E.length/2);const B=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),N=B.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(N+R.length-1,N),E.push(R[0].x),E.push(R[0].y);for(let G=1;G<R.length;G++)this.layoutVertexArray.emplaceBack(R[G].x,R[G].y),this.indexArray2.emplaceBack(N+G-1,N+G),E.push(R[G].x),E.push(R[G].y);B.vertexLength+=R.length,B.primitiveLength+=R.length}const A=u_(E,C);for(let R=0;R<A.length;R+=3)this.indexArray.emplaceBack(k+A[R],k+A[R+1],k+A[R+2]);x.vertexLength+=y,x.primitiveLength+=A.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,m,c)}}let f_,m_;qe("FillBucket",tf,{omit:["layers","patternFeatures"]});var I1={get paint(){return m_=m_||new f({"fill-antialias":new Ke(me.paint_fill["fill-antialias"]),"fill-opacity":new ot(me.paint_fill["fill-opacity"]),"fill-color":new ot(me.paint_fill["fill-color"]),"fill-outline-color":new ot(me.paint_fill["fill-outline-color"]),"fill-translate":new Ke(me.paint_fill["fill-translate"]),"fill-translate-anchor":new Ke(me.paint_fill["fill-translate-anchor"]),"fill-pattern":new ol(me.paint_fill["fill-pattern"])})},get layout(){return f_=f_||new f({"fill-sort-key":new ot(me.layout_fill["fill-sort-key"])})}};class E1 extends s{constructor(t){super(t,I1)}recalculate(t,n){super.recalculate(t,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new tf(t)}queryRadius(){return Fh(this.paint.get("fill-translate"))}queryIntersectsFeature(t,n,o,c,m,g,y){return Jg(Bh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,y),c)}isTileClipped(){return!0}}const P1=v([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),C1=v([{name:"a_centroid",components:2,type:"Int16"}],4),{members:M1}=P1;var ya={},z1=ne,g_=yl;function yl(r,t,n,o,c){this.properties={},this.extent=n,this.type=0,this._pbf=r,this._geometry=-1,this._keys=o,this._values=c,r.readFields(A1,this,t)}function A1(r,t,n){r==1?t.id=n.readVarint():r==2?function(o,c){for(var m=o.readVarint()+o.pos;o.pos<m;){var g=c._keys[o.readVarint()],y=c._values[o.readVarint()];c.properties[g]=y}}(n,t):r==3?t.type=n.readVarint():r==4&&(t._geometry=n.pos)}function D1(r){for(var t,n,o=0,c=0,m=r.length,g=m-1;c<m;g=c++)o+=((n=r[g]).x-(t=r[c]).x)*(t.y+n.y);return o}yl.types=["Unknown","Point","LineString","Polygon"],yl.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var t,n=r.readVarint()+r.pos,o=1,c=0,m=0,g=0,y=[];r.pos<n;){if(c<=0){var x=r.readVarint();o=7&x,c=x>>3}if(c--,o===1||o===2)m+=r.readSVarint(),g+=r.readSVarint(),o===1&&(t&&y.push(t),t=[]),t.push(new z1(m,g));else{if(o!==7)throw new Error("unknown command "+o);t&&t.push(t[0].clone())}}return t&&y.push(t),y},yl.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var t=r.readVarint()+r.pos,n=1,o=0,c=0,m=0,g=1/0,y=-1/0,x=1/0,k=-1/0;r.pos<t;){if(o<=0){var E=r.readVarint();n=7&E,o=E>>3}if(o--,n===1||n===2)(c+=r.readSVarint())<g&&(g=c),c>y&&(y=c),(m+=r.readSVarint())<x&&(x=m),m>k&&(k=m);else if(n!==7)throw new Error("unknown command "+n)}return[g,x,y,k]},yl.prototype.toGeoJSON=function(r,t,n){var o,c,m=this.extent*Math.pow(2,n),g=this.extent*r,y=this.extent*t,x=this.loadGeometry(),k=yl.types[this.type];function E(R){for(var B=0;B<R.length;B++){var N=R[B];R[B]=[360*(N.x+g)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(N.y+y)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(o=0;o<x.length;o++)C[o]=x[o][0];E(x=C);break;case 2:for(o=0;o<x.length;o++)E(x[o]);break;case 3:for(x=function(R){var B=R.length;if(B<=1)return[R];for(var N,G,X=[],de=0;de<B;de++){var ie=D1(R[de]);ie!==0&&(G===void 0&&(G=ie<0),G===ie<0?(N&&X.push(N),N=[R[de]]):N.push(R[de]))}return N&&X.push(N),X}(x),o=0;o<x.length;o++)for(c=0;c<x[o].length;c++)E(x[o][c])}x.length===1?x=x[0]:k="Multi"+k;var A={type:"Feature",geometry:{type:k,coordinates:x},properties:this.properties};return"id"in this&&(A.id=this.id),A};var L1=g_,__=y_;function y_(r,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(R1,this,t),this.length=this._features.length}function R1(r,t,n){r===15?t.version=n.readVarint():r===1?t.name=n.readString():r===5?t.extent=n.readVarint():r===2?t._features.push(n.pos):r===3?t._keys.push(n.readString()):r===4&&t._values.push(function(o){for(var c=null,m=o.readVarint()+o.pos;o.pos<m;){var g=o.readVarint()>>3;c=g===1?o.readString():g===2?o.readFloat():g===3?o.readDouble():g===4?o.readVarint64():g===5?o.readVarint():g===6?o.readSVarint():g===7?o.readBoolean():null}return c}(n))}y_.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var t=this._pbf.readVarint()+this._pbf.pos;return new L1(this._pbf,t,this.extent,this._keys,this._values)};var F1=__;function B1(r,t,n){if(r===3){var o=new F1(n,n.readVarint()+n.pos);o.length&&(t[o.name]=o)}}ya.VectorTile=function(r,t){this.layers=r.readFields(B1,{},t)},ya.VectorTileFeature=g_,ya.VectorTileLayer=__;const O1=ya.VectorTileFeature.types,rf=Math.pow(2,13);function Yu(r,t,n,o,c,m,g,y){r.emplaceBack(t,n,2*Math.floor(o*rf)+g,c*rf*2,m*rf*2,Math.round(y))}class nf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new da,this.centroidVertexArray=new Jr,this.indexArray=new pn,this.programConfigurations=new ho(t.layers,t.zoom),this.segments=new zt,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.features=[],this.hasPattern=Qp("fill-extrusion",this.layers,n);for(const{feature:c,id:m,index:g,sourceLayerIndex:y}of t){const x=this.layers[0]._featureFilter.needGeometry,k=fo(c,x);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),k,o))continue;const E={id:m,sourceLayerIndex:y,index:g,geometry:x?k.geometry:po(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(ef("fill-extrusion",this.layers,E,this.zoom,n)):this.addFeature(E,E.geometry,g,o,{}),n.featureIndex.insert(c,E.geometry,g,y,this.index,!0)}}addFeatures(t,n,o){for(const c of this.features){const{geometry:m}=c;this.addFeature(c,m,c.index,n,o)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,M1),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,C1.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,c,m){for(const g of Vo(n,500)){const y={x:0,y:0,vertexCount:0};let x=0;for(const B of g)x+=B.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const B of g){if(B.length===0||j1(B))continue;let N=0;for(let G=0;G<B.length;G++){const X=B[G];if(G>=1){const de=B[G-1];if(!N1(X,de)){k.vertexLength+4>zt.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ie=X.sub(de)._perp()._unit(),ue=de.dist(X);N+ue>32768&&(N=0),Yu(this.layoutVertexArray,X.x,X.y,ie.x,ie.y,0,0,N),Yu(this.layoutVertexArray,X.x,X.y,ie.x,ie.y,0,1,N),y.x+=2*X.x,y.y+=2*X.y,y.vertexCount+=2,N+=ue,Yu(this.layoutVertexArray,de.x,de.y,ie.x,ie.y,0,0,N),Yu(this.layoutVertexArray,de.x,de.y,ie.x,ie.y,0,1,N),y.x+=2*de.x,y.y+=2*de.y,y.vertexCount+=2;const ge=k.vertexLength;this.indexArray.emplaceBack(ge,ge+2,ge+1),this.indexArray.emplaceBack(ge+1,ge+2,ge+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+x>zt.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),O1[t.type]!=="Polygon")continue;const E=[],C=[],A=k.vertexLength;for(const B of g)if(B.length!==0){B!==g[0]&&C.push(E.length/2);for(let N=0;N<B.length;N++){const G=B[N];Yu(this.layoutVertexArray,G.x,G.y,0,0,1,1,0),y.x+=G.x,y.y+=G.y,y.vertexCount+=1,E.push(G.x),E.push(G.y)}}const R=u_(E,C);for(let B=0;B<R.length;B+=3)this.indexArray.emplaceBack(A+R[B],A+R[B+2],A+R[B+1]);k.primitiveLength+=R.length/3,k.vertexLength+=x;for(let B=0;B<y.vertexCount;B++){const N=Math.floor(y.x/y.vertexCount),G=Math.floor(y.y/y.vertexCount);this.centroidVertexArray.emplaceBack(N,G)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,m,c)}}function N1(r,t){return r.x===t.x&&(r.x<0||r.x>Pr)||r.y===t.y&&(r.y<0||r.y>Pr)}function j1(r){return r.every(t=>t.x<0)||r.every(t=>t.x>Pr)||r.every(t=>t.y<0)||r.every(t=>t.y>Pr)}let v_;qe("FillExtrusionBucket",nf,{omit:["layers","features"]});var V1={get paint(){return v_=v_||new f({"fill-extrusion-opacity":new Ke(me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ot(me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ke(me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ke(me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ol(me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ot(me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ot(me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ke(me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class U1 extends s{constructor(t){super(t,V1)}createBucket(t){return new nf(t)}queryRadius(){return Fh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,n,o,c,m,g,y,x){const k=Bh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,y),E=this.paint.get("fill-extrusion-height").evaluate(n,o),C=this.paint.get("fill-extrusion-base").evaluate(n,o),A=function(B,N,G,X){const de=[];for(const ie of B){const ue=[ie.x,ie.y,0,1];Oh(ue,ue,N),de.push(new Q(ue[0]/ue[3],ue[1]/ue[3]))}return de}(k,x),R=function(B,N,G,X){const de=[],ie=[],ue=X[8]*N,ge=X[9]*N,be=X[10]*N,Ve=X[11]*N,st=X[8]*G,Ne=X[9]*G,Be=X[10]*G,Qe=X[11]*G;for(const We of B){const Ze=[],ve=[];for(const et of We){const Ye=et.x,pt=et.y,Xt=X[0]*Ye+X[4]*pt+X[12],Wt=X[1]*Ye+X[5]*pt+X[13],Fr=X[2]*Ye+X[6]*pt+X[14],An=X[3]*Ye+X[7]*pt+X[15],ei=Fr+be,Br=An+Ve,bi=Xt+st,Si=Wt+Ne,Ti=Fr+Be,gr=An+Qe,Or=new Q((Xt+ue)/Br,(Wt+ge)/Br);Or.z=ei/Br,Ze.push(Or);const ci=new Q(bi/gr,Si/gr);ci.z=Ti/gr,ve.push(ci)}de.push(Ze),ie.push(ve)}return[de,ie]}(c,C,E,x);return function(B,N,G){let X=1/0;Jg(G,N)&&(X=x_(G,N[0]));for(let de=0;de<N.length;de++){const ie=N[de],ue=B[de];for(let ge=0;ge<ie.length-1;ge++){const be=ie[ge],Ve=[be,ie[ge+1],ue[ge+1],ue[ge],be];Kg(G,Ve)&&(X=Math.min(X,x_(G,Ve)))}}return X!==1/0&&X}(R[0],R[1],A)}}function Qu(r,t){return r.x*t.x+r.y*t.y}function x_(r,t){if(r.length===1){let n=0;const o=t[n++];let c;for(;!c||o.equals(c);)if(c=t[n++],!c)return 1/0;for(;n<t.length;n++){const m=t[n],g=r[0],y=c.sub(o),x=m.sub(o),k=g.sub(o),E=Qu(y,y),C=Qu(y,x),A=Qu(x,x),R=Qu(k,y),B=Qu(k,x),N=E*A-C*C,G=(A*R-C*B)/N,X=(E*B-C*R)/N,de=o.z*(1-G-X)+c.z*G+m.z*X;if(isFinite(de))return de}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const $1=v([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Z1}=$1,q1=v([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:G1}=q1,H1=ya.VectorTileFeature.types,W1=Math.cos(Math.PI/180*37.5),w_=Math.pow(2,14)/.5;class sf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new ul,this.layoutVertexArray2=new pa,this.indexArray=new pn,this.programConfigurations=new ho(t.layers,t.zoom),this.segments=new zt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=Qp("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key"),m=!c.isConstant(),g=[];for(const{feature:y,id:x,index:k,sourceLayerIndex:E}of t){const C=this.layers[0]._featureFilter.needGeometry,A=fo(y,C);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),A,o))continue;const R=m?c.evaluate(A,{},o):void 0,B={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:k,geometry:C?A.geometry:po(y),patterns:{},sortKey:R};g.push(B)}m&&g.sort((y,x)=>y.sortKey-x.sortKey);for(const y of g){const{geometry:x,index:k,sourceLayerIndex:E}=y;if(this.hasPattern){const C=ef("line",this.layers,y,this.zoom,n);this.patternFeatures.push(C)}else this.addFeature(y,x,k,o,{});n.featureIndex.insert(t[k].feature,x,k,E,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,G1)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Z1),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,c,m){const g=this.layers[0].layout,y=g.get("line-join").evaluate(t,{}),x=g.get("line-cap"),k=g.get("line-miter-limit"),E=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const C of n)this.addLine(C,t,y,x,k,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,m,c)}addLine(t,n,o,c,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<t.length-1;X++)this.totalDistance+=t[X].dist(t[X+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=H1[n.type]==="Polygon";let x=t.length;for(;x>=2&&t[x-1].equals(t[x-2]);)x--;let k=0;for(;k<x-1&&t[k].equals(t[k+1]);)k++;if(x<(y?3:2))return;o==="bevel"&&(m=1.05);const E=this.overscaling<=16?15*Pr/(512*this.overscaling):0,C=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let A,R,B,N,G;this.e1=this.e2=-1,y&&(A=t[x-2],G=t[k].sub(A)._unit()._perp());for(let X=k;X<x;X++){if(B=X===x-1?y?t[k+1]:void 0:t[X+1],B&&t[X].equals(B))continue;G&&(N=G),A&&(R=A),A=t[X],G=B?B.sub(A)._unit()._perp():N,N=N||G;let de=N.add(G);de.x===0&&de.y===0||de._unit();const ie=N.x*G.x+N.y*G.y,ue=de.x*G.x+de.y*G.y,ge=ue!==0?1/ue:1/0,be=2*Math.sqrt(2-2*ue),Ve=ue<W1&&R&&B,st=N.x*G.y-N.y*G.x>0;if(Ve&&X>k){const Qe=A.dist(R);if(Qe>2*E){const We=A.sub(A.sub(R)._mult(E/Qe)._round());this.updateDistance(R,We),this.addCurrentVertex(We,N,0,0,C),R=We}}const Ne=R&&B;let Be=Ne?o:y?"butt":c;if(Ne&&Be==="round"&&(ge<g?Be="miter":ge<=2&&(Be="fakeround")),Be==="miter"&&ge>m&&(Be="bevel"),Be==="bevel"&&(ge>2&&(Be="flipbevel"),ge<m&&(Be="miter")),R&&this.updateDistance(R,A),Be==="miter")de._mult(ge),this.addCurrentVertex(A,de,0,0,C);else if(Be==="flipbevel"){if(ge>100)de=G.mult(-1);else{const Qe=ge*N.add(G).mag()/N.sub(G).mag();de._perp()._mult(Qe*(st?-1:1))}this.addCurrentVertex(A,de,0,0,C),this.addCurrentVertex(A,de.mult(-1),0,0,C)}else if(Be==="bevel"||Be==="fakeround"){const Qe=-Math.sqrt(ge*ge-1),We=st?Qe:0,Ze=st?0:Qe;if(R&&this.addCurrentVertex(A,N,We,Ze,C),Be==="fakeround"){const ve=Math.round(180*be/Math.PI/20);for(let et=1;et<ve;et++){let Ye=et/ve;if(Ye!==.5){const Xt=Ye-.5;Ye+=Ye*Xt*(Ye-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*Xt*Xt+(.848013+ie*(.215638*ie-1.06021)))}const pt=G.sub(N)._mult(Ye)._add(N)._unit()._mult(st?-1:1);this.addHalfVertex(A,pt.x,pt.y,!1,st,0,C)}}B&&this.addCurrentVertex(A,G,-We,-Ze,C)}else if(Be==="butt")this.addCurrentVertex(A,de,0,0,C);else if(Be==="square"){const Qe=R?1:-1;this.addCurrentVertex(A,de,Qe,Qe,C)}else Be==="round"&&(R&&(this.addCurrentVertex(A,N,0,0,C),this.addCurrentVertex(A,N,1,1,C,!0)),B&&(this.addCurrentVertex(A,G,-1,-1,C,!0),this.addCurrentVertex(A,G,0,0,C)));if(Ve&&X<x-1){const Qe=A.dist(B);if(Qe>2*E){const We=A.add(B.sub(A)._mult(E/Qe)._round());this.updateDistance(A,We),this.addCurrentVertex(We,G,0,0,C),A=We}}}}addCurrentVertex(t,n,o,c,m,g=!1){const y=n.y*c-n.x,x=-n.y-n.x*c;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,g,!1,o,m),this.addHalfVertex(t,y,x,g,!0,-c,m),this.distance>w_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,o,c,m,g))}addHalfVertex({x:t,y:n},o,c,m,g,y,x){const k=.5*(this.lineClips?this.scaledDistance*(w_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(m?1:0),(n<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(y===0?0:y<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),x.primitiveLength++),g?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let b_,S_;qe("LineBucket",sf,{omit:["layers","patternFeatures"]});var T_={get paint(){return S_=S_||new f({"line-opacity":new ot(me.paint_line["line-opacity"]),"line-color":new ot(me.paint_line["line-color"]),"line-translate":new Ke(me.paint_line["line-translate"]),"line-translate-anchor":new Ke(me.paint_line["line-translate-anchor"]),"line-width":new ot(me.paint_line["line-width"]),"line-gap-width":new ot(me.paint_line["line-gap-width"]),"line-offset":new ot(me.paint_line["line-offset"]),"line-blur":new ot(me.paint_line["line-blur"]),"line-dasharray":new ll(me.paint_line["line-dasharray"]),"line-pattern":new ol(me.paint_line["line-pattern"]),"line-gradient":new $u(me.paint_line["line-gradient"])})},get layout(){return b_=b_||new f({"line-cap":new Ke(me.layout_line["line-cap"]),"line-join":new ot(me.layout_line["line-join"]),"line-miter-limit":new Ke(me.layout_line["line-miter-limit"]),"line-round-limit":new Ke(me.layout_line["line-round-limit"]),"line-sort-key":new ot(me.layout_line["line-sort-key"])})}};class X1 extends ot{possiblyEvaluate(t,n){return n=new rr(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,o,c){return n=Ge({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,o,c)}}let Uh;class K1 extends s{constructor(t){super(t,T_),this.gradientVersion=0,Uh||(Uh=new X1(T_.paint.properties["line-width"].specification),Uh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof Ws,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=Uh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new sf(t)}queryRadius(t){const n=t,o=k_(Gu("line-width",this,n),Gu("line-gap-width",this,n)),c=Gu("line-offset",this,n);return o/2+Math.abs(c)+Fh(this.paint.get("line-translate"))}queryIntersectsFeature(t,n,o,c,m,g,y){const x=Bh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,y),k=y/2*k_(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),E=this.paint.get("line-offset").evaluate(n,o);return E&&(c=function(C,A){const R=[];for(let B=0;B<C.length;B++){const N=C[B],G=[];for(let X=0;X<N.length;X++){const de=N[X-1],ie=N[X],ue=N[X+1],ge=X===0?new Q(0,0):ie.sub(de)._unit()._perp(),be=X===N.length-1?new Q(0,0):ue.sub(ie)._unit()._perp(),Ve=ge._add(be)._unit(),st=Ve.x*be.x+Ve.y*be.y;st!==0&&Ve._mult(1/st),G.push(Ve._mult(A)._add(ie))}R.push(G)}return R}(c,E*y)),function(C,A,R){for(let B=0;B<A.length;B++){const N=A[B];if(C.length>=3){for(let G=0;G<N.length;G++)if(ml(C,N[G]))return!0}if(s1(C,N,R))return!0}return!1}(x,c,k)}isTileClipped(){return!0}}function k_(r,t){return t>0?t+2*r:r}const J1=v([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Y1=v([{name:"a_projected_pos",components:3,type:"Float32"}],4);v([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Q1=v([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);v([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const I_=v([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ew=v([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function tw(r,t,n){return r.sections.forEach(o=>{o.text=function(c,m,g){const y=m.layout.get("text-transform").evaluate(g,{});return y==="uppercase"?c=c.toLocaleUpperCase():y==="lowercase"&&(c=c.toLocaleLowerCase()),Bi.applyArabicShaping&&(c=Bi.applyArabicShaping(c)),c}(o.text,t,n)}),r}v([{name:"triangle",components:3,type:"Uint16"}]),v([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),v([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),v([{type:"Float32",name:"offsetX"}]),v([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),v([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const ec={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var zr=24,E_=Ht,P_=function(r,t,n,o,c){var m,g,y=8*c-o-1,x=(1<<y)-1,k=x>>1,E=-7,C=c-1,A=-1,R=r[t+C];for(C+=A,m=R&(1<<-E)-1,R>>=-E,E+=y;E>0;m=256*m+r[t+C],C+=A,E-=8);for(g=m&(1<<-E)-1,m>>=-E,E+=o;E>0;g=256*g+r[t+C],C+=A,E-=8);if(m===0)m=1-k;else{if(m===x)return g?NaN:1/0*(R?-1:1);g+=Math.pow(2,o),m-=k}return(R?-1:1)*g*Math.pow(2,m-o)},C_=function(r,t,n,o,c,m){var g,y,x,k=8*m-c-1,E=(1<<k)-1,C=E>>1,A=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=0,B=1,N=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(y=isNaN(t)?1:0,g=E):(g=Math.floor(Math.log(t)/Math.LN2),t*(x=Math.pow(2,-g))<1&&(g--,x*=2),(t+=g+C>=1?A/x:A*Math.pow(2,1-C))*x>=2&&(g++,x/=2),g+C>=E?(y=0,g=E):g+C>=1?(y=(t*x-1)*Math.pow(2,c),g+=C):(y=t*Math.pow(2,C-1)*Math.pow(2,c),g=0));c>=8;r[n+R]=255&y,R+=B,y/=256,c-=8);for(g=g<<c|y,k+=c;k>0;r[n+R]=255&g,R+=B,g/=256,k-=8);r[n+R-B]|=128*N};function Ht(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Ht.Varint=0,Ht.Fixed64=1,Ht.Bytes=2,Ht.Fixed32=5;var af=4294967296,M_=1/af,z_=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function As(r){return r.type===Ht.Bytes?r.readVarint()+r.pos:r.pos+1}function vl(r,t,n){return n?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}function A_(r,t,n){var o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(o);for(var c=n.pos-1;c>=r;c--)n.buf[c+o]=n.buf[c]}function rw(r,t){for(var n=0;n<r.length;n++)t.writeVarint(r[n])}function iw(r,t){for(var n=0;n<r.length;n++)t.writeSVarint(r[n])}function nw(r,t){for(var n=0;n<r.length;n++)t.writeFloat(r[n])}function sw(r,t){for(var n=0;n<r.length;n++)t.writeDouble(r[n])}function aw(r,t){for(var n=0;n<r.length;n++)t.writeBoolean(r[n])}function ow(r,t){for(var n=0;n<r.length;n++)t.writeFixed32(r[n])}function lw(r,t){for(var n=0;n<r.length;n++)t.writeSFixed32(r[n])}function uw(r,t){for(var n=0;n<r.length;n++)t.writeFixed64(r[n])}function cw(r,t){for(var n=0;n<r.length;n++)t.writeSFixed64(r[n])}function $h(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+16777216*r[t+3]}function xl(r,t,n){r[n]=t,r[n+1]=t>>>8,r[n+2]=t>>>16,r[n+3]=t>>>24}function D_(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}Ht.prototype={destroy:function(){this.buf=null},readFields:function(r,t,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),c=o>>3,m=this.pos;this.type=7&o,r(c,t,this),this.pos===m&&this.skip(o)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=$h(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=D_(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=$h(this.buf,this.pos)+$h(this.buf,this.pos+4)*af;return this.pos+=8,r},readSFixed64:function(){var r=$h(this.buf,this.pos)+D_(this.buf,this.pos+4)*af;return this.pos+=8,r},readFloat:function(){var r=P_(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=P_(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t,n,o=this.buf;return t=127&(n=o[this.pos++]),n<128?t:(t|=(127&(n=o[this.pos++]))<<7,n<128?t:(t|=(127&(n=o[this.pos++]))<<14,n<128?t:(t|=(127&(n=o[this.pos++]))<<21,n<128?t:function(c,m,g){var y,x,k=g.buf;if(y=(112&(x=k[g.pos++]))>>4,x<128||(y|=(127&(x=k[g.pos++]))<<3,x<128)||(y|=(127&(x=k[g.pos++]))<<10,x<128)||(y|=(127&(x=k[g.pos++]))<<17,x<128)||(y|=(127&(x=k[g.pos++]))<<24,x<128)||(y|=(1&(x=k[g.pos++]))<<31,x<128))return vl(c,y,m);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=o[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=12&&z_?function(n,o,c){return z_.decode(n.subarray(o,c))}(this.buf,t,r):function(n,o,c){for(var m="",g=o;g<c;){var y,x,k,E=n[g],C=null,A=E>239?4:E>223?3:E>191?2:1;if(g+A>c)break;A===1?E<128&&(C=E):A===2?(192&(y=n[g+1]))==128&&(C=(31&E)<<6|63&y)<=127&&(C=null):A===3?(x=n[g+2],(192&(y=n[g+1]))==128&&(192&x)==128&&((C=(15&E)<<12|(63&y)<<6|63&x)<=2047||C>=55296&&C<=57343)&&(C=null)):A===4&&(x=n[g+2],k=n[g+3],(192&(y=n[g+1]))==128&&(192&x)==128&&(192&k)==128&&((C=(15&E)<<18|(63&y)<<12|(63&x)<<6|63&k)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,A=1):C>65535&&(C-=65536,m+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),m+=String.fromCharCode(C),g+=A}return m}(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==Ht.Bytes)return r.push(this.readVarint(t));var n=As(this);for(r=r||[];this.pos<n;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==Ht.Bytes)return r.push(this.readSVarint());var t=As(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Ht.Bytes)return r.push(this.readBoolean());var t=As(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Ht.Bytes)return r.push(this.readFloat());var t=As(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Ht.Bytes)return r.push(this.readDouble());var t=As(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Ht.Bytes)return r.push(this.readFixed32());var t=As(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Ht.Bytes)return r.push(this.readSFixed32());var t=As(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Ht.Bytes)return r.push(this.readFixed64());var t=As(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Ht.Bytes)return r.push(this.readSFixed64());var t=As(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=7&r;if(t===Ht.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ht.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ht.Fixed32)this.pos+=4;else{if(t!==Ht.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),xl(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),xl(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),xl(this.buf,-1&r,this.pos),xl(this.buf,Math.floor(r*M_),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),xl(this.buf,-1&r,this.pos),xl(this.buf,Math.floor(r*M_),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(t,n){var o,c;if(t>=0?(o=t%4294967296|0,c=t/4294967296|0):(c=~(-t/4294967296),4294967295^(o=~(-t%4294967296))?o=o+1|0:(o=0,c=c+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(m,g,y){y.buf[y.pos++]=127&m|128,m>>>=7,y.buf[y.pos++]=127&m|128,m>>>=7,y.buf[y.pos++]=127&m|128,m>>>=7,y.buf[y.pos++]=127&m|128,y.buf[y.pos]=127&(m>>>=7)}(o,0,n),function(m,g){var y=(7&m)<<4;g.buf[g.pos++]|=y|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))}(c,n)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var t=this.pos;this.pos=function(o,c,m){for(var g,y,x=0;x<c.length;x++){if((g=c.charCodeAt(x))>55295&&g<57344){if(!y){g>56319||x+1===c.length?(o[m++]=239,o[m++]=191,o[m++]=189):y=g;continue}if(g<56320){o[m++]=239,o[m++]=191,o[m++]=189,y=g;continue}g=y-55296<<10|g-56320|65536,y=null}else y&&(o[m++]=239,o[m++]=191,o[m++]=189,y=null);g<128?o[m++]=g:(g<2048?o[m++]=g>>6|192:(g<65536?o[m++]=g>>12|224:(o[m++]=g>>18|240,o[m++]=g>>12&63|128),o[m++]=g>>6&63|128),o[m++]=63&g|128)}return m}(this.buf,r,this.pos);var n=this.pos-t;n>=128&&A_(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(r){this.realloc(4),C_(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),C_(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=r[n]},writeRawMessage:function(r,t){this.pos++;var n=this.pos;r(t,this);var o=this.pos-n;o>=128&&A_(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(r,t,n){this.writeTag(r,Ht.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,rw,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,iw,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,aw,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,nw,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,sw,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,ow,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,lw,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,uw,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,cw,t)},writeBytesField:function(r,t){this.writeTag(r,Ht.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,Ht.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,Ht.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,Ht.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,Ht.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,Ht.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,Ht.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,Ht.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,Ht.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,Ht.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,!!t)}};var of=U(E_);const lf=3;function hw(r,t,n){r===1&&n.readMessage(dw,t)}function dw(r,t,n){if(r===3){const{id:o,bitmap:c,width:m,height:g,left:y,top:x,advance:k}=n.readMessage(pw,{});t.push({id:o,bitmap:new Wu({width:m+2*lf,height:g+2*lf},c),metrics:{width:m,height:g,left:y,top:x,advance:k}})}}function pw(r,t,n){r===1?t.id=n.readVarint():r===2?t.bitmap=n.readBytes():r===3?t.width=n.readVarint():r===4?t.height=n.readVarint():r===5?t.left=n.readSVarint():r===6?t.top=n.readSVarint():r===7&&(t.advance=n.readVarint())}const L_=lf;function R_(r){let t=0,n=0;for(const g of r)t+=g.w*g.h,n=Math.max(n,g.w);r.sort((g,y)=>y.h-g.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let c=0,m=0;for(const g of r)for(let y=o.length-1;y>=0;y--){const x=o[y];if(!(g.w>x.w||g.h>x.h)){if(g.x=x.x,g.y=x.y,m=Math.max(m,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===x.w&&g.h===x.h){const k=o.pop();y<o.length&&(o[y]=k)}else g.h===x.h?(x.x+=g.w,x.w-=g.w):g.w===x.w?(x.y+=g.h,x.h-=g.h):(o.push({x:x.x+g.w,y:x.y,w:x.w-g.w,h:g.h}),x.y+=g.h,x.h-=g.h);break}}return{w:c,h:m,fill:t/(c*m)||0}}const Ni=1;class uf{constructor(t,{pixelRatio:n,version:o,stretchX:c,stretchY:m,content:g,textFitWidth:y,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=c,this.stretchY=m,this.content=g,this.version=o,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+Ni,this.paddedRect.y+Ni]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ni,this.paddedRect.y+this.paddedRect.h-Ni]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ni)/this.pixelRatio,(this.paddedRect.h-2*Ni)/this.pixelRatio]}}class F_{constructor(t,n){const o={},c={};this.haveRenderCallbacks=[];const m=[];this.addImages(t,o,m),this.addImages(n,c,m);const{w:g,h:y}=R_(m),x=new fn({width:g||1,height:y||1});for(const k in t){const E=t[k],C=o[k].paddedRect;fn.copy(E.data,x,{x:0,y:0},{x:C.x+Ni,y:C.y+Ni},E.data)}for(const k in n){const E=n[k],C=c[k].paddedRect,A=C.x+Ni,R=C.y+Ni,B=E.data.width,N=E.data.height;fn.copy(E.data,x,{x:0,y:0},{x:A,y:R},E.data),fn.copy(E.data,x,{x:0,y:N-1},{x:A,y:R-1},{width:B,height:1}),fn.copy(E.data,x,{x:0,y:0},{x:A,y:R+N},{width:B,height:1}),fn.copy(E.data,x,{x:B-1,y:0},{x:A-1,y:R},{width:1,height:N}),fn.copy(E.data,x,{x:0,y:0},{x:A+B,y:R},{width:1,height:N})}this.image=x,this.iconPositions=o,this.patternPositions=c}addImages(t,n,o){for(const c in t){const m=t[c],g={x:0,y:0,w:m.data.width+2*Ni,h:m.data.height+2*Ni};o.push(g),n[c]=new uf(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[c,m]=t.tl;o.update(n.data,void 0,{x:c,y:m})}}var va;qe("ImagePosition",uf),qe("ImageAtlas",F_),S.ah=void 0,(va=S.ah||(S.ah={}))[va.none=0]="none",va[va.horizontal=1]="horizontal",va[va.vertical=2]="vertical",va[va.horizontalOnly=3]="horizontalOnly";const tc=-17;class rc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const o=new rc;return o.scale=t||1,o.fontStack=n,o}static forImage(t){const n=new rc;return n.imageName=t,n}}class wl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new wl;for(let c=0;c<t.sections.length;c++){const m=t.sections[c];m.image?o.addImageSection(m):o.addTextSection(m,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let o=0;o<t.length;o++){const c=t.charCodeAt(o+1)||null,m=t.charCodeAt(o-1)||null;n+=c&&Ch(c)&&!ec[t[o+1]]||m&&Ch(m)&&!ec[t[o-1]]||!ec[t[o]]?t[o]:ec[t[o]]}return n}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&qh[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&qh[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new wl;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(rc.forText(t.scale,t.fontStack||n));const o=this.sections.length-1;for(let c=0;c<t.text.length;++c)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void Qt("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(rc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Qt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zh(r,t,n,o,c,m,g,y,x,k,E,C,A,R,B){const N=wl.fromFeature(r,c);let G;C===S.ah.vertical&&N.verticalizePunctuation();const{processBidirectionalText:X,processStyledBidirectionalText:de}=Bi;if(X&&N.sections.length===1){G=[];const ge=X(N.toString(),cf(N,k,m,t,o,R));for(const be of ge){const Ve=new wl;Ve.text=be,Ve.sections=N.sections;for(let st=0;st<be.length;st++)Ve.sectionIndex.push(0);G.push(Ve)}}else if(de){G=[];const ge=de(N.text,N.sectionIndex,cf(N,k,m,t,o,R));for(const be of ge){const Ve=new wl;Ve.text=be[0],Ve.sectionIndex=be[1],Ve.sections=N.sections,G.push(Ve)}}else G=function(ge,be){const Ve=[],st=ge.text;let Ne=0;for(const Be of be)Ve.push(ge.substring(Ne,Be)),Ne=Be;return Ne<st.length&&Ve.push(ge.substring(Ne,st.length)),Ve}(N,cf(N,k,m,t,o,R));const ie=[],ue={positionedLines:ie,text:N.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:C,iconsInText:!1,verticalizable:!1};return function(ge,be,Ve,st,Ne,Be,Qe,We,Ze,ve,et,Ye){let pt=0,Xt=tc,Wt=0,Fr=0;const An=We==="right"?1:We==="left"?0:.5;let ei=0;for(const gr of Ne){gr.trim();const Or=gr.getMaxScale(),ci=(Or-1)*zr,ti={positionedGlyphs:[],lineOffset:0};ge.positionedLines[ei]=ti;const ki=ti.positionedGlyphs;let ri=0;if(!gr.length()){Xt+=Be,++ei;continue}for(let ji=0;ji<gr.length();ji++){const Bt=gr.getSection(ji),Jt=gr.getSectionIndex(ji),ar=gr.getCharCode(ji);let Qi=0,hr=null,kl=null,os=null,ls=zr;const Dn=!(Ze===S.ah.horizontal||!et&&!Vu(ar)||et&&(qh[ar]||(Br=ar,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Br)))));if(Bt.imageName){const _n=st[Bt.imageName];if(!_n)continue;os=Bt.imageName,ge.iconsInText=ge.iconsInText||!0,kl=_n.paddedRect;const $r=_n.displaySize;Bt.scale=Bt.scale*zr/Ye,hr={width:$r[0],height:$r[1],left:Ni,top:-L_,advance:Dn?$r[1]:$r[0]},Qi=ci+(zr-$r[1]*Bt.scale),ls=hr.advance;const Ds=Dn?$r[0]*Bt.scale-zr*Or:$r[1]*Bt.scale-zr*Or;Ds>0&&Ds>ri&&(ri=Ds)}else{const _n=Ve[Bt.fontStack],$r=_n&&_n[ar];if($r&&$r.rect)kl=$r.rect,hr=$r.metrics;else{const Ds=be[Bt.fontStack],lc=Ds&&Ds[ar];if(!lc)continue;hr=lc.metrics}Qi=(Or-Bt.scale)*zr}Dn?(ge.verticalizable=!0,ki.push({glyph:ar,imageName:os,x:pt,y:Xt+Qi,vertical:Dn,scale:Bt.scale,fontStack:Bt.fontStack,sectionIndex:Jt,metrics:hr,rect:kl}),pt+=ls*Bt.scale+ve):(ki.push({glyph:ar,imageName:os,x:pt,y:Xt+Qi,vertical:Dn,scale:Bt.scale,fontStack:Bt.fontStack,sectionIndex:Jt,metrics:hr,rect:kl}),pt+=hr.advance*Bt.scale+ve)}ki.length!==0&&(Wt=Math.max(pt-ve,Wt),_w(ki,0,ki.length-1,An,ri)),pt=0;const gn=Be*Or+ri;ti.lineOffset=Math.max(ri,ci),Xt+=gn,Fr=Math.max(gn,Fr),++ei}var Br;const bi=Xt-tc,{horizontalAlign:Si,verticalAlign:Ti}=hf(Qe);(function(gr,Or,ci,ti,ki,ri,gn,ji,Bt){const Jt=(Or-ci)*ki;let ar=0;ar=ri!==gn?-ji*ti-tc:(-ti*Bt+.5)*gn;for(const Qi of gr)for(const hr of Qi.positionedGlyphs)hr.x+=Jt,hr.y+=ar})(ge.positionedLines,An,Si,Ti,Wt,Fr,Be,bi,Ne.length),ge.top+=-Ti*bi,ge.bottom=ge.top+bi,ge.left+=-Si*Wt,ge.right=ge.left+Wt}(ue,t,n,o,G,g,y,x,C,k,A,B),!function(ge){for(const be of ge)if(be.positionedGlyphs.length!==0)return!1;return!0}(ie)&&ue}const qh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},fw={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},mw={40:!0};function B_(r,t,n,o,c,m){if(t.imageName){const g=o[t.imageName];return g?g.displaySize[0]*t.scale*zr/m+c:0}{const g=n[t.fontStack],y=g&&g[r];return y?y.metrics.advance*t.scale+c:0}}function O_(r,t,n,o){const c=Math.pow(r-t,2);return o?r<t?c/2:2*c:c+Math.abs(n)*n}function gw(r,t,n){let o=0;return r===10&&(o-=1e4),n&&(o+=150),r!==40&&r!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function N_(r,t,n,o,c,m){let g=null,y=O_(t,n,c,m);for(const x of o){const k=O_(t-x.x,n,c,m)+x.badness;k<=y&&(g=x,y=k)}return{index:r,x:t,priorBreak:g,badness:y}}function j_(r){return r?j_(r.priorBreak).concat(r.index):[]}function cf(r,t,n,o,c,m){if(!r)return[];const g=[],y=function(C,A,R,B,N,G){let X=0;for(let de=0;de<C.length();de++){const ie=C.getSection(de);X+=B_(C.getCharCode(de),ie,B,N,A,G)}return X/Math.max(1,Math.ceil(X/R))}(r,t,n,o,c,m),x=r.text.indexOf("")>=0;let k=0;for(let C=0;C<r.length();C++){const A=r.getSection(C),R=r.getCharCode(C);if(qh[R]||(k+=B_(R,A,o,c,t,m)),C<r.length()-1){const B=!((E=R)<11904)&&(!!Mt["CJK Compatibility Forms"](E)||!!Mt["CJK Compatibility"](E)||!!Mt["CJK Strokes"](E)||!!Mt["CJK Symbols and Punctuation"](E)||!!Mt["Enclosed CJK Letters and Months"](E)||!!Mt["Halfwidth and Fullwidth Forms"](E)||!!Mt["Ideographic Description Characters"](E)||!!Mt["Vertical Forms"](E)||Ph.test(String.fromCodePoint(E)));(fw[R]||B||A.imageName||C!==r.length()-2&&mw[r.getCharCode(C+1)])&&g.push(N_(C+1,k,y,g,gw(R,r.getCharCode(C+1),B&&x),!1))}}var E;return j_(N_(r.length(),k,y,g,0,!0))}function hf(r){let t=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function _w(r,t,n,o,c){if(!o&&!c)return;const m=r[n],g=(r[n].x+m.metrics.advance*m.scale)*o;for(let y=t;y<=n;y++)r[y].x-=g,r[y].y+=c}function yw(r,t,n){const{horizontalAlign:o,verticalAlign:c}=hf(n),m=t[0]-r.displaySize[0]*o,g=t[1]-r.displaySize[1]*c;return{image:r,top:g,bottom:g+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function V_(r){var t,n;let o=r.left,c=r.top,m=r.right-o,g=r.bottom-c;const y=(t=r.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(n=r.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",k=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&m/g<k||y==="proportional"){const E=Math.ceil(g*k);o*=E/m,m=E}}else if(y==="proportional"&&x==="stretchOnly"&&k!==0&&m/g>k){const E=Math.ceil(m/k);c*=E/g,g=E}return{x1:o,y1:c,x2:o+m,y2:c+g}}function U_(r,t,n,o,c,m){const g=r.image;let y;if(g.content){const G=g.content,X=g.pixelRatio||1;y=[G[0]/X,G[1]/X,g.displaySize[0]-G[2]/X,g.displaySize[1]-G[3]/X]}const x=t.left*m,k=t.right*m;let E,C,A,R;n==="width"||n==="both"?(R=c[0]+x-o[3],C=c[0]+k+o[1]):(R=c[0]+(x+k-g.displaySize[0])/2,C=R+g.displaySize[0]);const B=t.top*m,N=t.bottom*m;return n==="height"||n==="both"?(E=c[1]+B-o[0],A=c[1]+N+o[2]):(E=c[1]+(B+N-g.displaySize[1])/2,A=E+g.displaySize[1]),{image:g,top:E,right:C,bottom:A,left:R,collisionPadding:y}}const ic=255,as=128,xa=ic*as;function $_(r,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new rr(r+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:c}=n;let m=0;for(;m<o.length&&o[m]<=r;)m++;m=Math.max(0,m-1);let g=m;for(;g<o.length&&o[g]<r+1;)g++;g=Math.min(o.length-1,g);const y=o[m],x=o[g];return n.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:y,maxZoom:x,minSize:n.evaluate(new rr(y)),maxSize:n.evaluate(new rr(x)),interpolationType:c}}}function df(r,t,n){let o="never";const c=r.get(t);return c?o=c:r.get(n)&&(o="always"),o}const vw=ya.VectorTileFeature.types,xw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Gh(r,t,n,o,c,m,g,y,x,k,E,C,A){const R=y?Math.min(xa,Math.round(y[0])):0,B=y?Math.min(xa,Math.round(y[1])):0;r.emplaceBack(t,n,Math.round(32*o),Math.round(32*c),m,g,(R<<1)+(x?1:0),B,16*k,16*E,256*C,256*A)}function pf(r,t,n){r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n)}function ww(r){for(const t of r.sections)if(jp(t.text))return!0;return!1}class ff{constructor(t){this.layoutVertexArray=new cl,this.indexArray=new pn,this.programConfigurations=t,this.segments=new zt,this.dynamicLayoutVertexArray=new Zu,this.opacityVertexArray=new Ji,this.hasVisibleVertices=!1,this.placedSymbolArray=new ir}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,J1.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Y1.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,xw,!0),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}qe("SymbolBuffers",ff);class mf{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new zt,this.collisionVertexArray=new ns}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Q1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}qe("CollisionBuffers",mf);class bl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Hp([]),this.placementViewportMatrix=Hp([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=$_(this.zoom,n["text-size"]),this.iconSizeData=$_(this.zoom,n["icon-size"]);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),m=o.get("symbol-z-order");this.canOverlap=df(o,"text-overlap","text-allow-overlap")!=="never"||df(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(g=>S.ah[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID}createArrays(){this.text=new ff(new ho(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new ff(new ho(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new nr,this.lineVertexArray=new Kr,this.symbolInstances=new Pt,this.textAnchorOffsets=new sr}calculateGlyphDependencies(t,n,o,c,m){for(let g=0;g<t.length;g++)if(n[t.charCodeAt(g)]=!0,(o||c)&&m){const y=ec[t.charAt(g)];y&&(n[y.charCodeAt(0)]=!0)}}populate(t,n,o){const c=this.layers[0],m=c.layout,g=m.get("text-font"),y=m.get("text-field"),x=m.get("icon-image"),k=(y.value.kind!=="constant"||y.value.value instanceof Di&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),E=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,C=m.get("symbol-sort-key");if(this.features=[],!k&&!E)return;const A=n.iconDependencies,R=n.glyphDependencies,B=n.availableImages,N=new rr(this.zoom);for(const{feature:G,id:X,index:de,sourceLayerIndex:ie}of t){const ue=c._featureFilter.needGeometry,ge=fo(G,ue);if(!c._featureFilter.filter(N,ge,o))continue;let be,Ve;if(ue||(ge.geometry=po(G)),k){const Ne=c.getValueAndResolveTokens("text-field",ge,o,B),Be=Di.factory(Ne),Qe=this.hasRTLText=this.hasRTLText||ww(Be);(!Qe||Bi.getRTLTextPluginStatus()==="unavailable"||Qe&&Bi.isParsed())&&(be=tw(Be,c,ge))}if(E){const Ne=c.getValueAndResolveTokens("icon-image",ge,o,B);Ve=Ne instanceof Ri?Ne:Ri.fromString(Ne)}if(!be&&!Ve)continue;const st=this.sortFeaturesByKey?C.evaluate(ge,{},o):void 0;if(this.features.push({id:X,text:be,icon:Ve,index:de,sourceLayerIndex:ie,geometry:ge.geometry,properties:G.properties,type:vw[G.type],sortKey:st}),Ve&&(A[Ve.name]=!0),be){const Ne=g.evaluate(ge,{},o).join(","),Be=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(S.ah.vertical)>=0;for(const Qe of be.sections)if(Qe.image)A[Qe.image.name]=!0;else{const We=Nu(be.toString()),Ze=Qe.fontStack||Ne,ve=R[Ze]=R[Ze]||{};this.calculateGlyphDependencies(Qe.text,ve,Be,this.allowVerticalPlacement,We)}}}m.get("symbol-placement")==="line"&&(this.features=function(G){const X={},de={},ie=[];let ue=0;function ge(Ne){ie.push(G[Ne]),ue++}function be(Ne,Be,Qe){const We=de[Ne];return delete de[Ne],de[Be]=We,ie[We].geometry[0].pop(),ie[We].geometry[0]=ie[We].geometry[0].concat(Qe[0]),We}function Ve(Ne,Be,Qe){const We=X[Be];return delete X[Be],X[Ne]=We,ie[We].geometry[0].shift(),ie[We].geometry[0]=Qe[0].concat(ie[We].geometry[0]),We}function st(Ne,Be,Qe){const We=Qe?Be[0][Be[0].length-1]:Be[0][0];return`${Ne}:${We.x}:${We.y}`}for(let Ne=0;Ne<G.length;Ne++){const Be=G[Ne],Qe=Be.geometry,We=Be.text?Be.text.toString():null;if(!We){ge(Ne);continue}const Ze=st(We,Qe),ve=st(We,Qe,!0);if(Ze in de&&ve in X&&de[Ze]!==X[ve]){const et=Ve(Ze,ve,Qe),Ye=be(Ze,ve,ie[et].geometry);delete X[Ze],delete de[ve],de[st(We,ie[Ye].geometry,!0)]=Ye,ie[et].geometry=null}else Ze in de?be(Ze,ve,Qe):ve in X?Ve(Ze,ve,Qe):(ge(Ne),X[Ze]=ue-1,de[ve]=ue-1)}return ie.filter(Ne=>Ne.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((G,X)=>G.sortKey-X.sortKey)}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let c=t.dist(n[t.segment+1]),m=t.dist(n[t.segment]);const g={};for(let y=t.segment+1;y<n.length;y++)g[y]={x:n[y].x,y:n[y].y,tileUnitDistanceFromAnchor:c},y<n.length-1&&(c+=n[y+1].dist(n[y]));for(let y=t.segment||0;y>=0;y--)g[y]={x:n[y].x,y:n[y].y,tileUnitDistanceFromAnchor:m},y>0&&(m+=n[y-1].dist(n[y]));for(let y=0;y<n.length;y++){const x=g[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,c,m,g,y,x,k,E,C,A){const R=t.indexArray,B=t.layoutVertexArray,N=t.segments.prepareSegment(4*n.length,B,R,this.canOverlap?g.sortKey:void 0),G=this.glyphOffsetArray.length,X=N.vertexLength,de=this.allowVerticalPlacement&&y===S.ah.vertical?Math.PI/2:0,ie=g.text&&g.text.sections;for(let ue=0;ue<n.length;ue++){const{tl:ge,tr:be,bl:Ve,br:st,tex:Ne,pixelOffsetTL:Be,pixelOffsetBR:Qe,minFontScaleX:We,minFontScaleY:Ze,glyphOffset:ve,isSDF:et,sectionIndex:Ye}=n[ue],pt=N.vertexLength,Xt=ve[1];Gh(B,x.x,x.y,ge.x,Xt+ge.y,Ne.x,Ne.y,o,et,Be.x,Be.y,We,Ze),Gh(B,x.x,x.y,be.x,Xt+be.y,Ne.x+Ne.w,Ne.y,o,et,Qe.x,Be.y,We,Ze),Gh(B,x.x,x.y,Ve.x,Xt+Ve.y,Ne.x,Ne.y+Ne.h,o,et,Be.x,Qe.y,We,Ze),Gh(B,x.x,x.y,st.x,Xt+st.y,Ne.x+Ne.w,Ne.y+Ne.h,o,et,Qe.x,Qe.y,We,Ze),pf(t.dynamicLayoutVertexArray,x,de),R.emplaceBack(pt,pt+1,pt+2),R.emplaceBack(pt+1,pt+2,pt+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ve[0]),ue!==n.length-1&&Ye===n[ue+1].sectionIndex||t.programConfigurations.populatePaintArrays(B.length,g,g.index,{},A,ie&&ie[Ye])}t.placedSymbolArray.emplaceBack(x.x,x.y,G,this.glyphOffsetArray.length-G,X,k,E,x.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],y,0,!1,0,C)}_addCollisionDebugVertex(t,n,o,c,m,g){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,c,m,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(t,n,o,c,m,g,y){const x=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),k=x.vertexLength,E=m.layoutVertexArray,C=m.collisionVertexArray,A=y.anchorX,R=y.anchorY;this._addCollisionDebugVertex(E,C,g,A,R,new Q(t,n)),this._addCollisionDebugVertex(E,C,g,A,R,new Q(o,n)),this._addCollisionDebugVertex(E,C,g,A,R,new Q(o,c)),this._addCollisionDebugVertex(E,C,g,A,R,new Q(t,c)),x.vertexLength+=4;const B=m.indexArray;B.emplaceBack(k,k+1),B.emplaceBack(k+1,k+2),B.emplaceBack(k+2,k+3),B.emplaceBack(k+3,k),x.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,c){for(let m=t;m<n;m++){const g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,c?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new mf(Yi,I_.members,Ur),this.iconCollisionBox=new mf(Yi,I_.members,Ur);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,c,m,g,y,x,k){const E={};for(let C=n;C<o;C++){const A=t.get(C);E.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},E.textFeatureIndex=A.featureIndex;break}for(let C=c;C<m;C++){const A=t.get(C);E.verticalTextBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},E.verticalTextFeatureIndex=A.featureIndex;break}for(let C=g;C<y;C++){const A=t.get(C);E.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},E.iconFeatureIndex=A.featureIndex;break}for(let C=x;C<k;C++){const A=t.get(C);E.verticalIconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},E.verticalIconFeatureIndex=A.featureIndex;break}return E}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),c=o.vertexStartIndex+4*o.numGlyphs;for(let m=o.vertexStartIndex;m<c;m+=4)t.indexArray.emplaceBack(m,m+1,m+2),t.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),c=[],m=[],g=[];for(let y=0;y<this.symbolInstances.length;++y){g.push(y);const x=this.symbolInstances.get(y);c.push(0|Math.round(n*x.anchorX+o*x.anchorY)),m.push(x.featureIndex)}return g.sort((y,x)=>c[y]-c[x]||m[x]-m[y]),g}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((c,m,g)=>{c>=0&&g.indexOf(c)===m&&this.addIndicesForPlacedSymbol(this.text,c)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Z_,q_;qe("SymbolBucket",bl,{omit:["layers","collisionBoxArray","features","compareText"]}),bl.MAX_GLYPHS=65535,bl.addDynamicAttributes=pf;var gf={get paint(){return q_=q_||new f({"icon-opacity":new ot(me.paint_symbol["icon-opacity"]),"icon-color":new ot(me.paint_symbol["icon-color"]),"icon-halo-color":new ot(me.paint_symbol["icon-halo-color"]),"icon-halo-width":new ot(me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ot(me.paint_symbol["icon-halo-blur"]),"icon-translate":new Ke(me.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ke(me.paint_symbol["icon-translate-anchor"]),"text-opacity":new ot(me.paint_symbol["text-opacity"]),"text-color":new ot(me.paint_symbol["text-color"],{runtimeType:Lr,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new ot(me.paint_symbol["text-halo-color"]),"text-halo-width":new ot(me.paint_symbol["text-halo-width"]),"text-halo-blur":new ot(me.paint_symbol["text-halo-blur"]),"text-translate":new Ke(me.paint_symbol["text-translate"]),"text-translate-anchor":new Ke(me.paint_symbol["text-translate-anchor"])})},get layout(){return Z_=Z_||new f({"symbol-placement":new Ke(me.layout_symbol["symbol-placement"]),"symbol-spacing":new Ke(me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ke(me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ot(me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ke(me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ke(me.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ke(me.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ke(me.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ke(me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ke(me.layout_symbol["icon-rotation-alignment"]),"icon-size":new ot(me.layout_symbol["icon-size"]),"icon-text-fit":new Ke(me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ke(me.layout_symbol["icon-text-fit-padding"]),"icon-image":new ot(me.layout_symbol["icon-image"]),"icon-rotate":new ot(me.layout_symbol["icon-rotate"]),"icon-padding":new ot(me.layout_symbol["icon-padding"]),"icon-keep-upright":new Ke(me.layout_symbol["icon-keep-upright"]),"icon-offset":new ot(me.layout_symbol["icon-offset"]),"icon-anchor":new ot(me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ke(me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ke(me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ke(me.layout_symbol["text-rotation-alignment"]),"text-field":new ot(me.layout_symbol["text-field"]),"text-font":new ot(me.layout_symbol["text-font"]),"text-size":new ot(me.layout_symbol["text-size"]),"text-max-width":new ot(me.layout_symbol["text-max-width"]),"text-line-height":new Ke(me.layout_symbol["text-line-height"]),"text-letter-spacing":new ot(me.layout_symbol["text-letter-spacing"]),"text-justify":new ot(me.layout_symbol["text-justify"]),"text-radial-offset":new ot(me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ke(me.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ot(me.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ot(me.layout_symbol["text-anchor"]),"text-max-angle":new Ke(me.layout_symbol["text-max-angle"]),"text-writing-mode":new Ke(me.layout_symbol["text-writing-mode"]),"text-rotate":new ot(me.layout_symbol["text-rotate"]),"text-padding":new Ke(me.layout_symbol["text-padding"]),"text-keep-upright":new Ke(me.layout_symbol["text-keep-upright"]),"text-transform":new ot(me.layout_symbol["text-transform"]),"text-offset":new ot(me.layout_symbol["text-offset"]),"text-allow-overlap":new Ke(me.layout_symbol["text-allow-overlap"]),"text-overlap":new Ke(me.layout_symbol["text-overlap"]),"text-ignore-placement":new Ke(me.layout_symbol["text-ignore-placement"]),"text-optional":new Ke(me.layout_symbol["text-optional"])})}};class G_{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:gi,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qe("FormatSectionOverride",G_,{omit:["defaultValue"]});class Hh extends s{constructor(t){super(t,gf)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const m of o)c.indexOf(m)<0&&c.push(m);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,c){const m=this.layout.get(t).evaluate(n,{},o,c),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||Xo(g.value)||!m?m:function(y,x){return x.replace(/{([^{}]+)}/g,(k,E)=>y&&E in y?String(y[E]):"")}(n.properties,m)}createBucket(t){return new bl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of gf.paint.overridableProperties){if(!Hh.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new G_(n),c=new Wo(o,n.property.specification);let m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new ia("source",c):new na("composite",c,n.value.zoomStops),this.paint._values[t]=new Mn(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Hh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),c=gf.paint.properties[n];let m=!1;const g=y=>{for(const x of y)if(c.overrides&&c.overrides.hasOverride(x))return void(m=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Di)g(o.value.value.sections);else if(o.value.kind==="source"){const y=k=>{m||(k instanceof on&&Er(k.value)===ct?g(k.value.sections):k instanceof No?g(k.sections):k.eachChild(y))},x=o.value;x._styleExpression&&y(x._styleExpression.expression)}return m}}let H_;var bw={get paint(){return H_=H_||new f({"background-color":new Ke(me.paint_background["background-color"]),"background-pattern":new ll(me.paint_background["background-pattern"]),"background-opacity":new Ke(me.paint_background["background-opacity"])})}};class Sw extends s{constructor(t){super(t,bw)}}let W_;var Tw={get paint(){return W_=W_||new f({"raster-opacity":new Ke(me.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ke(me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ke(me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ke(me.paint_raster["raster-brightness-max"]),"raster-saturation":new Ke(me.paint_raster["raster-saturation"]),"raster-contrast":new Ke(me.paint_raster["raster-contrast"]),"raster-resampling":new Ke(me.paint_raster["raster-resampling"]),"raster-fade-duration":new Ke(me.paint_raster["raster-fade-duration"])})}};class kw extends s{constructor(t){super(t,Tw)}}class Iw extends s{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Ew{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const _f=63710088e-1;class wa{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new wa(Xe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,c=t.lat*n,m=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((t.lng-this.lng)*n);return _f*Math.acos(Math.min(m,1))}static convert(t){if(t instanceof wa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new wa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new wa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const X_=2*Math.PI*_f;function K_(r){return X_*Math.cos(r*Math.PI/180)}function J_(r){return(180+r)/360}function Y_(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Q_(r,t){return r/K_(t)}function yf(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class nc{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=wa.convert(t);return new nc(J_(o.lng),Y_(o.lat),Q_(n,o.lat))}toLngLat(){return new wa(360*this.x-180,yf(this.y))}toAltitude(){return this.z*K_(yf(this.y))}meterInMercatorCoordinateUnits(){return 1/X_*(t=yf(this.y),1/Math.cos(t*Math.PI/180));var t}}function ey(r,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[r*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class vf{constructor(t,n,o){if(!function(c,m,g){return!(c<0||c>25||g<0||g>=Math.pow(2,c)||m<0||m>=Math.pow(2,c))}(t,n,o))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=sc(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const c=(g=this.y,y=this.z,x=ey(256*(m=this.x),256*(g=Math.pow(2,y)-g-1),y),k=ey(256*(m+1),256*(g+1),y),x[0]+","+x[1]+","+k[0]+","+k[1]);var m,g,y,x,k;const E=function(C,A,R){let B,N="";for(let G=C;G>0;G--)B=1<<G-1,N+=(A&B?1:0)+(R&B?2:0);return N}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,c)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new Q((t.x*n-this.x)*Pr,(t.y*n-this.y)*Pr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ty{constructor(t,n){this.wrap=t,this.canonical=n,this.key=sc(t,n.z,n.z,n.x,n.y)}}class mn{constructor(t,n,o,c,m){if(t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new vf(o,+c,+m),this.key=sc(n,t,o,c,m)}clone(){return new mn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new mn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new mn(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?sc(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):sc(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new mn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new mn(n,this.wrap,n,o,c),new mn(n,this.wrap,n,o+1,c),new mn(n,this.wrap,n,o,c+1),new mn(n,this.wrap,n,o+1,c+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new mn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new mn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ty(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new nc(t.x-this.wrap,t.y))}}function sc(r,t,n,o,c){(r*=2)<0&&(r=-1*r-1);const m=1<<n;return(m*m*r+m*c+o).toString(36)+n.toString(36)+t.toString(36)}qe("CanonicalTileID",vf),qe("OverscaledTileID",mn,{omit:["posMatrix"]});class ry{constructor(t,n,o,c=1,m=1,g=1,y=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Qt(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const x=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=m,this.blueFactor=g,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<x;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(x,k)]=this.data[this._idx(x-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,x)]=this.data[this._idx(k,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<x;k++)for(let E=0;E<x;E++){const C=this.get(k,E);C>this.max&&(this.max=C),C<this.min&&(this.min=C)}}get(t,n){const o=new Uint8Array(this.data.buffer),c=4*this._idx(t,n);return this.unpack(o[c],o[c+1],o[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,o){return t*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new fn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,m=n*this.dim+this.dim,g=o*this.dim,y=o*this.dim+this.dim;switch(n){case-1:c=m-1;break;case 1:m=c+1}switch(o){case-1:g=y-1;break;case 1:y=g+1}const x=-n*this.dim,k=-o*this.dim;for(let E=g;E<y;E++)for(let C=c;C<m;C++)this.data[this._idx(C,E)]=t.data[this._idx(C+x,E+k)]}}qe("DEMData",ry);class iy{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class ny{constructor(t,n,o,c,m){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=c,this.properties=t.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class sy{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new oa(Pr,16,0),this.grid3D=new oa(Pr,16,0),this.featureIndexArray=new li,this.promoteId=n}insert(t,n,o,c,m,g){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,m);const x=g?this.grid3D:this.grid;for(let k=0;k<n.length;k++){const E=n[k],C=[1/0,1/0,-1/0,-1/0];for(let A=0;A<E.length;A++){const R=E[A];C[0]=Math.min(C[0],R.x),C[1]=Math.min(C[1],R.y),C[2]=Math.max(C[2],R.x),C[3]=Math.max(C[3],R.y)}C[0]<Pr&&C[1]<Pr&&C[2]>=0&&C[3]>=0&&x.insert(y,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ya.VectorTile(new of(this.rawTileData)).layers,this.sourceLayerCoder=new iy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,c){this.loadVTLayers();const m=t.params||{},g=Pr/t.tileSize/t.scale,y=Tu(m.filter),x=t.queryGeometry,k=t.queryPadding*g,E=oy(x),C=this.grid.query(E.minX-k,E.minY-k,E.maxX+k,E.maxY+k),A=oy(t.cameraQueryGeometry),R=this.grid3D.query(A.minX-k,A.minY-k,A.maxX+k,A.maxY+k,(G,X,de,ie)=>function(ue,ge,be,Ve,st){for(const Be of ue)if(ge<=Be.x&&be<=Be.y&&Ve>=Be.x&&st>=Be.y)return!0;const Ne=[new Q(ge,be),new Q(ge,st),new Q(Ve,st),new Q(Ve,be)];if(ue.length>2){for(const Be of Ne)if(ml(ue,Be))return!0}for(let Be=0;Be<ue.length-1;Be++)if(o1(ue[Be],ue[Be+1],Ne))return!0;return!1}(t.cameraQueryGeometry,G-k,X-k,de+k,ie+k));for(const G of R)C.push(G);C.sort(Pw);const B={};let N;for(let G=0;G<C.length;G++){const X=C[G];if(X===N)continue;N=X;const de=this.featureIndexArray.get(X);let ie=null;this.loadMatchingFeature(B,de.bucketIndex,de.sourceLayerIndex,de.featureIndex,y,m.layers,m.availableImages,n,o,c,(ue,ge,be)=>(ie||(ie=po(ue)),ge.queryIntersectsFeature(x,ue,be,ie,this.z,t.transform,g,t.pixelPosMatrix)))}return B}loadMatchingFeature(t,n,o,c,m,g,y,x,k,E,C){const A=this.bucketLayerIDs[n];if(g&&!function(G,X){for(let de=0;de<G.length;de++)if(X.indexOf(G[de])>=0)return!0;return!1}(g,A))return;const R=this.sourceLayerCoder.decode(o),B=this.vtLayers[R].feature(c);if(m.needGeometry){const G=fo(B,!0);if(!m.filter(new rr(this.tileID.overscaledZ),G,this.tileID.canonical))return}else if(!m.filter(new rr(this.tileID.overscaledZ),B))return;const N=this.getId(B,R);for(let G=0;G<A.length;G++){const X=A[G];if(g&&g.indexOf(X)<0)continue;const de=x[X];if(!de)continue;let ie={};N&&E&&(ie=E.getState(de.sourceLayer||"_geojsonTileLayer",N));const ue=Ge({},k[X]);ue.paint=ay(ue.paint,de.paint,B,ie,y),ue.layout=ay(ue.layout,de.layout,B,ie,y);const ge=!C||C(B,de,ie);if(!ge)continue;const be=new ny(B,this.z,this.x,this.y,N);be.layer=ue;let Ve=t[X];Ve===void 0&&(Ve=t[X]=[]),Ve.push({featureIndex:c,feature:be,intersectionZ:ge})}}lookupSymbolFeatures(t,n,o,c,m,g,y,x){const k={};this.loadVTLayers();const E=Tu(m);for(const C of t)this.loadMatchingFeature(k,o,c,C,E,g,y,x,n);return k}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){let o=t.id;return this.promoteId&&(o=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function ay(r,t,n,o,c){return Rt(r,(m,g)=>{const y=t instanceof lo?t.get(g):null;return y&&y.evaluate?y.evaluate(n,o,c):y})}function oy(r){let t=1/0,n=1/0,o=-1/0,c=-1/0;for(const m of r)t=Math.min(t,m.x),n=Math.min(n,m.y),o=Math.max(o,m.x),c=Math.max(c,m.y);return{minX:t,minY:n,maxX:o,maxY:c}}function Pw(r,t){return t-r}function ly(r,t,n,o,c){const m=[];for(let g=0;g<r.length;g++){const y=r[g];let x;for(let k=0;k<y.length-1;k++){let E=y[k],C=y[k+1];E.x<t&&C.x<t||(E.x<t?E=new Q(t,E.y+(t-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x<t&&(C=new Q(t,E.y+(t-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y<n&&C.y<n||(E.y<n?E=new Q(E.x+(n-E.y)/(C.y-E.y)*(C.x-E.x),n)._round():C.y<n&&(C=new Q(E.x+(n-E.y)/(C.y-E.y)*(C.x-E.x),n)._round()),E.x>=o&&C.x>=o||(E.x>=o?E=new Q(o,E.y+(o-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x>=o&&(C=new Q(o,E.y+(o-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y>=c&&C.y>=c||(E.y>=c?E=new Q(E.x+(c-E.y)/(C.y-E.y)*(C.x-E.x),c)._round():C.y>=c&&(C=new Q(E.x+(c-E.y)/(C.y-E.y)*(C.x-E.x),c)._round()),x&&E.equals(x[x.length-1])||(x=[E],m.push(x)),x.push(C)))))}}return m}qe("FeatureIndex",sy,{omit:["rawTileData","sourceLayerCoder"]});class ba extends Q{constructor(t,n,o,c){super(t,n),this.angle=o,c!==void 0&&(this.segment=c)}clone(){return new ba(this.x,this.y,this.angle,this.segment)}}function uy(r,t,n,o,c){if(t.segment===void 0||n===0)return!0;let m=t,g=t.segment+1,y=0;for(;y>-n/2;){if(g--,g<0)return!1;y-=r[g].dist(m),m=r[g]}y+=r[g].dist(r[g+1]),g++;const x=[];let k=0;for(;y<n/2;){const E=r[g],C=r[g+1];if(!C)return!1;let A=r[g-1].angleTo(E)-E.angleTo(C);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:A}),k+=A;y-x[0].distance>o;)k-=x.shift().angleDelta;if(k>c)return!1;g++,y+=E.dist(C)}return!0}function cy(r){let t=0;for(let n=0;n<r.length-1;n++)t+=r[n].dist(r[n+1]);return t}function hy(r,t,n){return r?.6*t*n:0}function dy(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function Cw(r,t,n,o,c,m){const g=hy(n,c,m),y=dy(n,o)*m;let x=0;const k=cy(r)/2;for(let E=0;E<r.length-1;E++){const C=r[E],A=r[E+1],R=C.dist(A);if(x+R>k){const B=(k-x)/R,N=yi.number(C.x,A.x,B),G=yi.number(C.y,A.y,B),X=new ba(N,G,A.angleTo(C),E);return X._round(),!g||uy(r,X,y,g,t)?X:void 0}x+=R}}function Mw(r,t,n,o,c,m,g,y,x){const k=hy(o,m,g),E=dy(o,c),C=E*g,A=r[0].x===0||r[0].x===x||r[0].y===0||r[0].y===x;return t-C<t/4&&(t=C+t/4),py(r,A?t/2*y%t:(E/2+2*m)*g*y%t,t,k,n,C,A,!1,x)}function py(r,t,n,o,c,m,g,y,x){const k=m/2,E=cy(r);let C=0,A=t-n,R=[];for(let B=0;B<r.length-1;B++){const N=r[B],G=r[B+1],X=N.dist(G),de=G.angleTo(N);for(;A+n<C+X;){A+=n;const ie=(A-C)/X,ue=yi.number(N.x,G.x,ie),ge=yi.number(N.y,G.y,ie);if(ue>=0&&ue<x&&ge>=0&&ge<x&&A-k>=0&&A+k<=E){const be=new ba(ue,ge,de,B);be._round(),o&&!uy(r,be,m,o,c)||R.push(be)}}C+=X}return y||R.length||g||(R=py(r,C/2,n,o,c,m,g,!0,x)),R}qe("Anchor",ba);const Sl=Ni;function fy(r,t,n,o){const c=[],m=r.image,g=m.pixelRatio,y=m.paddedRect.w-2*Sl,x=m.paddedRect.h-2*Sl;let k={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const E=m.stretchX||[[0,y]],C=m.stretchY||[[0,x]],A=(ve,et)=>ve+et[1]-et[0],R=E.reduce(A,0),B=C.reduce(A,0),N=y-R,G=x-B;let X=0,de=R,ie=0,ue=B,ge=0,be=N,Ve=0,st=G;if(m.content&&o){const ve=m.content,et=ve[2]-ve[0],Ye=ve[3]-ve[1];(m.textFitWidth||m.textFitHeight)&&(k=V_(r)),X=Wh(E,0,ve[0]),ie=Wh(C,0,ve[1]),de=Wh(E,ve[0],ve[2]),ue=Wh(C,ve[1],ve[3]),ge=ve[0]-X,Ve=ve[1]-ie,be=et-de,st=Ye-ue}const Ne=k.x1,Be=k.y1,Qe=k.x2-Ne,We=k.y2-Be,Ze=(ve,et,Ye,pt)=>{const Xt=Xh(ve.stretch-X,de,Qe,Ne),Wt=Kh(ve.fixed-ge,be,ve.stretch,R),Fr=Xh(et.stretch-ie,ue,We,Be),An=Kh(et.fixed-Ve,st,et.stretch,B),ei=Xh(Ye.stretch-X,de,Qe,Ne),Br=Kh(Ye.fixed-ge,be,Ye.stretch,R),bi=Xh(pt.stretch-ie,ue,We,Be),Si=Kh(pt.fixed-Ve,st,pt.stretch,B),Ti=new Q(Xt,Fr),gr=new Q(ei,Fr),Or=new Q(ei,bi),ci=new Q(Xt,bi),ti=new Q(Wt/g,An/g),ki=new Q(Br/g,Si/g),ri=t*Math.PI/180;if(ri){const Bt=Math.sin(ri),Jt=Math.cos(ri),ar=[Jt,-Bt,Bt,Jt];Ti._matMult(ar),gr._matMult(ar),ci._matMult(ar),Or._matMult(ar)}const gn=ve.stretch+ve.fixed,ji=et.stretch+et.fixed;return{tl:Ti,tr:gr,bl:ci,br:Or,tex:{x:m.paddedRect.x+Sl+gn,y:m.paddedRect.y+Sl+ji,w:Ye.stretch+Ye.fixed-gn,h:pt.stretch+pt.fixed-ji},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ti,pixelOffsetBR:ki,minFontScaleX:be/g/Qe,minFontScaleY:st/g/We,isSDF:n}};if(o&&(m.stretchX||m.stretchY)){const ve=my(E,N,R),et=my(C,G,B);for(let Ye=0;Ye<ve.length-1;Ye++){const pt=ve[Ye],Xt=ve[Ye+1];for(let Wt=0;Wt<et.length-1;Wt++)c.push(Ze(pt,et[Wt],Xt,et[Wt+1]))}}else c.push(Ze({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return c}function Wh(r,t,n){let o=0;for(const c of r)o+=Math.max(t,Math.min(n,c[1]))-Math.max(t,Math.min(n,c[0]));return o}function my(r,t,n){const o=[{fixed:-Sl,stretch:0}];for(const[c,m]of r){const g=o[o.length-1];o.push({fixed:c-g.stretch,stretch:g.stretch}),o.push({fixed:c-g.stretch,stretch:g.stretch+(m-c)})}return o.push({fixed:t+Sl,stretch:n}),o}function Xh(r,t,n,o){return r/t*n+o}function Kh(r,t,n,o){return r-t*n/o}class Jh{constructor(t,n,o,c,m,g,y,x,k,E){var C;if(this.boxStartIndex=t.length,k){let A=g.top,R=g.bottom;const B=g.collisionPadding;B&&(A-=B[1],R+=B[3]);let N=R-A;N>0&&(N=Math.max(10,N),this.circleDiameter=N)}else{const A=!((C=g.image)===null||C===void 0)&&C.content&&(g.image.textFitWidth||g.image.textFitHeight)?V_(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};A.y1=A.y1*y-x[0],A.y2=A.y2*y+x[2],A.x1=A.x1*y-x[3],A.x2=A.x2*y+x[1];const R=g.collisionPadding;if(R&&(A.x1-=R[0]*y,A.y1-=R[1]*y,A.x2+=R[2]*y,A.y2+=R[3]*y),E){const B=new Q(A.x1,A.y1),N=new Q(A.x2,A.y1),G=new Q(A.x1,A.y2),X=new Q(A.x2,A.y2),de=E*Math.PI/180;B._rotate(de),N._rotate(de),G._rotate(de),X._rotate(de),A.x1=Math.min(B.x,N.x,G.x,X.x),A.x2=Math.max(B.x,N.x,G.x,X.x),A.y1=Math.min(B.y,N.y,G.y,X.y),A.y2=Math.max(B.y,N.y,G.y,X.y)}t.emplaceBack(n.x,n.y,A.x1,A.y1,A.x2,A.y2,o,c,m)}this.boxEndIndex=t.length}}class zw{constructor(t=[],n=(o,c)=>o<c?-1:o>c?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,c=n[t];for(;t>0;){const m=t-1>>1,g=n[m];if(o(c,g)>=0)break;n[t]=g,t=m}n[t]=c}_down(t){const{data:n,compare:o}=this,c=this.length>>1,m=n[t];for(;t<c;){let g=1+(t<<1);const y=g+1;if(y<this.length&&o(n[y],n[g])<0&&(g=y),o(n[g],m)>=0)break;n[t]=n[g],t=g}n[t]=m}}function Aw(r,t=1,n=!1){let o=1/0,c=1/0,m=-1/0,g=-1/0;const y=r[0];for(let R=0;R<y.length;R++){const B=y[R];(!R||B.x<o)&&(o=B.x),(!R||B.y<c)&&(c=B.y),(!R||B.x>m)&&(m=B.x),(!R||B.y>g)&&(g=B.y)}const x=Math.min(m-o,g-c);let k=x/2;const E=new zw([],Dw);if(x===0)return new Q(o,c);for(let R=o;R<m;R+=x)for(let B=c;B<g;B+=x)E.push(new Tl(R+k,B+k,k,r));let C=function(R){let B=0,N=0,G=0;const X=R[0];for(let de=0,ie=X.length,ue=ie-1;de<ie;ue=de++){const ge=X[de],be=X[ue],Ve=ge.x*be.y-be.x*ge.y;N+=(ge.x+be.x)*Ve,G+=(ge.y+be.y)*Ve,B+=3*Ve}return new Tl(N/B,G/B,0,R)}(r),A=E.length;for(;E.length;){const R=E.pop();(R.d>C.d||!C.d)&&(C=R,n&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,A)),R.max-C.d<=t||(k=R.h/2,E.push(new Tl(R.p.x-k,R.p.y-k,k,r)),E.push(new Tl(R.p.x+k,R.p.y-k,k,r)),E.push(new Tl(R.p.x-k,R.p.y+k,k,r)),E.push(new Tl(R.p.x+k,R.p.y+k,k,r)),A+=4)}return n&&(console.log(`num probes: ${A}`),console.log(`best distance: ${C.d}`)),C.p}function Dw(r,t){return t.max-r.max}function Tl(r,t,n,o){this.p=new Q(r,t),this.h=n,this.d=function(c,m){let g=!1,y=1/0;for(let x=0;x<m.length;x++){const k=m[x];for(let E=0,C=k.length,A=C-1;E<C;A=E++){const R=k[E],B=k[A];R.y>c.y!=B.y>c.y&&c.x<(B.x-R.x)*(c.y-R.y)/(B.y-R.y)+R.x&&(g=!g),y=Math.min(y,Yg(c,R,B))}}return(g?1:-1)*Math.sqrt(y)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Qr;S.aq=void 0,(Qr=S.aq||(S.aq={}))[Qr.center=1]="center",Qr[Qr.left=2]="left",Qr[Qr.right=3]="right",Qr[Qr.top=4]="top",Qr[Qr.bottom=5]="bottom",Qr[Qr["top-left"]=6]="top-left",Qr[Qr["top-right"]=7]="top-right",Qr[Qr["bottom-left"]=8]="bottom-left",Qr[Qr["bottom-right"]=9]="bottom-right";const Sa=7,xf=Number.POSITIVE_INFINITY;function gy(r,t){return t[1]!==xf?function(n,o,c){let m=0,g=0;switch(o=Math.abs(o),c=Math.abs(c),n){case"top-right":case"top-left":case"top":g=c-Sa;break;case"bottom-right":case"bottom-left":case"bottom":g=-c+Sa}switch(n){case"top-right":case"bottom-right":case"right":m=-o;break;case"top-left":case"bottom-left":case"left":m=o}return[m,g]}(r,t[0],t[1]):function(n,o){let c=0,m=0;o<0&&(o=0);const g=o/Math.SQRT2;switch(n){case"top-right":case"top-left":m=g-Sa;break;case"bottom-right":case"bottom-left":m=-g+Sa;break;case"bottom":m=-o+Sa;break;case"top":m=o-Sa}switch(n){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=o;break;case"right":c=-o}return[c,m]}(r,t[0])}function _y(r,t,n){var o;const c=r.layout,m=(o=c.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},n);if(m){const y=m.values,x=[];for(let k=0;k<y.length;k+=2){const E=x[k]=y[k],C=y[k+1].map(A=>A*zr);E.startsWith("top")?C[1]-=Sa:E.startsWith("bottom")&&(C[1]+=Sa),x[k+1]=C}return new Gi(x)}const g=c.get("text-variable-anchor");if(g){let y;y=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(t,{},n)*zr,xf]:c.get("text-offset").evaluate(t,{},n).map(k=>k*zr);const x=[];for(const k of g)x.push(k,gy(k,y));return new Gi(x)}return null}function wf(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Lw(r,t,n,o,c,m,g,y,x,k,E){let C=m.textMaxSize.evaluate(t,{});C===void 0&&(C=g);const A=r.layers[0].layout,R=A.get("icon-offset").evaluate(t,{},E),B=vy(n.horizontal),N=g/24,G=r.tilePixelRatio*N,X=r.tilePixelRatio*C/24,de=r.tilePixelRatio*y,ie=r.tilePixelRatio*A.get("symbol-spacing"),ue=A.get("text-padding")*r.tilePixelRatio,ge=function(ve,et,Ye,pt=1){const Xt=ve.get("icon-padding").evaluate(et,{},Ye),Wt=Xt&&Xt.values;return[Wt[0]*pt,Wt[1]*pt,Wt[2]*pt,Wt[3]*pt]}(A,t,E,r.tilePixelRatio),be=A.get("text-max-angle")/180*Math.PI,Ve=A.get("text-rotation-alignment")!=="viewport"&&A.get("symbol-placement")!=="point",st=A.get("icon-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",Ne=A.get("symbol-placement"),Be=ie/2,Qe=A.get("icon-text-fit");let We;o&&Qe!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(We=U_(o,n.vertical,Qe,A.get("icon-text-fit-padding"),R,N)),B&&(o=U_(o,B,Qe,A.get("icon-text-fit-padding"),R,N)));const Ze=(ve,et)=>{et.x<0||et.x>=Pr||et.y<0||et.y>=Pr||function(Ye,pt,Xt,Wt,Fr,An,ei,Br,bi,Si,Ti,gr,Or,ci,ti,ki,ri,gn,ji,Bt,Jt,ar,Qi,hr,kl){const os=Ye.addToLineVertexArray(pt,Xt);let ls,Dn,_n,$r,Ds=0,lc=0,Sy=0,Ty=0,Cf=-1,Mf=-1;const Ls={};let ky=hl("");if(Ye.allowVerticalPlacement&&Wt.vertical){const hi=Br.layout.get("text-rotate").evaluate(Jt,{},hr)+90;_n=new Jh(bi,pt,Si,Ti,gr,Wt.vertical,Or,ci,ti,hi),ei&&($r=new Jh(bi,pt,Si,Ti,gr,ei,ri,gn,ti,hi))}if(Fr){const hi=Br.layout.get("icon-rotate").evaluate(Jt,{}),yn=Br.layout.get("icon-text-fit")!=="none",go=fy(Fr,hi,Qi,yn),Hn=ei?fy(ei,hi,Qi,yn):void 0;Dn=new Jh(bi,pt,Si,Ti,gr,Fr,ri,gn,!1,hi),Ds=4*go.length;const _o=Ye.iconSizeData;let us=null;_o.kind==="source"?(us=[as*Br.layout.get("icon-size").evaluate(Jt,{})],us[0]>xa&&Qt(`${Ye.layerIds[0]}: Value for "icon-size" is >= ${ic}. Reduce your "icon-size".`)):_o.kind==="composite"&&(us=[as*ar.compositeIconSizes[0].evaluate(Jt,{},hr),as*ar.compositeIconSizes[1].evaluate(Jt,{},hr)],(us[0]>xa||us[1]>xa)&&Qt(`${Ye.layerIds[0]}: Value for "icon-size" is >= ${ic}. Reduce your "icon-size".`)),Ye.addSymbols(Ye.icon,go,us,Bt,ji,Jt,S.ah.none,pt,os.lineStartIndex,os.lineLength,-1,hr),Cf=Ye.icon.placedSymbolArray.length-1,Hn&&(lc=4*Hn.length,Ye.addSymbols(Ye.icon,Hn,us,Bt,ji,Jt,S.ah.vertical,pt,os.lineStartIndex,os.lineLength,-1,hr),Mf=Ye.icon.placedSymbolArray.length-1)}const Iy=Object.keys(Wt.horizontal);for(const hi of Iy){const yn=Wt.horizontal[hi];if(!ls){ky=hl(yn.text);const Hn=Br.layout.get("text-rotate").evaluate(Jt,{},hr);ls=new Jh(bi,pt,Si,Ti,gr,yn,Or,ci,ti,Hn)}const go=yn.positionedLines.length===1;if(Sy+=yy(Ye,pt,yn,An,Br,ti,Jt,ki,os,Wt.vertical?S.ah.horizontal:S.ah.horizontalOnly,go?Iy:[hi],Ls,Cf,ar,hr),go)break}Wt.vertical&&(Ty+=yy(Ye,pt,Wt.vertical,An,Br,ti,Jt,ki,os,S.ah.vertical,["vertical"],Ls,Mf,ar,hr));const Bw=ls?ls.boxStartIndex:Ye.collisionBoxArray.length,Ow=ls?ls.boxEndIndex:Ye.collisionBoxArray.length,Nw=_n?_n.boxStartIndex:Ye.collisionBoxArray.length,jw=_n?_n.boxEndIndex:Ye.collisionBoxArray.length,Vw=Dn?Dn.boxStartIndex:Ye.collisionBoxArray.length,Uw=Dn?Dn.boxEndIndex:Ye.collisionBoxArray.length,$w=$r?$r.boxStartIndex:Ye.collisionBoxArray.length,Zw=$r?$r.boxEndIndex:Ye.collisionBoxArray.length;let Gn=-1;const Qh=(hi,yn)=>hi&&hi.circleDiameter?Math.max(hi.circleDiameter,yn):yn;Gn=Qh(ls,Gn),Gn=Qh(_n,Gn),Gn=Qh(Dn,Gn),Gn=Qh($r,Gn);const Ey=Gn>-1?1:0;Ey&&(Gn*=kl/zr),Ye.glyphOffsetArray.length>=bl.MAX_GLYPHS&&Qt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Jt.sortKey!==void 0&&Ye.addToSortKeyRanges(Ye.symbolInstances.length,Jt.sortKey);const qw=_y(Br,Jt,hr),[Gw,Hw]=function(hi,yn){const go=hi.length,Hn=yn==null?void 0:yn.values;if((Hn==null?void 0:Hn.length)>0)for(let _o=0;_o<Hn.length;_o+=2){const us=Hn[_o+1];hi.emplaceBack(S.aq[Hn[_o]],us[0],us[1])}return[go,hi.length]}(Ye.textAnchorOffsets,qw);Ye.symbolInstances.emplaceBack(pt.x,pt.y,Ls.right>=0?Ls.right:-1,Ls.center>=0?Ls.center:-1,Ls.left>=0?Ls.left:-1,Ls.vertical||-1,Cf,Mf,ky,Bw,Ow,Nw,jw,Vw,Uw,$w,Zw,Si,Sy,Ty,Ds,lc,Ey,0,Or,Gn,Gw,Hw)}(r,et,ve,n,o,c,We,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,G,[ue,ue,ue,ue],Ve,x,de,ge,st,R,t,m,k,E,g)};if(Ne==="line")for(const ve of ly(t.geometry,0,0,Pr,Pr)){const et=Mw(ve,ie,be,n.vertical||B,o,24,X,r.overscaling,Pr);for(const Ye of et)B&&Rw(r,B.text,Be,Ye)||Ze(ve,Ye)}else if(Ne==="line-center"){for(const ve of t.geometry)if(ve.length>1){const et=Cw(ve,be,n.vertical||B,o,24,X);et&&Ze(ve,et)}}else if(t.type==="Polygon")for(const ve of Vo(t.geometry,0)){const et=Aw(ve,16);Ze(ve[0],new ba(et.x,et.y,0))}else if(t.type==="LineString")for(const ve of t.geometry)Ze(ve,new ba(ve[0].x,ve[0].y,0));else if(t.type==="Point")for(const ve of t.geometry)for(const et of ve)Ze([et],new ba(et.x,et.y,0))}function yy(r,t,n,o,c,m,g,y,x,k,E,C,A,R,B){const N=function(de,ie,ue,ge,be,Ve,st,Ne){const Be=ge.layout.get("text-rotate").evaluate(Ve,{})*Math.PI/180,Qe=[];for(const We of ie.positionedLines)for(const Ze of We.positionedGlyphs){if(!Ze.rect)continue;const ve=Ze.rect||{};let et=L_+1,Ye=!0,pt=1,Xt=0;const Wt=(be||Ne)&&Ze.vertical,Fr=Ze.metrics.advance*Ze.scale/2;if(Ne&&ie.verticalizable&&(Xt=We.lineOffset/2-(Ze.imageName?-(zr-Ze.metrics.width*Ze.scale)/2:(Ze.scale-1)*zr)),Ze.imageName){const Bt=st[Ze.imageName];Ye=Bt.sdf,pt=Bt.pixelRatio,et=Ni/pt}const An=be?[Ze.x+Fr,Ze.y]:[0,0];let ei=be?[0,0]:[Ze.x+Fr+ue[0],Ze.y+ue[1]-Xt],Br=[0,0];Wt&&(Br=ei,ei=[0,0]);const bi=Ze.metrics.isDoubleResolution?2:1,Si=(Ze.metrics.left-et)*Ze.scale-Fr+ei[0],Ti=(-Ze.metrics.top-et)*Ze.scale+ei[1],gr=Si+ve.w/bi*Ze.scale/pt,Or=Ti+ve.h/bi*Ze.scale/pt,ci=new Q(Si,Ti),ti=new Q(gr,Ti),ki=new Q(Si,Or),ri=new Q(gr,Or);if(Wt){const Bt=new Q(-Fr,Fr-tc),Jt=-Math.PI/2,ar=zr/2-Fr,Qi=new Q(5-tc-ar,-(Ze.imageName?ar:0)),hr=new Q(...Br);ci._rotateAround(Jt,Bt)._add(Qi)._add(hr),ti._rotateAround(Jt,Bt)._add(Qi)._add(hr),ki._rotateAround(Jt,Bt)._add(Qi)._add(hr),ri._rotateAround(Jt,Bt)._add(Qi)._add(hr)}if(Be){const Bt=Math.sin(Be),Jt=Math.cos(Be),ar=[Jt,-Bt,Bt,Jt];ci._matMult(ar),ti._matMult(ar),ki._matMult(ar),ri._matMult(ar)}const gn=new Q(0,0),ji=new Q(0,0);Qe.push({tl:ci,tr:ti,bl:ki,br:ri,tex:ve,writingMode:ie.writingMode,glyphOffset:An,sectionIndex:Ze.sectionIndex,isSDF:Ye,pixelOffsetTL:gn,pixelOffsetBR:ji,minFontScaleX:0,minFontScaleY:0})}return Qe}(0,n,y,c,m,g,o,r.allowVerticalPlacement),G=r.textSizeData;let X=null;G.kind==="source"?(X=[as*c.layout.get("text-size").evaluate(g,{})],X[0]>xa&&Qt(`${r.layerIds[0]}: Value for "text-size" is >= ${ic}. Reduce your "text-size".`)):G.kind==="composite"&&(X=[as*R.compositeTextSizes[0].evaluate(g,{},B),as*R.compositeTextSizes[1].evaluate(g,{},B)],(X[0]>xa||X[1]>xa)&&Qt(`${r.layerIds[0]}: Value for "text-size" is >= ${ic}. Reduce your "text-size".`)),r.addSymbols(r.text,N,X,y,m,g,k,t,x.lineStartIndex,x.lineLength,A,B);for(const de of E)C[de]=r.text.placedSymbolArray.length-1;return 4*N.length}function vy(r){for(const t in r)return r[t];return null}function Rw(r,t,n,o){const c=r.compareText;if(t in c){const m=c[t];for(let g=m.length-1;g>=0;g--)if(o.dist(m[g])<n)return!0}else c[t]=[];return c[t].push(o),!1}const xy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class bf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const m=xy[15&o];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(t,2,1),[y]=new Uint32Array(t,4,1);return new bf(y,g,m,t)}constructor(t,n=64,o=Float64Array,c){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const m=xy.indexOf(this.ArrayType),g=2*t*this.ArrayType.BYTES_PER_ELEMENT,y=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+g+y+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=n,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Sf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:y}=this,x=[0,m.length-1,0],k=[];for(;x.length;){const E=x.pop()||0,C=x.pop()||0,A=x.pop()||0;if(C-A<=y){for(let G=A;G<=C;G++){const X=g[2*G],de=g[2*G+1];X>=t&&X<=o&&de>=n&&de<=c&&k.push(m[G])}continue}const R=A+C>>1,B=g[2*R],N=g[2*R+1];B>=t&&B<=o&&N>=n&&N<=c&&k.push(m[R]),(E===0?t<=B:n<=N)&&(x.push(A),x.push(R-1),x.push(1-E)),(E===0?o>=B:c>=N)&&(x.push(R+1),x.push(C),x.push(1-E))}return k}within(t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:m,nodeSize:g}=this,y=[0,c.length-1,0],x=[],k=o*o;for(;y.length;){const E=y.pop()||0,C=y.pop()||0,A=y.pop()||0;if(C-A<=g){for(let G=A;G<=C;G++)by(m[2*G],m[2*G+1],t,n)<=k&&x.push(c[G]);continue}const R=A+C>>1,B=m[2*R],N=m[2*R+1];by(B,N,t,n)<=k&&x.push(c[R]),(E===0?t-o<=B:n-o<=N)&&(y.push(A),y.push(R-1),y.push(1-E)),(E===0?t+o>=B:n+o>=N)&&(y.push(R+1),y.push(C),y.push(1-E))}return x}}function Sf(r,t,n,o,c,m){if(c-o<=n)return;const g=o+c>>1;wy(r,t,g,o,c,m),Sf(r,t,n,o,g-1,1-m),Sf(r,t,n,g+1,c,1-m)}function wy(r,t,n,o,c,m){for(;c>o;){if(c-o>600){const k=c-o+1,E=n-o+1,C=Math.log(k),A=.5*Math.exp(2*C/3),R=.5*Math.sqrt(C*A*(k-A)/k)*(E-k/2<0?-1:1);wy(r,t,n,Math.max(o,Math.floor(n-E*A/k+R)),Math.min(c,Math.floor(n+(k-E)*A/k+R)),m)}const g=t[2*n+m];let y=o,x=c;for(ac(r,t,o,n),t[2*c+m]>g&&ac(r,t,o,c);y<x;){for(ac(r,t,y,x),y++,x--;t[2*y+m]<g;)y++;for(;t[2*x+m]>g;)x--}t[2*o+m]===g?ac(r,t,o,x):(x++,ac(r,t,x,c)),x<=n&&(o=x+1),n<=x&&(c=x-1)}}function ac(r,t,n,o){Tf(r,n,o),Tf(t,2*n,2*o),Tf(t,2*n+1,2*o+1)}function Tf(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}function by(r,t,n,o){const c=r-n,m=t-o;return c*c+m*m}var kf;S.bg=void 0,(kf=S.bg||(S.bg={})).create="create",kf.load="load",kf.fullLoad="fullLoad";let Yh=null,oc=[];const If=1e3/60,Ef="loadTime",Pf="fullLoadTime",Fw={mark(r){performance.mark(r)},frame(r){const t=r;Yh!=null&&oc.push(t-Yh),Yh=t},clearMetrics(){Yh=null,oc=[],performance.clearMeasures(Ef),performance.clearMeasures(Pf);for(const r in S.bg)performance.clearMarks(S.bg[r])},getPerformanceMetrics(){performance.measure(Ef,S.bg.create,S.bg.load),performance.measure(Pf,S.bg.create,S.bg.fullLoad);const r=performance.getEntriesByName(Ef)[0].duration,t=performance.getEntriesByName(Pf)[0].duration,n=oc.length,o=1/(oc.reduce((m,g)=>m+g,0)/n/1e3),c=oc.filter(m=>m>If).reduce((m,g)=>m+(g-If)/If,0);return{loadTime:r,fullLoadTime:t,fps:o,percentDroppedFrames:c/(n+c)*100,totalFrames:n}}};S.$=class extends M{},S.A=gl,S.B=Rp,S.C=function(r){if(zi==null){const t=r.navigator?r.navigator.userAgent:null;zi=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return zi},S.D=Ke,S.E=ts,S.F=class{constructor(r,t){this.target=r,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Ew(()=>this.process()),this.subscription=function(n,o,c,m){return n.addEventListener(o,c,!1),{unsubscribe:()=>{n.removeEventListener(o,c,!1)}}}(this.target,"message",n=>this.receive(n)),this.globalScope=Tr(self)?r:window}registerMessageHandler(r,t){this.messageHandlers[r]=t}sendAsync(r,t){return new Promise((n,o)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[c]={resolve:n,reject:o},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[c];const y={id:c,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(y)},{once:!0});const m=[],g=Object.assign(Object.assign({},r),{id:c,sourceMapId:this.mapId,origin:location.origin,data:la(r.data,m)});this.target.postMessage(g,{transfer:m})})}receive(r){const t=r.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(Tr(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),t=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(r,t)}processTask(r,t){return d(this,void 0,void 0,function*(){if(t.type==="<response>"){const c=this.resolveRejects[r];return delete this.resolveRejects[r],c?void(t.error?c.reject(ua(t.error)):c.resolve(ua(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=ua(t.data),o=new AbortController;this.abortControllers[r]=o;try{const c=yield this.messageHandlers[t.type](t.sourceMapId,n,o);this.completeTask(r,null,c)}catch(c){this.completeTask(r,c)}})}completeTask(r,t,n){const o=[];delete this.abortControllers[r];const c={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?la(t):null,data:la(n,o)};this.target.postMessage(c,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},S.G=Gr,S.H=function(){var r=new gl(16);return gl!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},S.I=uf,S.J=function(r,t,n){var o,c,m,g,y,x,k,E,C,A,R,B,N=n[0],G=n[1],X=n[2];return t===r?(r[12]=t[0]*N+t[4]*G+t[8]*X+t[12],r[13]=t[1]*N+t[5]*G+t[9]*X+t[13],r[14]=t[2]*N+t[6]*G+t[10]*X+t[14],r[15]=t[3]*N+t[7]*G+t[11]*X+t[15]):(c=t[1],m=t[2],g=t[3],y=t[4],x=t[5],k=t[6],E=t[7],C=t[8],A=t[9],R=t[10],B=t[11],r[0]=o=t[0],r[1]=c,r[2]=m,r[3]=g,r[4]=y,r[5]=x,r[6]=k,r[7]=E,r[8]=C,r[9]=A,r[10]=R,r[11]=B,r[12]=o*N+y*G+C*X+t[12],r[13]=c*N+x*G+A*X+t[13],r[14]=m*N+k*G+R*X+t[14],r[15]=g*N+E*G+B*X+t[15]),r},S.K=function(r,t,n){var o=n[0],c=n[1],m=n[2];return r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o,r[3]=t[3]*o,r[4]=t[4]*c,r[5]=t[5]*c,r[6]=t[6]*c,r[7]=t[7]*c,r[8]=t[8]*m,r[9]=t[9]*m,r[10]=t[10]*m,r[11]=t[11]*m,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},S.L=r_,S.M=function(r,t){const n={};for(let o=0;o<t.length;o++){const c=t[o];c in r&&(n[c]=r[c])}return n},S.N=wa,S.O=J_,S.P=Q,S.Q=Y_,S.R=fn,S.S=mn,S.T=al,S.U=oe,S.V=ee,S.W=ht,S.X=Pr,S.Y=v,S.Z=nc,S._=d,S.a=er,S.a$=function(r,t){var n=r[0],o=r[1],c=r[2],m=r[3],g=r[4],y=r[5],x=r[6],k=r[7],E=r[8],C=r[9],A=r[10],R=r[11],B=r[12],N=r[13],G=r[14],X=r[15],de=t[0],ie=t[1],ue=t[2],ge=t[3],be=t[4],Ve=t[5],st=t[6],Ne=t[7],Be=t[8],Qe=t[9],We=t[10],Ze=t[11],ve=t[12],et=t[13],Ye=t[14],pt=t[15];return Math.abs(n-de)<=wi*Math.max(1,Math.abs(n),Math.abs(de))&&Math.abs(o-ie)<=wi*Math.max(1,Math.abs(o),Math.abs(ie))&&Math.abs(c-ue)<=wi*Math.max(1,Math.abs(c),Math.abs(ue))&&Math.abs(m-ge)<=wi*Math.max(1,Math.abs(m),Math.abs(ge))&&Math.abs(g-be)<=wi*Math.max(1,Math.abs(g),Math.abs(be))&&Math.abs(y-Ve)<=wi*Math.max(1,Math.abs(y),Math.abs(Ve))&&Math.abs(x-st)<=wi*Math.max(1,Math.abs(x),Math.abs(st))&&Math.abs(k-Ne)<=wi*Math.max(1,Math.abs(k),Math.abs(Ne))&&Math.abs(E-Be)<=wi*Math.max(1,Math.abs(E),Math.abs(Be))&&Math.abs(C-Qe)<=wi*Math.max(1,Math.abs(C),Math.abs(Qe))&&Math.abs(A-We)<=wi*Math.max(1,Math.abs(A),Math.abs(We))&&Math.abs(R-Ze)<=wi*Math.max(1,Math.abs(R),Math.abs(Ze))&&Math.abs(B-ve)<=wi*Math.max(1,Math.abs(B),Math.abs(ve))&&Math.abs(N-et)<=wi*Math.max(1,Math.abs(N),Math.abs(et))&&Math.abs(G-Ye)<=wi*Math.max(1,Math.abs(G),Math.abs(Ye))&&Math.abs(X-pt)<=wi*Math.max(1,Math.abs(X),Math.abs(pt))},S.a0=zt,S.a1=vf,S.a2=ke,S.a3=r=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(n=>{t.onloadstart=()=>{n(t)};for(const o of r){const c=window.document.createElement("source");qi(o)||(t.crossOrigin="Anonymous"),c.src=o,t.appendChild(c)}})},S.a4=function(){return it++},S.a5=je,S.a6=bl,S.a7=Tu,S.a8=fo,S.a9=ny,S.aA=function(r){if(r.type==="custom")return new Iw(r);switch(r.type){case"background":return new Sw(r);case"circle":return new c1(r);case"fill":return new E1(r);case"fill-extrusion":return new U1(r);case"heatmap":return new d1(r);case"hillshade":return new f1(r);case"line":return new K1(r);case"raster":return new kw(r);case"symbol":return new Hh(r)}},S.aB=wt,S.aC=function(r,t){if(!r)return[{command:"setStyle",args:[t]}];let n=[];try{if(!Ct(r.version,t.version))return[{command:"setStyle",args:[t]}];Ct(r.center,t.center)||n.push({command:"setCenter",args:[t.center]}),Ct(r.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),Ct(r.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),Ct(r.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),Ct(r.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),Ct(r.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),Ct(r.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),Ct(r.light,t.light)||n.push({command:"setLight",args:[t.light]}),Ct(r.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),Ct(r.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),Ct(r.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const o={},c=[];(function(g,y,x,k){let E;for(E in y=y||{},g=g||{})Object.prototype.hasOwnProperty.call(g,E)&&(Object.prototype.hasOwnProperty.call(y,E)||Ai(E,x,k));for(E in y)Object.prototype.hasOwnProperty.call(y,E)&&(Object.prototype.hasOwnProperty.call(g,E)?Ct(g[E],y[E])||(g[E].type==="geojson"&&y[E].type==="geojson"&&Un(g,y,E)?tr(x,{command:"setGeoJSONSourceData",args:[E,y[E].data]}):Wr(E,y,x,k)):En(E,y,x))})(r.sources,t.sources,c,o);const m=[];r.layers&&r.layers.forEach(g=>{"source"in g&&o[g.source]?n.push({command:"removeLayer",args:[g.id]}):m.push(g)}),n=n.concat(c),function(g,y,x){y=y||[];const k=(g=g||[]).map(gs),E=y.map(gs),C=g.reduce(_s,{}),A=y.reduce(_s,{}),R=k.slice(),B=Object.create(null);let N,G,X,de,ie;for(let ue=0,ge=0;ue<k.length;ue++)N=k[ue],Object.prototype.hasOwnProperty.call(A,N)?ge++:(tr(x,{command:"removeLayer",args:[N]}),R.splice(R.indexOf(N,ge),1));for(let ue=0,ge=0;ue<E.length;ue++)N=E[E.length-1-ue],R[R.length-1-ue]!==N&&(Object.prototype.hasOwnProperty.call(C,N)?(tr(x,{command:"removeLayer",args:[N]}),R.splice(R.lastIndexOf(N,R.length-ge),1)):ge++,de=R[R.length-ue],tr(x,{command:"addLayer",args:[A[N],de]}),R.splice(R.length-ue,0,N),B[N]=!0);for(let ue=0;ue<E.length;ue++)if(N=E[ue],G=C[N],X=A[N],!B[N]&&!Ct(G,X))if(Ct(G.source,X.source)&&Ct(G["source-layer"],X["source-layer"])&&Ct(G.type,X.type)){for(ie in Mr(G.layout,X.layout,x,N,null,"setLayoutProperty"),Mr(G.paint,X.paint,x,N,null,"setPaintProperty"),Ct(G.filter,X.filter)||tr(x,{command:"setFilter",args:[N,X.filter]}),Ct(G.minzoom,X.minzoom)&&Ct(G.maxzoom,X.maxzoom)||tr(x,{command:"setLayerZoomRange",args:[N,X.minzoom,X.maxzoom]}),G)Object.prototype.hasOwnProperty.call(G,ie)&&ie!=="layout"&&ie!=="paint"&&ie!=="filter"&&ie!=="metadata"&&ie!=="minzoom"&&ie!=="maxzoom"&&(ie.indexOf("paint.")===0?Mr(G[ie],X[ie],x,N,ie.slice(6),"setPaintProperty"):Ct(G[ie],X[ie])||tr(x,{command:"setLayerProperty",args:[N,ie,X[ie]]}));for(ie in X)Object.prototype.hasOwnProperty.call(X,ie)&&!Object.prototype.hasOwnProperty.call(G,ie)&&ie!=="layout"&&ie!=="paint"&&ie!=="filter"&&ie!=="metadata"&&ie!=="minzoom"&&ie!=="maxzoom"&&(ie.indexOf("paint.")===0?Mr(G[ie],X[ie],x,N,ie.slice(6),"setPaintProperty"):Ct(G[ie],X[ie])||tr(x,{command:"setLayerProperty",args:[N,ie,X[ie]]}))}else tr(x,{command:"removeLayer",args:[N]}),de=R[R.lastIndexOf(N)+1],tr(x,{command:"addLayer",args:[X,de]})}(m,t.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[t]}]}return n},S.aD=function(r){const t=[],n=r.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},S.aE=function r(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(!r(t[o],n[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const o in t)if(!r(t[o],n[o]))return!1;return!0}return t===n},S.aF=Rt,S.aG=vt,S.aH=class extends co{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},S.aI=Lh,S.aJ=class extends co{constructor(r,t){super(r,t),this.current=r1}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},S.aK=qg,S.aL=Gg,S.aM=qt,S.aN=class extends co{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},S.aO=class extends co{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},S.aP=function(r,t,n,o,c,m,g){var y=1/(t-n),x=1/(o-c),k=1/(m-g);return r[0]=-2*y,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*k,r[11]=0,r[12]=(t+n)*y,r[13]=(c+o)*x,r[14]=(g+m)*k,r[15]=1,r},S.aQ=u1,S.aR=class extends ae{},S.aS=ew,S.aT=class extends pe{},S.aU=Kp,S.aV=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},S.aW=o_,S.aX=Jr,S.aY=pn,S.aZ=class extends Je{},S.a_=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},S.aa=function(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,c,m)=>{const g=c||m;return t[o]=!g||g.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},S.ab=function(r,t){const n=[];for(const o in r)o in t||n.push(o);return n},S.ac=Ue,S.ad=function(r,t,n){var o=Math.sin(n),c=Math.cos(n),m=t[0],g=t[1],y=t[2],x=t[3],k=t[4],E=t[5],C=t[6],A=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=m*c+k*o,r[1]=g*c+E*o,r[2]=y*c+C*o,r[3]=x*c+A*o,r[4]=k*c-m*o,r[5]=E*c-g*o,r[6]=C*c-y*o,r[7]=A*c-x*o,r},S.ae=function(r){var t=new gl(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},S.af=Oh,S.ag=function(r,t){let n=0,o=0;if(r.kind==="constant")o=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:c,minZoom:m,maxZoom:g}=r,y=c?Ue(vi.interpolationFactor(c,t,m,g),0,1):0;r.kind==="camera"?o=yi.number(r.minSize,r.maxSize,y):n=y}return{uSizeT:n,uSize:o}},S.ai=function(r,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:c}){return r.kind==="source"?o/as:r.kind==="composite"?yi.number(o/as,c/as,n):t},S.aj=pf,S.ak=function(r,t,n,o){const c=t.y-r.y,m=t.x-r.x,g=o.y-n.y,y=o.x-n.x,x=g*m-y*c;if(x===0)return null;const k=(y*(r.y-n.y)-g*(r.x-n.x))/x;return new Q(r.x+k*m,r.y+k*c)},S.al=ly,S.am=Kg,S.an=Hp,S.ao=function(r){let t=1/0,n=1/0,o=-1/0,c=-1/0;for(const m of r)t=Math.min(t,m.x),n=Math.min(n,m.y),o=Math.max(o,m.x),c=Math.max(c,m.y);return[t,n,o,c]},S.ap=zr,S.ar=df,S.as=function(r,t){var n=t[0],o=t[1],c=t[2],m=t[3],g=t[4],y=t[5],x=t[6],k=t[7],E=t[8],C=t[9],A=t[10],R=t[11],B=t[12],N=t[13],G=t[14],X=t[15],de=n*y-o*g,ie=n*x-c*g,ue=n*k-m*g,ge=o*x-c*y,be=o*k-m*y,Ve=c*k-m*x,st=E*N-C*B,Ne=E*G-A*B,Be=E*X-R*B,Qe=C*G-A*N,We=C*X-R*N,Ze=A*X-R*G,ve=de*Ze-ie*We+ue*Qe+ge*Be-be*Ne+Ve*st;return ve?(r[0]=(y*Ze-x*We+k*Qe)*(ve=1/ve),r[1]=(c*We-o*Ze-m*Qe)*ve,r[2]=(N*Ve-G*be+X*ge)*ve,r[3]=(A*be-C*Ve-R*ge)*ve,r[4]=(x*Be-g*Ze-k*Ne)*ve,r[5]=(n*Ze-c*Be+m*Ne)*ve,r[6]=(G*ue-B*Ve-X*ie)*ve,r[7]=(E*Ve-A*ue+R*ie)*ve,r[8]=(g*We-y*Be+k*st)*ve,r[9]=(o*Be-n*We-m*st)*ve,r[10]=(B*be-N*ue+X*de)*ve,r[11]=(C*ue-E*be-R*de)*ve,r[12]=(y*Ne-g*Qe-x*st)*ve,r[13]=(n*Qe-o*Ne+c*st)*ve,r[14]=(N*ie-B*ge-G*de)*ve,r[15]=(E*ge-C*ie+A*de)*ve,r):null},S.at=wf,S.au=hf,S.av=bf,S.aw=function(){const r={},t=me.$version;for(const n in me.$root){const o=me.$root[n];if(o.required){let c=null;c=n==="version"?t:o.type==="array"?[]:{},c!=null&&(r[n]=c)}}return r},S.ax=Ou,S.ay=mi,S.az=function(r){r=r.slice();const t=Object.create(null);for(let n=0;n<r.length;n++)t[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=Vn(r[n],t[r[n].ref]));return r},S.b=jr,S.b0=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},S.b1=function(r,t,n){return r[0]=t[0]*n[0],r[1]=t[1]*n[1],r[2]=t[2]*n[2],r[3]=t[3]*n[3],r},S.b2=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]},S.b3=Xe,S.b4=ty,S.b5=Q_,S.b6=function(r,t,n,o,c){var m,g=1/Math.tan(t/2);return r[0]=g/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,c!=null&&c!==1/0?(r[10]=(c+o)*(m=1/(o-c)),r[14]=2*c*o*m):(r[10]=-1,r[14]=-2*o),r},S.b7=function(r,t,n){var o=Math.sin(n),c=Math.cos(n),m=t[4],g=t[5],y=t[6],x=t[7],k=t[8],E=t[9],C=t[10],A=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=m*c+k*o,r[5]=g*c+E*o,r[6]=y*c+C*o,r[7]=x*c+A*o,r[8]=k*c-m*o,r[9]=E*c-g*o,r[10]=C*c-y*o,r[11]=A*c-x*o,r},S.b8=he,S.b9=Se,S.bA=E_,S.bB=function(r){return r.message===Nt},S.bC=ra,S.bD=Bi,S.ba=function(r){return r*Math.PI/180},S.bb=function(r,t){const{x:n,y:o}=nc.fromLngLat(t);return!(r<0||r>25||o<0||o>=1||n<0||n>=1)},S.bc=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},S.bd=class extends P{},S.be=_f,S.bf=Fw,S.bh=ur,S.bi=function(r,t){er.REGISTERED_PROTOCOLS[r]=t},S.bj=function(r){delete er.REGISTERED_PROTOCOLS[r]},S.bk=function(r,t){const n={};for(let c=0;c<r.length;c++){const m=t&&t[r[c].id]||bh(r[c]);t&&(t[r[c].id]=m);let g=n[m];g||(g=n[m]=[]),g.push(r[c])}const o=[];for(const c in n)o.push(n[c]);return o},S.bl=qe,S.bm=iy,S.bn=sy,S.bo=F_,S.bp=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=Pr/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const t=r.bucket.layers[0],n=t.layout,o=t._unevaluatedLayout._values,c={layoutIconSize:o["icon-size"].possiblyEvaluate(new rr(r.bucket.zoom+1),r.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new rr(r.bucket.zoom+1),r.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new rr(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:E}=r.bucket.textSizeData;c.compositeTextSizes=[o["text-size"].possiblyEvaluate(new rr(k),r.canonical),o["text-size"].possiblyEvaluate(new rr(E),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:E}=r.bucket.iconSizeData;c.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new rr(k),r.canonical),o["icon-size"].possiblyEvaluate(new rr(E),r.canonical)]}const m=n.get("text-line-height")*zr,g=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",y=n.get("text-keep-upright"),x=n.get("text-size");for(const k of r.bucket.features){const E=n.get("text-font").evaluate(k,{},r.canonical).join(","),C=x.evaluate(k,{},r.canonical),A=c.layoutTextSize.evaluate(k,{},r.canonical),R=c.layoutIconSize.evaluate(k,{},r.canonical),B={horizontal:{},vertical:void 0},N=k.text;let G,X=[0,0];if(N){const ue=N.toString(),ge=n.get("text-letter-spacing").evaluate(k,{},r.canonical)*zr,be=Fp(ue)?ge:0,Ve=n.get("text-anchor").evaluate(k,{},r.canonical),st=_y(t,k,r.canonical);if(!st){const We=n.get("text-radial-offset").evaluate(k,{},r.canonical);X=We?gy(Ve,[We*zr,xf]):n.get("text-offset").evaluate(k,{},r.canonical).map(Ze=>Ze*zr)}let Ne=g?"center":n.get("text-justify").evaluate(k,{},r.canonical);const Be=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(k,{},r.canonical)*zr:1/0,Qe=()=>{r.bucket.allowVerticalPlacement&&Nu(ue)&&(B.vertical=Zh(N,r.glyphMap,r.glyphPositions,r.imagePositions,E,Be,m,Ve,"left",be,X,S.ah.vertical,!0,A,C))};if(!g&&st){const We=new Set;if(Ne==="auto")for(let ve=0;ve<st.values.length;ve+=2)We.add(wf(st.values[ve]));else We.add(Ne);let Ze=!1;for(const ve of We)if(!B.horizontal[ve])if(Ze)B.horizontal[ve]=B.horizontal[0];else{const et=Zh(N,r.glyphMap,r.glyphPositions,r.imagePositions,E,Be,m,"center",ve,be,X,S.ah.horizontal,!1,A,C);et&&(B.horizontal[ve]=et,Ze=et.positionedLines.length===1)}Qe()}else{Ne==="auto"&&(Ne=wf(Ve));const We=Zh(N,r.glyphMap,r.glyphPositions,r.imagePositions,E,Be,m,Ve,Ne,be,X,S.ah.horizontal,!1,A,C);We&&(B.horizontal[Ne]=We),Qe(),Nu(ue)&&g&&y&&(B.vertical=Zh(N,r.glyphMap,r.glyphPositions,r.imagePositions,E,Be,m,Ve,Ne,be,X,S.ah.vertical,!1,A,C))}}let de=!1;if(k.icon&&k.icon.name){const ue=r.imageMap[k.icon.name];ue&&(G=yw(r.imagePositions[k.icon.name],n.get("icon-offset").evaluate(k,{},r.canonical),n.get("icon-anchor").evaluate(k,{},r.canonical)),de=!!ue.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=de:r.bucket.sdfIcons!==de&&Qt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ue.pixelRatio!==r.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const ie=vy(B.horizontal)||B.vertical;r.bucket.iconsInText=!!ie&&ie.iconsInText,(ie||G)&&Lw(r.bucket,k,B,G,r.imageMap,c,A,R,X,de,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},S.bq=sf,S.br=tf,S.bs=nf,S.bt=ya,S.bu=of,S.bv=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},S.bw=function(r,t,n,o,c){return d(this,void 0,void 0,function*(){if(ee())try{return yield ht(r,t,n,o,c)}catch{}return function(m,g,y,x,k){const E=m.width,C=m.height;ut&&It||(ut=new OffscreenCanvas(E,C),It=ut.getContext("2d",{willReadFrequently:!0})),ut.width=E,ut.height=C,It.drawImage(m,0,0,E,C);const A=It.getImageData(g,y,x,k);return It.clearRect(0,0,E,C),A.data}(r,t,n,o,c)})},S.bx=ry,S.by=U,S.bz=ne,S.c=si,S.d=r=>d(void 0,void 0,void 0,function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),S.e=Ge,S.f=r=>new Promise((t,n)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=He})},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(r)],{type:"image/png"});o.src=r.byteLength?URL.createObjectURL(c):He}),S.g=Dr,S.h=(r,t)=>at(Ge(r,{type:"json"}),t),S.i=Tr,S.j=In,S.k=ai,S.l=(r,t)=>at(Ge(r,{type:"arrayBuffer"}),t),S.m=at,S.n=function(r){return new of(r).readFields(hw,[])},S.o=Wu,S.p=R_,S.q=f,S.r=Lp,S.s=qi,S.t=Fu,S.u=Cs,S.v=me,S.w=Qt,S.x=function([r,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(n),y:r*Math.sin(t)*Math.sin(n),z:r*Math.cos(n)}},S.y=yi,S.z=rr}),b("worker",["./shared"],function(S){class d{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,L){for(const Z of D){this._layerConfigs[Z.id]=Z;const te=this._layers[Z.id]=S.aA(Z);te._featureFilter=S.a7(te.filter),this.keyCache[Z.id]&&delete this.keyCache[Z.id]}for(const Z of L)delete this.keyCache[Z],delete this._layerConfigs[Z],delete this._layers[Z];this.familiesBySource={};const O=S.bk(Object.values(this._layerConfigs),this.keyCache);for(const Z of O){const te=Z.map(fe=>this._layers[fe.id]),se=te[0];if(se.visibility==="none")continue;const ce=se.source||"";let Y=this.familiesBySource[ce];Y||(Y=this.familiesBySource[ce]={});const _e=se.sourceLayer||"_geojsonTileLayer";let we=Y[_e];we||(we=Y[_e]=[]),we.push(te)}}}class U{constructor(D){const L={},O=[];for(const ce in D){const Y=D[ce],_e=L[ce]={};for(const we in Y){const fe=Y[+we];if(!fe||fe.bitmap.width===0||fe.bitmap.height===0)continue;const ze={x:0,y:0,w:fe.bitmap.width+2,h:fe.bitmap.height+2};O.push(ze),_e[we]={rect:ze,metrics:fe.metrics}}}const{w:Z,h:te}=S.p(O),se=new S.o({width:Z||1,height:te||1});for(const ce in D){const Y=D[ce];for(const _e in Y){const we=Y[+_e];if(!we||we.bitmap.width===0||we.bitmap.height===0)continue;const fe=L[ce][_e].rect;S.o.copy(we.bitmap,se,{x:0,y:0},{x:fe.x+1,y:fe.y+1},we.bitmap)}}this.image=se,this.positions=L}}S.bl("GlyphAtlas",U);class ne{constructor(D){this.tileID=new S.S(D.tileID.overscaledZ,D.tileID.wrap,D.tileID.canonical.z,D.tileID.canonical.x,D.tileID.canonical.y),this.uid=D.uid,this.zoom=D.zoom,this.pixelRatio=D.pixelRatio,this.tileSize=D.tileSize,this.source=D.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=D.showCollisionBoxes,this.collectResourceTiming=!!D.collectResourceTiming,this.returnDependencies=!!D.returnDependencies,this.promoteId=D.promoteId,this.inFlightDependencies=[]}parse(D,L,O,Z){return S._(this,void 0,void 0,function*(){this.status="parsing",this.data=D,this.collisionBoxArray=new S.a5;const te=new S.bm(Object.keys(D.layers).sort()),se=new S.bn(this.tileID,this.promoteId);se.bucketLayerIDs=[];const ce={},Y={featureIndex:se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:O},_e=L.familiesBySource[this.source];for(const St in _e){const Zt=D.layers[St];if(!Zt)continue;Zt.version===1&&S.w(`Vector tile source "${this.source}" layer "${St}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const or=te.encode(St),Rr=[];for(let Vr=0;Vr<Zt.length;Vr++){const oi=Zt.feature(Vr),qs=se.getId(oi,St);Rr.push({feature:oi,id:qs,index:Vr,sourceLayerIndex:or})}for(const Vr of _e[St]){const oi=Vr[0];oi.source!==this.source&&S.w(`layer.source = ${oi.source} does not equal this.source = ${this.source}`),oi.minzoom&&this.zoom<Math.floor(oi.minzoom)||oi.maxzoom&&this.zoom>=oi.maxzoom||oi.visibility!=="none"&&(ye(Vr,this.zoom,O),(ce[oi.id]=oi.createBucket({index:se.bucketLayerIDs.length,layers:Vr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:or,sourceID:this.source})).populate(Rr,Y,this.tileID.canonical),se.bucketLayerIDs.push(Vr.map(qs=>qs.id)))}}const we=S.aF(Y.glyphDependencies,St=>Object.keys(St).map(Number));this.inFlightDependencies.forEach(St=>St==null?void 0:St.abort()),this.inFlightDependencies=[];let fe=Promise.resolve({});if(Object.keys(we).length){const St=new AbortController;this.inFlightDependencies.push(St),fe=Z.sendAsync({type:"GG",data:{stacks:we,source:this.source,tileID:this.tileID,type:"glyphs"}},St)}const ze=Object.keys(Y.iconDependencies);let tt=Promise.resolve({});if(ze.length){const St=new AbortController;this.inFlightDependencies.push(St),tt=Z.sendAsync({type:"GI",data:{icons:ze,source:this.source,tileID:this.tileID,type:"icons"}},St)}const nt=Object.keys(Y.patternDependencies);let At=Promise.resolve({});if(nt.length){const St=new AbortController;this.inFlightDependencies.push(St),At=Z.sendAsync({type:"GI",data:{icons:nt,source:this.source,tileID:this.tileID,type:"patterns"}},St)}const[gt,Dt,Et]=yield Promise.all([fe,tt,At]),Ir=new U(gt),cr=new S.bo(Dt,Et);for(const St in ce){const Zt=ce[St];Zt instanceof S.a6?(ye(Zt.layers,this.zoom,O),S.bp({bucket:Zt,glyphMap:gt,glyphPositions:Ir.positions,imageMap:Dt,imagePositions:cr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Zt.hasPattern&&(Zt instanceof S.bq||Zt instanceof S.br||Zt instanceof S.bs)&&(ye(Zt.layers,this.zoom,O),Zt.addFeatures(Y,this.tileID.canonical,cr.patternPositions))}return this.status="done",{buckets:Object.values(ce).filter(St=>!St.isEmpty()),featureIndex:se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ir.image,imageAtlas:cr,glyphMap:this.returnDependencies?gt:null,iconMap:this.returnDependencies?Dt:null,glyphPositions:this.returnDependencies?Ir.positions:null}})}}function ye($,D,L){const O=new S.z(D);for(const Z of $)Z.recalculate(O,L)}class Q{constructor(D,L,O){this.actor=D,this.layerIndex=L,this.availableImages=O,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(D,L){return S._(this,void 0,void 0,function*(){const O=yield S.l(D.request,L);try{return{vectorTile:new S.bt.VectorTile(new S.bu(O.data)),rawData:O.data,cacheControl:O.cacheControl,expires:O.expires}}catch(Z){const te=new Uint8Array(O.data);let se=`Unable to parse the tile at ${D.request.url}, `;throw se+=te[0]===31&&te[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Z.message}`,new Error(se)}})}loadTile(D){return S._(this,void 0,void 0,function*(){const L=D.uid,O=!!(D&&D.request&&D.request.collectResourceTiming)&&new S.bv(D.request),Z=new ne(D);this.loading[L]=Z;const te=new AbortController;Z.abort=te;try{const se=yield this.loadVectorTile(D,te);if(delete this.loading[L],!se)return null;const ce=se.rawData,Y={};se.expires&&(Y.expires=se.expires),se.cacheControl&&(Y.cacheControl=se.cacheControl);const _e={};if(O){const fe=O.finish();fe&&(_e.resourceTiming=JSON.parse(JSON.stringify(fe)))}Z.vectorTile=se.vectorTile;const we=Z.parse(se.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[L]=Z,this.fetching[L]={rawTileData:ce,cacheControl:Y,resourceTiming:_e};try{const fe=yield we;return S.e({rawTileData:ce.slice(0)},fe,Y,_e)}finally{delete this.fetching[L]}}catch(se){throw delete this.loading[L],Z.status="done",this.loaded[L]=Z,se}})}reloadTile(D){return S._(this,void 0,void 0,function*(){const L=D.uid;if(!this.loaded||!this.loaded[L])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const O=this.loaded[L];if(O.showCollisionBoxes=D.showCollisionBoxes,O.status==="parsing"){const Z=yield O.parse(O.vectorTile,this.layerIndex,this.availableImages,this.actor);let te;if(this.fetching[L]){const{rawTileData:se,cacheControl:ce,resourceTiming:Y}=this.fetching[L];delete this.fetching[L],te=S.e({rawTileData:se.slice(0)},Z,ce,Y)}else te=Z;return te}if(O.status==="done"&&O.vectorTile)return O.parse(O.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(D){return S._(this,void 0,void 0,function*(){const L=this.loading,O=D.uid;L&&L[O]&&L[O].abort&&(L[O].abort.abort(),delete L[O])})}removeTile(D){return S._(this,void 0,void 0,function*(){this.loaded&&this.loaded[D.uid]&&delete this.loaded[D.uid]})}}class W{constructor(){this.loaded={}}loadTile(D){return S._(this,void 0,void 0,function*(){const{uid:L,encoding:O,rawImageData:Z,redFactor:te,greenFactor:se,blueFactor:ce,baseShift:Y}=D,_e=Z.width+2,we=Z.height+2,fe=S.b(Z)?new S.R({width:_e,height:we},yield S.bw(Z,-1,-1,_e,we)):Z,ze=new S.bx(L,fe,O,te,se,ce,Y);return this.loaded=this.loaded||{},this.loaded[L]=ze,ze})}removeTile(D){const L=this.loaded,O=D.uid;L&&L[O]&&delete L[O]}}function De($,D){if($.length!==0){Me($[0],D);for(var L=1;L<$.length;L++)Me($[L],!D)}}function Me($,D){for(var L=0,O=0,Z=0,te=$.length,se=te-1;Z<te;se=Z++){var ce=($[Z][0]-$[se][0])*($[se][1]+$[Z][1]),Y=L+ce;O+=Math.abs(L)>=Math.abs(ce)?L-Y+ce:ce-Y+L,L=Y}L+O>=0!=!!D&&$.reverse()}var Pe=S.by(function $(D,L){var O,Z=D&&D.type;if(Z==="FeatureCollection")for(O=0;O<D.features.length;O++)$(D.features[O],L);else if(Z==="GeometryCollection")for(O=0;O<D.geometries.length;O++)$(D.geometries[O],L);else if(Z==="Feature")$(D.geometry,L);else if(Z==="Polygon")De(D.coordinates,L);else if(Z==="MultiPolygon")for(O=0;O<D.coordinates.length;O++)De(D.coordinates[O],L);return D});const _t=S.bt.VectorTileFeature.prototype.toGeoJSON;var oe={exports:{}},ee=S.bz,he=S.bt.VectorTileFeature,Se=Ue;function Ue($,D){this.options=D||{},this.features=$,this.length=$.length}function Xe($,D){this.id=typeof $.id=="number"?$.id:void 0,this.type=$.type,this.rawGeometry=$.type===1?[$.geometry]:$.geometry,this.properties=$.tags,this.extent=D||4096}Ue.prototype.feature=function($){return new Xe(this.features[$],this.options.extent)},Xe.prototype.loadGeometry=function(){var $=this.rawGeometry;this.geometry=[];for(var D=0;D<$.length;D++){for(var L=$[D],O=[],Z=0;Z<L.length;Z++)O.push(new ee(L[Z][0],L[Z][1]));this.geometry.push(O)}return this.geometry},Xe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $=this.geometry,D=1/0,L=-1/0,O=1/0,Z=-1/0,te=0;te<$.length;te++)for(var se=$[te],ce=0;ce<se.length;ce++){var Y=se[ce];D=Math.min(D,Y.x),L=Math.max(L,Y.x),O=Math.min(O,Y.y),Z=Math.max(Z,Y.y)}return[D,O,L,Z]},Xe.prototype.toGeoJSON=he.prototype.toGeoJSON;var Ge=S.bA,it=Se;function Rt($){var D=new Ge;return function(L,O){for(var Z in L.layers)O.writeMessage(3,vt,L.layers[Z])}($,D),D.finish()}function vt($,D){var L;D.writeVarintField(15,$.version||1),D.writeStringField(1,$.name||""),D.writeVarintField(5,$.extent||4096);var O={keys:[],values:[],keycache:{},valuecache:{}};for(L=0;L<$.length;L++)O.feature=$.feature(L),D.writeMessage(2,wt,O);var Z=O.keys;for(L=0;L<Z.length;L++)D.writeStringField(3,Z[L]);var te=O.values;for(L=0;L<te.length;L++)D.writeMessage(4,zi,te[L])}function wt($,D){var L=$.feature;L.id!==void 0&&D.writeVarintField(1,L.id),D.writeMessage(2,Mi,$),D.writeVarintField(3,L.type),D.writeMessage(4,Tr,L)}function Mi($,D){var L=$.feature,O=$.keys,Z=$.values,te=$.keycache,se=$.valuecache;for(var ce in L.properties){var Y=L.properties[ce],_e=te[ce];if(Y!==null){_e===void 0&&(O.push(ce),te[ce]=_e=O.length-1),D.writeVarint(_e);var we=typeof Y;we!=="string"&&we!=="boolean"&&we!=="number"&&(Y=JSON.stringify(Y));var fe=we+":"+Y,ze=se[fe];ze===void 0&&(Z.push(Y),se[fe]=ze=Z.length-1),D.writeVarint(ze)}}}function Qt($,D){return(D<<3)+(7&$)}function Ot($){return $<<1^$>>31}function Tr($,D){for(var L=$.loadGeometry(),O=$.type,Z=0,te=0,se=L.length,ce=0;ce<se;ce++){var Y=L[ce],_e=1;O===1&&(_e=Y.length),D.writeVarint(Qt(1,_e));for(var we=O===3?Y.length-1:Y.length,fe=0;fe<we;fe++){fe===1&&O!==1&&D.writeVarint(Qt(2,we-1));var ze=Y[fe].x-Z,tt=Y[fe].y-te;D.writeVarint(Ot(ze)),D.writeVarint(Ot(tt)),Z+=ze,te+=tt}O===3&&D.writeVarint(Qt(7,1))}}function zi($,D){var L=typeof $;L==="string"?D.writeStringField(1,$):L==="boolean"?D.writeBooleanField(7,$):L==="number"&&($%1!=0?D.writeDoubleField(3,$):$<0?D.writeSVarintField(6,$):D.writeVarintField(5,$))}oe.exports=Rt,oe.exports.fromVectorTileJs=Rt,oe.exports.fromGeojsonVt=function($,D){D=D||{};var L={};for(var O in $)L[O]=new it($[O].features,D),L[O].name=O,L[O].version=D.version,L[O].extent=D.extent;return Rt({layers:L})},oe.exports.GeoJSONWrapper=it;var jr=S.by(oe.exports);const He={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:$=>$},ht=Math.fround||(ut=new Float32Array(1),$=>(ut[0]=+$,ut[0]));var ut;const It=3,Nt=5,si=6;class er{constructor(D){this.options=Object.assign(Object.create(He),D),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(D){const{log:L,minZoom:O,maxZoom:Z}=this.options;L&&console.time("total time");const te=`prepare ${D.length} points`;L&&console.time(te),this.points=D;const se=[];for(let Y=0;Y<D.length;Y++){const _e=D[Y];if(!_e.geometry)continue;const[we,fe]=_e.geometry.coordinates,ze=ht(ur(we)),tt=ht(mi(fe));se.push(ze,tt,1/0,Y,-1,1),this.options.reduce&&se.push(0)}let ce=this.trees[Z+1]=this._createTree(se);L&&console.timeEnd(te);for(let Y=Z;Y>=O;Y--){const _e=+Date.now();ce=this.trees[Y]=this._createTree(this._cluster(ce,Y)),L&&console.log("z%d: %d clusters in %dms",Y,ce.numItems,+Date.now()-_e)}return L&&console.timeEnd("total time"),this}getClusters(D,L){let O=((D[0]+180)%360+360)%360-180;const Z=Math.max(-90,Math.min(90,D[1]));let te=D[2]===180?180:((D[2]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)O=-180,te=180;else if(O>te){const fe=this.getClusters([O,Z,180,se],L),ze=this.getClusters([-180,Z,te,se],L);return fe.concat(ze)}const ce=this.trees[this._limitZoom(L)],Y=ce.range(ur(O),mi(se),ur(te),mi(Z)),_e=ce.data,we=[];for(const fe of Y){const ze=this.stride*fe;we.push(_e[ze+Nt]>1?Dr(_e,ze,this.clusterProps):this.points[_e[ze+It]])}return we}getChildren(D){const L=this._getOriginId(D),O=this._getOriginZoom(D),Z="No cluster with the specified id.",te=this.trees[O];if(!te)throw new Error(Z);const se=te.data;if(L*this.stride>=se.length)throw new Error(Z);const ce=this.options.radius/(this.options.extent*Math.pow(2,O-1)),Y=te.within(se[L*this.stride],se[L*this.stride+1],ce),_e=[];for(const we of Y){const fe=we*this.stride;se[fe+4]===D&&_e.push(se[fe+Nt]>1?Dr(se,fe,this.clusterProps):this.points[se[fe+It]])}if(_e.length===0)throw new Error(Z);return _e}getLeaves(D,L,O){const Z=[];return this._appendLeaves(Z,D,L=L||10,O=O||0,0),Z}getTile(D,L,O){const Z=this.trees[this._limitZoom(D)],te=Math.pow(2,D),{extent:se,radius:ce}=this.options,Y=ce/se,_e=(O-Y)/te,we=(O+1+Y)/te,fe={features:[]};return this._addTileFeatures(Z.range((L-Y)/te,_e,(L+1+Y)/te,we),Z.data,L,O,te,fe),L===0&&this._addTileFeatures(Z.range(1-Y/te,_e,1,we),Z.data,te,O,te,fe),L===te-1&&this._addTileFeatures(Z.range(0,_e,Y/te,we),Z.data,-1,O,te,fe),fe.features.length?fe:null}getClusterExpansionZoom(D){let L=this._getOriginZoom(D)-1;for(;L<=this.options.maxZoom;){const O=this.getChildren(D);if(L++,O.length!==1)break;D=O[0].properties.cluster_id}return L}_appendLeaves(D,L,O,Z,te){const se=this.getChildren(L);for(const ce of se){const Y=ce.properties;if(Y&&Y.cluster?te+Y.point_count<=Z?te+=Y.point_count:te=this._appendLeaves(D,Y.cluster_id,O,Z,te):te<Z?te++:D.push(ce),D.length===O)break}return te}_createTree(D){const L=new S.av(D.length/this.stride|0,this.options.nodeSize,Float32Array);for(let O=0;O<D.length;O+=this.stride)L.add(D[O],D[O+1]);return L.finish(),L.data=D,L}_addTileFeatures(D,L,O,Z,te,se){for(const ce of D){const Y=ce*this.stride,_e=L[Y+Nt]>1;let we,fe,ze;if(_e)we=Gr(L,Y,this.clusterProps),fe=L[Y],ze=L[Y+1];else{const At=this.points[L[Y+It]];we=At.properties;const[gt,Dt]=At.geometry.coordinates;fe=ur(gt),ze=mi(Dt)}const tt={type:1,geometry:[[Math.round(this.options.extent*(fe*te-O)),Math.round(this.options.extent*(ze*te-Z))]],tags:we};let nt;nt=_e||this.options.generateId?L[Y+It]:this.points[L[Y+It]].id,nt!==void 0&&(tt.id=nt),se.features.push(tt)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(Math.floor(+D),this.options.maxZoom+1))}_cluster(D,L){const{radius:O,extent:Z,reduce:te,minPoints:se}=this.options,ce=O/(Z*Math.pow(2,L)),Y=D.data,_e=[],we=this.stride;for(let fe=0;fe<Y.length;fe+=we){if(Y[fe+2]<=L)continue;Y[fe+2]=L;const ze=Y[fe],tt=Y[fe+1],nt=D.within(Y[fe],Y[fe+1],ce),At=Y[fe+Nt];let gt=At;for(const Dt of nt){const Et=Dt*we;Y[Et+2]>L&&(gt+=Y[Et+Nt])}if(gt>At&&gt>=se){let Dt,Et=ze*At,Ir=tt*At,cr=-1;const St=((fe/we|0)<<5)+(L+1)+this.points.length;for(const Zt of nt){const or=Zt*we;if(Y[or+2]<=L)continue;Y[or+2]=L;const Rr=Y[or+Nt];Et+=Y[or]*Rr,Ir+=Y[or+1]*Rr,Y[or+4]=St,te&&(Dt||(Dt=this._map(Y,fe,!0),cr=this.clusterProps.length,this.clusterProps.push(Dt)),te(Dt,this._map(Y,or)))}Y[fe+4]=St,_e.push(Et/gt,Ir/gt,1/0,St,-1,gt),te&&_e.push(cr)}else{for(let Dt=0;Dt<we;Dt++)_e.push(Y[fe+Dt]);if(gt>1)for(const Dt of nt){const Et=Dt*we;if(!(Y[Et+2]<=L)){Y[Et+2]=L;for(let Ir=0;Ir<we;Ir++)_e.push(Y[Et+Ir])}}}}return _e}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,L,O){if(D[L+Nt]>1){const se=this.clusterProps[D[L+si]];return O?Object.assign({},se):se}const Z=this.points[D[L+It]].properties,te=this.options.map(Z);return O&&te===Z?Object.assign({},te):te}}function Dr($,D,L){return{type:"Feature",id:$[D+It],properties:Gr($,D,L),geometry:{type:"Point",coordinates:[(O=$[D],360*(O-.5)),at($[D+1])]}};var O}function Gr($,D,L){const O=$[D+Nt],Z=O>=1e4?`${Math.round(O/1e3)}k`:O>=1e3?Math.round(O/100)/10+"k":O,te=$[D+si],se=te===-1?{}:Object.assign({},L[te]);return Object.assign(se,{cluster:!0,cluster_id:$[D+It],point_count:O,point_count_abbreviated:Z})}function ur($){return $/360+.5}function mi($){const D=Math.sin($*Math.PI/180),L=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return L<0?0:L>1?1:L}function at($){const D=(180-360*$)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function qi($,D,L,O){let Z=O;const te=D+(L-D>>1);let se,ce=L-D;const Y=$[D],_e=$[D+1],we=$[L],fe=$[L+1];for(let ze=D+3;ze<L;ze+=3){const tt=ms($[ze],$[ze+1],Y,_e,we,fe);if(tt>Z)se=ze,Z=tt;else if(tt===Z){const nt=Math.abs(ze-te);nt<ce&&(se=ze,ce=nt)}}Z>O&&(se-D>3&&qi($,D,se,O),$[se+2]=Z,L-se>3&&qi($,se,L,O))}function ms($,D,L,O,Z,te){let se=Z-L,ce=te-O;if(se!==0||ce!==0){const Y=(($-L)*se+(D-O)*ce)/(se*se+ce*ce);Y>1?(L=Z,O=te):Y>0&&(L+=se*Y,O+=ce*Y)}return se=$-L,ce=D-O,se*se+ce*ce}function Hr($,D,L,O){const Z={id:$??null,type:D,geometry:L,tags:O,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(D==="Point"||D==="MultiPoint"||D==="LineString")ai(Z,L);else if(D==="Polygon")ai(Z,L[0]);else if(D==="MultiLineString")for(const te of L)ai(Z,te);else if(D==="MultiPolygon")for(const te of L)ai(Z,te[0]);return Z}function ai($,D){for(let L=0;L<D.length;L+=3)$.minX=Math.min($.minX,D[L]),$.minY=Math.min($.minY,D[L+1]),$.maxX=Math.max($.maxX,D[L]),$.maxY=Math.max($.maxY,D[L+1])}function In($,D,L,O){if(!D.geometry)return;const Z=D.geometry.coordinates;if(Z&&Z.length===0)return;const te=D.geometry.type,se=Math.pow(L.tolerance/((1<<L.maxZoom)*L.extent),2);let ce=[],Y=D.id;if(L.promoteId?Y=D.properties[L.promoteId]:L.generateId&&(Y=O||0),te==="Point")ts(Z,ce);else if(te==="MultiPoint")for(const _e of Z)ts(_e,ce);else if(te==="LineString")me(Z,ce,se,!1);else if(te==="MultiLineString"){if(L.lineMetrics){for(const _e of Z)ce=[],me(_e,ce,se,!1),$.push(Hr(Y,"LineString",ce,D.properties));return}jn(Z,ce,se,!1)}else if(te==="Polygon")jn(Z,ce,se,!0);else{if(te!=="MultiPolygon"){if(te==="GeometryCollection"){for(const _e of D.geometry.geometries)In($,{id:Y,geometry:_e,properties:D.properties},L,O);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const _e of Z){const we=[];jn(_e,we,se,!0),ce.push(we)}}$.push(Hr(Y,te,ce,D.properties))}function ts($,D){D.push(Vn($[0]),Ct($[1]),0)}function me($,D,L,O){let Z,te,se=0;for(let Y=0;Y<$.length;Y++){const _e=Vn($[Y][0]),we=Ct($[Y][1]);D.push(_e,we,0),Y>0&&(se+=O?(Z*we-_e*te)/2:Math.sqrt(Math.pow(_e-Z,2)+Math.pow(we-te,2))),Z=_e,te=we}const ce=D.length-3;D[2]=1,qi(D,0,ce,L),D[ce+2]=1,D.size=Math.abs(se),D.start=0,D.end=D.size}function jn($,D,L,O){for(let Z=0;Z<$.length;Z++){const te=[];me($[Z],te,L,O),D.push(te)}}function Vn($){return $/360+.5}function Ct($){const D=Math.sin($*Math.PI/180),L=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return L<0?0:L>1?1:L}function tr($,D,L,O,Z,te,se,ce){if(O/=D,te>=(L/=D)&&se<O)return $;if(se<L||te>=O)return null;const Y=[];for(const _e of $){const we=_e.geometry;let fe=_e.type;const ze=Z===0?_e.minX:_e.minY,tt=Z===0?_e.maxX:_e.maxY;if(ze>=L&&tt<O){Y.push(_e);continue}if(tt<L||ze>=O)continue;let nt=[];if(fe==="Point"||fe==="MultiPoint")En(we,nt,L,O,Z);else if(fe==="LineString")Ai(we,nt,L,O,Z,!1,ce.lineMetrics);else if(fe==="MultiLineString")Un(we,nt,L,O,Z,!1);else if(fe==="Polygon")Un(we,nt,L,O,Z,!0);else if(fe==="MultiPolygon")for(const At of we){const gt=[];Un(At,gt,L,O,Z,!0),gt.length&&nt.push(gt)}if(nt.length){if(ce.lineMetrics&&fe==="LineString"){for(const At of nt)Y.push(Hr(_e.id,fe,At,_e.tags));continue}fe!=="LineString"&&fe!=="MultiLineString"||(nt.length===1?(fe="LineString",nt=nt[0]):fe="MultiLineString"),fe!=="Point"&&fe!=="MultiPoint"||(fe=nt.length===3?"Point":"MultiPoint"),Y.push(Hr(_e.id,fe,nt,_e.tags))}}return Y.length?Y:null}function En($,D,L,O,Z){for(let te=0;te<$.length;te+=3){const se=$[te+Z];se>=L&&se<=O&&Mr(D,$[te],$[te+1],$[te+2])}}function Ai($,D,L,O,Z,te,se){let ce=Wr($);const Y=Z===0?gs:_s;let _e,we,fe=$.start;for(let gt=0;gt<$.length-3;gt+=3){const Dt=$[gt],Et=$[gt+1],Ir=$[gt+2],cr=$[gt+3],St=$[gt+4],Zt=Z===0?Dt:Et,or=Z===0?cr:St;let Rr=!1;se&&(_e=Math.sqrt(Math.pow(Dt-cr,2)+Math.pow(Et-St,2))),Zt<L?or>L&&(we=Y(ce,Dt,Et,cr,St,L),se&&(ce.start=fe+_e*we)):Zt>O?or<O&&(we=Y(ce,Dt,Et,cr,St,O),se&&(ce.start=fe+_e*we)):Mr(ce,Dt,Et,Ir),or<L&&Zt>=L&&(we=Y(ce,Dt,Et,cr,St,L),Rr=!0),or>O&&Zt<=O&&(we=Y(ce,Dt,Et,cr,St,O),Rr=!0),!te&&Rr&&(se&&(ce.end=fe+_e*we),D.push(ce),ce=Wr($)),se&&(fe+=_e)}let ze=$.length-3;const tt=$[ze],nt=$[ze+1],At=Z===0?tt:nt;At>=L&&At<=O&&Mr(ce,tt,nt,$[ze+2]),ze=ce.length-3,te&&ze>=3&&(ce[ze]!==ce[0]||ce[ze+1]!==ce[1])&&Mr(ce,ce[0],ce[1],ce[2]),ce.length&&D.push(ce)}function Wr($){const D=[];return D.size=$.size,D.start=$.start,D.end=$.end,D}function Un($,D,L,O,Z,te){for(const se of $)Ai(se,D,L,O,Z,te,!1)}function Mr($,D,L,O){$.push(D,L,O)}function gs($,D,L,O,Z,te){const se=(te-D)/(O-D);return Mr($,te,L+(Z-L)*se,1),se}function _s($,D,L,O,Z,te){const se=(te-L)/(Z-L);return Mr($,D+(O-D)*se,te,1),se}function ke($,D){const L=[];for(let O=0;O<$.length;O++){const Z=$[O],te=Z.type;let se;if(te==="Point"||te==="MultiPoint"||te==="LineString")se=an(Z.geometry,D);else if(te==="MultiLineString"||te==="Polygon"){se=[];for(const ce of Z.geometry)se.push(an(ce,D))}else if(te==="MultiPolygon"){se=[];for(const ce of Z.geometry){const Y=[];for(const _e of ce)Y.push(an(_e,D));se.push(Y)}}L.push(Hr(Z.id,te,se,Z.tags))}return L}function an($,D){const L=[];L.size=$.size,$.start!==void 0&&(L.start=$.start,L.end=$.end);for(let O=0;O<$.length;O+=3)L.push($[O]+D,$[O+1],$[O+2]);return L}function kr($,D){if($.transformed)return $;const L=1<<$.z,O=$.x,Z=$.y;for(const te of $.features){const se=te.geometry,ce=te.type;if(te.geometry=[],ce===1)for(let Y=0;Y<se.length;Y+=2)te.geometry.push(yr(se[Y],se[Y+1],D,L,O,Z));else for(let Y=0;Y<se.length;Y++){const _e=[];for(let we=0;we<se[Y].length;we+=2)_e.push(yr(se[Y][we],se[Y][we+1],D,L,O,Z));te.geometry.push(_e)}}return $.transformed=!0,$}function yr($,D,L,O,Z,te){return[Math.round(L*($*O-Z)),Math.round(L*(D*O-te))]}function gi($,D,L,O,Z){const te=D===Z.maxZoom?0:Z.tolerance/((1<<D)*Z.extent),se={features:[],numPoints:0,numSimplified:0,numFeatures:$.length,source:null,x:L,y:O,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ce of $)Ee(se,ce,te,Z);return se}function Ee($,D,L,O){const Z=D.geometry,te=D.type,se=[];if($.minX=Math.min($.minX,D.minX),$.minY=Math.min($.minY,D.minY),$.maxX=Math.max($.maxX,D.maxX),$.maxY=Math.max($.maxY,D.maxY),te==="Point"||te==="MultiPoint")for(let ce=0;ce<Z.length;ce+=3)se.push(Z[ce],Z[ce+1]),$.numPoints++,$.numSimplified++;else if(te==="LineString")yt(se,Z,$,L,!1,!1);else if(te==="MultiLineString"||te==="Polygon")for(let ce=0;ce<Z.length;ce++)yt(se,Z[ce],$,L,te==="Polygon",ce===0);else if(te==="MultiPolygon")for(let ce=0;ce<Z.length;ce++){const Y=Z[ce];for(let _e=0;_e<Y.length;_e++)yt(se,Y[_e],$,L,!0,_e===0)}if(se.length){let ce=D.tags||null;if(te==="LineString"&&O.lineMetrics){ce={};for(const _e in D.tags)ce[_e]=D.tags[_e];ce.mapbox_clip_start=Z.start/Z.size,ce.mapbox_clip_end=Z.end/Z.size}const Y={geometry:se,type:te==="Polygon"||te==="MultiPolygon"?3:te==="LineString"||te==="MultiLineString"?2:1,tags:ce};D.id!==null&&(Y.id=D.id),$.features.push(Y)}}function yt($,D,L,O,Z,te){const se=O*O;if(O>0&&D.size<(Z?se:O))return void(L.numPoints+=D.length/3);const ce=[];for(let Y=0;Y<D.length;Y+=3)(O===0||D[Y+2]>se)&&(L.numSimplified++,ce.push(D[Y],D[Y+1])),L.numPoints++;Z&&function(Y,_e){let we=0;for(let fe=0,ze=Y.length,tt=ze-2;fe<ze;tt=fe,fe+=2)we+=(Y[fe]-Y[tt])*(Y[fe+1]+Y[tt+1]);if(we>0===_e)for(let fe=0,ze=Y.length;fe<ze/2;fe+=2){const tt=Y[fe],nt=Y[fe+1];Y[fe]=Y[ze-2-fe],Y[fe+1]=Y[ze-1-fe],Y[ze-2-fe]=tt,Y[ze-1-fe]=nt}}(ce,te),$.push(ce)}const lt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Lr{constructor(D,L){const O=(L=this.options=function(te,se){for(const ce in se)te[ce]=se[ce];return te}(Object.create(lt),L)).debug;if(O&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");let Z=function(te,se){const ce=[];if(te.type==="FeatureCollection")for(let Y=0;Y<te.features.length;Y++)In(ce,te.features[Y],se,Y);else In(ce,te.type==="Feature"?te:{geometry:te},se);return ce}(D,L);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Z=function(te,se){const ce=se.buffer/se.extent;let Y=te;const _e=tr(te,1,-1-ce,ce,0,-1,2,se),we=tr(te,1,1-ce,2+ce,0,-1,2,se);return(_e||we)&&(Y=tr(te,1,-ce,1+ce,0,-1,2,se)||[],_e&&(Y=ke(_e,1).concat(Y)),we&&(Y=Y.concat(ke(we,-1)))),Y}(Z,L),Z.length&&this.splitTile(Z,0,0,0),O&&(Z.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(D,L,O,Z,te,se,ce){const Y=[D,L,O,Z],_e=this.options,we=_e.debug;for(;Y.length;){Z=Y.pop(),O=Y.pop(),L=Y.pop(),D=Y.pop();const fe=1<<L,ze=_i(L,O,Z);let tt=this.tiles[ze];if(!tt&&(we>1&&console.time("creation"),tt=this.tiles[ze]=gi(D,L,O,Z,_e),this.tileCoords.push({z:L,x:O,y:Z}),we)){we>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,O,Z,tt.numFeatures,tt.numPoints,tt.numSimplified),console.timeEnd("creation"));const Rr=`z${L}`;this.stats[Rr]=(this.stats[Rr]||0)+1,this.total++}if(tt.source=D,te==null){if(L===_e.indexMaxZoom||tt.numPoints<=_e.indexMaxPoints)continue}else{if(L===_e.maxZoom||L===te)continue;if(te!=null){const Rr=te-L;if(O!==se>>Rr||Z!==ce>>Rr)continue}}if(tt.source=null,D.length===0)continue;we>1&&console.time("clipping");const nt=.5*_e.buffer/_e.extent,At=.5-nt,gt=.5+nt,Dt=1+nt;let Et=null,Ir=null,cr=null,St=null,Zt=tr(D,fe,O-nt,O+gt,0,tt.minX,tt.maxX,_e),or=tr(D,fe,O+At,O+Dt,0,tt.minX,tt.maxX,_e);D=null,Zt&&(Et=tr(Zt,fe,Z-nt,Z+gt,1,tt.minY,tt.maxY,_e),Ir=tr(Zt,fe,Z+At,Z+Dt,1,tt.minY,tt.maxY,_e),Zt=null),or&&(cr=tr(or,fe,Z-nt,Z+gt,1,tt.minY,tt.maxY,_e),St=tr(or,fe,Z+At,Z+Dt,1,tt.minY,tt.maxY,_e),or=null),we>1&&console.timeEnd("clipping"),Y.push(Et||[],L+1,2*O,2*Z),Y.push(Ir||[],L+1,2*O,2*Z+1),Y.push(cr||[],L+1,2*O+1,2*Z),Y.push(St||[],L+1,2*O+1,2*Z+1)}}getTile(D,L,O){D=+D,L=+L,O=+O;const Z=this.options,{extent:te,debug:se}=Z;if(D<0||D>24)return null;const ce=1<<D,Y=_i(D,L=L+ce&ce-1,O);if(this.tiles[Y])return kr(this.tiles[Y],te);se>1&&console.log("drilling down to z%d-%d-%d",D,L,O);let _e,we=D,fe=L,ze=O;for(;!_e&&we>0;)we--,fe>>=1,ze>>=1,_e=this.tiles[_i(we,fe,ze)];return _e&&_e.source?(se>1&&(console.log("found parent tile z%d-%d-%d",we,fe,ze),console.time("drilling down")),this.splitTile(_e.source,we,fe,ze,D,L,O),se>1&&console.timeEnd("drilling down"),this.tiles[Y]?kr(this.tiles[Y],te):null):null}}function _i($,D,L){return 32*((1<<$)*L+D)+$}function mt($,D){return D?$.properties[D]:$.id}function Ie($,D){if($==null)return!0;if($.type==="Feature")return mt($,D)!=null;if($.type==="FeatureCollection"){const L=new Set;for(const O of $.features){const Z=mt(O,D);if(Z==null||L.has(Z))return!1;L.add(Z)}return!0}return!1}function ct($,D){const L=new Map;if($!=null)if($.type==="Feature")L.set(mt($,D),$);else for(const O of $.features)L.set(mt(O,D),O);return L}class bt extends Q{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(D,L){return S._(this,void 0,void 0,function*(){const O=D.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Z=this._geoJSONIndex.getTile(O.z,O.x,O.y);if(!Z)return null;const te=new class{constructor(ce){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=S.X,this.length=ce.length,this._features=ce}feature(ce){return new class{constructor(Y){this._feature=Y,this.extent=S.X,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){const Y=[];for(const _e of this._feature.geometry)Y.push([new S.P(_e[0],_e[1])]);return Y}{const Y=[];for(const _e of this._feature.geometry){const we=[];for(const fe of _e)we.push(new S.P(fe[0],fe[1]));Y.push(we)}return Y}}toGeoJSON(Y,_e,we){return _t.call(this,Y,_e,we)}}(this._features[ce])}}(Z.features);let se=jr(te);return se.byteOffset===0&&se.byteLength===se.buffer.byteLength||(se=new Uint8Array(se)),{vectorTile:te,rawData:se.buffer}})}loadData(D){return S._(this,void 0,void 0,function*(){var L;(L=this._pendingRequest)===null||L===void 0||L.abort();const O=!!(D&&D.request&&D.request.collectResourceTiming)&&new S.bv(D.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(D,this._pendingRequest),this._geoJSONIndex=D.cluster?new er(function({superclusterOptions:se,clusterProperties:ce}){if(!ce||!se)return se;const Y={},_e={},we={accumulated:null,zoom:0},fe={properties:null},ze=Object.keys(ce);for(const tt of ze){const[nt,At]=ce[tt],gt=S.bC(At),Dt=S.bC(typeof nt=="string"?[nt,["accumulated"],["get",tt]]:nt);Y[tt]=gt.value,_e[tt]=Dt.value}return se.map=tt=>{fe.properties=tt;const nt={};for(const At of ze)nt[At]=Y[At].evaluate(we,fe);return nt},se.reduce=(tt,nt)=>{fe.properties=nt;for(const At of ze)we.accumulated=tt[At],tt[At]=_e[At].evaluate(we,fe)},se}(D)).load((yield this._pendingData).features):(Z=yield this._pendingData,new Lr(Z,D.geojsonVtOptions)),this.loaded={};const te={};if(O){const se=O.finish();se&&(te.resourceTiming={},te.resourceTiming[D.source]=JSON.parse(JSON.stringify(se)))}return te}catch(te){if(delete this._pendingRequest,S.bB(te))return{abandoned:!0};throw te}var Z})}getData(){return S._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(D){const L=this.loaded;return L&&L[D.uid]?super.reloadTile(D):this.loadTile(D)}loadAndProcessGeoJSON(D,L){return S._(this,void 0,void 0,function*(){let O=yield this.loadGeoJSON(D,L);if(delete this._pendingRequest,typeof O!="object")throw new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`);if(Pe(O,!0),D.filter){const Z=S.bC(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Z.result==="error")throw new Error(Z.value.map(se=>`${se.key}: ${se.message}`).join(", "));O={type:"FeatureCollection",features:O.features.filter(se=>Z.value.evaluate({zoom:0},se))}}return O})}loadGeoJSON(D,L){return S._(this,void 0,void 0,function*(){const{promoteId:O}=D;if(D.request){const Z=yield S.h(D.request,L);return this._dataUpdateable=Ie(Z.data,O)?ct(Z.data,O):void 0,Z.data}if(typeof D.data=="string")try{const Z=JSON.parse(D.data);return this._dataUpdateable=Ie(Z,O)?ct(Z,O):void 0,Z}catch{throw new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`)}if(!D.dataDiff)throw new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${D.source}`);return function(Z,te,se){var ce,Y,_e,we;if(te.removeAll&&Z.clear(),te.remove)for(const fe of te.remove)Z.delete(fe);if(te.add)for(const fe of te.add){const ze=mt(fe,se);ze!=null&&Z.set(ze,fe)}if(te.update)for(const fe of te.update){let ze=Z.get(fe.id);if(ze==null)continue;const tt=!fe.removeAllProperties&&(((ce=fe.removeProperties)===null||ce===void 0?void 0:ce.length)>0||((Y=fe.addOrUpdateProperties)===null||Y===void 0?void 0:Y.length)>0);if((fe.newGeometry||fe.removeAllProperties||tt)&&(ze=Object.assign({},ze),Z.set(fe.id,ze),tt&&(ze.properties=Object.assign({},ze.properties))),fe.newGeometry&&(ze.geometry=fe.newGeometry),fe.removeAllProperties)ze.properties={};else if(((_e=fe.removeProperties)===null||_e===void 0?void 0:_e.length)>0)for(const nt of fe.removeProperties)Object.prototype.hasOwnProperty.call(ze.properties,nt)&&delete ze.properties[nt];if(((we=fe.addOrUpdateProperties)===null||we===void 0?void 0:we.length)>0)for(const{key:nt,value:At}of fe.addOrUpdateProperties)ze.properties[nt]=At}}(this._dataUpdateable,D.dataDiff,O),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(D){return S._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(D){return this._geoJSONIndex.getClusterExpansionZoom(D.clusterId)}getClusterChildren(D){return this._geoJSONIndex.getChildren(D.clusterId)}getClusterLeaves(D){return this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset)}}class Ut{constructor(D){this.self=D,this.actor=new S.F(D),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(L,O)=>{if(this.externalWorkerSourceTypes[L])throw new Error(`Worker source with name "${L}" already registered.`);this.externalWorkerSourceTypes[L]=O},this.self.addProtocol=S.bi,this.self.removeProtocol=S.bj,this.self.registerRTLTextPlugin=L=>{if(S.bD.isParsed())throw new Error("RTL text plugin already registered.");S.bD.setMethods(L)},this.actor.registerMessageHandler("LDT",(L,O)=>this._getDEMWorkerSource(L,O.source).loadTile(O)),this.actor.registerMessageHandler("RDT",(L,O)=>S._(this,void 0,void 0,function*(){this._getDEMWorkerSource(L,O.source).removeTile(O)})),this.actor.registerMessageHandler("GCEZ",(L,O)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(L,O.type,O.source).getClusterExpansionZoom(O)})),this.actor.registerMessageHandler("GCC",(L,O)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(L,O.type,O.source).getClusterChildren(O)})),this.actor.registerMessageHandler("GCL",(L,O)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(L,O.type,O.source).getClusterLeaves(O)})),this.actor.registerMessageHandler("LD",(L,O)=>this._getWorkerSource(L,O.type,O.source).loadData(O)),this.actor.registerMessageHandler("GD",(L,O)=>this._getWorkerSource(L,O.type,O.source).getData()),this.actor.registerMessageHandler("LT",(L,O)=>this._getWorkerSource(L,O.type,O.source).loadTile(O)),this.actor.registerMessageHandler("RT",(L,O)=>this._getWorkerSource(L,O.type,O.source).reloadTile(O)),this.actor.registerMessageHandler("AT",(L,O)=>this._getWorkerSource(L,O.type,O.source).abortTile(O)),this.actor.registerMessageHandler("RMT",(L,O)=>this._getWorkerSource(L,O.type,O.source).removeTile(O)),this.actor.registerMessageHandler("RS",(L,O)=>S._(this,void 0,void 0,function*(){if(!this.workerSources[L]||!this.workerSources[L][O.type]||!this.workerSources[L][O.type][O.source])return;const Z=this.workerSources[L][O.type][O.source];delete this.workerSources[L][O.type][O.source],Z.removeSource!==void 0&&Z.removeSource(O)})),this.actor.registerMessageHandler("RM",L=>S._(this,void 0,void 0,function*(){delete this.layerIndexes[L],delete this.availableImages[L],delete this.workerSources[L],delete this.demWorkerSources[L]})),this.actor.registerMessageHandler("SR",(L,O)=>S._(this,void 0,void 0,function*(){this.referrer=O})),this.actor.registerMessageHandler("SRPS",(L,O)=>this._syncRTLPluginState(L,O)),this.actor.registerMessageHandler("IS",(L,O)=>S._(this,void 0,void 0,function*(){this.self.importScripts(O)})),this.actor.registerMessageHandler("SI",(L,O)=>this._setImages(L,O)),this.actor.registerMessageHandler("UL",(L,O)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(L).update(O.layers,O.removedIds)})),this.actor.registerMessageHandler("SL",(L,O)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(L).replace(O)}))}_setImages(D,L){return S._(this,void 0,void 0,function*(){this.availableImages[D]=L;for(const O in this.workerSources[D]){const Z=this.workerSources[D][O];for(const te in Z)Z[te].availableImages=L}})}_syncRTLPluginState(D,L){return S._(this,void 0,void 0,function*(){if(S.bD.isParsed())return S.bD.getState();if(L.pluginStatus!=="loading")return S.bD.setState(L),L;const O=L.pluginURL;if(this.self.importScripts(O),S.bD.isParsed()){const Z={pluginStatus:"loaded",pluginURL:O};return S.bD.setState(Z),Z}throw S.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${O}`)})}_getAvailableImages(D){let L=this.availableImages[D];return L||(L=[]),L}_getLayerIndex(D){let L=this.layerIndexes[D];return L||(L=this.layerIndexes[D]=new d),L}_getWorkerSource(D,L,O){if(this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][L]||(this.workerSources[D][L]={}),!this.workerSources[D][L][O]){const Z={sendAsync:(te,se)=>(te.targetMapId=D,this.actor.sendAsync(te,se))};switch(L){case"vector":this.workerSources[D][L][O]=new Q(Z,this._getLayerIndex(D),this._getAvailableImages(D));break;case"geojson":this.workerSources[D][L][O]=new bt(Z,this._getLayerIndex(D),this._getAvailableImages(D));break;default:this.workerSources[D][L][O]=new this.externalWorkerSourceTypes[L](Z,this._getLayerIndex(D),this._getAvailableImages(D))}}return this.workerSources[D][L][O]}_getDEMWorkerSource(D,L){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][L]||(this.demWorkerSources[D][L]=new W),this.demWorkerSources[D][L]}}return S.i(self)&&(self.worker=new Ut(self)),Ut}),b("index",["exports","./shared"],function(S,d){var U="4.7.1";let ne,ye;const Q={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:f=>new Promise((e,s)=>{const l=requestAnimationFrame(e);f.signal.addEventListener("abort",()=>{cancelAnimationFrame(l),s(d.c())})}),getImageData(f,e=0){return this.getImageCanvasContext(f).getImageData(-e,-e,f.width+2*e,f.height+2*e)},getImageCanvasContext(f){const e=window.document.createElement("canvas"),s=e.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return e.width=f.width,e.height=f.height,s.drawImage(f,0,0,f.width,f.height),s},resolveURL:f=>(ne||(ne=document.createElement("a")),ne.href=f,ne.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ye==null&&(ye=matchMedia("(prefers-reduced-motion: reduce)")),ye.matches)}};class W{static testProp(e){if(!W.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in W.docStyle)return e[s];return e[0]}static create(e,s,l){const u=window.document.createElement(e);return s!==void 0&&(u.className=s),l&&l.appendChild(u),u}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){W.docStyle&&W.selectProp&&(W.userSelect=W.docStyle[W.selectProp],W.docStyle[W.selectProp]="none")}static enableDrag(){W.docStyle&&W.selectProp&&(W.docStyle[W.selectProp]=W.userSelect)}static setTransform(e,s){e.style[W.transformProp]=s}static addEventListener(e,s,l,u={}){e.addEventListener(s,l,"passive"in u?u:u.capture)}static removeEventListener(e,s,l,u={}){e.removeEventListener(s,l,"passive"in u?u:u.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",W.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",W.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",W.suppressClickInternal,!0)},0)}static getScale(e){const s=e.getBoundingClientRect();return{x:s.width/e.offsetWidth||1,y:s.height/e.offsetHeight||1,boundingClientRect:s}}static getPoint(e,s,l){const u=s.boundingClientRect;return new d.P((l.clientX-u.left)/s.x-e.clientLeft,(l.clientY-u.top)/s.y-e.clientTop)}static mousePos(e,s){const l=W.getScale(e);return W.getPoint(e,l,s)}static touchPos(e,s){const l=[],u=W.getScale(e);for(let p=0;p<s.length;p++)l.push(W.getPoint(e,u,s[p]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}W.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,W.selectProp=W.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),W.transformProp=W.testProp(["transform","WebkitTransform"]);const De={supported:!1,testSupport:function(f){!_t&&Pe&&(oe?ee(f):Me=f)}};let Me,Pe,_t=!1,oe=!1;function ee(f){const e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,Pe),f.isContextLost())return;De.supported=!0}catch{}f.deleteTexture(e),_t=!0}var he;typeof document<"u"&&(Pe=document.createElement("img"),Pe.onload=()=>{Me&&ee(Me),Me=null,oe=!0},Pe.onerror=()=>{_t=!0,Me=null},Pe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(f){let e,s,l,u;f.resetRequestQueue=()=>{e=[],s=0,l=0,u={}},f.addThrottleControl=T=>{const P=l++;return u[P]=T,P},f.removeThrottleControl=T=>{delete u[T],v()},f.getImage=(T,P,M=!0)=>new Promise((z,F)=>{De.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),d.e(T,{type:"image"}),e.push({abortController:P,requestParameters:T,supportImageRefresh:M,state:"queued",onError:j=>{F(j)},onSuccess:j=>{z(j)}}),v()});const p=T=>d._(this,void 0,void 0,function*(){T.state="running";const{requestParameters:P,supportImageRefresh:M,onError:z,onSuccess:F,abortController:j}=T,V=M===!1&&!d.i(self)&&!d.g(P.url)&&(!P.headers||Object.keys(P.headers).reduce((J,re)=>J&&re==="accept",!0));s++;const H=V?w(P,j):d.m(P,j);try{const J=yield H;delete T.abortController,T.state="completed",J.data instanceof HTMLImageElement||d.b(J.data)?F(J):J.data&&F({data:yield(K=J.data,typeof createImageBitmap=="function"?d.d(K):d.f(K)),cacheControl:J.cacheControl,expires:J.expires})}catch(J){delete T.abortController,z(J)}finally{s--,v()}var K}),v=()=>{const T=(()=>{for(const P of Object.keys(u))if(u[P]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let P=s;P<T&&e.length>0;P++){const M=e.shift();M.abortController.signal.aborted?P--:p(M)}},w=(T,P)=>new Promise((M,z)=>{const F=new Image,j=T.url,V=T.credentials;V&&V==="include"?F.crossOrigin="use-credentials":(V&&V==="same-origin"||!d.s(j))&&(F.crossOrigin="anonymous"),P.signal.addEventListener("abort",()=>{F.src="",z(d.c())}),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,M({data:F})},F.onerror=()=>{F.onerror=F.onload=null,P.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=j})}(he||(he={})),he.resetRequestQueue();class Se{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Ue(f){var e=new d.A(3);return e[0]=f[0],e[1]=f[1],e[2]=f[2],e}var Xe,Ge=function(f,e,s){return f[0]=e[0]-s[0],f[1]=e[1]-s[1],f[2]=e[2]-s[2],f};Xe=new d.A(3),d.A!=Float32Array&&(Xe[0]=0,Xe[1]=0,Xe[2]=0);var it=function(f){var e=f[0],s=f[1];return e*e+s*s};function Rt(f){const e=[];if(typeof f=="string")e.push({id:"default",url:f});else if(f&&f.length>0){const s=[];for(const{id:l,url:u}of f){const p=`${l}${u}`;s.indexOf(p)===-1&&(s.push(p),e.push({id:l,url:u}))}}return e}function vt(f,e,s){const l=f.split("?");return l[0]+=`${e}${s}`,l.join("?")}(function(){var f=new d.A(2);d.A!=Float32Array&&(f[0]=0,f[1]=0)})();class wt{constructor(e,s,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(s,u)}update(e,s,l){const{width:u,height:p}=e,v=!(this.size&&this.size[0]===u&&this.size[1]===p||l),{context:w}=this,{gl:T}=w;if(this.useMipmap=!!(s&&s.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!s||s.premultiply!==!1)),v)this.size=[u,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,u,p,0,this.format,T.UNSIGNED_BYTE,e.data);else{const{x:P,y:M}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?T.texSubImage2D(T.TEXTURE_2D,0,P,M,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,P,M,u,p,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)}bind(e,s,l){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),l!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,l||e),this.filter=e),s!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Mi(f){const{userImage:e}=f;return!!(e&&e.render&&e.render())&&(f.data.replace(new Uint8Array(e.data.buffer)),!0)}class Qt extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,promiseResolve:l}of this.requestors)l(this._getImagesForIds(s));this.requestors=[]}}getImage(e){const s=this.images[e];if(s&&!s.data&&s.spriteData){const l=s.spriteData;s.data=new d.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),s.spriteData=null}return s}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let l=!0;const u=s.data||s.spriteData;return this._validateStretch(s.stretchX,u&&u.width)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(s.stretchY,u&&u.height)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(s.content,s)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,s){if(!e)return!0;let l=0;for(const u of e){if(u[0]<l||u[1]<u[0]||s<u[1])return!1;l=u[1]}return!0}_validateContent(e,s){if(!e)return!0;if(e.length!==4)return!1;const l=s.spriteData,u=l&&l.width||s.data.width,p=l&&l.height||s.data.height;return!(e[0]<0||u<e[0]||e[1]<0||p<e[1]||e[2]<0||u<e[2]||e[3]<0||p<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,s,l=!0){const u=this.getImage(e);if(l&&(u.data.width!==s.data.width||u.data.height!==s.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=u.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((s,l)=>{let u=!0;if(!this.isLoaded())for(const p of e)this.images[p]||(u=!1);this.isLoaded()||u?s(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:s})})}_getImagesForIds(e){const s={};for(const l of e){let u=this.getImage(l);u||(this.fire(new d.k("styleimagemissing",{id:l})),u=this.getImage(l)),u?s[l]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,textFitWidth:u.textFitWidth,textFitHeight:u.textFitHeight,hasRenderCallback:!!(u.userImage&&u.userImage.render)}:d.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],l=this.getImage(e);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},p=new d.I(u,l);this.patterns[e]={bin:u,position:p}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new wt(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const p in this.patterns)e.push(this.patterns[p].bin);const{w:s,h:l}=d.p(e),u=this.atlasImage;u.resize({width:s||1,height:l||1});for(const p in this.patterns){const{bin:v}=this.patterns[p],w=v.x+1,T=v.y+1,P=this.getImage(p).data,M=P.width,z=P.height;d.R.copy(P,u,{x:0,y:0},{x:w,y:T},{width:M,height:z}),d.R.copy(P,u,{x:0,y:z-1},{x:w,y:T-1},{width:M,height:1}),d.R.copy(P,u,{x:0,y:0},{x:w,y:T+z},{width:M,height:1}),d.R.copy(P,u,{x:M-1,y:0},{x:w-1,y:T},{width:1,height:z}),d.R.copy(P,u,{x:0,y:0},{x:w+M,y:T},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const l=this.getImage(s);l||d.w(`Image with ID: "${s}" was not found`),Mi(l)&&this.updateImage(s,l)}}}const Ot=1e20;function Tr(f,e,s,l,u,p,v,w,T){for(let P=e;P<e+l;P++)zi(f,s*p+P,p,u,v,w,T);for(let P=s;P<s+u;P++)zi(f,P*p+e,1,l,v,w,T)}function zi(f,e,s,l,u,p,v){p[0]=0,v[0]=-Ot,v[1]=Ot,u[0]=f[e];for(let w=1,T=0,P=0;w<l;w++){u[w]=f[e+w*s];const M=w*w;do{const z=p[T];P=(u[w]-u[z]+M-z*z)/(w-z)/2}while(P<=v[T]&&--T>-1);T++,p[T]=w,v[T]=P,v[T+1]=Ot}for(let w=0,T=0;w<l;w++){for(;v[T+1]<w;)T++;const P=p[T],M=w-P;f[e+w*s]=u[P]+M*M}}class jr{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return d._(this,void 0,void 0,function*(){const s=[];for(const p in e)for(const v of e[p])s.push(this._getAndCacheGlyphsPromise(p,v));const l=yield Promise.all(s),u={};for(const{stack:p,id:v,glyph:w}of l)u[p]||(u[p]={}),u[p][v]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return u})}_getAndCacheGlyphsPromise(e,s){return d._(this,void 0,void 0,function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let u=l.glyphs[s];if(u!==void 0)return{stack:e,id:s,glyph:u};if(u=this._tinySDF(l,e,s),u)return l.glyphs[s]=u,{stack:e,id:s,glyph:u};const p=Math.floor(s/256);if(256*p>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[p])return{stack:e,id:s,glyph:u};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[p]){const w=jr.loadGlyphRange(e,p,this.url,this.requestManager);l.requests[p]=w}const v=yield l.requests[p];for(const w in v)this._doesCharSupportLocalGlyph(+w)||(l.glyphs[+w]=v[+w]);return l.ranges[p]=!0,{stack:e,id:s,glyph:v[s]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,s,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let p=e.tinySDF;if(!p){let w="400";/bold/i.test(s)?w="900":/medium/i.test(s)?w="500":/light/i.test(s)&&(w="200"),p=e.tinySDF=new jr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:w})}const v=p.draw(String.fromCharCode(l));return{id:l,bitmap:new d.o({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}jr.loadGlyphRange=function(f,e,s,l){return d._(this,void 0,void 0,function*(){const u=256*e,p=u+255,v=l.transformRequest(s.replace("{fontstack}",f).replace("{range}",`${u}-${p}`),"Glyphs"),w=yield d.l(v,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${u}-${p}`);const T={};for(const P of d.n(w.data))T[P.id]=P;return T})},jr.TinySDF=class{constructor({fontSize:f=24,buffer:e=3,radius:s=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:v="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=s;const w=this.size=f+4*e,T=this._createCanvas(w),P=this.ctx=T.getContext("2d",{willReadFrequently:!0});P.font=`${v} ${p} ${f}px ${u}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(f){const e=document.createElement("canvas");return e.width=e.height=f,e}draw(f){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(f),v=Math.ceil(s),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),T=Math.min(this.size-this.buffer,v+Math.ceil(l)),P=w+2*this.buffer,M=T+2*this.buffer,z=Math.max(P*M,0),F=new Uint8ClampedArray(z),j={data:F,width:P,height:M,glyphWidth:w,glyphHeight:T,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(w===0||T===0)return j;const{ctx:V,buffer:H,gridInner:K,gridOuter:J}=this;V.clearRect(H,H,w,T),V.fillText(f,H,H+v);const re=V.getImageData(H,H,w,T);J.fill(Ot,0,z),K.fill(0,0,z);for(let q=0;q<T;q++)for(let ae=0;ae<w;ae++){const le=re.data[4*(q*w+ae)+3]/255;if(le===0)continue;const pe=(q+H)*P+ae+H;if(le===1)J[pe]=0,K[pe]=Ot;else{const xe=.5-le;J[pe]=xe>0?xe*xe:0,K[pe]=xe<0?xe*xe:0}}Tr(J,0,0,P,M,P,this.f,this.v,this.z),Tr(K,H,H,w,T,P,this.f,this.v,this.z);for(let q=0;q<z;q++){const ae=Math.sqrt(J[q])-Math.sqrt(K[q]);F[q]=Math.round(255-255*(ae/this.radius+this.cutoff))}return j}};class He{constructor(){this.specification=d.v.light.position}possiblyEvaluate(e,s){return d.x(e.expression.evaluate(s))}interpolate(e,s,l){return{x:d.y.number(e.x,s.x,l),y:d.y.number(e.y,s.y,l),z:d.y.number(e.z,s.z,l)}}}let ht;class ut extends d.E{constructor(e){super(),ht=ht||new d.q({anchor:new d.D(d.v.light.anchor),position:new He,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.T(ht),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(d.r,e,s))for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l){return(!l||l.validate!==!1)&&d.t(this,e.call(d.u,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}const It=new d.q({"sky-color":new d.D(d.v.sky["sky-color"]),"horizon-color":new d.D(d.v.sky["horizon-color"]),"fog-color":new d.D(d.v.sky["fog-color"]),"fog-ground-blend":new d.D(d.v.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.v.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.v.sky["atmosphere-blend"])});class Nt extends d.E{constructor(e){super(),this._transitionable=new d.T(It),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.z(0))}setSky(e,s={}){if(!this._validate(d.B,e,s)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l={}){return(l==null?void 0:l.validate)!==!1&&d.t(this,e.call(d.u,d.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:d.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class si{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const l=e.join(",")+String(s);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,s)),this.dashEntry[l]}getDashRanges(e,s,l){const u=[];let p=e.length%2==1?-e[e.length-1]*l:0,v=e[0]*l,w=!0;u.push({left:p,right:v,isDash:w,zeroLength:e[0]===0});let T=e[0];for(let P=1;P<e.length;P++){w=!w;const M=e[P];p=T*l,T+=M,v=T*l,u.push({left:p,right:v,isDash:w,zeroLength:M===0})}return u}addRoundDash(e,s,l){const u=s/2;for(let p=-l;p<=l;p++){const v=this.width*(this.nextRow+l+p);let w=0,T=e[w];for(let P=0;P<this.width;P++){P/T.right>1&&(T=e[++w]);const M=Math.abs(P-T.left),z=Math.abs(P-T.right),F=Math.min(M,z);let j;const V=p/l*(u+1);if(T.isDash){const H=u-Math.abs(V);j=Math.sqrt(F*F+H*H)}else j=u-Math.sqrt(F*F+V*V);this.data[v+P]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const T=e[w],P=e[w+1];T.zeroLength?e.splice(w,1):P&&P.isDash===T.isDash&&(P.left=T.left,e.splice(w,1))}const s=e[0],l=e[e.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const u=this.width*this.nextRow;let p=0,v=e[p];for(let w=0;w<this.width;w++){w/v.right>1&&(v=e[++p]);const T=Math.abs(w-v.left),P=Math.abs(w-v.right),M=Math.min(T,P);this.data[u+w]=Math.max(0,Math.min(255,(v.isDash?M:-M)+128))}}addDash(e,s){const l=s?7:0,u=2*l+1;if(this.nextRow+u>this.height)return d.w("LineAtlas out of space"),null;let p=0;for(let w=0;w<e.length;w++)p+=e[w];if(p!==0){const w=this.width/p,T=this.getDashRanges(e,this.width,w);s?this.addRoundDash(T,w,l):this.addRegularDash(T)}const v={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:p};return this.nextRow+=u,this.dirty=!0,v}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const er="maplibre_preloaded_worker_pool";class Dr{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Dr.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[er]}numActive(){return Object.keys(this.active).length}}const Gr=Math.floor(Q.hardwareConcurrency/2);let ur,mi;function at(){return ur||(ur=new Dr),ur}Dr.workerCount=d.C(globalThis)?Math.max(Math.min(Gr,3),1):1;class qi{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=s;const l=this.workerPool.acquire(s);for(let u=0;u<l.length;u++){const p=new d.F(l[u],s);p.name=`Worker ${u}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s){const l=[];for(const u of this.actors)l.push(u.sendAsync({type:e,data:s}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,s){for(const l of this.actors)l.registerMessageHandler(e,s)}}function ms(){return mi||(mi=new qi(at(),d.G),mi.registerMessageHandler("GR",(f,e,s)=>d.m(e,s))),mi}function Hr(f,e){const s=d.H();return d.J(s,s,[1,1,0]),d.K(s,s,[.5*f.width,.5*f.height,1]),d.L(s,s,f.calculatePosMatrix(e.toUnwrapped()))}function ai(f,e,s,l,u,p){const v=function(z,F,j){if(z)for(const V of z){const H=F[V];if(H&&H.source===j&&H.type==="fill-extrusion")return!0}else for(const V in F){const H=F[V];if(H.source===j&&H.type==="fill-extrusion")return!0}return!1}(u&&u.layers,e,f.id),w=p.maxPitchScaleFactor(),T=f.tilesIn(l,w,v);T.sort(In);const P=[];for(const z of T)P.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(e,s,f._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,u,p,w,Hr(f.transform,z.tileID))});const M=function(z){const F={},j={};for(const V of z){const H=V.queryResults,K=V.wrappedTileID,J=j[K]=j[K]||{};for(const re in H){const q=H[re],ae=J[re]=J[re]||{},le=F[re]=F[re]||[];for(const pe of q)ae[pe.featureIndex]||(ae[pe.featureIndex]=!0,le.push(pe))}}return F}(P);for(const z in M)M[z].forEach(F=>{const j=F.feature,V=f.getFeatureState(j.layer["source-layer"],j.id);j.source=j.layer.source,j.layer["source-layer"]&&(j.sourceLayer=j.layer["source-layer"]),j.state=V});return M}function In(f,e){const s=f.tileID,l=e.tileID;return s.overscaledZ-l.overscaledZ||s.canonical.y-l.canonical.y||s.wrap-l.wrap||s.canonical.x-l.canonical.x}function ts(f,e,s){return d._(this,void 0,void 0,function*(){let l=f;if(f.url?l=(yield d.h(e.transformRequest(f.url,"Source"),s)).data:yield Q.frameAsync(s),!l)return null;const u=d.M(d.e(l,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(u.vectorLayerIds=l.vector_layers.map(p=>p.id)),u})}class me{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}extend(e){const s=this._sw,l=this._ne;let u,p;if(e instanceof d.N)u=e,p=e;else{if(!(e instanceof me))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(me.convert(e)):this.extend(d.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(d.N.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return s||l?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new d.N(u.lng,u.lat),this._ne=new d.N(p.lng,p.lat)),this}getCenter(){return new d.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.N(this.getWest(),this.getNorth())}getSouthEast(){return new d.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:l}=d.N.convert(e);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return e instanceof me?e:e&&new me(e)}static fromLngLat(e,s=0){const l=360*s/40075017,u=l/Math.cos(Math.PI/180*e.lat);return new me(new d.N(e.lng-u,e.lat-l),new d.N(e.lng+u,e.lat+l))}adjustAntiMeridian(){const e=new d.N(this._sw.lng,this._sw.lat),s=new d.N(this._ne.lng,this._ne.lat);return new me(e,e.lng>s.lng?new d.N(s.lng+360,s.lat):s)}}class jn{constructor(e,s,l){this.bounds=me.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),l=Math.floor(d.O(this.bounds.getWest())*s),u=Math.floor(d.Q(this.bounds.getNorth())*s),p=Math.ceil(d.O(this.bounds.getEast())*s),v=Math.ceil(d.Q(this.bounds.getSouth())*s);return e.x>=l&&e.x<p&&e.y>=u&&e.y<v}}class Vn extends d.E{constructor(e,s,l,u){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.M(s,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ts(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(d.e(this,e),e.bounds&&(this.tileBounds=new jn(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(s,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request.collectResourceTiming=this._collectResourceTiming;let u="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((p,v)=>{e.reloadPromise={resolve:p,reject:v}})}else e.actor=this.dispatcher.getActor(),u="LT";e.abortController=new AbortController;try{const p=yield e.actor.sendAsync({type:u,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,p)}catch(p){if(delete e.abortController,e.aborted)return;if(p&&p.status!==404)throw p;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,s){if(s&&s.resourceTiming&&(e.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&e.setExpiryData(s),e.loadVectorData(s,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ct extends d.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},s),d.e(this,d.M(s,["url","scheme","tileSize"]))}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ts(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(d.e(this,e),e.bounds&&(this.tileBounds=new jn(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return d.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield he.getImage(this.map._requestManager.transformRequest(s,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const u=this.map.painter.context,p=u.gl,v=l.data;e.texture=this.map.painter.getTileTexture(v.width),e.texture?e.texture.update(v,{useMipmap:!0}):(e.texture=new wt(u,v,p.RGBA,{useMipmap:!0}),e.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class tr extends Ct{constructor(e,s,l,u){super(e,s,l,u),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(s,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const u=yield he.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){const p=u.data;this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const v=d.b(p)&&d.U()?p:yield this.readImageNow(p),w={type:this.type,uid:e.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const T=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=T,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}readImageNow(e){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.V()){const s=e.width+2,l=e.height+2;try{return new d.R({width:s,height:l},yield d.W(e,-1,-1,s,l))}catch{}}return Q.getImageData(e,1)})}_getNeighboringTiles(e){const s=e.canonical,l=Math.pow(2,s.z),u=(s.x-1+l)%l,p=s.x===0?e.wrap-1:e.wrap,v=(s.x+1+l)%l,w=s.x+1===l?e.wrap+1:e.wrap,T={};return T[new d.S(e.overscaledZ,p,s.z,u,s.y).key]={backfilled:!1},T[new d.S(e.overscaledZ,w,s.z,v,s.y).key]={backfilled:!1},s.y>0&&(T[new d.S(e.overscaledZ,p,s.z,u,s.y-1).key]={backfilled:!1},T[new d.S(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},T[new d.S(e.overscaledZ,w,s.z,v,s.y-1).key]={backfilled:!1}),s.y+1<l&&(T[new d.S(e.overscaledZ,p,s.z,u,s.y+1).key]={backfilled:!1},T[new d.S(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},T[new d.S(e.overscaledZ,w,s.z,v,s.y+1).key]={backfilled:!1}),T}unloadTile(e){return d._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class En extends d.E{constructor(e,s,l,u){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(u),this._data=s.data,this._options=d.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const p=d.X/this.tileSize;s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*p,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*p,extent:d.X,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:d.X,radius:(s.clusterRadius||50)*p,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return d._(this,void 0,void 0,function*(){const e=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,s,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:s,offset:l}})}_updateWorkerData(e){return d._(this,void 0,void 0,function*(){const s=d.e({type:this.type},this.workerOptions);e?s.dataDiff=e:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(Q.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new d.k("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new d.k("dataabort",{dataType:"source"}));let u=null;l.resourceTiming&&l.resourceTiming[this.id]&&(u=l.resourceTiming[this.id].slice(0));const p={dataType:"source"};this._collectResourceTiming&&u&&u.length>0&&d.e(p,{resourceTiming:u}),this.fire(new d.k("data",Object.assign(Object.assign({},p),{sourceDataType:"metadata"}))),this.fire(new d.k("data",Object.assign(Object.assign({},p),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new d.k("dataabort",{dataType:"source"}));this.fire(new d.j(l))}})}loaded(){return this._pendingLoads===0}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const u=yield this.actor.sendAsync({type:s,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(u,this.map.painter,s==="RT")})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ai=d.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Wr extends d.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=s}load(e){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield he.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,e&&(this.coordinates=e),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new d.j(s))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const s=e.map(d.Z.fromLngLat);this.tileID=function(u){let p=1/0,v=1/0,w=-1/0,T=-1/0;for(const F of u)p=Math.min(p,F.x),v=Math.min(v,F.y),w=Math.max(w,F.x),T=Math.max(T,F.y);const P=Math.max(w-p,T-v),M=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),z=Math.pow(2,M);return new d.a1(M,Math.floor((p+w)/2*z),Math.floor((v+T)/2*z))}(s),this.minzoom=this.maxzoom=this.tileID.z;const l=s.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new d.$,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,d.X,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,d.X),this._boundsArray.emplaceBack(l[2].x,l[2].y,d.X,d.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Ai.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new wt(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,l=!0)}l&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Un extends Wr{constructor(e,s,l,u){super(e,s,l,u),this.roundZoom=!0,this.type="video",this.options=s}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield d.a3(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new d.j(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new d.j(new d.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Ai.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new wt(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,l=!0)}l&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Mr extends Wr{constructor(e,s,l,u){super(e,s,l,u),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(v=>typeof v!="number"))||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new d.j(new d.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,l=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Ai.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new wt(s,this.canvas,l.RGBA,{premultiply:!0});let u=!1;for(const p in this.tiles){const v=this.tiles[p];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const gs={},_s=f=>{switch(f){case"geojson":return En;case"image":return Wr;case"raster":return Ct;case"raster-dem":return tr;case"vector":return Vn;case"video":return Un;case"canvas":return Mr}return gs[f]},ke="RTLPluginLoaded";class an extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ms()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return d._(this,arguments,void 0,function*(s,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Q.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.k(ke))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let kr=null;function yr(){return kr||(kr=new an),kr}class gi{constructor(e,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=d.a4(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,p){const v={};if(!p)return v;for(const w of u){const T=w.layerIds.map(P=>p.getLayer(P)).filter(Boolean);if(T.length!==0){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(P=>T.filter(M=>M.id===P)[0]));for(const P of T)v[P.id]=w}}return v}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof d.a6){if(this.hasSymbolBuckets=!0,!l)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof d.a6&&p.hasRTLText){this.hasRTLText=!0,yr().lazyLoad();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(u).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new d.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new wt(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new wt(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,l,u,p,v,w,T,P,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:p,scale:v,tileSize:this.tileSize,pixelPosMatrix:M,transform:T,params:w,queryPadding:this.queryPadding*P},e,s,l):{}}querySourceFeatures(e,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),p=s&&s.sourceLayer?s.sourceLayer:"",v=u._geojsonTileLayer||u[p];if(!v)return;const w=d.a7(s&&s.filter),{z:T,x:P,y:M}=this.tileID.canonical,z={z:T,x:P,y:M};for(let F=0;F<v.length;F++){const j=v.feature(F);if(w.needGeometry){const K=d.a8(j,!0);if(!w.filter(new d.z(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!w.filter(new d.z(this.tileID.overscaledZ),j))continue;const V=l.getId(j,p),H=new d.a9(j,T,P,M,V);H.tile=z,e.push(H)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const l=d.aa(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const p=this.expirationTime-s;p?this.expirationTime=l+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!s.style.hasLayer(u))continue;const p=this.buckets[u],v=p.layers[0].sourceLayer||"_geojsonTileLayer",w=l[v],T=e[v];if(!w||!T||Object.keys(T).length===0)continue;p.update(T,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const P=s&&s.style&&s.style.getLayer(u);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Q.now()+e}setDependencies(e,s){const l={};for(const u of s)l[u]=!0;this.dependencies[e]=l}hasDependency(e,s){for(const l of e){const u=this.dependencies[l];if(u){for(const p of s)if(u[p])return!0}}return!1}}class Ee{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,l){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const p={value:s,timeout:void 0};if(l!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},l)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const l=e.wrapped().key,u=s===void 0?0:this.data[l].indexOf(s),p=this.data[l][u];return this.data[l].splice(u,1),p.timeout&&clearTimeout(p.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(p.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||s.push(u);for(const l of s)this.remove(l.value.tileID,l)}}class yt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,l){const u=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},d.e(this.stateChanges[e][u],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==u&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const p in this.state[e][u])l[p]||(this.deletedStates[e][u][p]=null)}else for(const p in l)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][p]===null&&delete this.deletedStates[e][u][p]}removeFeatureState(e,s,l){if(this.deletedStates[e]===null)return;const u=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&s!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,s){const l=String(s),u=d.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][s];if(p===null)return{};for(const v in p)delete u[v]}return u}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const v in this.stateChanges[u])this.state[u][v]||(this.state[u][v]={}),d.e(this.state[u][v],this.stateChanges[u][v]),p[v]=this.state[u][v];l[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(this.deletedStates[u]===null)for(const v in this.state[u])p[v]={},this.state[u][v]={};else for(const v in this.deletedStates[u]){if(this.deletedStates[u][v]===null)this.state[u][v]={};else for(const w of Object.keys(this.deletedStates[u][v]))delete this.state[u][v][w];p[v]=this.state[u][v]}l[u]=l[u]||{},d.e(l[u],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in e)e[u].setFeatureState(l,s)}}class lt extends d.E{constructor(e,s,l){super(),this.id=e,this.dispatcher=l,this.on("data",u=>this._dataHandler(u)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((u,p,v,w)=>{const T=new(_s(p.type))(u,p,v,w);if(T.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${T.id}`);return T})(e,s,l,this),this._tiles={},this._cache=new Ee(0,u=>this._unloadTile(u)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new yt,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s,l){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,s,l)}catch(u){e.state="errored",u.status!==404?this._source.fire(new d.j(u,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new d.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Lr).map(e=>e.key)}getRenderableIds(e){const s=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&s.push(this._tiles[l]);return e?s.sort((l,u)=>{const p=l.tileID,v=u.tileID,w=new d.P(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),T=new d.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-v.overscaledZ||T.y-w.y||T.x-w.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(Lr).map(l=>l.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){return d._(this,void 0,void 0,function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=s),yield this._loadTile(l,e,s))})}_tileLoaded(e,s,l){e.timeAdded=Q.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new d.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const p=s[u];if(e.neighboringTiles&&e.neighboringTiles[p]){const v=this.getTileByID(p);l(e,v),l(v,e)}}function l(u,p){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let v=p.tileID.canonical.x-u.tileID.canonical.x;const w=p.tileID.canonical.y-u.tileID.canonical.y,T=Math.pow(2,u.tileID.canonical.z),P=p.tileID.key;v===0&&w===0||Math.abs(w)>1||(Math.abs(v)>1&&(Math.abs(v+T)===1?v+=T:Math.abs(v-T)===1&&(v-=T)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,v,w),u.neighboringTiles&&u.neighboringTiles[P]&&(u.neighboringTiles[P].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,l,u){for(const p in this._tiles){let v=this._tiles[p];if(u[p]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>l)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const P=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[P.key],v&&v.hasData()&&(w=P)}let T=w;for(;T.overscaledZ>s;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]){u[w.key]=w;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=e.overscaledZ-1;l>=s;l--){const u=e.scaledTo(l),p=this._getLoadedTile(u);if(p)return p}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,u=Math.floor(s*l*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(p)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const l={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),l[p.tileID.key]=p}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}_updateCoveredAndRetainedTiles(e,s,l,u,p,v){const w={},T={},P=Object.keys(e),M=Q.now();for(const z of P){const F=e[z],j=this._tiles[z];if(!j||j.fadeEndTime!==0&&j.fadeEndTime<=M)continue;const V=this.findLoadedParent(F,s),H=this.findLoadedSibling(F),K=V||H||null;K&&(this._addTile(K.tileID),w[K.tileID.key]=K.tileID),T[z]=F}this._retainLoadedChildren(T,u,l,e);for(const z in w)e[z]||(this._coveredTiles[z]=!0,e[z]=w[z]);if(v){const z={},F={};for(const j of p)this._tiles[j.key].hasData()?z[j.key]=j:F[j.key]=j;for(const j in F){const V=F[j].children(this._source.maxzoom);this._tiles[V[0].key]&&this._tiles[V[1].key]&&this._tiles[V[2].key]&&this._tiles[V[3].key]&&(z[V[0].key]=e[V[0].key]=V[0],z[V[1].key]=e[V[1].key]=V[1],z[V[2].key]=e[V[2].key]=V[2],z[V[3].key]=e[V[3].key]=V[3],delete F[j])}for(const j in F){const V=F[j],H=this.findLoadedParent(V,this._source.minzoom),K=this.findLoadedSibling(V),J=H||K||null;if(J){z[J.tileID.key]=e[J.tileID.key]=J.tileID;for(const re in z)z[re].isChildOf(J.tileID)&&delete z[re]}}for(const j in this._tiles)z[j]||(this._coveredTiles[j]=!0)}}update(e,s){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=s,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new d.S(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(l=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(l=l.filter(M=>this._source.hasTile(M)))):l=[];const u=e.coveringZoomLevel(this._source),p=Math.max(u-lt.maxOverzooming,this._source.minzoom),v=Math.max(u+lt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const z of l)if(z.canonical.z>this._source.minzoom){const F=z.scaledTo(z.canonical.z-1);M[F.key]=F;const j=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));M[j.key]=j}l=l.concat(Object.values(M))}const w=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new d.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=this._updateRetainedTiles(l,u);_i(this._source.type)&&this._updateCoveredAndRetainedTiles(T,p,v,u,l,s);for(const M in T)this._tiles[M].clearFadeHold();const P=d.ab(this._tiles,T);for(const M of P){const z=this._tiles[M];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){var l;const u={},p={},v=Math.max(s-lt.maxOverzooming,this._source.minzoom),w=Math.max(s+lt.maxUnderzooming,this._source.minzoom),T={};for(const P of e){const M=this._addTile(P);u[P.key]=P,M.hasData()||s<this._source.maxzoom&&(T[P.key]=P)}this._retainLoadedChildren(T,s,w,u);for(const P of e){let M=this._tiles[P.key];if(M.hasData())continue;if(s+1>this._source.maxzoom){const F=P.children(this._source.maxzoom)[0],j=this.getTile(F);if(j&&j.hasData()){u[F.key]=F;continue}}else{const F=P.children(this._source.maxzoom);if(u[F[0].key]&&u[F[1].key]&&u[F[2].key]&&u[F[3].key])continue}let z=M.wasRequested();for(let F=P.overscaledZ-1;F>=v;--F){const j=P.scaledTo(F);if(p[j.key])break;if(p[j.key]=!0,M=this.getTile(j),!M&&z&&(M=this._addTile(j)),M){const V=M.hasData();if((V||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||z)&&(u[j.key]=j),z=M.wasRequested(),V)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}s.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(p),l)break;u=p}for(const p of s)this._loadedParentTiles[p]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const s=this._tiles[e].tileID,l=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=l}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const l=s;return s||(s=new gi(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,e.key,s.state)),s.uses++,this._tiles[e.key]=s,l||this._source.fire(new d.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=s.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(e){const s=e.sourceDataType;e.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,l){const u=[],p=this.transform;if(!p)return u;const v=l?p.getCameraQueryGeometry(e):e,w=e.map(V=>p.pointCoordinate(V,this.terrain)),T=v.map(V=>p.pointCoordinate(V,this.terrain)),P=this.getIds();let M=1/0,z=1/0,F=-1/0,j=-1/0;for(const V of T)M=Math.min(M,V.x),z=Math.min(z,V.y),F=Math.max(F,V.x),j=Math.max(j,V.y);for(let V=0;V<P.length;V++){const H=this._tiles[P[V]];if(H.holdingForFade())continue;const K=H.tileID,J=Math.pow(2,p.zoom-H.tileID.overscaledZ),re=s*H.queryPadding*d.X/H.tileSize/J,q=[K.getTilePoint(new d.Z(M,z)),K.getTilePoint(new d.Z(F,j))];if(q[0].x-re<d.X&&q[0].y-re<d.X&&q[1].x+re>=0&&q[1].y+re>=0){const ae=w.map(pe=>K.getTilePoint(pe)),le=T.map(pe=>K.getTilePoint(pe));u.push({tile:H,tileID:K,queryGeometry:ae,cameraQueryGeometry:le,scale:J})}}return u}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of s)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(_i(this._source.type)){const e=Q.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=e)return!0}return!1}setFeatureState(e,s,l){this._state.updateState(e=e||"_geojsonTileLayer",s,l)}removeFeatureState(e,s,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,l)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,l){const u=this._tiles[e];u&&u.setDependencies(s,l)}reloadTilesForDependencies(e,s){for(const l in this._tiles)this._tiles[l].hasDependency(e,s)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(e,s))}}function Lr(f,e){const s=Math.abs(2*f.wrap)-+(f.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return f.overscaledZ-e.overscaledZ||l-s||e.canonical.y-f.canonical.y||e.canonical.x-f.canonical.x}function _i(f){return f==="raster"||f==="image"||f==="video"}lt.maxOverzooming=10,lt.maxUnderzooming=3;class mt{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=d.ac(e,0,1);let s=1,l=this._distances[s];const u=e*this.paddedLength+this.padding;for(;l<u&&s<this._distances.length;)l=this._distances[++s];const p=s-1,v=this._distances[p],w=l-v,T=w>0?(u-v)/w:0;return this.points[p].mult(1-T).add(this.points[s].mult(T))}}function Ie(f,e){let s=!0;return f==="always"||f!=="never"&&e!=="never"||(s=!1),s}class ct{constructor(e,s,l){const u=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(s/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)u.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,l,u,p){this._forEachCell(s,l,u,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(p)}insertCircle(e,s,l,u){this._forEachCell(s-u,l-u,s+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(l),this.circles.push(u)}_insertBoxCell(e,s,l,u,p,v){this.boxCells[p].push(v)}_insertCircleCell(e,s,l,u,p,v){this.circleCells[p].push(v)}_query(e,s,l,u,p,v,w){if(l<0||e>this.width||u<0||s>this.height)return[];const T=[];if(e<=0&&s<=0&&this.width<=l&&this.height<=u){if(p)return[{key:null,x1:e,y1:s,x2:l,y2:u}];for(let P=0;P<this.boxKeys.length;P++)T.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const M=this.circles[3*P],z=this.circles[3*P+1],F=this.circles[3*P+2];T.push({key:this.circleKeys[P],x1:M-F,y1:z-F,x2:M+F,y2:z+F})}}else this._forEachCell(e,s,l,u,this._queryCell,T,{hitTest:p,overlapMode:v,seenUids:{box:{},circle:{}}},w);return T}query(e,s,l,u){return this._query(e,s,l,u,!1,null)}hitTest(e,s,l,u,p,v){return this._query(e,s,l,u,!0,p,v).length>0}hitTestCircle(e,s,l,u,p){const v=e-l,w=e+l,T=s-l,P=s+l;if(w<0||v>this.width||P<0||T>this.height)return!1;const M=[];return this._forEachCell(v,T,w,P,this._queryCellCircle,M,{hitTest:!0,overlapMode:u,circle:{x:e,y:s,radius:l},seenUids:{box:{},circle:{}}},p),M.length>0}_queryCell(e,s,l,u,p,v,w,T){const{seenUids:P,hitTest:M,overlapMode:z}=w,F=this.boxCells[p];if(F!==null){const V=this.bboxes;for(const H of F)if(!P.box[H]){P.box[H]=!0;const K=4*H,J=this.boxKeys[H];if(e<=V[K+2]&&s<=V[K+3]&&l>=V[K+0]&&u>=V[K+1]&&(!T||T(J))&&(!M||!Ie(z,J.overlapMode))&&(v.push({key:J,x1:V[K],y1:V[K+1],x2:V[K+2],y2:V[K+3]}),M))return!0}}const j=this.circleCells[p];if(j!==null){const V=this.circles;for(const H of j)if(!P.circle[H]){P.circle[H]=!0;const K=3*H,J=this.circleKeys[H];if(this._circleAndRectCollide(V[K],V[K+1],V[K+2],e,s,l,u)&&(!T||T(J))&&(!M||!Ie(z,J.overlapMode))){const re=V[K],q=V[K+1],ae=V[K+2];if(v.push({key:J,x1:re-ae,y1:q-ae,x2:re+ae,y2:q+ae}),M)return!0}}}return!1}_queryCellCircle(e,s,l,u,p,v,w,T){const{circle:P,seenUids:M,overlapMode:z}=w,F=this.boxCells[p];if(F!==null){const V=this.bboxes;for(const H of F)if(!M.box[H]){M.box[H]=!0;const K=4*H,J=this.boxKeys[H];if(this._circleAndRectCollide(P.x,P.y,P.radius,V[K+0],V[K+1],V[K+2],V[K+3])&&(!T||T(J))&&!Ie(z,J.overlapMode))return v.push(!0),!0}}const j=this.circleCells[p];if(j!==null){const V=this.circles;for(const H of j)if(!M.circle[H]){M.circle[H]=!0;const K=3*H,J=this.circleKeys[H];if(this._circlesCollide(V[K],V[K+1],V[K+2],P.x,P.y,P.radius)&&(!T||T(J))&&!Ie(z,J.overlapMode))return v.push(!0),!0}}}_forEachCell(e,s,l,u,p,v,w,T){const P=this._convertToXCellCoord(e),M=this._convertToYCellCoord(s),z=this._convertToXCellCoord(l),F=this._convertToYCellCoord(u);for(let j=P;j<=z;j++)for(let V=M;V<=F;V++)if(p.call(this,e,s,l,u,this.xCellCount*V+j,v,w,T))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,l,u,p,v){const w=u-e,T=p-s,P=l+v;return P*P>w*w+T*T}_circleAndRectCollide(e,s,l,u,p,v,w){const T=(v-u)/2,P=Math.abs(e-(u+T));if(P>T+l)return!1;const M=(w-p)/2,z=Math.abs(s-(p+M));if(z>M+l)return!1;if(P<=T||z<=M)return!0;const F=P-T,j=z-M;return F*F+j*j<=l*l}}function bt(f,e,s,l,u){const p=d.H();return e?(d.K(p,p,[1/u,1/u,1]),s||d.ad(p,p,l.angle)):d.L(p,l.labelPlaneMatrix,f),p}function Ut(f,e,s,l,u){if(e){const p=d.ae(f);return d.K(p,p,[u,u,1]),s||d.ad(p,p,-l.angle),p}return l.glCoordMatrix}function $(f,e,s,l){let u;l?(u=[f,e,l(f,e),1],d.af(u,u,s)):(u=[f,e,0,1],At(u,u,s));const p=u[3];return{point:new d.P(u[0]/p,u[1]/p),signedDistanceFromCamera:p,isOccluded:!1}}function D(f,e){return .5+f/e*.5}function L(f,e){return f.x>=-e[0]&&f.x<=e[0]&&f.y>=-e[1]&&f.y<=e[1]}function O(f,e,s,l,u,p,v,w,T,P,M,z,F,j,V){const H=l?f.textSizeData:f.iconSizeData,K=d.ag(H,s.transform.zoom),J=[256/s.width*2+1,256/s.height*2+1],re=l?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;re.clear();const q=f.lineVertexArray,ae=l?f.text.placedSymbolArray:f.icon.placedSymbolArray,le=s.transform.width/s.transform.height;let pe=!1;for(let xe=0;xe<ae.length;xe++){const Te=ae.get(xe);if(Te.hidden||Te.writingMode===d.ah.vertical&&!pe){nt(Te.numGlyphs,re);continue}pe=!1;const Oe=$(Te.anchorX,Te.anchorY,e,V);if(!L(Oe.point,J)){nt(Te.numGlyphs,re);continue}const $e=D(s.transform.cameraToCenterDistance,Oe.signedDistanceFromCamera),Le=d.ai(H,K,Te),Ae=v?Le/$e:Le*$e,Je={getElevation:V,labelPlaneMatrix:u,lineVertexArray:q,pitchWithMap:v,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:P,tileAnchorPoint:new d.P(Te.anchorX,Te.anchorY),unwrappedTileID:M,width:z,height:F,translation:j},ft=se(Je,Te,Ae,!1,w,e,p,f.glyphOffsetArray,re,le,T);pe=ft.useVertical,(ft.notEnoughRoom||pe||ft.needsFlipping&&se(Je,Te,Ae,!0,w,e,p,f.glyphOffsetArray,re,le,T).notEnoughRoom)&&nt(Te.numGlyphs,re)}l?f.text.dynamicLayoutVertexBuffer.updateData(re):f.icon.dynamicLayoutVertexBuffer.updateData(re)}function Z(f,e,s,l,u,p,v,w){const T=p.glyphStartIndex+p.numGlyphs,P=p.lineStartIndex,M=p.lineStartIndex+p.lineLength,z=e.getoffsetX(p.glyphStartIndex),F=e.getoffsetX(T-1),j=ze(f*z,s,l,u,p.segment,P,M,w,v);if(!j)return null;const V=ze(f*F,s,l,u,p.segment,P,M,w,v);return V?w.projectionCache.anyProjectionOccluded?null:{first:j,last:V}:null}function te(f,e,s,l){return f===d.ah.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*l?{useVertical:!0}:(f===d.ah.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function se(f,e,s,l,u,p,v,w,T,P,M){const z=s/24,F=e.lineOffsetX*z,j=e.lineOffsetY*z;let V;if(e.numGlyphs>1){const H=e.glyphStartIndex+e.numGlyphs,K=e.lineStartIndex,J=e.lineStartIndex+e.lineLength,re=Z(z,w,F,j,l,e,M,f);if(!re)return{notEnoughRoom:!0};const q=$(re.first.point.x,re.first.point.y,v,f.getElevation).point,ae=$(re.last.point.x,re.last.point.y,v,f.getElevation).point;if(u&&!l){const le=te(e.writingMode,q,ae,P);if(le)return le}V=[re.first];for(let le=e.glyphStartIndex+1;le<H-1;le++)V.push(ze(z*w.getoffsetX(le),F,j,l,e.segment,K,J,f,M));V.push(re.last)}else{if(u&&!l){const K=$(f.tileAnchorPoint.x,f.tileAnchorPoint.y,p,f.getElevation).point,J=e.lineStartIndex+e.segment+1,re=new d.P(f.lineVertexArray.getx(J),f.lineVertexArray.gety(J)),q=$(re.x,re.y,p,f.getElevation),ae=q.signedDistanceFromCamera>0?q.point:function(pe,xe,Te,Oe,$e,Le){return ce(pe,xe,Te,1,$e,Le)}(f.tileAnchorPoint,re,K,0,p,f),le=te(e.writingMode,K,ae,P);if(le)return le}const H=ze(z*w.getoffsetX(e.glyphStartIndex),F,j,l,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,f,M);if(!H||f.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};V=[H]}for(const H of V)d.aj(T,H.point,H.angle);return{}}function ce(f,e,s,l,u,p){const v=f.add(f.sub(e)._unit()),w=u!==void 0?$(v.x,v.y,u,p.getElevation).point:_e(v.x,v.y,p).point,T=s.sub(w);return s.add(T._mult(l/T.mag()))}function Y(f,e,s){const l=e.projectionCache;if(l.projections[f])return l.projections[f];const u=new d.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),p=_e(u.x,u.y,e);if(p.signedDistanceFromCamera>0)return l.projections[f]=p.point,l.anyProjectionOccluded=l.anyProjectionOccluded||p.isOccluded,p.point;const v=f-s.direction;return function(w,T,P,M,z){return ce(w,T,P,M,void 0,z)}(s.distanceFromAnchor===0?e.tileAnchorPoint:new d.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),u,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,e)}function _e(f,e,s){const l=f+s.translation[0],u=e+s.translation[1];let p;return!s.pitchWithMap&&s.projection.useSpecialProjectionForSymbols?(p=s.projection.projectTileCoordinates(l,u,s.unwrappedTileID,s.getElevation),p.point.x=(.5*p.point.x+.5)*s.width,p.point.y=(.5*-p.point.y+.5)*s.height):(p=$(l,u,s.labelPlaneMatrix,s.getElevation),p.isOccluded=!1),p}function we(f,e,s){return f._unit()._perp()._mult(e*s)}function fe(f,e,s,l,u,p,v,w,T){if(w.projectionCache.offsets[f])return w.projectionCache.offsets[f];const P=s.add(e);if(f+T.direction<l||f+T.direction>=u)return w.projectionCache.offsets[f]=P,P;const M=Y(f+T.direction,w,T),z=we(M.sub(s),v,T.direction),F=s.add(z),j=M.add(z);return w.projectionCache.offsets[f]=d.ak(p,P,F,j)||P,w.projectionCache.offsets[f]}function ze(f,e,s,l,u,p,v,w,T){const P=l?f-e:f+e;let M=P>0?1:-1,z=0;l&&(M*=-1,z=Math.PI),M<0&&(z+=Math.PI);let F,j=M>0?p+u:p+u+1;w.projectionCache.cachedAnchorPoint?F=w.projectionCache.cachedAnchorPoint:(F=_e(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=F);let V,H,K=F,J=F,re=0,q=0;const ae=Math.abs(P),le=[];let pe;for(;re+q<=ae;){if(j+=M,j<p||j>=v)return null;re+=q,J=K,H=V;const Oe={absOffsetX:ae,direction:M,distanceFromAnchor:re,previousVertex:J};if(K=Y(j,w,Oe),s===0)le.push(J),pe=K.sub(J);else{let $e;const Le=K.sub(J);$e=Le.mag()===0?we(Y(j+M,w,Oe).sub(K),s,M):we(Le,s,M),H||(H=J.add($e)),V=fe(j,$e,K,p,v,H,s,w,Oe),le.push(H),pe=V.sub(H)}q=pe.mag()}const xe=pe._mult((ae-re)/q)._add(H||J),Te=z+Math.atan2(K.y-J.y,K.x-J.x);return le.push(xe),{point:xe,angle:T?Te:0,path:le}}const tt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function nt(f,e){for(let s=0;s<f;s++){const l=e.length;e.resize(l+4),e.float32.set(tt,3*l)}}function At(f,e,s){const l=e[0],u=e[1];return f[0]=s[0]*l+s[4]*u+s[12],f[1]=s[1]*l+s[5]*u+s[13],f[3]=s[3]*l+s[7]*u+s[15],f}const gt=100;class Dt{constructor(e,s,l=new ct(e.width+200,e.height+200,25),u=new ct(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=s,this.grid=l,this.ignoredGrid=u,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+gt,this.screenBottomBoundary=e.height+gt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,l,u,p,v,w,T,P,M,z){const F=e.anchorPointX+T[0],j=e.anchorPointY+T[1],V=this.projectAndGetPerspectiveRatio(u,F,j,p,M),H=l*V.perspectiveRatio;let K;if(v||w)K=this._projectCollisionBox(e,H,u,p,v,w,T,V,M,z);else{const le=V.point.x+(z?z.x*H:0),pe=V.point.y+(z?z.y*H:0);K={allPointsOccluded:!1,box:[le+e.x1*H,pe+e.y1*H,le+e.x2*H,pe+e.y2*H]}}const[J,re,q,ae]=K.box;return this.mapProjection.useSpecialProjectionForSymbols&&(v?K.allPointsOccluded:this.mapProjection.isOccluded(F,j,p))||V.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(J,re,q,ae)||s!=="always"&&this.grid.hitTest(J,re,q,ae,s,P)?{box:[J,re,q,ae],placeable:!1,offscreen:!1}:{box:[J,re,q,ae],placeable:!0,offscreen:this.isOffscreen(J,re,q,ae)}}placeCollisionCircles(e,s,l,u,p,v,w,T,P,M,z,F,j,V,H,K){const J=[],re=new d.P(s.anchorX,s.anchorY),q=this.getPerspectiveRatio(v,re.x,re.y,w,K),ae=(z?p/q:p*q)/d.ap,le={getElevation:K,labelPlaneMatrix:T,lineVertexArray:l,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:re,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:H},pe=Z(ae,u,s.lineOffsetX*ae,s.lineOffsetY*ae,!1,s,!1,le);let xe=!1,Te=!1,Oe=!0;if(pe){const $e=.5*j*q+V,Le=new d.P(-100,-100),Ae=new d.P(this.screenRightBoundary,this.screenBottomBoundary),Je=new mt,ft=pe.first,Fe=pe.last;let je=[];for(let xt=ft.path.length-1;xt>=1;xt--)je.push(ft.path[xt]);for(let xt=1;xt<Fe.path.length;xt++)je.push(Fe.path[xt]);const dt=2.5*$e;if(P){const xt=this.projectPathToScreenSpace(je,le,P);je=xt.some(Pt=>Pt.signedDistanceFromCamera<=0)?[]:xt.map(Pt=>Pt.point)}let ir=[];if(je.length>0){const xt=je[0].clone(),Pt=je[0].clone();for(let nr=1;nr<je.length;nr++)xt.x=Math.min(xt.x,je[nr].x),xt.y=Math.min(xt.y,je[nr].y),Pt.x=Math.max(Pt.x,je[nr].x),Pt.y=Math.max(Pt.y,je[nr].y);ir=xt.x>=Le.x&&Pt.x<=Ae.x&&xt.y>=Le.y&&Pt.y<=Ae.y?[je]:Pt.x<Le.x||xt.x>Ae.x||Pt.y<Le.y||xt.y>Ae.y?[]:d.al([je],Le.x,Le.y,Ae.x,Ae.y)}for(const xt of ir){Je.reset(xt,.25*$e);let Pt=0;Pt=Je.length<=.5*$e?1:Math.ceil(Je.paddedLength/dt)+1;for(let nr=0;nr<Pt;nr++){const Kr=nr/Math.max(Pt-1,1),dn=Je.lerp(Kr),sr=dn.x+gt,xi=dn.y+gt;J.push(sr,xi,$e,0);const li=sr-$e,Jr=xi-$e,ui=sr+$e,zn=xi+$e;if(Oe=Oe&&this.isOffscreen(li,Jr,ui,zn),Te=Te||this.isInsideGrid(li,Jr,ui,zn),e!=="always"&&this.grid.hitTestCircle(sr,xi,$e,e,F)&&(xe=!0,!M))return{circles:[],offscreen:!1,collisionDetected:xe}}}}return{circles:!M&&xe||!Te||q<this.perspectiveRatioCutoff?[]:J,offscreen:Oe,collisionDetected:xe}}projectPathToScreenSpace(e,s,l){return e.map(u=>$(u.x,u.y,l,s.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let l=1/0,u=1/0,p=-1/0,v=-1/0;for(const M of e){const z=new d.P(M.x+gt,M.y+gt);l=Math.min(l,z.x),u=Math.min(u,z.y),p=Math.max(p,z.x),v=Math.max(v,z.y),s.push(z)}const w=this.grid.query(l,u,p,v).concat(this.ignoredGrid.query(l,u,p,v)),T={},P={};for(const M of w){const z=M.key;if(T[z.bucketInstanceId]===void 0&&(T[z.bucketInstanceId]={}),T[z.bucketInstanceId][z.featureIndex])continue;const F=[new d.P(M.x1,M.y1),new d.P(M.x2,M.y1),new d.P(M.x2,M.y2),new d.P(M.x1,M.y2)];d.am(s,F)&&(T[z.bucketInstanceId][z.featureIndex]=!0,P[z.bucketInstanceId]===void 0&&(P[z.bucketInstanceId]=[]),P[z.bucketInstanceId].push(z.featureIndex))}return P}insertCollisionBox(e,s,l,u,p,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:v,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,l,u,p,v){const w=l?this.ignoredGrid:this.grid,T={bucketInstanceId:u,featureIndex:p,collisionGroupID:v,overlapMode:s};for(let P=0;P<e.length;P+=4)w.insertCircle(T,e[P],e[P+1],e[P+2])}projectAndGetPerspectiveRatio(e,s,l,u,p){let v;p?(v=[s,l,p(s,l),1],d.af(v,v,e)):(v=[s,l,0,1],At(v,v,e));const w=v[3];return{point:new d.P((v[0]/w+1)/2*this.transform.width+gt,(-v[1]/w+1)/2*this.transform.height+gt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}getPerspectiveRatio(e,s,l,u,p){const v=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,l,u,p):$(s,l,e,p);return .5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5}isOffscreen(e,s,l,u){return l<gt||e>=this.screenRightBoundary||u<gt||s>this.screenBottomBoundary}isInsideGrid(e,s,l,u){return l>=0&&e<this.gridRightBoundary&&u>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=d.an([]);return d.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,s,l,u,p,v,w,T,P,M){let z=new d.P(1,0),F=new d.P(0,1);const j=new d.P(e.anchorPointX+w[0],e.anchorPointY+w[1]);if(v&&!p){const Oe=this.projectAndGetPerspectiveRatio(l,j.x+1,j.y,u,P).point.sub(T.point).unit(),$e=Math.atan(Oe.y/Oe.x)+(Oe.x<0?Math.PI:0),Le=Math.sin($e),Ae=Math.cos($e);z=new d.P(Ae,Le),F=new d.P(-Le,Ae)}else if(!v&&p){const Oe=-this.transform.angle,$e=Math.sin(Oe),Le=Math.cos(Oe);z=new d.P(Le,$e),F=new d.P(-$e,Le)}let V=T.point,H=s;if(p){V=j;const Oe=this.transform.zoom-Math.floor(this.transform.zoom);H=Math.pow(2,-Oe),H*=this.mapProjection.getPitchedTextCorrection(this.transform,j,u),M||(H*=d.ac(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}M&&(V=V.add(z.mult(M.x*H)).add(F.mult(M.y*H)));const K=e.x1*H,J=e.x2*H,re=(K+J)/2,q=e.y1*H,ae=e.y2*H,le=(q+ae)/2,pe=[{offsetX:K,offsetY:q},{offsetX:re,offsetY:q},{offsetX:J,offsetY:q},{offsetX:J,offsetY:le},{offsetX:J,offsetY:ae},{offsetX:re,offsetY:ae},{offsetX:K,offsetY:ae},{offsetX:K,offsetY:le}];let xe=[];for(const{offsetX:Oe,offsetY:$e}of pe)xe.push(new d.P(V.x+z.x*Oe+F.x*$e,V.y+z.y*Oe+F.y*$e));let Te=!1;if(p){const Oe=xe.map($e=>this.projectAndGetPerspectiveRatio(l,$e.x,$e.y,u,P));Te=Oe.some($e=>!$e.isOccluded),xe=Oe.map($e=>$e.point)}else Te=!0;return{box:d.ao(xe),allPointsOccluded:!Te}}}function Et(f,e,s){return e*(d.X/(f.tileSize*Math.pow(2,s-f.tileID.overscaledZ)))}class Ir{constructor(e,s,l,u){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class cr{constructor(e,s,l,u,p){this.text=new Ir(e?e.text:null,s,l,p),this.icon=new Ir(e?e.icon:null,s,u,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class St{constructor(e,s,l){this.text=e,this.icon=s,this.skipFade=l}}class Zt{constructor(){this.invProjMatrix=d.H(),this.viewportMatrix=d.H(),this.circles=[]}}class or{constructor(e,s,l,u,p){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=p}}class Rr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:l=>l.collisionGroupID===s}}return this.collisionGroups[e]}}function Vr(f,e,s,l,u){const{horizontalAlign:p,verticalAlign:v}=d.au(f);return new d.P(-(p-.5)*e+l[0]*u,-(v-.5)*s+l[1]*u)}class oi{constructor(e,s,l,u,p,v){this.transform=e.clone(),this.terrain=l,this.collisionIndex=new Dt(this.transform,s),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Rr(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const s=this.terrain;return s?(l,u)=>s.getElevation(e,l,u):null}getBucketParts(e,s,l,u){const p=l.getBucket(s),v=l.latestFeatureIndex;if(!p||!v||s.id!==p.layerIds[0])return;const w=l.collisionBoxArray,T=p.layers[0].layout,P=p.layers[0].paint,M=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),z=l.tileSize/d.X,F=l.tileID.toUnwrapped(),j=this.transform.calculatePosMatrix(F),V=T.get("text-pitch-alignment")==="map",H=T.get("text-rotation-alignment")==="map",K=Et(l,1,this.transform.zoom),J=this.collisionIndex.mapProjection.translatePosition(this.transform,l,P.get("text-translate"),P.get("text-translate-anchor")),re=this.collisionIndex.mapProjection.translatePosition(this.transform,l,P.get("icon-translate"),P.get("icon-translate-anchor")),q=bt(j,V,H,this.transform,K);let ae=null;if(V){const pe=Ut(j,V,H,this.transform,K);ae=d.L([],this.transform.labelPlaneMatrix,pe)}this.retainedQueryData[p.bucketInstanceId]=new or(p.bucketInstanceId,v,p.sourceLayerIndex,p.index,l.tileID);const le={bucket:p,layout:T,translationText:J,translationIcon:re,posMatrix:j,unwrappedTileID:F,textLabelPlaneMatrix:q,labelToScreenMatrix:ae,scale:M,textPixelRatio:z,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:d.ag(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(u)for(const pe of p.sortKeyRanges){const{sortKey:xe,symbolInstanceStart:Te,symbolInstanceEnd:Oe}=pe;e.push({sortKey:xe,symbolInstanceStart:Te,symbolInstanceEnd:Oe,parameters:le})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:le})}attemptAnchorPlacement(e,s,l,u,p,v,w,T,P,M,z,F,j,V,H,K,J,re,q){const ae=d.aq[e.textAnchor],le=[e.textOffset0,e.textOffset1],pe=Vr(ae,l,u,le,p),xe=this.collisionIndex.placeCollisionBox(s,F,T,P,M,w,v,K,z.predicate,q,pe);if((!re||this.collisionIndex.placeCollisionBox(re,F,T,P,M,w,v,J,z.predicate,q,pe).placeable)&&xe.placeable){let Te;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(Te=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:le,width:l,height:u,anchor:ae,textBoxScale:p,prevAnchor:Te},this.markUsedJustification(V,ae,j,H),V.allowVerticalPlacement&&(this.markUsedOrientation(V,H,j),this.placedOrientations[j.crossTileID]=H),{shift:pe,placedGlyphBoxes:xe}}}placeLayerBucketPart(e,s,l){const{bucket:u,layout:p,translationText:v,translationIcon:w,posMatrix:T,unwrappedTileID:P,textLabelPlaneMatrix:M,labelToScreenMatrix:z,textPixelRatio:F,holdingForFade:j,collisionBoxArray:V,partiallyEvaluatedTextSize:H,collisionGroup:K}=e.parameters,J=p.get("text-optional"),re=p.get("icon-optional"),q=d.ar(p,"text-overlap","text-allow-overlap"),ae=q==="always",le=d.ar(p,"icon-overlap","icon-allow-overlap"),pe=le==="always",xe=p.get("text-rotation-alignment")==="map",Te=p.get("text-pitch-alignment")==="map",Oe=p.get("icon-text-fit")!=="none",$e=p.get("symbol-z-order")==="viewport-y",Le=ae&&(pe||!u.hasIconData()||re),Ae=pe&&(ae||!u.hasTextData()||J);!u.collisionArrays&&V&&u.deserializeCollisionBoxes(V);const Je=this._getTerrainElevationFunc(this.retainedQueryData[u.bucketInstanceId].tileID),ft=(Fe,je,dt)=>{var ir,xt;if(s[Fe.crossTileID])return;if(j)return void(this.placements[Fe.crossTileID]=new St(!1,!1,!1));let Pt=!1,nr=!1,Kr=!0,dn=null,sr={box:null,placeable:!1,offscreen:null},xi={placeable:!1},li=null,Jr=null,ui=null,zn=0,da=0,ul=0;je.textFeatureIndex?zn=je.textFeatureIndex:Fe.useRuntimeCollisionCircles&&(zn=Fe.featureIndex),je.verticalTextFeatureIndex&&(da=je.verticalTextFeatureIndex);const pa=je.textBox;if(pa){const Ji=Ur=>{let Yr=d.ah.horizontal;if(u.allowVerticalPlacement&&!Ur&&this.prevPlacement){const Oi=this.prevPlacement.placedOrientations[Fe.crossTileID];Oi&&(this.placedOrientations[Fe.crossTileID]=Oi,Yr=Oi,this.markUsedOrientation(u,Yr,Fe))}return Yr},Yi=(Ur,Yr)=>{if(u.allowVerticalPlacement&&Fe.numVerticalGlyphVertices>0&&je.verticalTextBox){for(const Oi of u.writingModes)if(Oi===d.ah.vertical?(sr=Yr(),xi=sr):sr=Ur(),sr&&sr.placeable)break}else sr=Ur()},ns=Fe.textAnchorOffsetStartIndex,pn=Fe.textAnchorOffsetEndIndex;if(pn===ns){const Ur=(Yr,Oi)=>{const zt=this.collisionIndex.placeCollisionBox(Yr,q,F,T,P,Te,xe,v,K.predicate,Je);return zt&&zt.placeable&&(this.markUsedOrientation(u,Oi,Fe),this.placedOrientations[Fe.crossTileID]=Oi),zt};Yi(()=>Ur(pa,d.ah.horizontal),()=>{const Yr=je.verticalTextBox;return u.allowVerticalPlacement&&Fe.numVerticalGlyphVertices>0&&Yr?Ur(Yr,d.ah.vertical):{box:null,offscreen:null}}),Ji(sr&&sr.placeable)}else{let Ur=d.aq[(xt=(ir=this.prevPlacement)===null||ir===void 0?void 0:ir.variableOffsets[Fe.crossTileID])===null||xt===void 0?void 0:xt.anchor];const Yr=(zt,Ms,fa)=>{const ma=zt.x2-zt.x1,zh=zt.y2-zt.y1,Vp=Fe.textBoxScale,Ah=Oe&&le==="never"?Ms:null;let ss=null,Dh=q==="never"?1:2,hl="never";Ur&&Dh++;for(let uo=0;uo<Dh;uo++){for(let dl=ns;dl<pn;dl++){const pl=u.textAnchorOffsets.get(dl);if(Ur&&pl.textAnchor!==Ur)continue;const ga=this.attemptAnchorPlacement(pl,zt,ma,zh,Vp,xe,Te,F,T,P,K,hl,Fe,u,fa,v,w,Ah,Je);if(ga&&(ss=ga.placedGlyphBoxes,ss&&ss.placeable))return Pt=!0,dn=ga.shift,ss}Ur?Ur=null:hl=q}return l&&!ss&&(ss={box:this.collisionIndex.placeCollisionBox(pa,"always",F,T,P,Te,xe,v,K.predicate,Je,new d.P(0,0)).box,offscreen:!1,placeable:!1}),ss};Yi(()=>Yr(pa,je.iconBox,d.ah.horizontal),()=>{const zt=je.verticalTextBox;return u.allowVerticalPlacement&&(!sr||!sr.placeable)&&Fe.numVerticalGlyphVertices>0&&zt?Yr(zt,je.verticalIconBox,d.ah.vertical):{box:null,occluded:!0,offscreen:null}}),sr&&(Pt=sr.placeable,Kr=sr.offscreen);const Oi=Ji(sr&&sr.placeable);if(!Pt&&this.prevPlacement){const zt=this.prevPlacement.variableOffsets[Fe.crossTileID];zt&&(this.variableOffsets[Fe.crossTileID]=zt,this.markUsedJustification(u,zt.anchor,Fe,Oi))}}}if(li=sr,Pt=li&&li.placeable,Kr=li&&li.offscreen,Fe.useRuntimeCollisionCircles){const Ji=u.text.placedSymbolArray.get(Fe.centerJustifiedTextSymbolIndex),Yi=d.ai(u.textSizeData,H,Ji),ns=p.get("text-padding");Jr=this.collisionIndex.placeCollisionCircles(q,Ji,u.lineVertexArray,u.glyphOffsetArray,Yi,T,P,M,z,l,Te,K.predicate,Fe.collisionCircleDiameter,ns,v,Je),Jr.circles.length&&Jr.collisionDetected&&!l&&d.w("Collisions detected, but collision boxes are not shown"),Pt=ae||Jr.circles.length>0&&!Jr.collisionDetected,Kr=Kr&&Jr.offscreen}if(je.iconFeatureIndex&&(ul=je.iconFeatureIndex),je.iconBox){const Ji=Yi=>this.collisionIndex.placeCollisionBox(Yi,le,F,T,P,Te,xe,w,K.predicate,Je,Oe&&dn?dn:void 0);xi&&xi.placeable&&je.verticalIconBox?(ui=Ji(je.verticalIconBox),nr=ui.placeable):(ui=Ji(je.iconBox),nr=ui.placeable),Kr=Kr&&ui.offscreen}const Ki=J||Fe.numHorizontalGlyphVertices===0&&Fe.numVerticalGlyphVertices===0,cl=re||Fe.numIconVertices===0;Ki||cl?cl?Ki||(nr=nr&&Pt):Pt=nr&&Pt:nr=Pt=nr&&Pt;const Zu=nr&&ui.placeable;if(Pt&&li.placeable&&this.collisionIndex.insertCollisionBox(li.box,q,p.get("text-ignore-placement"),u.bucketInstanceId,xi&&xi.placeable&&da?da:zn,K.ID),Zu&&this.collisionIndex.insertCollisionBox(ui.box,le,p.get("icon-ignore-placement"),u.bucketInstanceId,ul,K.ID),Jr&&Pt&&this.collisionIndex.insertCollisionCircles(Jr.circles,q,p.get("text-ignore-placement"),u.bucketInstanceId,zn,K.ID),l&&this.storeCollisionData(u.bucketInstanceId,dt,je,li,ui,Jr),Fe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Fe.crossTileID]=new St(Pt||Le,nr||Ae,Kr||u.justReloaded),s[Fe.crossTileID]=!0};if($e){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Fe=u.getSortedSymbolIndexes(this.transform.angle);for(let je=Fe.length-1;je>=0;--je){const dt=Fe[je];ft(u.symbolInstances.get(dt),u.collisionArrays[dt],dt)}}else for(let Fe=e.symbolInstanceStart;Fe<e.symbolInstanceEnd;Fe++)ft(u.symbolInstances.get(Fe),u.collisionArrays[Fe],Fe);if(l&&u.bucketInstanceId in this.collisionCircleArrays){const Fe=this.collisionCircleArrays[u.bucketInstanceId];d.as(Fe.invProjMatrix,T),Fe.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}storeCollisionData(e,s,l,u,p,v){if(l.textBox||l.iconBox){let w,T;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(s)?T=w.get(s):(T={text:null,icon:null},w.set(s,T)),l.textBox&&(T.text=u.box),l.iconBox&&(T.icon=p.box)}if(v){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=new Zt);for(let T=0;T<v.circles.length;T+=4)w.circles.push(v.circles[T+0]),w.circles.push(v.circles[T+1]),w.circles.push(v.circles[T+2]),w.circles.push(v.collisionDetected?1:0)}}markUsedJustification(e,s,l,u){let p;p=u===d.ah.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[d.at(s)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of v)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=p>=0&&w!==p?0:l.crossTileID)}markUsedOrientation(e,s,l){const u=s===d.ah.horizontal||s===d.ah.horizontalOnly?s:0,p=s===d.ah.vertical?s:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of v)e.text.placedSymbolArray.get(w).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let l=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const u=s?s.symbolFadeChange(e):1,p=s?s.opacities:{},v=s?s.variableOffsets:{},w=s?s.placedOrientations:{};for(const T in this.placements){const P=this.placements[T],M=p[T];M?(this.opacities[T]=new cr(M,u,P.text,P.icon),l=l||P.text!==M.text.placed||P.icon!==M.icon.placed):(this.opacities[T]=new cr(null,u,P.text,P.icon,P.skipFade),l=l||P.text||P.icon)}for(const T in p){const P=p[T];if(!this.opacities[T]){const M=new cr(P,u,!1,!1);M.isHidden()||(this.opacities[T]=M,l=l||P.text.placed||P.icon.placed)}}for(const T in v)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=v[T]);for(const T in w)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=w[T]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const l={};for(const u of s){const p=u.getBucket(e);p&&u.latestFeatureIndex&&e.id===p.layerIds[0]&&this.updateBucketOpacities(p,u.tileID,l,u.collisionBoxArray)}}updateBucketOpacities(e,s,l,u){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const p=e.layers[0],v=p.layout,w=new cr(null,0,!1,!1,!0),T=v.get("text-allow-overlap"),P=v.get("icon-allow-overlap"),M=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=v.get("text-rotation-alignment")==="map",F=v.get("text-pitch-alignment")==="map",j=v.get("icon-text-fit")!=="none",V=new cr(null,0,T&&(P||!e.hasIconData()||v.get("icon-optional")),P&&(T||!e.hasTextData()||v.get("text-optional")),!0);!e.collisionArrays&&u&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(u);const H=(J,re,q)=>{for(let ae=0;ae<re/4;ae++)J.opacityVertexArray.emplaceBack(q);J.hasVisibleVertices=J.hasVisibleVertices||q!==Gs},K=this.collisionBoxArrays.get(e.bucketInstanceId);for(let J=0;J<e.symbolInstances.length;J++){const re=e.symbolInstances.get(J),{numHorizontalGlyphVertices:q,numVerticalGlyphVertices:ae,crossTileID:le}=re;let pe=this.opacities[le];l[le]?pe=w:pe||(pe=V,this.opacities[le]=pe),l[le]=!0;const xe=re.numIconVertices>0,Te=this.placedOrientations[re.crossTileID],Oe=Te===d.ah.vertical,$e=Te===d.ah.horizontal||Te===d.ah.horizontalOnly;if(q>0||ae>0){const Ae=Ri(pe.text);H(e.text,q,Oe?Gs:Ae),H(e.text,ae,$e?Gs:Ae);const Je=pe.text.isHidden();[re.rightJustifiedTextSymbolIndex,re.centerJustifiedTextSymbolIndex,re.leftJustifiedTextSymbolIndex].forEach(je=>{je>=0&&(e.text.placedSymbolArray.get(je).hidden=Je||Oe?1:0)}),re.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(re.verticalPlacedTextSymbolIndex).hidden=Je||$e?1:0);const ft=this.variableOffsets[re.crossTileID];ft&&this.markUsedJustification(e,ft.anchor,re,Te);const Fe=this.placedOrientations[re.crossTileID];Fe&&(this.markUsedJustification(e,"left",re,Fe),this.markUsedOrientation(e,Fe,re))}if(xe){const Ae=Ri(pe.icon),Je=!(j&&re.verticalPlacedIconSymbolIndex&&Oe);re.placedIconSymbolIndex>=0&&(H(e.icon,re.numIconVertices,Je?Ae:Gs),e.icon.placedSymbolArray.get(re.placedIconSymbolIndex).hidden=pe.icon.isHidden()),re.verticalPlacedIconSymbolIndex>=0&&(H(e.icon,re.numVerticalIconVertices,Je?Gs:Ae),e.icon.placedSymbolArray.get(re.verticalPlacedIconSymbolIndex).hidden=pe.icon.isHidden())}const Le=K&&K.has(J)?K.get(J):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Ae=e.collisionArrays[J];if(Ae){let Je=new d.P(0,0);if(Ae.textBox||Ae.verticalTextBox){let ft=!0;if(M){const Fe=this.variableOffsets[le];Fe?(Je=Vr(Fe.anchor,Fe.width,Fe.height,Fe.textOffset,Fe.textBoxScale),z&&Je._rotate(F?this.transform.angle:-this.transform.angle)):ft=!1}if(Ae.textBox||Ae.verticalTextBox){let Fe;Ae.textBox&&(Fe=Oe),Ae.verticalTextBox&&(Fe=$e),qs(e.textCollisionBox.collisionVertexArray,pe.text.placed,!ft||Fe,Le.text,Je.x,Je.y)}}if(Ae.iconBox||Ae.verticalIconBox){const ft=!!(!$e&&Ae.verticalIconBox);let Fe;Ae.iconBox&&(Fe=ft),Ae.verticalIconBox&&(Fe=!ft),qs(e.iconCollisionBox.collisionVertexArray,pe.icon.placed,Fe,Le.icon,j?Je.x:0,j?Je.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=J.invProjMatrix,e.placementViewportMatrix=J.viewportMatrix,e.collisionCircleArray=J.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const l=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function qs(f,e,s,l,u,p){l&&l.length!==0||(l=[0,0,0,0]);const v=l[0]-gt,w=l[1]-gt,T=l[2]-gt,P=l[3]-gt;f.emplaceBack(e?1:0,s?1:0,u||0,p||0,v,w),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,T,w),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,T,P),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,v,P)}const qt=Math.pow(2,25),tu=Math.pow(2,24),ru=Math.pow(2,17),Di=Math.pow(2,16),Li=Math.pow(2,9),mp=Math.pow(2,8),Gi=Math.pow(2,1);function Ri(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const e=f.placed?1:0,s=Math.floor(127*f.opacity);return s*qt+e*tu+s*ru+e*Di+s*Li+e*mp+s*Gi+e}const Gs=0;function ys(){return{isOccluded:(f,e,s)=>!1,getPitchedTextCorrection:(f,e,s)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(f,e,s,l){throw new Error("Not implemented.")},translatePosition:(f,e,s,l)=>function(u,p,v,w,T=!1){if(!v[0]&&!v[1])return[0,0];const P=T?w==="map"?u.angle:0:w==="viewport"?-u.angle:0;if(P){const M=Math.sin(P),z=Math.cos(P);v=[v[0]*z-v[1]*M,v[0]*M+v[1]*z]}return[T?v[0]:Et(p,v[0],u.zoom),T?v[1]:Et(p,v[1],u.zoom)]}(f,e,s,l),getCircleRadiusCorrection:f=>1}}class Er{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,l,u,p){const v=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(v,u,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((w,T)=>w.sortKey-T.sortKey));this._currentPartIndex<v.length;)if(s.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,p())return!0;return!1}}class Za{constructor(e,s,l,u,p,v,w,T){this.placement=new oi(e,ys(),s,v,w,T),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(e,s,l){const u=Q.now(),p=()=>!this._forceFullPlacement&&Q.now()-u>2;for(;this._currentPlacementIndex>=0;){const v=s[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=w)&&(!v.maxzoom||v.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new Er(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const on=512/d.X/2;class vr{constructor(e,s,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let p=0;p<s.length;p++){const v=s.get(p),w=v.key,T=u.get(w);T?T.push(v):u.set(w,[v])}for(const[p,v]of u){const w={positions:v.map(T=>({x:Math.floor(T.anchorX*on),y:Math.floor(T.anchorY*on)})),crossTileIDs:v.map(T=>T.crossTileID)};if(w.positions.length>128){const T=new d.av(w.positions.length,16,Uint16Array);for(const{x:P,y:M}of w.positions)T.add(P,M);T.finish(),delete w.positions,w.index=T}this._symbolsByKey[p]=w}}getScaledCoordinates(e,s){const{x:l,y:u,z:p}=this.tileID.canonical,{x:v,y:w,z:T}=s.canonical,P=on/Math.pow(2,T-p),M=(w*d.X+e.anchorY)*P,z=u*d.X*on;return{x:Math.floor((v*d.X+e.anchorX)*P-l*d.X*on),y:Math.floor(M-z)}}findMatches(e,s,l){const u=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let p=0;p<e.length;p++){const v=e.get(p);if(v.crossTileID)continue;const w=this._symbolsByKey[v.key];if(!w)continue;const T=this.getScaledCoordinates(v,s);if(w.index){const P=w.index.range(T.x-u,T.y-u,T.x+u,T.y+u).sort();for(const M of P){const z=w.crossTileIDs[M];if(!l[z]){l[z]=!0,v.crossTileID=z;break}}}else if(w.positions)for(let P=0;P<w.positions.length;P++){const M=w.positions[P],z=w.crossTileIDs[P];if(Math.abs(M.x-T.x)<=u&&Math.abs(M.y-T.y)<=u&&!l[z]){l[z]=!0,v.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ao{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ln{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const l in this.indexes){const u=this.indexes[l],p={};for(const v in u){const w=u[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+s),p[w.tileID.key]=w}this.indexes[l]=p}this.lng=e}addBucket(e,s,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let p=0;p<s.symbolInstances.length;p++)s.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const u=this.usedCrossTileIDs[e.overscaledZ];for(const p in this.indexes){const v=this.indexes[p];if(Number(p)>e.overscaledZ)for(const w in v){const T=v[w];T.tileID.isChildOf(e)&&T.findMatches(s.symbolInstances,e,u)}else{const w=v[e.scaledTo(Number(p)).key];w&&w.findMatches(s.symbolInstances,e,u)}}for(let p=0;p<s.symbolInstances.length;p++){const v=s.symbolInstances.get(p);v.crossTileID||(v.crossTileID=l.generate(),u[v.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new vr(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const l of s.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[e][u]}removeStaleBuckets(e){let s=!1;for(const l in this.indexes){const u=this.indexes[l];for(const p in u)e[u[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[p]),delete u[p],s=!0)}return s}}class iu{constructor(){this.layerIndexes={},this.crossTileIDs=new Ao,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,l){let u=this.layerIndexes[e.id];u===void 0&&(u=this.layerIndexes[e.id]=new ln);let p=!1;const v={};u.handleWrapJump(l);for(const w of s){const T=w.getBucket(e);T&&e.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(w.tileID,T,this.crossTileIDs)&&(p=!0),v[T.bucketInstanceId]=!0)}return u.removeStaleBuckets(v)&&(p=!0),p}pruneUnusedLayers(e){const s={};e.forEach(l=>{s[l]=!0});for(const l in this.layerIndexes)s[l]||delete this.layerIndexes[l]}}const un=(f,e)=>d.t(f,e&&e.filter(s=>s.identifier!=="source.canvas")),gp=d.aw();class Do extends d.E{constructor(e,s={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const u=this.sourceCaches[l].getSource().type;u!=="vector"&&u!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new qi(at(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,u)=>this.getGlyphs(l,u)),this.dispatcher.registerMessageHandler("GI",(l,u)=>this.getImages(l,u)),this.imageManager=new Qt,this.imageManager.setEventedParent(this),this.glyphManager=new jr(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new si(256,512),this.crossTileSymbolIndex=new iu,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",d.ay()),yr().on(ke,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const u=this.sourceCaches[l.sourceId];if(!u)return;const p=u.getSource();if(p&&p.vectorLayerIds)for(const v in this._layers){const w=this._layers[v];w.source===p.id&&this._validateLayer(w)}})}loadURL(e,s={},l){this.fire(new d.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const u=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const p=this._loadStyleRequest;d.h(u,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,s,l)}).catch(v=>{this._loadStyleRequest=null,v&&!p.signal.aborted&&this.fire(new d.j(v))})}loadJSON(e,s={},l){this.fire(new d.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Q.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(e,s,l)}).catch(()=>{})}loadEmpty(){this.fire(new d.k("dataloading",{dataType:"style"})),this._load(gp,{validate:!1})}_load(e,s,l){var u;const p=s.transformStyle?s.transformStyle(l,e):e;if(!s.validate||!un(this,d.u(p))){this._loaded=!0,this.stylesheet=p;for(const v in p.sources)this.addSource(v,p.sources[v],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs),this._createLayers(),this.light=new ut(this.stylesheet.light),this.sky=new Nt(this.stylesheet.sky),this.map.setTerrain((u=this.stylesheet.terrain)!==null&&u!==void 0?u:null),this.fire(new d.k("data",{dataType:"style"})),this.fire(new d.k("style.load"))}}_createLayers(){const e=d.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of e){const l=d.aA(s);l.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=l}}_loadSprite(e,s=!1,l=void 0){let u;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(p,v,w,T){return d._(this,void 0,void 0,function*(){const P=Rt(p),M=w>1?"@2x":"",z={},F={};for(const{id:j,url:V}of P){const H=v.transformRequest(vt(V,M,".json"),"SpriteJSON");z[j]=d.h(H,T);const K=v.transformRequest(vt(V,M,".png"),"SpriteImage");F[j]=he.getImage(K,T)}return yield Promise.all([...Object.values(z),...Object.values(F)]),function(j,V){return d._(this,void 0,void 0,function*(){const H={};for(const K in j){H[K]={};const J=Q.getImageCanvasContext((yield V[K]).data),re=(yield j[K]).data;for(const q in re){const{width:ae,height:le,x:pe,y:xe,sdf:Te,pixelRatio:Oe,stretchX:$e,stretchY:Le,content:Ae,textFitWidth:Je,textFitHeight:ft}=re[q];H[K][q]={data:null,pixelRatio:Oe,sdf:Te,stretchX:$e,stretchY:Le,content:Ae,textFitWidth:Je,textFitHeight:ft,spriteData:{width:ae,height:le,x:pe,y:xe,context:J}}}}return H})}(z,F)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(p=>{if(this._spriteRequest=null,p)for(const v in p){this._spritesImagesIds[v]=[];const w=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(T=>!(T in p)):[];for(const T of w)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in p[v]){const P=v==="default"?T:`${v}:${T}`;this._spritesImagesIds[v].push(P),P in this.imageManager.images?this.imageManager.updateImage(P,p[v][T],!1):this.imageManager.addImage(P,p[v][T]),s&&(this._changedImages[P]=!0)}}}).catch(p=>{this._spriteRequest=null,u=p,this.fire(new d.j(u))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"})),l&&l(u)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const l=e.sourceLayer;if(!l)return;const u=s.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new d.j(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,s=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(s?d.aB(l):l);const u=[];for(const p of e)if(l[p]){const v=s?d.aB(l[p]):l[p];u.push(v)}return u}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const s=Object.keys(this._layers);for(const l of s){const u=this._layers[l];u.type!=="custom"&&(e[l]=u.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(s){const u=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(u.length||p.length)&&this._updateWorkerLayers(u,p);for(const v in this._updatedSources){const w=this._updatedSources[v];if(w==="reload")this._reloadSource(v);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const p=this.sourceCaches[u];l[u]=p.used,p.used=!1}for(const u of this._order){const p=this._layers[u];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const u in l){const p=this.sourceCaches[u];!!l[u]!=!!p.used&&p.fire(new d.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,s&&this.fire(new d.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,s={}){var l;this._checkLoaded();const u=this.serialize();if(e=s.transformStyle?s.transformStyle(u,e):e,((l=s.validate)===null||l===void 0||l)&&un(this,d.u(e)))return!1;(e=d.aB(e)).layers=d.az(e.layers);const p=d.aC(u,e),v=this._getOperationsToPerform(p);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const w of v.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const s=[],l=[];for(const u of e)switch(u.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,u.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,u.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,u.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,u.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,u.args));break;case"addSource":s.push(()=>this.addSource.apply(this,u.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,u.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,u.args));break;case"setLight":s.push(()=>this.setLight.apply(this,u.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,u.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,u.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,u.args));break;case"setSky":s.push(()=>this.setSky.apply(this,u.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,u.args));break;case"setTransition":s.push(()=>{});break;default:l.push(u.command)}return{operations:s,unimplemented:l}}addImage(e,s){if(this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(d.u.source,`sources.${e}`,s,null,l))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const u=this.sourceCaches[e]=new lt(e,s,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:e})),u.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new d.j(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new d.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,l={}){this._checkLoaded();const u=e.id;if(this.getLayer(u))return void this.fire(new d.j(new Error(`Layer "${u}" already exists on this map.`)));let p;if(e.type==="custom"){if(un(this,d.aD(e)))return;p=d.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(u,e.source),e=d.aB(e),e=d.e(e,{source:u})),this._validate(d.u.layer,`layers.${u}`,e,{arrayIndex:-1},l))return;p=d.aA(e),this._validateLayer(p),p.setEventedParent(this,{layer:{id:u}})}const v=s?this._order.indexOf(s):this._order.length;if(s&&v===-1)this.fire(new d.j(new Error(`Cannot add layer "${u}" before non-existing layer "${s}".`)));else{if(this._order.splice(v,0,u),this._layerOrderChanged=!0,this._layers[u]=p,this._removedLayers[u]&&p.source&&p.type!=="custom"){const w=this._removedLayers[u];delete this._removedLayers[u],w.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new d.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const l=this._order.indexOf(e);this._order.splice(l,1);const u=s?this._order.indexOf(s):this._order.length;s&&u===-1?this.fire(new d.j(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(u,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new d.j(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,l){this._checkLoaded();const u=this.getLayer(e);u?u.minzoom===s&&u.maxzoom===l||(s!=null&&(u.minzoom=s),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new d.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,l={}){this._checkLoaded();const u=this.getLayer(e);if(u){if(!d.aE(u.filter,s))return s==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(d.u.filter,`layers.${u.id}.filter`,s,null,l)||(u.filter=d.aB(s),this._updateLayer(u)))}else this.fire(new d.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return d.aB(this.getLayer(e).filter)}setLayoutProperty(e,s,l,u={}){this._checkLoaded();const p=this.getLayer(e);p?d.aE(p.getLayoutProperty(s),l)||(p.setLayoutProperty(s,l,u),this._updateLayer(p)):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const l=this.getLayer(e);if(l)return l.getLayoutProperty(s);this.fire(new d.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,l,u={}){this._checkLoaded();const p=this.getLayer(e);p?d.aE(p.getPaintProperty(s),l)||(p.setPaintProperty(s,l,u)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const l=e.source,u=e.sourceLayer,p=this.sourceCaches[l];if(p===void 0)return void this.fire(new d.j(new Error(`The source '${l}' does not exist in the map's style.`)));const v=p.getSource().type;v==="geojson"&&u?this.fire(new d.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||u?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),p.setFeatureState(u,e.id,s)):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const l=e.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new d.j(new Error(`The source '${l}' does not exist in the map's style.`)));const p=u.getSource().type,v=p==="vector"?e.sourceLayer:void 0;p!=="vector"||v?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new d.j(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(v,e.id,s):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,l=e.sourceLayer,u=this.sourceCaches[s];if(u!==void 0)return u.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,e.id)):void this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=d.aF(this.sourceCaches,p=>p.serialize()),s=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,u=this.stylesheet;return d.aG({version:u.version,name:u.name,metadata:u.metadata,light:u.light,sky:u.sky,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,sources:e,layers:s,terrain:l},p=>p!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=v=>this._layers[v].type==="fill-extrusion",l={},u=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(s(w)){l[w]=v;for(const T of e){const P=T[w];if(P)for(const M of P)u.push(M)}}}u.sort((v,w)=>w.intersectionZ-v.intersectionZ);const p=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(s(w))for(let T=u.length-1;T>=0;T--){const P=u[T].feature;if(l[P.layer.id]<v)break;p.push(P),u.pop()}else for(const T of e){const P=T[w];if(P)for(const M of P)p.push(M.feature)}}return p}queryRenderedFeatures(e,s,l){s&&s.filter&&this._validate(d.u.filter,"queryRenderedFeatures.filter",s.filter,null,s);const u={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new d.j(new Error("parameters.layers must be an Array."))),[];for(const w of s.layers){const T=this._layers[w];if(!T)return this.fire(new d.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];u[T.source]=!0}}const p=[];s.availableImages=this._availableImages;const v=this._serializedAllLayers();for(const w in this.sourceCaches)s.layers&&!u[w]||p.push(ai(this.sourceCaches[w],this._layers,v,e,s,l));return this.placement&&p.push(function(w,T,P,M,z,F,j){const V={},H=F.queryRenderedSymbols(M),K=[];for(const J of Object.keys(H).map(Number))K.push(j[J]);K.sort(In);for(const J of K){const re=J.featureIndex.lookupSymbolFeatures(H[J.bucketInstanceId],T,J.bucketIndex,J.sourceLayerIndex,z.filter,z.layers,z.availableImages,w);for(const q in re){const ae=V[q]=V[q]||[],le=re[q];le.sort((pe,xe)=>{const Te=J.featureSortOrder;if(Te){const Oe=Te.indexOf(pe.featureIndex);return Te.indexOf(xe.featureIndex)-Oe}return xe.featureIndex-pe.featureIndex});for(const pe of le)ae.push(pe)}}for(const J in V)V[J].forEach(re=>{const q=re.feature,ae=P[w[J].source].getFeatureState(q.layer["source-layer"],q.id);q.source=q.layer.source,q.layer["source-layer"]&&(q.sourceLayer=q.layer["source-layer"]),q.state=ae});return V}(this._layers,v,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(e,s){s&&s.filter&&this._validate(d.u.filter,"querySourceFeatures.filter",s.filter,null,s);const l=this.sourceCaches[e];return l?function(u,p){const v=u.getRenderableIds().map(P=>u.getTileByID(P)),w=[],T={};for(let P=0;P<v.length;P++){const M=v[P],z=M.tileID.canonical.key;T[z]||(T[z]=!0,M.querySourceFeatures(w,p))}return w}(l,s):[]}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const v in e)if(!d.aE(e[v],l[v])){u=!0;break}if(!u)return;const p={now:Q.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(p)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,s={}){const l=this.getSky();let u=!1;if(!e&&!l)return;if(e&&!l)u=!0;else if(!e&&l)u=!0;else for(const v in e)if(!d.aE(e[v],l[v])){u=!0;break}if(!u)return;const p={now:Q.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,s),this.sky.updateTransitions(p)}_validate(e,s,l,u,p={}){return(!p||p.validate!==!1)&&un(this,e.call(d.u,d.e({key:s,style:this.serialize(),value:l,styleSpec:d.v},u)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),yr().off(ke,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const l=this.sourceCaches[s];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,l,u,p=!1){let v=!1,w=!1;const T={};for(const P of this._order){const M=this._layers[P];if(M.type!=="symbol")continue;if(!T[M.source]){const F=this.sourceCaches[M.source];T[M.source]=F.getRenderableIds(!0).map(j=>F.getTileByID(j)).sort((j,V)=>V.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(V.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(M,T[M.source],e.center.lng);v=v||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Q.now(),e.zoom))&&(this.pauseablePlacement=new Za(e,this.map.terrain,this._order,p,s,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Q.now()),w=!0),v&&this.pauseablePlacement.placement.setStale()),w||v)for(const P of this._order){const M=this._layers[P];M.type==="symbol"&&this.placement.updateLayerOpacities(M,T[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Q.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s){return d._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,s.icons),l})}getGlyphs(e,s){return d._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(s.stacks),u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,s={}){this._checkLoaded(),e&&this._validate(d.u.glyphs,"glyphs",e,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,s,l={},u){this._checkLoaded();const p=[{id:e,url:s}],v=[...Rt(this.stylesheet.sprite),...p];this._validate(d.u.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(p,!0,u))}removeSprite(e){this._checkLoaded();const s=Rt(this.stylesheet.sprite);if(s.find(l=>l.id===e)){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;s.splice(s.findIndex(l=>l.id===e),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}else this.fire(new d.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Rt(this.stylesheet.sprite)}setSprite(e,s={},l){this._checkLoaded(),e&&this._validate(d.u.sprite,"sprite",e,null,s)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var vs=d.Y([{name:"a_pos",type:"Int16",components:2}]);const rs={prelude:jt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:jt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:jt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:jt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:jt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:jt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:jt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:jt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:jt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:jt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:jt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:jt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:jt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:jt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:jt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:jt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:jt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:jt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:jt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:jt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:jt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:jt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:jt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:jt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:jt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:jt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:jt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:jt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:jt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:jt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function jt(f,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/attribute ([\w]+) ([\w]+)/g),u=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=p?p.concat(u):u,w={};return{fragmentSource:f=f.replace(s,(T,P,M,z,F)=>(w[F]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${M} ${z} ${F};
#else
uniform ${M} ${z} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${M} ${z} ${F} = u_${F};
#endif
`)),vertexSource:e=e.replace(s,(T,P,M,z,F)=>{const j=z==="float"?"vec2":"vec4",V=F.match(/color/)?"color":j;return w[F]?P==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${M} ${j} a_${F};
varying ${M} ${z} ${F};
#else
uniform ${M} ${z} u_${F};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${M} ${z} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${V}(a_${F}, u_${F}_t);
#else
    ${M} ${z} ${F} = u_${F};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${M} ${j} a_${F};
#else
uniform ${M} ${z} u_${F};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${M} ${z} ${F} = a_${F};
#else
    ${M} ${z} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${M} ${z} ${F} = unpack_mix_${V}(a_${F}, u_${F}_t);
#else
    ${M} ${z} ${F} = u_${F};
#endif
`}),staticAttributes:l,staticUniforms:v}}class nu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,l,u,p,v,w,T,P){this.context=e;let M=this.boundPaintVertexBuffers.length!==u.length;for(let z=0;!M&&z<u.length;z++)this.boundPaintVertexBuffers[z]!==u[z]&&(M=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==l||M||this.boundIndexBuffer!==p||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==P?this.freshBind(s,l,u,p,v,w,T,P):(e.bindVertexArray.set(this.vao),w&&w.bind(),p&&p.dynamicDraw&&p.bind(),T&&T.bind(),P&&P.bind())}freshBind(e,s,l,u,p,v,w,T){const P=e.numAttributes,M=this.context,z=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=T,s.enableAttributes(z,e);for(const F of l)F.enableAttributes(z,e);v&&v.enableAttributes(z,e),w&&w.enableAttributes(z,e),T&&T.enableAttributes(z,e),s.bind(),s.setVertexAttribPointers(z,e,p);for(const F of l)F.bind(),F.setVertexAttribPointers(z,e,p);v&&(v.bind(),v.setVertexAttribPointers(z,e,p)),u&&u.bind(),w&&(w.bind(),w.setVertexAttribPointers(z,e,p)),T&&(T.bind(),T.setVertexAttribPointers(z,e,p)),M.currentNumAttributes=P}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const su=(f,e,s,l,u)=>({u_matrix:f,u_texture:0,u_ele_delta:e,u_fog_matrix:s,u_fog_color:l?l.properties.get("fog-color"):d.aM.white,u_fog_ground_blend:l?l.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:l?l.calculateFogBlendOpacity(u):0,u_horizon_color:l?l.properties.get("horizon-color"):d.aM.white,u_horizon_fog_blend:l?l.properties.get("horizon-fog-blend"):1});function Hs(f){const e=[];for(let s=0;s<f.length;s++){if(f[s]===null)continue;const l=f[s].split(" ");e.push(l.pop())}return e}class au{constructor(e,s,l,u,p,v){const w=e.gl;this.program=w.createProgram();const T=Hs(s.staticAttributes),P=l?l.getBinderAttributes():[],M=T.concat(P),z=rs.prelude.staticUniforms?Hs(rs.prelude.staticUniforms):[],F=s.staticUniforms?Hs(s.staticUniforms):[],j=l?l.getBinderUniforms():[],V=z.concat(F).concat(j),H=[];for(const pe of V)H.indexOf(pe)<0&&H.push(pe);const K=l?l.defines():[];p&&K.push("#define OVERDRAW_INSPECTOR;"),v&&K.push("#define TERRAIN3D;");const J=K.concat(rs.prelude.fragmentSource,s.fragmentSource).join(`
`),re=K.concat(rs.prelude.vertexSource,s.vertexSource).join(`
`),q=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(q,J),w.compileShader(q),!w.getShaderParameter(q,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(q)}`);w.attachShader(this.program,q);const ae=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(ae,re),w.compileShader(ae),!w.getShaderParameter(ae,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(ae)}`);w.attachShader(this.program,ae),this.attributes={};const le={};this.numAttributes=M.length;for(let pe=0;pe<this.numAttributes;pe++)M[pe]&&(w.bindAttribLocation(this.program,pe,M[pe]),this.attributes[M[pe]]=pe);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(ae),w.deleteShader(q);for(let pe=0;pe<H.length;pe++){const xe=H[pe];if(xe&&!le[xe]){const Te=w.getUniformLocation(this.program,xe);Te&&(le[xe]=Te)}}this.fixedUniforms=u(e,le),this.terrainUniforms=((pe,xe)=>({u_depth:new d.aH(pe,xe.u_depth),u_terrain:new d.aH(pe,xe.u_terrain),u_terrain_dim:new d.aI(pe,xe.u_terrain_dim),u_terrain_matrix:new d.aJ(pe,xe.u_terrain_matrix),u_terrain_unpack:new d.aK(pe,xe.u_terrain_unpack),u_terrain_exaggeration:new d.aI(pe,xe.u_terrain_exaggeration)}))(e,le),this.binderUniforms=l?l.getUniforms(e,le):[]}draw(e,s,l,u,p,v,w,T,P,M,z,F,j,V,H,K,J,re){const q=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(u),e.setColorMode(p),e.setCullFace(v),T){e.activeTexture.set(q.TEXTURE2),q.bindTexture(q.TEXTURE_2D,T.depthTexture),e.activeTexture.set(q.TEXTURE3),q.bindTexture(q.TEXTURE_2D,T.texture);for(const le in this.terrainUniforms)this.terrainUniforms[le].set(T[le])}for(const le in this.fixedUniforms)this.fixedUniforms[le].set(w[le]);H&&H.setUniforms(e,this.binderUniforms,j,{zoom:V});let ae=0;switch(s){case q.LINES:ae=2;break;case q.TRIANGLES:ae=3;break;case q.LINE_STRIP:ae=1}for(const le of F.get()){const pe=le.vaos||(le.vaos={});(pe[P]||(pe[P]=new nu)).bind(e,this,M,H?H.getPaintVertexBuffers():[],z,le.vertexOffset,K,J,re),q.drawElements(s,le.primitiveLength*ae,q.UNSIGNED_SHORT,le.primitiveOffset*ae*2)}}}function Lo(f,e,s){const l=1/Et(s,1,e.transform.tileZoom),u=Math.pow(2,s.tileID.overscaledZ),p=s.tileSize*Math.pow(2,e.transform.tileZoom)/u,v=p*(s.tileID.canonical.x+s.tileID.wrap*u),w=p*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[l,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}const qa=(f,e,s,l)=>{const u=e.style.light,p=u.properties.get("position"),v=[p.x,p.y,p.z],w=function(){var P=new d.A(9);return d.A!=Float32Array&&(P[1]=0,P[2]=0,P[3]=0,P[5]=0,P[6]=0,P[7]=0),P[0]=1,P[4]=1,P[8]=1,P}();u.properties.get("anchor")==="viewport"&&function(P,M){var z=Math.sin(M),F=Math.cos(M);P[0]=F,P[1]=z,P[2]=0,P[3]=-z,P[4]=F,P[5]=0,P[6]=0,P[7]=0,P[8]=1}(w,-e.transform.angle),function(P,M,z){var F=M[0],j=M[1],V=M[2];P[0]=F*z[0]+j*z[3]+V*z[6],P[1]=F*z[1]+j*z[4]+V*z[7],P[2]=F*z[2]+j*z[5]+V*z[8]}(v,v,w);const T=u.properties.get("color");return{u_matrix:f,u_lightpos:v,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+s,u_opacity:l}},Ro=(f,e,s,l,u,p,v)=>d.e(qa(f,e,s,l),Lo(p,e,v),{u_height_factor:-Math.pow(2,u.overscaledZ)/v.tileSize/8}),Ws=f=>({u_matrix:f}),Yc=(f,e,s,l)=>d.e(Ws(f),Lo(s,e,l)),_p=(f,e)=>({u_matrix:f,u_world:e}),Qc=(f,e,s,l,u)=>d.e(Yc(f,e,s,l),{u_world:u}),yp=(f,e,s,l)=>{const u=f.transform;let p,v;if(l.paint.get("circle-pitch-alignment")==="map"){const w=Et(s,1,u.zoom);p=!0,v=[w,w]}else p=!1,v=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(e.posMatrix,s,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:v}},xs=(f,e,s)=>({u_matrix:f,u_inv_matrix:e,u_camera_to_center_distance:s.cameraToCenterDistance,u_viewport_size:[s.width,s.height]}),Ga=(f,e,s=1)=>({u_matrix:f,u_color:e,u_overlay:0,u_overlay_scale:s}),yi=f=>({u_matrix:f}),vi=(f,e,s,l)=>({u_matrix:f,u_extrude_scale:Et(e,1,s),u_intensity:l}),Fo=(f,e,s,l)=>{const u=d.H();d.aP(u,0,f.width,f.height,0,0,1);const p=f.context.gl;return{u_matrix:u,u_world:[p.drawingBufferWidth,p.drawingBufferHeight],u_image:s,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}};function Bo(f,e){const s=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new d.Z(0,l/s).toLngLat().lat,new d.Z(0,(l+1)/s).toLngLat().lat]}const Oo=(f,e,s,l)=>{const u=f.transform;return{u_matrix:rh(f,e,s,l),u_ratio:1/Et(e,1,u.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},eh=(f,e,s,l,u)=>d.e(Oo(f,e,s,u),{u_image:0,u_image_height:l}),Xs=(f,e,s,l,u)=>{const p=f.transform,v=th(e,p);return{u_matrix:rh(f,e,s,u),u_texsize:e.imageAtlasTexture.size,u_ratio:1/Et(e,1,p.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[v,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},vp=(f,e,s,l,u,p)=>{const v=f.lineAtlas,w=th(e,f.transform),T=s.layout.get("line-cap")==="round",P=v.getDash(l.from,T),M=v.getDash(l.to,T),z=P.width*u.fromScale,F=M.width*u.toScale;return d.e(Oo(f,e,s,p),{u_patternscale_a:[w/z,-P.height/2],u_patternscale_b:[w/F,-M.height/2],u_sdfgamma:v.width/(256*Math.min(z,F)*f.pixelRatio)/2,u_image:0,u_tex_y_a:P.y,u_tex_y_b:M.y,u_mix:u.t})};function th(f,e){return 1/Et(f,1,e.tileZoom)}function rh(f,e,s,l){return f.translatePosMatrix(l?l.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const xp=(f,e,s,l,u)=>{return{u_matrix:f,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(v=u.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(p=u.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:wp(u.paint.get("raster-hue-rotate"))};var p,v};function wp(f){f*=Math.PI/180;const e=Math.sin(f),s=Math.cos(f);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const ih=(f,e,s,l,u,p,v,w,T,P,M,z,F,j)=>{const V=v.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:V.cameraToCenterDistance,u_pitch:V.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:V.width/V.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:T,u_coord_matrix:P,u_is_text:+z,u_pitch_with_map:+l,u_is_along_line:u,u_is_variable_anchor:p,u_texsize:F,u_texture:0,u_translation:M,u_pitched_scale:j}},Ha=(f,e,s,l,u,p,v,w,T,P,M,z,F,j,V)=>{const H=v.transform;return d.e(ih(f,e,s,l,u,p,v,w,T,P,M,z,F,V),{u_gamma_scale:l?Math.cos(H._pitch)*H.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},ou=(f,e,s,l,u,p,v,w,T,P,M,z,F,j)=>d.e(Ha(f,e,s,l,u,p,v,w,T,P,M,!0,z,!0,j),{u_texsize_icon:F,u_texture_icon:1}),No=(f,e,s)=>({u_matrix:f,u_opacity:e,u_color:s}),lu=(f,e,s,l,u,p)=>d.e(function(v,w,T,P){const M=T.imageManager.getPattern(v.from.toString()),z=T.imageManager.getPattern(v.to.toString()),{width:F,height:j}=T.imageManager.getPixelSize(),V=Math.pow(2,P.tileID.overscaledZ),H=P.tileSize*Math.pow(2,T.transform.tileZoom)/V,K=H*(P.tileID.canonical.x+P.tileID.wrap*V),J=H*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[F,j],u_mix:w.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/Et(P,1,T.transform.tileZoom),u_pixel_coord_upper:[K>>16,J>>16],u_pixel_coord_lower:[65535&K,65535&J]}}(l,p,s,u),{u_matrix:f,u_opacity:e}),uu={fillExtrusion:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_lightpos:new d.aN(f,e.u_lightpos),u_lightintensity:new d.aI(f,e.u_lightintensity),u_lightcolor:new d.aN(f,e.u_lightcolor),u_vertical_gradient:new d.aI(f,e.u_vertical_gradient),u_opacity:new d.aI(f,e.u_opacity)}),fillExtrusionPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_lightpos:new d.aN(f,e.u_lightpos),u_lightintensity:new d.aI(f,e.u_lightintensity),u_lightcolor:new d.aN(f,e.u_lightcolor),u_vertical_gradient:new d.aI(f,e.u_vertical_gradient),u_height_factor:new d.aI(f,e.u_height_factor),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade),u_opacity:new d.aI(f,e.u_opacity)}),fill:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix)}),fillPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),fillOutline:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world)}),fillOutlinePattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),circle:(f,e)=>({u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_scale_with_map:new d.aH(f,e.u_scale_with_map),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_extrude_scale:new d.aO(f,e.u_extrude_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_matrix:new d.aJ(f,e.u_matrix)}),collisionBox:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_pixel_extrude_scale:new d.aO(f,e.u_pixel_extrude_scale)}),collisionCircle:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_inv_matrix:new d.aJ(f,e.u_inv_matrix),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_viewport_size:new d.aO(f,e.u_viewport_size)}),debug:(f,e)=>({u_color:new d.aL(f,e.u_color),u_matrix:new d.aJ(f,e.u_matrix),u_overlay:new d.aH(f,e.u_overlay),u_overlay_scale:new d.aI(f,e.u_overlay_scale)}),clippingMask:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix)}),heatmap:(f,e)=>({u_extrude_scale:new d.aI(f,e.u_extrude_scale),u_intensity:new d.aI(f,e.u_intensity),u_matrix:new d.aJ(f,e.u_matrix)}),heatmapTexture:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world),u_image:new d.aH(f,e.u_image),u_color_ramp:new d.aH(f,e.u_color_ramp),u_opacity:new d.aI(f,e.u_opacity)}),hillshade:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_latrange:new d.aO(f,e.u_latrange),u_light:new d.aO(f,e.u_light),u_shadow:new d.aL(f,e.u_shadow),u_highlight:new d.aL(f,e.u_highlight),u_accent:new d.aL(f,e.u_accent)}),hillshadePrepare:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_dimension:new d.aO(f,e.u_dimension),u_zoom:new d.aI(f,e.u_zoom),u_unpack:new d.aK(f,e.u_unpack)}),line:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels)}),lineGradient:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_image:new d.aH(f,e.u_image),u_image_height:new d.aI(f,e.u_image_height)}),linePattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texsize:new d.aO(f,e.u_texsize),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_image:new d.aH(f,e.u_image),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),lineSDF:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_patternscale_a:new d.aO(f,e.u_patternscale_a),u_patternscale_b:new d.aO(f,e.u_patternscale_b),u_sdfgamma:new d.aI(f,e.u_sdfgamma),u_image:new d.aH(f,e.u_image),u_tex_y_a:new d.aI(f,e.u_tex_y_a),u_tex_y_b:new d.aI(f,e.u_tex_y_b),u_mix:new d.aI(f,e.u_mix)}),raster:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_tl_parent:new d.aO(f,e.u_tl_parent),u_scale_parent:new d.aI(f,e.u_scale_parent),u_buffer_scale:new d.aI(f,e.u_buffer_scale),u_fade_t:new d.aI(f,e.u_fade_t),u_opacity:new d.aI(f,e.u_opacity),u_image0:new d.aH(f,e.u_image0),u_image1:new d.aH(f,e.u_image1),u_brightness_low:new d.aI(f,e.u_brightness_low),u_brightness_high:new d.aI(f,e.u_brightness_high),u_saturation_factor:new d.aI(f,e.u_saturation_factor),u_contrast_factor:new d.aI(f,e.u_contrast_factor),u_spin_weights:new d.aN(f,e.u_spin_weights)}),symbolIcon:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texture:new d.aH(f,e.u_texture),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),symbolSDF:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texture:new d.aH(f,e.u_texture),u_gamma_scale:new d.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_is_halo:new d.aH(f,e.u_is_halo),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),symbolTextAndIcon:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texsize_icon:new d.aO(f,e.u_texsize_icon),u_texture:new d.aH(f,e.u_texture),u_texture_icon:new d.aH(f,e.u_texture_icon),u_gamma_scale:new d.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_is_halo:new d.aH(f,e.u_is_halo),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),background:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_opacity:new d.aI(f,e.u_opacity),u_color:new d.aL(f,e.u_color)}),backgroundPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_opacity:new d.aI(f,e.u_opacity),u_image:new d.aH(f,e.u_image),u_pattern_tl_a:new d.aO(f,e.u_pattern_tl_a),u_pattern_br_a:new d.aO(f,e.u_pattern_br_a),u_pattern_tl_b:new d.aO(f,e.u_pattern_tl_b),u_pattern_br_b:new d.aO(f,e.u_pattern_br_b),u_texsize:new d.aO(f,e.u_texsize),u_mix:new d.aI(f,e.u_mix),u_pattern_size_a:new d.aO(f,e.u_pattern_size_a),u_pattern_size_b:new d.aO(f,e.u_pattern_size_b),u_scale_a:new d.aI(f,e.u_scale_a),u_scale_b:new d.aI(f,e.u_scale_b),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_tile_units_to_pixels:new d.aI(f,e.u_tile_units_to_pixels)}),terrain:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texture:new d.aH(f,e.u_texture),u_ele_delta:new d.aI(f,e.u_ele_delta),u_fog_matrix:new d.aJ(f,e.u_fog_matrix),u_fog_color:new d.aL(f,e.u_fog_color),u_fog_ground_blend:new d.aI(f,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.aI(f,e.u_fog_ground_blend_opacity),u_horizon_color:new d.aL(f,e.u_horizon_color),u_horizon_fog_blend:new d.aI(f,e.u_horizon_fog_blend)}),terrainDepth:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ele_delta:new d.aI(f,e.u_ele_delta)}),terrainCoords:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texture:new d.aH(f,e.u_texture),u_terrain_coords_id:new d.aI(f,e.u_terrain_coords_id),u_ele_delta:new d.aI(f,e.u_ele_delta)}),sky:(f,e)=>({u_sky_color:new d.aL(f,e.u_sky_color),u_horizon_color:new d.aL(f,e.u_horizon_color),u_horizon:new d.aI(f,e.u_horizon),u_sky_horizon_blend:new d.aI(f,e.u_sky_horizon_blend)})};class Pn{constructor(e,s,l){this.context=e;const u=e.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const bp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class cu{constructor(e,s,l,u){this.length=s.length,this.attributes=l,this.itemSize=s.bytesPerElement,this.dynamicDraw=u,this.context=e;const p=e.gl;this.buffer=p.createBuffer(),e.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let l=0;l<this.attributes.length;l++){const u=s.attributes[this.attributes[l].name];u!==void 0&&e.enableVertexAttribArray(u)}}setVertexAttribPointers(e,s,l){for(let u=0;u<this.attributes.length;u++){const p=this.attributes[u],v=s.attributes[p.name];v!==void 0&&e.vertexAttribPointer(v,p.components,e[bp[p.type]],!1,this.itemSize,p.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ws=new WeakMap;function is(f){var e;if(ws.has(f))return ws.get(f);{const s=(e=f.getParameter(f.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return ws.set(f,s),s}}class Vt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class jo extends Vt{getDefault(){return d.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Sp extends Vt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Ks extends Vt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Tp extends Vt{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class nh extends Vt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class kp extends Vt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class sh extends Vt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class hu extends Vt{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class ah extends Vt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class oh extends Vt{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class lh extends Vt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class uh extends Vt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class bs extends Vt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class ch extends Vt{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ip extends Vt{getDefault(){return d.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class hh extends Vt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Wa extends Vt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class Ep extends Vt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Vo extends Vt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Pp extends Vt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Cp extends Vt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class dh extends Vt{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ph extends Vt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class fh extends Vt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class du extends Vt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class mh extends Vt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Uo extends Vt{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class $n extends Vt{getDefault(){return null}set(e){var s;if(e===this.current&&!this.dirty)return;const l=this.gl;is(l)?l.bindVertexArray(e):(s=l.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class pu extends Vt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class fu extends Vt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class mu extends Vt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class $o extends Vt{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class gu extends $o{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Ss extends $o{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class _u extends $o{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Mp{constructor(e,s,l,u,p){this.context=e,this.width=s,this.height=l;const v=e.gl,w=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new gu(e,w),u)this.depthAttachment=p?new _u(e,w):new Ss(e,w);else if(p)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class fr{constructor(e,s,l){this.blendFunction=e,this.blendColor=s,this.mask=l}}fr.Replace=[1,0],fr.disabled=new fr(fr.Replace,d.aM.transparent,[!1,!1,!1,!1]),fr.unblended=new fr(fr.Replace,d.aM.transparent,[!0,!0,!0,!0]),fr.alphaBlended=new fr([1,771],d.aM.transparent,[!0,!0,!0,!0]);class zp{constructor(e){var s,l;if(this.gl=e,this.clearColor=new jo(this),this.clearDepth=new Sp(this),this.clearStencil=new Ks(this),this.colorMask=new Tp(this),this.depthMask=new nh(this),this.stencilMask=new kp(this),this.stencilFunc=new sh(this),this.stencilOp=new hu(this),this.stencilTest=new ah(this),this.depthRange=new oh(this),this.depthTest=new lh(this),this.depthFunc=new uh(this),this.blend=new bs(this),this.blendFunc=new ch(this),this.blendColor=new Ip(this),this.blendEquation=new hh(this),this.cullFace=new Wa(this),this.cullFaceSide=new Ep(this),this.frontFace=new Vo(this),this.program=new Pp(this),this.activeTexture=new Cp(this),this.viewport=new dh(this),this.bindFramebuffer=new ph(this),this.bindRenderbuffer=new fh(this),this.bindTexture=new du(this),this.bindVertexBuffer=new mh(this),this.bindElementBuffer=new Uo(this),this.bindVertexArray=new $n(this),this.pixelStoreUnpack=new pu(this),this.pixelStoreUnpackPremultiplyAlpha=new fu(this),this.pixelStoreUnpackFlipY=new mu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),is(e)){this.HALF_FLOAT=e.HALF_FLOAT;const u=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=e.RGBA16F)!==null&&s!==void 0?s:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:u==null?void 0:u.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const u=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new Pn(this,e,s)}createVertexBuffer(e,s,l){return new cu(this,e,s,l)}createRenderbuffer(e,s,l){const u=this.gl,p=u.createRenderbuffer();return this.bindRenderbuffer.set(p),u.renderbufferStorage(u.RENDERBUFFER,e,s,l),this.bindRenderbuffer.set(null),p}createFramebuffer(e,s,l,u){return new Mp(this,e,s,l,u)}clear({color:e,depth:s,stencil:l}){const u=this.gl;let p=0;e&&(p|=u.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(p|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),l!==void 0&&(p|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(p)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){d.aE(e.blendFunction,fr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return is(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var s;return is(this.gl)?this.gl.deleteVertexArray(e):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class Tt{constructor(e,s,l){this.func=e,this.mask=s,this.range=l}}Tt.ReadOnly=!1,Tt.ReadWrite=!0,Tt.disabled=new Tt(519,Tt.ReadOnly,[0,1]);const Zo=7680;class Kt{constructor(e,s,l,u,p,v){this.test=e,this.ref=s,this.mask=l,this.fail=u,this.depthFail=p,this.pass=v}}Kt.disabled=new Kt({func:519,mask:0},0,0,Zo,Zo,Zo);class Gt{constructor(e,s,l){this.enable=e,this.mode=s,this.frontFace=l}}let Ts;function Xa(f,e,s,l,u){const p=f.context,v=p.gl,w=f.useProgram("collisionBox"),T=[];let P=0,M=0;for(let J=0;J<l.length;J++){const re=l[J],q=e.getTile(re).getBucket(s);if(!q)continue;const ae=u?q.textCollisionBox:q.iconCollisionBox,le=q.collisionCircleArray;if(le.length>0){const pe=d.H();d.aQ(pe,q.placementInvProjMatrix,f.transform.glCoordMatrix),d.aQ(pe,pe,q.placementViewportMatrix),T.push({circleArray:le,circleOffset:M,transform:re.posMatrix,invTransform:pe,coord:re}),P+=le.length/4,M=P}ae&&w.draw(p,v.LINES,Tt.disabled,Kt.disabled,f.colorModeForRenderPass(),Gt.disabled,{u_matrix:re.posMatrix,u_pixel_extrude_scale:[1/(z=f.transform).width,1/z.height]},f.style.map.terrain&&f.style.map.terrain.getTerrainData(re),s.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,null,f.transform.zoom,null,null,ae.collisionVertexBuffer)}var z;if(!u||!T.length)return;const F=f.useProgram("collisionCircle"),j=new d.aR;j.resize(4*P),j._trim();let V=0;for(const J of T)for(let re=0;re<J.circleArray.length/4;re++){const q=4*re,ae=J.circleArray[q+0],le=J.circleArray[q+1],pe=J.circleArray[q+2],xe=J.circleArray[q+3];j.emplace(V++,ae,le,pe,xe,0),j.emplace(V++,ae,le,pe,xe,1),j.emplace(V++,ae,le,pe,xe,2),j.emplace(V++,ae,le,pe,xe,3)}(!Ts||Ts.length<2*P)&&(Ts=function(J){const re=2*J,q=new d.aT;q.resize(re),q._trim();for(let ae=0;ae<re;ae++){const le=6*ae;q.uint16[le+0]=4*ae+0,q.uint16[le+1]=4*ae+1,q.uint16[le+2]=4*ae+2,q.uint16[le+3]=4*ae+2,q.uint16[le+4]=4*ae+3,q.uint16[le+5]=4*ae+0}return q}(P));const H=p.createIndexBuffer(Ts,!0),K=p.createVertexBuffer(j,d.aS.members,!0);for(const J of T){const re=xs(J.transform,J.invTransform,f.transform);F.draw(p,v.TRIANGLES,Tt.disabled,Kt.disabled,f.colorModeForRenderPass(),Gt.disabled,re,f.style.map.terrain&&f.style.map.terrain.getTerrainData(J.coord),s.id,K,H,d.a0.simpleSegment(0,2*J.circleOffset,J.circleArray.length,J.circleArray.length/2),null,f.transform.zoom,null,null,null)}K.destroy(),H.destroy()}Gt.disabled=new Gt(!1,1029,2305),Gt.backCCW=new Gt(!0,1029,2305);const Ka=d.an(new Float32Array(16));function yu(f,e,s,l,u,p){const{horizontalAlign:v,verticalAlign:w}=d.au(f);return new d.P((-(v-.5)*e/u+l[0])*p,(-(w-.5)*s/u+l[1])*p)}function ks(f,e,s,l,u,p){const v=e.tileAnchorPoint.add(new d.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=l.mult(p);s||(w=w.rotate(-u));const T=v.add(w);return $(T.x,T.y,e.labelPlaneMatrix,e.getElevation).point}if(s){const w=_e(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(f),T=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return f.add(l.rotate(T))}return f.add(l)}function Js(f,e,s,l,u,p,v,w,T,P,M,z,F,j){const V=f.text.placedSymbolArray,H=f.text.dynamicLayoutVertexArray,K=f.icon.dynamicLayoutVertexArray,J={};H.clear();for(let re=0;re<V.length;re++){const q=V.get(re),ae=q.hidden||!q.crossTileID||f.allowVerticalPlacement&&!q.placedOrientation?null:l[q.crossTileID];if(ae){const le=new d.P(q.anchorX,q.anchorY),pe={getElevation:j,width:u.width,height:u.height,labelPlaneMatrix:p,pitchWithMap:s,projection:M,tileAnchorPoint:le,translation:z,unwrappedTileID:F},xe=s?$(le.x,le.y,v,j):_e(le.x,le.y,pe),Te=D(u.cameraToCenterDistance,xe.signedDistanceFromCamera);let Oe=d.ai(f.textSizeData,T,q)*Te/d.ap;s&&(Oe*=f.tilePixelRatio/w);const{width:$e,height:Le,anchor:Ae,textOffset:Je,textBoxScale:ft}=ae,Fe=yu(Ae,$e,Le,Je,ft,Oe),je=M.getPitchedTextCorrection(u,le.add(new d.P(z[0],z[1])),F),dt=ks(xe.point,pe,e,Fe,u.angle,je),ir=f.allowVerticalPlacement&&q.placedOrientation===d.ah.vertical?Math.PI/2:0;for(let xt=0;xt<q.numGlyphs;xt++)d.aj(H,dt,ir);P&&q.associatedIconIndex>=0&&(J[q.associatedIconIndex]={shiftedAnchor:dt,angle:ir})}else nt(q.numGlyphs,H)}if(P){K.clear();const re=f.icon.placedSymbolArray;for(let q=0;q<re.length;q++){const ae=re.get(q);if(ae.hidden)nt(ae.numGlyphs,K);else{const le=J[q];if(le)for(let pe=0;pe<ae.numGlyphs;pe++)d.aj(K,le.shiftedAnchor,le.angle);else nt(ae.numGlyphs,K)}}f.icon.dynamicLayoutVertexBuffer.updateData(K)}f.text.dynamicLayoutVertexBuffer.updateData(H)}function Hi(f,e,s){return s.iconsInText&&e?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function vu(f,e,s,l,u,p,v,w,T,P,M,z){const F=f.context,j=F.gl,V=f.transform,H=ys(),K=w==="map",J=T==="map",re=w!=="viewport"&&s.layout.get("symbol-placement")!=="point",q=K&&!J&&!re,ae=!J&&re,le=!s.layout.get("symbol-sort-key").isConstant();let pe=!1;const xe=f.depthModeForSublayer(0,Tt.ReadOnly),Te=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Oe=[],$e=H.getCircleRadiusCorrection(V);for(const Le of l){const Ae=e.getTile(Le),Je=Ae.getBucket(s);if(!Je)continue;const ft=u?Je.text:Je.icon;if(!ft||!ft.segments.get().length||!ft.hasVisibleVertices)continue;const Fe=ft.programConfigurations.get(s.id),je=u||Je.sdfIcons,dt=u?Je.textSizeData:Je.iconSizeData,ir=J||V.pitch!==0,xt=f.useProgram(Hi(je,u,Je),Fe),Pt=d.ag(dt,V.zoom),nr=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Le);let Kr,dn,sr,xi,li=[0,0],Jr=null;if(u)dn=Ae.glyphAtlasTexture,sr=j.LINEAR,Kr=Ae.glyphAtlasTexture.size,Je.iconsInText&&(li=Ae.imageAtlasTexture.size,Jr=Ae.imageAtlasTexture,xi=ir||f.options.rotating||f.options.zooming||dt.kind==="composite"||dt.kind==="camera"?j.LINEAR:j.NEAREST);else{const zt=s.layout.get("icon-size").constantOr(0)!==1||Je.iconsNeedLinear;dn=Ae.imageAtlasTexture,sr=je||f.options.rotating||f.options.zooming||zt||ir?j.LINEAR:j.NEAREST,Kr=Ae.imageAtlasTexture.size}const ui=Et(Ae,1,f.transform.zoom),zn=ae?Le.posMatrix:Ka,da=bt(zn,J,K,f.transform,ui),ul=Ut(zn,J,K,f.transform,ui),pa=Ut(Le.posMatrix,J,K,f.transform,ui),Ki=H.translatePosition(f.transform,Ae,p,v),cl=Te&&Je.hasTextData(),Zu=s.layout.get("icon-text-fit")!=="none"&&cl&&Je.hasIconData();if(re){const zt=f.style.map.terrain?(fa,ma)=>f.style.map.terrain.getElevation(Le,fa,ma):null,Ms=s.layout.get("text-rotation-alignment")==="map";O(Je,Le.posMatrix,f,u,da,pa,J,P,Ms,H,Le.toUnwrapped(),V.width,V.height,Ki,zt)}const Ji=Le.posMatrix,Yi=u&&Te||Zu,ns=re||Yi?Ka:da,pn=ul,Ur=je&&s.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Yr;Yr=je?Je.iconsInText?ou(dt.kind,Pt,q,J,re,Yi,f,Ji,ns,pn,Ki,Kr,li,$e):Ha(dt.kind,Pt,q,J,re,Yi,f,Ji,ns,pn,Ki,u,Kr,!0,$e):ih(dt.kind,Pt,q,J,re,Yi,f,Ji,ns,pn,Ki,u,Kr,$e);const Oi={program:xt,buffers:ft,uniformValues:Yr,atlasTexture:dn,atlasTextureIcon:Jr,atlasInterpolation:sr,atlasInterpolationIcon:xi,isSDF:je,hasHalo:Ur};if(le&&Je.canOverlap){pe=!0;const zt=ft.segments.get();for(const Ms of zt)Oe.push({segments:new d.a0([Ms]),sortKey:Ms.sortKey,state:Oi,terrainData:nr})}else Oe.push({segments:ft.segments,sortKey:0,state:Oi,terrainData:nr})}pe&&Oe.sort((Le,Ae)=>Le.sortKey-Ae.sortKey);for(const Le of Oe){const Ae=Le.state;if(F.activeTexture.set(j.TEXTURE0),Ae.atlasTexture.bind(Ae.atlasInterpolation,j.CLAMP_TO_EDGE),Ae.atlasTextureIcon&&(F.activeTexture.set(j.TEXTURE1),Ae.atlasTextureIcon&&Ae.atlasTextureIcon.bind(Ae.atlasInterpolationIcon,j.CLAMP_TO_EDGE)),Ae.isSDF){const Je=Ae.uniformValues;Ae.hasHalo&&(Je.u_is_halo=1,xu(Ae.buffers,Le.segments,s,f,Ae.program,xe,M,z,Je,Le.terrainData)),Je.u_is_halo=0}xu(Ae.buffers,Le.segments,s,f,Ae.program,xe,M,z,Ae.uniformValues,Le.terrainData)}}function xu(f,e,s,l,u,p,v,w,T,P){const M=l.context;u.draw(M,M.gl.TRIANGLES,p,v,w,Gt.disabled,T,P,s.id,f.layoutVertexBuffer,f.indexBuffer,e,s.paint,l.transform.zoom,f.programConfigurations.get(s.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function wu(f,e,s,l){const u=f.context,p=u.gl,v=Kt.disabled,w=new fr([p.ONE,p.ONE],d.aM.transparent,[!0,!0,!0,!0]),T=e.getBucket(s);if(!T)return;const P=l.key;let M=s.heatmapFbos.get(P);M||(M=Ja(u,e.tileSize,e.tileSize),s.heatmapFbos.set(P,M)),u.bindFramebuffer.set(M.framebuffer),u.viewport.set([0,0,e.tileSize,e.tileSize]),u.clear({color:d.aM.transparent});const z=T.programConfigurations.get(s.id),F=f.useProgram("heatmap",z),j=f.style.map.terrain.getTerrainData(l);F.draw(u,p.TRIANGLES,Tt.disabled,v,w,Gt.disabled,vi(l.posMatrix,e,f.transform.zoom,s.paint.get("heatmap-intensity")),j,s.id,T.layoutVertexBuffer,T.indexBuffer,T.segments,s.paint,f.transform.zoom,z)}function Is(f,e,s){const l=f.context,u=l.gl;l.setColorMode(f.colorModeForRenderPass());const p=Ya(l,e),v=s.key,w=e.heatmapFbos.get(v);w&&(l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,w.colorAttachment.get()),l.activeTexture.set(u.TEXTURE1),p.bind(u.LINEAR,u.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(l,u.TRIANGLES,Tt.disabled,Kt.disabled,f.colorModeForRenderPass(),Gt.disabled,Fo(f,e,0,1),null,e.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments,e.paint,f.transform.zoom),w.destroy(),e.heatmapFbos.delete(v))}function Ja(f,e,s){var l,u;const p=f.gl,v=p.createTexture();p.bindTexture(p.TEXTURE_2D,v),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);const w=(l=f.HALF_FLOAT)!==null&&l!==void 0?l:p.UNSIGNED_BYTE,T=(u=f.RGBA16F)!==null&&u!==void 0?u:p.RGBA;p.texImage2D(p.TEXTURE_2D,0,T,e,s,0,p.RGBA,w,null);const P=f.createFramebuffer(e,s,!1,!1);return P.colorAttachment.set(v),P}function Ya(f,e){return e.colorRampTexture||(e.colorRampTexture=new wt(f,e.colorRamp,f.gl.RGBA)),e.colorRampTexture}function Ys(f,e,s,l,u){if(!s||!l||!l.imageAtlas)return;const p=l.imageAtlas.patternPositions;let v=p[s.to.toString()],w=p[s.from.toString()];if(!v&&w&&(v=w),!w&&v&&(w=v),!v||!w){const T=u.getPaintProperty(e);v=p[T],w=p[T]}v&&w&&f.setConstantPatternPositions(v,w)}function Qa(f,e,s,l,u,p,v){const w=f.context.gl,T="fill-pattern",P=s.paint.get(T),M=P&&P.constantOr(1),z=s.getCrossfadeParameters();let F,j,V,H,K;v?(j=M&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=w.LINES):(j=M?"fillPattern":"fill",F=w.TRIANGLES);const J=P.constantOr(null);for(const re of l){const q=e.getTile(re);if(M&&!q.patternsLoaded())continue;const ae=q.getBucket(s);if(!ae)continue;const le=ae.programConfigurations.get(s.id),pe=f.useProgram(j,le),xe=f.style.map.terrain&&f.style.map.terrain.getTerrainData(re);M&&(f.context.activeTexture.set(w.TEXTURE0),q.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),le.updatePaintBuffers(z)),Ys(le,T,J,q,s);const Te=xe?re:null,Oe=f.translatePosMatrix(Te?Te.posMatrix:re.posMatrix,q,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(v){H=ae.indexBuffer2,K=ae.segments2;const $e=[w.drawingBufferWidth,w.drawingBufferHeight];V=j==="fillOutlinePattern"&&M?Qc(Oe,f,z,q,$e):_p(Oe,$e)}else H=ae.indexBuffer,K=ae.segments,V=M?Yc(Oe,f,z,q):Ws(Oe);pe.draw(f.context,F,u,f.stencilModeForClipping(re),p,Gt.disabled,V,xe,s.id,ae.layoutVertexBuffer,H,K,s.paint,f.transform.zoom,le)}}function qo(f,e,s,l,u,p,v){const w=f.context,T=w.gl,P="fill-extrusion-pattern",M=s.paint.get(P),z=M.constantOr(1),F=s.getCrossfadeParameters(),j=s.paint.get("fill-extrusion-opacity"),V=M.constantOr(null);for(const H of l){const K=e.getTile(H),J=K.getBucket(s);if(!J)continue;const re=f.style.map.terrain&&f.style.map.terrain.getTerrainData(H),q=J.programConfigurations.get(s.id),ae=f.useProgram(z?"fillExtrusionPattern":"fillExtrusion",q);z&&(f.context.activeTexture.set(T.TEXTURE0),K.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),q.updatePaintBuffers(F)),Ys(q,P,V,K,s);const le=f.translatePosMatrix(H.posMatrix,K,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),pe=s.paint.get("fill-extrusion-vertical-gradient"),xe=z?Ro(le,f,pe,j,H,F,K):qa(le,f,pe,j);ae.draw(w,w.gl.TRIANGLES,u,p,v,Gt.backCCW,xe,re,s.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,s.paint,f.transform.zoom,q,f.style.map.terrain&&J.centroidVertexBuffer)}}function Qs(f,e,s,l,u,p,v){const w=f.context,T=w.gl,P=s.fbo;if(!P)return;const M=f.useProgram("hillshade"),z=f.style.map.terrain&&f.style.map.terrain.getTerrainData(e);w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,P.colorAttachment.get()),M.draw(w,T.TRIANGLES,u,p,v,Gt.disabled,((F,j,V,H)=>{const K=V.paint.get("hillshade-shadow-color"),J=V.paint.get("hillshade-highlight-color"),re=V.paint.get("hillshade-accent-color");let q=V.paint.get("hillshade-illumination-direction")*(Math.PI/180);V.paint.get("hillshade-illumination-anchor")==="viewport"&&(q-=F.transform.angle);const ae=!F.options.moving;return{u_matrix:H?H.posMatrix:F.transform.calculatePosMatrix(j.tileID.toUnwrapped(),ae),u_image:0,u_latrange:Bo(0,j.tileID),u_light:[V.paint.get("hillshade-exaggeration"),q],u_shadow:K,u_highlight:J,u_accent:re}})(f,s,l,z?e:null),z,l.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function ea(f,e,s,l,u,p){const v=f.context,w=v.gl,T=e.dem;if(T&&T.data){const P=T.dim,M=T.stride,z=T.getPixels();if(v.activeTexture.set(w.TEXTURE1),v.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||f.getTileTexture(M),e.demTexture){const j=e.demTexture;j.update(z,{premultiply:!1}),j.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else e.demTexture=new wt(v,z,w.RGBA,{premultiply:!1}),e.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);v.activeTexture.set(w.TEXTURE0);let F=e.fbo;if(!F){const j=new wt(v,{width:P,height:P,data:null},w.RGBA);j.bind(w.LINEAR,w.CLAMP_TO_EDGE),F=e.fbo=v.createFramebuffer(P,P,!0,!1),F.colorAttachment.set(j.texture)}v.bindFramebuffer.set(F.framebuffer),v.viewport.set([0,0,P,P]),f.useProgram("hillshadePrepare").draw(v,w.TRIANGLES,l,u,p,Gt.disabled,((j,V)=>{const H=V.stride,K=d.H();return d.aP(K,0,d.X,-d.X,0,0,1),d.J(K,K,[0,-d.X,0]),{u_matrix:K,u_image:1,u_dimension:[H,H],u_zoom:j.overscaledZ,u_unpack:V.getUnpackVector()}})(e.tileID,T),null,s.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function gh(f,e,s,l,u,p){const v=l.paint.get("raster-fade-duration");if(!p&&v>0){const w=Q.now(),T=(w-f.timeAdded)/v,P=e?(w-e.timeAdded)/v:-1,M=s.getSource(),z=u.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),F=!e||Math.abs(e.tileID.overscaledZ-z)>Math.abs(f.tileID.overscaledZ-z),j=F&&f.refreshedUponExpiration?1:d.ac(F?T:1-P,0,1);return f.refreshedUponExpiration&&T>=1&&(f.refreshedUponExpiration=!1),e?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}const bu=new d.aM(1,0,0,1),Ft=new d.aM(0,1,0,1),Go=new d.aM(0,0,1,1),Ap=new d.aM(1,0,1,1),_h=new d.aM(0,1,1,1);function ta(f,e,s,l){Ho(f,0,e+s/2,f.transform.width,s,l)}function yh(f,e,s,l){Ho(f,e-s/2,0,s,f.transform.height,l)}function Ho(f,e,s,l,u,p){const v=f.context,w=v.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*f.pixelRatio,s*f.pixelRatio,l*f.pixelRatio,u*f.pixelRatio),v.clear({color:p}),w.disable(w.SCISSOR_TEST)}function vh(f,e,s){const l=f.context,u=l.gl,p=s.posMatrix,v=f.useProgram("debug"),w=Tt.disabled,T=Kt.disabled,P=f.colorModeForRenderPass(),M="$debug",z=f.style.map.terrain&&f.style.map.terrain.getTerrainData(s);l.activeTexture.set(u.TEXTURE0);const F=e.getTileByID(s.key).latestRawTileData,j=Math.floor((F&&F.byteLength||0)/1024),V=e.getTile(s).tileSize,H=512/Math.min(V,512)*(s.overscaledZ/f.transform.zoom)*.5;let K=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(K+=` => ${s.overscaledZ}`),function(J,re){J.initDebugOverlayCanvas();const q=J.debugOverlayCanvas,ae=J.context.gl,le=J.debugOverlayCanvas.getContext("2d");le.clearRect(0,0,q.width,q.height),le.shadowColor="white",le.shadowBlur=2,le.lineWidth=1.5,le.strokeStyle="white",le.textBaseline="top",le.font="bold 36px Open Sans, sans-serif",le.fillText(re,5,5),le.strokeText(re,5,5),J.debugOverlayTexture.update(q),J.debugOverlayTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE)}(f,`${K} ${j}kB`),v.draw(l,u.TRIANGLES,w,T,fr.alphaBlended,Gt.disabled,Ga(p,d.aM.transparent,H),null,M,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),v.draw(l,u.LINE_STRIP,w,T,P,Gt.disabled,Ga(p,d.aM.red),z,M,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function xh(f,e,s){const l=f.context,u=l.gl,p=f.colorModeForRenderPass(),v=new Tt(u.LEQUAL,Tt.ReadWrite,f.depthRangeFor3D),w=f.useProgram("terrain"),T=e.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,f.width,f.height]);for(const P of s){const M=f.renderToTexture.getTexture(P),z=e.getTerrainData(P.tileID);l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,M.texture);const F=f.transform.calculatePosMatrix(P.tileID.toUnwrapped()),j=e.getMeshFrameDelta(f.transform.zoom),V=f.transform.calculateFogMatrix(P.tileID.toUnwrapped()),H=su(F,j,V,f.style.sky,f.transform.pitch);w.draw(l,u.TRIANGLES,v,Kt.disabled,p,Gt.backCCW,H,z,"terrain",T.vertexBuffer,T.indexBuffer,T.segments)}}class Wo{constructor(e,s,l){this.vertexBuffer=e,this.indexBuffer=s,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Xo{constructor(e,s){this.context=new zp(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=lt.maxUnderzooming+lt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new iu}resize(e,s,l){if(this.width=Math.floor(e*l),this.height=Math.floor(s*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const e=this.context,s=new d.aX;s.emplaceBack(0,0),s.emplaceBack(d.X,0),s.emplaceBack(0,d.X),s.emplaceBack(d.X,d.X),this.tileExtentBuffer=e.createVertexBuffer(s,vs.members),this.tileExtentSegments=d.a0.simpleSegment(0,0,4,2);const l=new d.aX;l.emplaceBack(0,0),l.emplaceBack(d.X,0),l.emplaceBack(0,d.X),l.emplaceBack(d.X,d.X),this.debugBuffer=e.createVertexBuffer(l,vs.members),this.debugSegments=d.a0.simpleSegment(0,0,4,5);const u=new d.$;u.emplaceBack(0,0,0,0),u.emplaceBack(d.X,0,d.X,0),u.emplaceBack(0,d.X,0,d.X),u.emplaceBack(d.X,d.X,d.X,d.X),this.rasterBoundsBuffer=e.createVertexBuffer(u,Ai.members),this.rasterBoundsSegments=d.a0.simpleSegment(0,0,4,2);const p=new d.aX;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(p,vs.members),this.viewportSegments=d.a0.simpleSegment(0,0,4,2);const v=new d.aZ;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(v);const w=new d.aY;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(w);const T=this.context.gl;this.stencilClearMode=new Kt({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=d.H();d.aP(l,0,this.width,this.height,0,0,1),d.K(l,l,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,Tt.disabled,this.stencilClearMode,fr.disabled,Gt.disabled,yi(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const l=this.context,u=l.gl;this.nextStencilID+s.length>256&&this.clearStencil(),l.setColorMode(fr.disabled),l.setDepthMode(Tt.disabled);const p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of s){const w=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,T=this.style.map.terrain&&this.style.map.terrain.getTerrainData(v);p.draw(l,u.TRIANGLES,Tt.disabled,new Kt({func:u.ALWAYS,mask:0},w,255,u.KEEP,u.KEEP,u.REPLACE),fr.disabled,Gt.disabled,yi(v.posMatrix),T,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new Kt({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new Kt({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,l=e.sort((v,w)=>w.overscaledZ-v.overscaledZ),u=l[l.length-1].overscaledZ,p=l[0].overscaledZ-u+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const v={};for(let w=0;w<p;w++)v[w+u]=new Kt({func:s.GEQUAL,mask:255},w+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=p,[v,l]}return[{[u]:Kt.disabled},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new fr([e.CONSTANT_COLOR,e.ONE],new d.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?fr.unblended:fr.alphaBlended}depthModeForSublayer(e,s,l){if(!this.opaquePassEnabledForLayer())return Tt.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Tt(l||this.context.gl.LEQUAL,s,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Q.now()),this.imageManager.beginFrame();const l=this.style._order,u=this.style.sourceCaches,p={},v={},w={};for(const T in u){const P=u[T];P.used&&P.prepare(this.context),p[T]=P.getVisibleCoordinates(),v[T]=p[T].slice().reverse(),w[T]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let T=0;T<l.length;T++)if(this.style._layers[l[T]].is3D()){this.opaquePassCutoff=T;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const T of l){const P=this.style._layers[T];if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const M=v[P.source];(P.type==="custom"||M.length)&&this.renderLayer(this,u[P.source],P,M)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?d.aM.black:d.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(T,P){const M=T.context,z=M.gl,F=((J,re,q)=>({u_sky_color:J.properties.get("sky-color"),u_horizon_color:J.properties.get("horizon-color"),u_horizon:(re.height/2+re.getHorizon())*q,u_sky_horizon_blend:J.properties.get("sky-horizon-blend")*re.height/2*q}))(P,T.style.map.transform,T.pixelRatio),j=new Tt(z.LEQUAL,Tt.ReadWrite,[0,1]),V=Kt.disabled,H=T.colorModeForRenderPass(),K=T.useProgram("sky");if(!P.mesh){const J=new d.aX;J.emplaceBack(-1,-1),J.emplaceBack(1,-1),J.emplaceBack(1,1),J.emplaceBack(-1,1);const re=new d.aY;re.emplaceBack(0,1,2),re.emplaceBack(0,2,3),P.mesh=new Wo(M.createVertexBuffer(J,vs.members),M.createIndexBuffer(re),d.a0.simpleSegment(0,0,J.length,re.length))}K.draw(M,z.TRIANGLES,j,V,H,Gt.disabled,F,void 0,"sky",P.mesh.vertexBuffer,P.mesh.indexBuffer,P.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const T=this.style._layers[l[this.currentLayer]],P=u[T.source],M=p[T.source];this._renderTileClippingMasks(T,M),this.renderLayer(this,P,T,M)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const T=this.style._layers[l[this.currentLayer]],P=u[T.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(T))continue;const M=(T.type==="symbol"?w:v)[T.source];this._renderTileClippingMasks(T,p[T.source]),this.renderLayer(this,P,T,M)}if(this.options.showTileBoundaries){const T=function(P,M){let z=null;const F=Object.values(P._layers).flatMap(K=>K.source&&!K.isHidden(M)?[P.sourceCaches[K.source]]:[]),j=F.filter(K=>K.getSource().type==="vector"),V=F.filter(K=>K.getSource().type!=="vector"),H=K=>{(!z||z.getSource().maxzoom<K.getSource().maxzoom)&&(z=K)};return j.forEach(K=>H(K)),z||V.forEach(K=>H(K)),z}(this.style,this.transform.zoom);T&&function(P,M,z){for(let F=0;F<z.length;F++)vh(P,M,z[F])}(this,T,T.getVisibleCoordinates())}this.options.showPadding&&function(T){const P=T.transform.padding;ta(T,T.transform.height-(P.top||0),3,bu),ta(T,P.bottom||0,3,Ft),yh(T,P.left||0,3,Go),yh(T,T.transform.width-(P.right||0),3,Ap);const M=T.transform.centerPoint;(function(z,F,j,V){Ho(z,F-1,j-10,2,20,V),Ho(z,F-10,j-1,20,2,V)})(T,M.x,T.transform.height-M.y,_h)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let u=this.terrainFacilitator.dirty;u||(u=e?!d.a_(s,l):!d.a$(s,l)),u||(u=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),u&&(d.b0(s,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(p,v){const w=p.context,T=w.gl,P=fr.unblended,M=new Tt(T.LEQUAL,Tt.ReadWrite,[0,1]),z=v.getTerrainMesh(),F=v.sourceCache.getRenderableTiles(),j=p.useProgram("terrainDepth");w.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),w.clear({color:d.aM.transparent,depth:1});for(const V of F){const H=v.getTerrainData(V.tileID),K={u_matrix:p.transform.calculatePosMatrix(V.tileID.toUnwrapped()),u_ele_delta:v.getMeshFrameDelta(p.transform.zoom)};j.draw(w,T.TRIANGLES,M,Kt.disabled,P,Gt.backCCW,K,H,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain),function(p,v){const w=p.context,T=w.gl,P=fr.unblended,M=new Tt(T.LEQUAL,Tt.ReadWrite,[0,1]),z=v.getTerrainMesh(),F=v.getCoordsTexture(),j=v.sourceCache.getRenderableTiles(),V=p.useProgram("terrainCoords");w.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),w.clear({color:d.aM.transparent,depth:1}),v.coordsIndex=[];for(const H of j){const K=v.getTerrainData(H.tileID);w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,F.texture);const J={u_matrix:p.transform.calculatePosMatrix(H.tileID.toUnwrapped()),u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(p.transform.zoom)};V.draw(w,T.TRIANGLES,M,Kt.disabled,P,Gt.backCCW,J,K,"terrain",z.vertexBuffer,z.indexBuffer,z.segments),v.coordsIndex.push(H.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain))}renderLayer(e,s,l,u){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(u||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(p,v,w,T,P){if(p.renderPass!=="translucent")return;const M=Kt.disabled,z=p.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(F,j,V,H,K,J,re,q,ae){const le=j.transform,pe=ys(),xe=K==="map",Te=J==="map";for(const Oe of F){const $e=H.getTile(Oe),Le=$e.getBucket(V);if(!Le||!Le.text||!Le.text.segments.get().length)continue;const Ae=d.ag(Le.textSizeData,le.zoom),Je=Et($e,1,j.transform.zoom),ft=bt(Oe.posMatrix,Te,xe,j.transform,Je),Fe=V.layout.get("icon-text-fit")!=="none"&&Le.hasIconData();if(Ae){const je=Math.pow(2,le.zoom-$e.tileID.overscaledZ),dt=j.style.map.terrain?(xt,Pt)=>j.style.map.terrain.getElevation(Oe,xt,Pt):null,ir=pe.translatePosition(le,$e,re,q);Js(Le,xe,Te,ae,le,ft,Oe.posMatrix,je,Ae,Fe,pe,ir,Oe.toUnwrapped(),dt)}}}(T,p,w,v,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),P),w.paint.get("icon-opacity").constantOr(1)!==0&&vu(p,v,w,T,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),M,z),w.paint.get("text-opacity").constantOr(1)!==0&&vu(p,v,w,T,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),M,z),v.map.showCollisionBoxes&&(Xa(p,v,w,T,!0),Xa(p,v,w,T,!1))})(e,s,l,u,this.style.placement.variableOffsets);break;case"circle":(function(p,v,w,T){if(p.renderPass!=="translucent")return;const P=w.paint.get("circle-opacity"),M=w.paint.get("circle-stroke-width"),z=w.paint.get("circle-stroke-opacity"),F=!w.layout.get("circle-sort-key").isConstant();if(P.constantOr(1)===0&&(M.constantOr(1)===0||z.constantOr(1)===0))return;const j=p.context,V=j.gl,H=p.depthModeForSublayer(0,Tt.ReadOnly),K=Kt.disabled,J=p.colorModeForRenderPass(),re=[];for(let q=0;q<T.length;q++){const ae=T[q],le=v.getTile(ae),pe=le.getBucket(w);if(!pe)continue;const xe=pe.programConfigurations.get(w.id),Te=p.useProgram("circle",xe),Oe=pe.layoutVertexBuffer,$e=pe.indexBuffer,Le=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ae),Ae={programConfiguration:xe,program:Te,layoutVertexBuffer:Oe,indexBuffer:$e,uniformValues:yp(p,ae,le,w),terrainData:Le};if(F){const Je=pe.segments.get();for(const ft of Je)re.push({segments:new d.a0([ft]),sortKey:ft.sortKey,state:Ae})}else re.push({segments:pe.segments,sortKey:0,state:Ae})}F&&re.sort((q,ae)=>q.sortKey-ae.sortKey);for(const q of re){const{programConfiguration:ae,program:le,layoutVertexBuffer:pe,indexBuffer:xe,uniformValues:Te,terrainData:Oe}=q.state;le.draw(j,V.TRIANGLES,H,K,J,Gt.disabled,Te,Oe,w.id,pe,xe,q.segments,w.paint,p.transform.zoom,ae)}})(e,s,l,u);break;case"heatmap":(function(p,v,w,T){if(w.paint.get("heatmap-opacity")===0)return;const P=p.context;if(p.style.map.terrain){for(const M of T){const z=v.getTile(M);v.hasRenderableParent(M)||(p.renderPass==="offscreen"?wu(p,z,w,M):p.renderPass==="translucent"&&Is(p,w,M))}P.viewport.set([0,0,p.width,p.height])}else p.renderPass==="offscreen"?function(M,z,F,j){const V=M.context,H=V.gl,K=Kt.disabled,J=new fr([H.ONE,H.ONE],d.aM.transparent,[!0,!0,!0,!0]);(function(re,q,ae){const le=re.gl;re.activeTexture.set(le.TEXTURE1),re.viewport.set([0,0,q.width/4,q.height/4]);let pe=ae.heatmapFbos.get(d.aU);pe?(le.bindTexture(le.TEXTURE_2D,pe.colorAttachment.get()),re.bindFramebuffer.set(pe.framebuffer)):(pe=Ja(re,q.width/4,q.height/4),ae.heatmapFbos.set(d.aU,pe))})(V,M,F),V.clear({color:d.aM.transparent});for(let re=0;re<j.length;re++){const q=j[re];if(z.hasRenderableParent(q))continue;const ae=z.getTile(q),le=ae.getBucket(F);if(!le)continue;const pe=le.programConfigurations.get(F.id),xe=M.useProgram("heatmap",pe),{zoom:Te}=M.transform;xe.draw(V,H.TRIANGLES,Tt.disabled,K,J,Gt.disabled,vi(q.posMatrix,ae,Te,F.paint.get("heatmap-intensity")),null,F.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,F.paint,M.transform.zoom,pe)}V.viewport.set([0,0,M.width,M.height])}(p,v,w,T):p.renderPass==="translucent"&&function(M,z){const F=M.context,j=F.gl;F.setColorMode(M.colorModeForRenderPass());const V=z.heatmapFbos.get(d.aU);V&&(F.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,V.colorAttachment.get()),F.activeTexture.set(j.TEXTURE1),Ya(F,z).bind(j.LINEAR,j.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(F,j.TRIANGLES,Tt.disabled,Kt.disabled,M.colorModeForRenderPass(),Gt.disabled,Fo(M,z,0,1),null,z.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,z.paint,M.transform.zoom))}(p,w)})(e,s,l,u);break;case"line":(function(p,v,w,T){if(p.renderPass!=="translucent")return;const P=w.paint.get("line-opacity"),M=w.paint.get("line-width");if(P.constantOr(1)===0||M.constantOr(1)===0)return;const z=p.depthModeForSublayer(0,Tt.ReadOnly),F=p.colorModeForRenderPass(),j=w.paint.get("line-dasharray"),V=w.paint.get("line-pattern"),H=V.constantOr(1),K=w.paint.get("line-gradient"),J=w.getCrossfadeParameters(),re=H?"linePattern":j?"lineSDF":K?"lineGradient":"line",q=p.context,ae=q.gl;let le=!0;for(const pe of T){const xe=v.getTile(pe);if(H&&!xe.patternsLoaded())continue;const Te=xe.getBucket(w);if(!Te)continue;const Oe=Te.programConfigurations.get(w.id),$e=p.context.program.get(),Le=p.useProgram(re,Oe),Ae=le||Le.program!==$e,Je=p.style.map.terrain&&p.style.map.terrain.getTerrainData(pe),ft=V.constantOr(null);if(ft&&xe.imageAtlas){const dt=xe.imageAtlas,ir=dt.patternPositions[ft.to.toString()],xt=dt.patternPositions[ft.from.toString()];ir&&xt&&Oe.setConstantPatternPositions(ir,xt)}const Fe=Je?pe:null,je=H?Xs(p,xe,w,J,Fe):j?vp(p,xe,w,j,J,Fe):K?eh(p,xe,w,Te.lineClipsArray.length,Fe):Oo(p,xe,w,Fe);if(H)q.activeTexture.set(ae.TEXTURE0),xe.imageAtlasTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),Oe.updatePaintBuffers(J);else if(j&&(Ae||p.lineAtlas.dirty))q.activeTexture.set(ae.TEXTURE0),p.lineAtlas.bind(q);else if(K){const dt=Te.gradients[w.id];let ir=dt.texture;if(w.gradientVersion!==dt.version){let xt=256;if(w.stepInterpolant){const Pt=v.getSource().maxzoom,nr=pe.canonical.z===Pt?Math.ceil(1<<p.transform.maxZoom-pe.canonical.z):1;xt=d.ac(d.aV(Te.maxLineLength/d.X*1024*nr),256,q.maxTextureSize)}dt.gradient=d.aW({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:xt,image:dt.gradient||void 0,clips:Te.lineClipsArray}),dt.texture?dt.texture.update(dt.gradient):dt.texture=new wt(q,dt.gradient,ae.RGBA),dt.version=w.gradientVersion,ir=dt.texture}q.activeTexture.set(ae.TEXTURE0),ir.bind(w.stepInterpolant?ae.NEAREST:ae.LINEAR,ae.CLAMP_TO_EDGE)}Le.draw(q,ae.TRIANGLES,z,p.stencilModeForClipping(pe),F,Gt.disabled,je,Je,w.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,w.paint,p.transform.zoom,Oe,Te.layoutVertexBuffer2),le=!1}})(e,s,l,u);break;case"fill":(function(p,v,w,T){const P=w.paint.get("fill-color"),M=w.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const z=p.colorModeForRenderPass(),F=w.paint.get("fill-pattern"),j=p.opaquePassEnabledForLayer()&&!F.constantOr(1)&&P.constantOr(d.aM.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===j){const V=p.depthModeForSublayer(1,p.renderPass==="opaque"?Tt.ReadWrite:Tt.ReadOnly);Qa(p,v,w,T,V,z,!1)}if(p.renderPass==="translucent"&&w.paint.get("fill-antialias")){const V=p.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,Tt.ReadOnly);Qa(p,v,w,T,V,z,!0)}})(e,s,l,u);break;case"fill-extrusion":(function(p,v,w,T){const P=w.paint.get("fill-extrusion-opacity");if(P!==0&&p.renderPass==="translucent"){const M=new Tt(p.context.gl.LEQUAL,Tt.ReadWrite,p.depthRangeFor3D);if(P!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))qo(p,v,w,T,M,Kt.disabled,fr.disabled),qo(p,v,w,T,M,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const z=p.colorModeForRenderPass();qo(p,v,w,T,M,Kt.disabled,z)}}})(e,s,l,u);break;case"hillshade":(function(p,v,w,T){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const P=p.context,M=p.depthModeForSublayer(0,Tt.ReadOnly),z=p.colorModeForRenderPass(),[F,j]=p.renderPass==="translucent"?p.stencilConfigForOverlap(T):[{},T];for(const V of j){const H=v.getTile(V);H.needsHillshadePrepare!==void 0&&H.needsHillshadePrepare&&p.renderPass==="offscreen"?ea(p,H,w,M,Kt.disabled,z):p.renderPass==="translucent"&&Qs(p,V,H,w,M,F[V.overscaledZ],z)}P.viewport.set([0,0,p.width,p.height])})(e,s,l,u);break;case"raster":(function(p,v,w,T){if(p.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!T.length)return;const P=p.context,M=P.gl,z=v.getSource(),F=p.useProgram("raster"),j=p.colorModeForRenderPass(),[V,H]=z instanceof Wr?[{},T]:p.stencilConfigForOverlap(T),K=H[H.length-1].overscaledZ,J=!p.options.moving;for(const re of H){const q=p.depthModeForSublayer(re.overscaledZ-K,w.paint.get("raster-opacity")===1?Tt.ReadWrite:Tt.ReadOnly,M.LESS),ae=v.getTile(re);ae.registerFadeDuration(w.paint.get("raster-fade-duration"));const le=v.findLoadedParent(re,0),pe=v.findLoadedSibling(re),xe=gh(ae,le||pe||null,v,w,p.transform,p.style.map.terrain);let Te,Oe;const $e=w.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;P.activeTexture.set(M.TEXTURE0),ae.texture.bind($e,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),P.activeTexture.set(M.TEXTURE1),le?(le.texture.bind($e,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),Te=Math.pow(2,le.tileID.overscaledZ-ae.tileID.overscaledZ),Oe=[ae.tileID.canonical.x*Te%1,ae.tileID.canonical.y*Te%1]):ae.texture.bind($e,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),ae.texture.useMipmap&&P.extTextureFilterAnisotropic&&p.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);const Le=p.style.map.terrain&&p.style.map.terrain.getTerrainData(re),Ae=Le?re:null,Je=Ae?Ae.posMatrix:p.transform.calculatePosMatrix(re.toUnwrapped(),J),ft=xp(Je,Oe||[0,0],Te||1,xe,w);z instanceof Wr?F.draw(P,M.TRIANGLES,q,Kt.disabled,j,Gt.disabled,ft,Le,w.id,z.boundsBuffer,p.quadTriangleIndexBuffer,z.boundsSegments):F.draw(P,M.TRIANGLES,q,V[re.overscaledZ],j,Gt.disabled,ft,Le,w.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}})(e,s,l,u);break;case"background":(function(p,v,w,T){const P=w.paint.get("background-color"),M=w.paint.get("background-opacity");if(M===0)return;const z=p.context,F=z.gl,j=p.transform,V=j.tileSize,H=w.paint.get("background-pattern");if(p.isPatternMissing(H))return;const K=!H&&P.a===1&&M===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==K)return;const J=Kt.disabled,re=p.depthModeForSublayer(0,K==="opaque"?Tt.ReadWrite:Tt.ReadOnly),q=p.colorModeForRenderPass(),ae=p.useProgram(H?"backgroundPattern":"background"),le=T||j.coveringTiles({tileSize:V,terrain:p.style.map.terrain});H&&(z.activeTexture.set(F.TEXTURE0),p.imageManager.bind(p.context));const pe=w.getCrossfadeParameters();for(const xe of le){const Te=T?xe.posMatrix:p.transform.calculatePosMatrix(xe.toUnwrapped()),Oe=H?lu(Te,M,p,H,{tileID:xe,tileSize:V},pe):No(Te,M,P),$e=p.style.map.terrain&&p.style.map.terrain.getTerrainData(xe);ae.draw(z,F.TRIANGLES,re,J,q,Gt.disabled,Oe,$e,w.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}})(e,0,l,u);break;case"custom":(function(p,v,w){const T=p.context,P=w.implementation;if(p.renderPass==="offscreen"){const M=P.prerender;M&&(p.setCustomLayerDefaults(),T.setColorMode(p.colorModeForRenderPass()),M.call(P,T.gl,p.transform.customLayerMatrix()),T.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),T.setColorMode(p.colorModeForRenderPass()),T.setStencilMode(Kt.disabled);const M=P.renderingMode==="3d"?new Tt(p.context.gl.LEQUAL,Tt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,Tt.ReadOnly);T.setDepthMode(M),P.render(T.gl,p.transform.customLayerMatrix(),{farZ:p.transform.farZ,nearZ:p.transform.nearZ,fov:p.transform._fov,modelViewProjectionMatrix:p.transform.modelViewProjectionMatrix,projectionMatrix:p.transform.projectionMatrix}),T.setDirty(),p.setBaseState(),T.bindFramebuffer.set(null)}})(e,0,l)}}translatePosMatrix(e,s,l,u,p){if(!l[0]&&!l[1])return e;const v=p?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(v){const P=Math.sin(v),M=Math.cos(v);l=[l[0]*M-l[1]*P,l[0]*P+l[1]*M]}const w=[p?l[0]:Et(s,l[0],this.transform.zoom),p?l[1]:Et(s,l[1],this.transform.zoom),0],T=new Float32Array(16);return d.J(T,e,w),T}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!s||!l}useProgram(e,s){this.cache=this.cache||{};const l=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new au(this.context,rs[e],s,uu[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new wt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:s}=this.context.gl;return this.width!==e||this.height!==s}}class ra{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,l){const u=Math.pow(2,l),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const T=1/(w=d.af([],w,e))[3]/s*u;return d.b1(w,w,[T,T,1/w[3],T])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const T=function(F,j){var V=j[0],H=j[1],K=j[2],J=V*V+H*H+K*K;return J>0&&(J=1/Math.sqrt(J)),F[0]=j[0]*J,F[1]=j[1]*J,F[2]=j[2]*J,F}([],function(F,j,V){var H=j[0],K=j[1],J=j[2],re=V[0],q=V[1],ae=V[2];return F[0]=K*ae-J*q,F[1]=J*re-H*ae,F[2]=H*q-K*re,F}([],Ge([],p[w[0]],p[w[1]]),Ge([],p[w[2]],p[w[1]]))),P=-((M=T)[0]*(z=p[w[1]])[0]+M[1]*z[1]+M[2]*z[2]);var M,z;return T.concat(P)});return new ra(p,v)}}class ia{constructor(e,s){this.min=e,this.max=s,this.center=function(l,u,p){return l[0]=.5*u[0],l[1]=.5*u[1],l[2]=.5*u[2],l}([],function(l,u,p){return l[0]=u[0]+p[0],l[1]=u[1]+p[1],l[2]=u[2]+p[2],l}([],this.min,this.max))}quadrant(e){const s=[e%2==0,e<2],l=Ue(this.min),u=Ue(this.max);for(let p=0;p<s.length;p++)l[p]=s[p]?this.min[p]:this.center[p],u[p]=s[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new ia(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let u=0;u<e.planes.length;u++){const p=e.planes[u];let v=0;for(let w=0;w<s.length;w++)d.b2(p,s[w])>=0&&v++;if(v===0)return 0;v!==s.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){const T=e.points[w][u]-this.min[u];p=Math.min(p,T),v=Math.max(v,T)}if(v<0||p>this.max[u]-this.min[u])return 0}return 1}}class na{constructor(e=0,s=0,l=0,u=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=l,this.right=u}interpolate(e,s,l){return s.top!=null&&e.top!=null&&(this.top=d.y.number(e.top,s.top,l)),s.bottom!=null&&e.bottom!=null&&(this.bottom=d.y.number(e.bottom,s.bottom,l)),s.left!=null&&e.left!=null&&(this.left=d.y.number(e.left,s.left,l)),s.right!=null&&e.right!=null&&(this.right=d.y.number(e.right,s.right,l)),this}getCenter(e,s){const l=d.ac((this.left+e-this.right)/2,0,e),u=d.ac((this.top+s-this.bottom)/2,0,s);return new d.P(l,u)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new na(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Su=85.051129;class sa{constructor(e,s,l,u,p){this.tileSize=512,this._renderWorldCopies=p===void 0||!!p,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=l??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new na,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new sa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-d.b3(e,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var l=new d.A(4);return d.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,u,p){var v=u[0],w=u[1],T=u[2],P=u[3],M=Math.sin(p),z=Math.cos(p);l[0]=v*z+T*M,l[1]=w*z+P*M,l[2]=v*-M+T*z,l[3]=w*-M+P*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=d.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,l){this._unmodified=!1,this._edgeInsets.interpolate(e,s,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new d.b4(0,e)];if(this._renderWorldCopies){const l=this.pointCoordinate(new d.P(0,0)),u=this.pointCoordinate(new d.P(this.width,0)),p=this.pointCoordinate(new d.P(this.width,this.height)),v=this.pointCoordinate(new d.P(0,this.height)),w=Math.floor(Math.min(l.x,u.x,p.x,v.x)),T=Math.floor(Math.max(l.x,u.x,p.x,v.x)),P=1;for(let M=w-P;M<=T+P;M++)M!==0&&s.push(new d.b4(M,e))}return s}coveringTiles(e){var s,l;let u=this.coveringZoomLevel(e);const p=u;if(e.minzoom!==void 0&&u<e.minzoom)return[];e.maxzoom!==void 0&&u>e.maxzoom&&(u=e.maxzoom);const v=this.pointCoordinate(this.getCameraPoint()),w=d.Z.fromLngLat(this.center),T=Math.pow(2,u),P=[T*v.x,T*v.y,0],M=[T*w.x,T*w.y,0],z=ra.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,u);let F=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=u);const j=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,V=q=>({aabb:new ia([q*T,0,0],[(q+1)*T,T,0]),zoom:0,x:0,y:0,wrap:q,fullyVisible:!1}),H=[],K=[],J=u,re=e.reparseOverscaled?p:u;if(this._renderWorldCopies)for(let q=1;q<=3;q++)H.push(V(-q)),H.push(V(q));for(H.push(V(0));H.length>0;){const q=H.pop(),ae=q.x,le=q.y;let pe=q.fullyVisible;if(!pe){const Le=q.aabb.intersects(z);if(Le===0)continue;pe=Le===2}const xe=e.terrain?P:M,Te=q.aabb.distanceX(xe),Oe=q.aabb.distanceY(xe),$e=Math.max(Math.abs(Te),Math.abs(Oe));if(q.zoom===J||$e>j+(1<<J-q.zoom)-2&&q.zoom>=F){const Le=J-q.zoom,Ae=P[0]-.5-(ae<<Le),Je=P[1]-.5-(le<<Le);K.push({tileID:new d.S(q.zoom===J?re:q.zoom,q.wrap,q.zoom,ae,le),distanceSq:it([M[0]-.5-ae,M[1]-.5-le]),tileDistanceToCamera:Math.sqrt(Ae*Ae+Je*Je)})}else for(let Le=0;Le<4;Le++){const Ae=(ae<<1)+Le%2,Je=(le<<1)+(Le>>1),ft=q.zoom+1;let Fe=q.aabb.quadrant(Le);if(e.terrain){const je=new d.S(ft,q.wrap,ft,Ae,Je),dt=e.terrain.getMinMaxElevation(je),ir=(s=dt.minElevation)!==null&&s!==void 0?s:this.elevation,xt=(l=dt.maxElevation)!==null&&l!==void 0?l:this.elevation;Fe=new ia([Fe.min[0],Fe.min[1],ir],[Fe.max[0],Fe.max[1],xt])}H.push({aabb:Fe,zoom:ft,x:Ae,y:Je,wrap:q.wrap,fullyVisible:pe})}}return K.sort((q,ae)=>q.distanceSq-ae.distanceSq).map(q=>q.tileID)}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=d.ac(e.lat,-85.051129,Su);return new d.P(d.O(e.lng)*this.worldSize,d.Q(s)*this.worldSize)}unproject(e){return new d.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.elevation,l=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,u=this.pointLocation(this.centerPoint,e),p=e.getElevationForLngLatZoom(u,this.tileZoom);if(!(this.elevation-p))return;const v=l+s-p,w=Math.cos(this._pitch)*this.cameraToCenterDistance/v/d.b5(1,u.lat),T=this.scaleZoom(w/this.tileSize);this._elevation=p,this._center=u,this.zoom=T}setLocationAtPoint(e,s){const l=this.pointCoordinate(s),u=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(e),v=new d.Z(p.x-(l.x-u.x),p.y-(l.y-u.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),s.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return d.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const F=s.pointCoordinate(e);if(F!=null)return F}const l=[e.x,e.y,0,1],u=[e.x,e.y,1,1];d.af(l,l,this.pixelMatrixInverse),d.af(u,u,this.pixelMatrixInverse);const p=l[3],v=u[3],w=l[1]/p,T=u[1]/v,P=l[2]/p,M=u[2]/v,z=P===M?0:(0-P)/(M-P);return new d.Z(d.y.number(l[0]/p,u[0]/v,z)/this.worldSize,d.y.number(w,T,z)/this.worldSize)}coordinatePoint(e,s=0,l=this.pixelMatrix){const u=[e.x*this.worldSize,e.y*this.worldSize,s,1];return d.af(u,u,l),new d.P(u[0]/u[3],u[1]/u[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new me().extend(this.pointLocation(new d.P(0,e))).extend(this.pointLocation(new d.P(this.width,e))).extend(this.pointLocation(new d.P(this.width,this.height))).extend(this.pointLocation(new d.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new me([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Su])}calculateTileMatrix(e){const s=e.canonical,l=this.worldSize/this.zoomScale(s.z),u=s.x+Math.pow(2,s.z)*e.wrap,p=d.an(new Float64Array(16));return d.J(p,p,[u*l,s.y*l,0]),d.K(p,p,[l/d.X,l/d.X,1]),p}calculatePosMatrix(e,s=!1){const l=e.key,u=s?this._alignedPosMatrixCache:this._posMatrixCache;if(u[l])return u[l];const p=this.calculateTileMatrix(e);return d.L(p,s?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,p),u[l]=new Float32Array(p),u[l]}calculateFogMatrix(e){const s=e.key,l=this._fogMatrixCache;if(l[s])return l[s];const u=this.calculateTileMatrix(e);return d.L(u,this.fogMatrix,u),l[s]=new Float32Array(u),l[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,s){s=d.ac(+s,this.minZoom,this.maxZoom);const l={center:new d.N(e.lng,e.lat),zoom:s};let u=this.lngRange;if(!this._renderWorldCopies&&u===null){const q=179.9999999999;u=[-q,q]}const p=this.tileSize*this.zoomScale(l.zoom);let v=0,w=p,T=0,P=p,M=0,z=0;const{x:F,y:j}=this.size;if(this.latRange){const q=this.latRange;v=d.Q(q[1])*p,w=d.Q(q[0])*p,w-v<j&&(M=j/(w-v))}u&&(T=d.b3(d.O(u[0])*p,0,p),P=d.b3(d.O(u[1])*p,0,p),P<T&&(P+=p),P-T<F&&(z=F/(P-T)));const{x:V,y:H}=this.project.call({worldSize:p},e);let K,J;const re=Math.max(z||0,M||0);if(re){const q=new d.P(z?(P+T)/2:V,M?(w+v)/2:H);return l.center=this.unproject.call({worldSize:p},q).wrap(),l.zoom+=this.scaleZoom(re),l}if(this.latRange){const q=j/2;H-q<v&&(J=v+q),H+q>w&&(J=w-q)}if(u){const q=(T+P)/2;let ae=V;this._renderWorldCopies&&(ae=d.b3(V,q-p/2,q+p/2));const le=F/2;ae-le<T&&(K=T+le),ae+le>P&&(K=P-le)}if(K!==void 0||J!==void 0){const q=new d.P(K??V,J??H);l.center=this.unproject.call({worldSize:p},q).wrap()}return l}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:s,zoom:l}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=l,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=d.b5(1,this.center.lat)*this.worldSize;let u=d.an(new Float64Array(16));d.K(u,u,[this.width/2,-this.height/2,1]),d.J(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=d.an(new Float64Array(16)),d.K(u,u,[1,-1,1]),d.J(u,u,[-1,-1,0]),d.K(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u;const p=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),v=Math.min(this.elevation,this.minElevationForCurrentTile),w=p-v*this._pixelPerMeter/Math.cos(this._pitch),T=v<0?w:p,P=Math.PI/2+this._pitch,M=this._fov*(.5+e.y/this.height),z=Math.sin(M)*T/Math.sin(d.ac(Math.PI-P-M,.01,Math.PI-.01)),F=this.getHorizon(),j=2*Math.atan(F/this.cameraToCenterDistance)*(.5+e.y/(2*F)),V=Math.sin(j)*T/Math.sin(d.ac(Math.PI-P-j,.01,Math.PI-.01)),H=Math.min(z,V);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*H+T),this.nearZ=this.height/50,u=new Float64Array(16),d.b6(u,this._fov,this.width/this.height,this.nearZ,this.farZ),u[8]=2*-e.x/this.width,u[9]=2*e.y/this.height,this.projectionMatrix=d.ae(u),d.K(u,u,[1,-1,1]),d.J(u,u,[0,0,-this.cameraToCenterDistance]),d.b7(u,u,this._pitch),d.ad(u,u,this.angle),d.J(u,u,[-s,-l,0]),this.mercatorMatrix=d.K([],u,[this.worldSize,this.worldSize,this.worldSize]),d.K(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=d.L(new Float64Array(16),this.labelPlaneMatrix,u),d.J(u,u,[0,0,-this.elevation]),this.modelViewProjectionMatrix=u,this.invModelViewProjectionMatrix=d.as([],u),this.fogMatrix=new Float64Array(16),d.b6(this.fogMatrix,this._fov,this.width/this.height,p,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,d.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),d.b7(this.fogMatrix,this.fogMatrix,this._pitch),d.ad(this.fogMatrix,this.fogMatrix,this.angle),d.J(this.fogMatrix,this.fogMatrix,[-s,-l,0]),d.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=d.L(new Float64Array(16),this.labelPlaneMatrix,u);const K=this.width%2/2,J=this.height%2/2,re=Math.cos(this.angle),q=Math.sin(this.angle),ae=s-Math.round(s)+re*K+q*J,le=l-Math.round(l)+re*J+q*K,pe=new Float64Array(u);if(d.J(pe,pe,[ae>.5?ae-1:ae,le>.5?le-1:le,0]),this.alignedModelViewProjectionMatrix=pe,u=d.as(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new d.P(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return d.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let l=s.x,u=s.y,p=s.x,v=s.y;for(const w of e)l=Math.min(l,w.x),u=Math.min(u,w.y),p=Math.max(p,w.x),v=Math.max(v,w.y);return[new d.P(l,u),new d.P(p,u),new d.P(p,v),new d.P(l,v),new d.P(l,u)]}}lngLatToCameraDepth(e,s){const l=this.locationCoordinate(e),u=[l.x*this.worldSize,l.y*this.worldSize,s,1];return d.af(u,u,this.modelViewProjectionMatrix),u[2]/u[3]}}function eo(f,e){let s,l=!1,u=null,p=null;const v=()=>{u=null,l&&(f.apply(p,s),u=setTimeout(v,e),l=!1)};return(...w)=>(l=!0,p=this,s=w,u||v(),u)}class Ko{constructor(e){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let l;return s.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(l=u)}),(l&&l[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:l,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const l=s.join("/");let u=l;u.split("&").length>0&&(u=u.split("&")[0]),this._hashName&&(u=`${this._hashName}=${l}`);let p=window.location.hash.replace(u,"");p.startsWith("#&")?p=p.slice(0,1)+p.slice(2):p==="#"&&(p="");let v=window.location.href.replace(/(#.+)?$/,p);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=eo(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const s=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,u),v=Math.round(s.lng*p)/p,w=Math.round(s.lat*p)/p,T=this._map.getBearing(),P=this._map.getPitch();let M="";if(M+=e?`/${v}/${w}/${l}`:`${l}/${w}/${v}`,(T||P)&&(M+="/"+Math.round(10*T)/10),P&&(M+=`/${Math.round(P)}`),this._hashName){const z=this._hashName;let F=!1;const j=window.location.hash.slice(1).split("&").map(V=>{const H=V.split("=")[0];return H===z?(F=!0,`${H}=${M}`):V}).filter(V=>V);return F||j.push(`${z}=${M}`),`#${j.join("&")}`}return`#${M}`}}const Jo={linearity:.3,easing:d.b8(0,0,.3,1)},Tu=d.e({deceleration:2500,maxSpeed:1400},Jo),Dp=d.e({deceleration:20,maxSpeed:1400},Jo),wh=d.e({deceleration:1e3,maxSpeed:360},Jo),Yo=d.e({deceleration:1e3,maxSpeed:90},Jo);class ku{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Q.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=Q.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)s.zoom+=p.zoomDelta||0,s.bearing+=p.bearingDelta||0,s.pitch+=p.pitchDelta||0,p.panDelta&&s.pan._add(p.panDelta),p.around&&(s.around=p.around),p.pinchAround&&(s.pinchAround=p.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(s.pan.mag()){const p=ro(s.pan.mag(),l,d.e({},Tu,e||{}));u.offset=s.pan.mult(p.amount/s.pan.mag()),u.center=this._map.transform.center,to(u,p)}if(s.zoom){const p=ro(s.zoom,l,Dp);u.zoom=this._map.transform.zoom+p.amount,to(u,p)}if(s.bearing){const p=ro(s.bearing,l,wh);u.bearing=this._map.transform.bearing+d.ac(p.amount,-179,179),to(u,p)}if(s.pitch){const p=ro(s.pitch,l,Yo);u.pitch=this._map.transform.pitch+p.amount,to(u,p)}if(u.zoom||u.bearing){const p=s.pinchAround===void 0?s.around:s.pinchAround;u.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),d.e(u,{noMoveStart:!0})}}function to(f,e){(!f.duration||f.duration<e.duration)&&(f.duration=e.duration,f.easing=e.easing)}function ro(f,e,s){const{maxSpeed:l,linearity:u,deceleration:p}=s,v=d.ac(f*u/(e/1e3),-l,l),w=Math.abs(v)/(p*u);return{easing:s.easing,duration:1e3*w,amount:v*(w/2)}}class Xr extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l,u={}){const p=W.mousePos(s.getCanvas(),l),v=s.unproject(p);super(e,d.e({point:p,lngLat:v,originalEvent:l},u)),this._defaultPrevented=!1,this.target=s}}class Es extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){const u=e==="touchend"?l.changedTouches:l.touches,p=W.touchPos(s.getCanvasContainer(),u),v=p.map(T=>s.unproject(T)),w=p.reduce((T,P,M,z)=>T.add(P.div(z.length)),new d.P(0,0));super(e,{points:p,point:w,lngLats:v,lngLat:s.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class bh extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class Sh{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new bh(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new Xr(e.type,this._map,e))}mouseup(e){this._map.fire(new Xr(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Xr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Xr(e.type,this._map,e))}mouseover(e){this._map.fire(new Xr(e.type,this._map,e))}mouseout(e){this._map.fire(new Xr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Es(e.type,this._map,e))}touchmove(e){this._map.fire(new Es(e.type,this._map,e))}touchend(e){this._map.fire(new Es(e.type,this._map,e))}touchcancel(e){this._map.fire(new Es(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Xr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Xr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cn{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(d.P.convert(e),this._map.terrain)}}class Fi{constructor(e,s){this._map=e,this._tr=new cn(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(W.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const l=s;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=W.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const p=Math.min(u.x,l.x),v=Math.max(u.x,l.x),w=Math.min(u.y,l.y),T=Math.max(u.y,l.y);W.setTransform(this._box,`translate(${p}px,${w}px)`),this._box.style.width=v-p+"px",this._box.style.height=T-w+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const l=this._startPos,u=s;if(this.reset(),W.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new d.k("boxzoomend",{originalEvent:e})),{cameraAnimation:p=>p.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(W.remove(this._box),this._box=null),W.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new d.k(e,{originalEvent:s}))}}function io(f,e){if(f.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${e.length}`);const s={};for(let l=0;l<f.length;l++)s[f[l].identifier]=e[l];return s}class Iu{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=function(u){const p=new d.P(0,0);for(const v of u)p._add(v);return p.div(u.length)}(s),this.touches=io(l,s)))}touchmove(e,s,l){if(this.aborted||!this.centroid)return;const u=io(l,s);for(const p in this.touches){const v=u[p];(!v||v.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(e,s,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class Qo{constructor(e){this.singleTap=new Iu(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,l){this.singleTap.touchstart(e,s,l)}touchmove(e,s,l){this.singleTap.touchmove(e,s,l)}touchend(e,s,l){const u=this.singleTap.touchend(e,s,l);if(u){const p=e.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(u)<30;if(p&&v||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class aa{constructor(e){this._tr=new cn(e),this._zoomIn=new Qo({numTouches:1,numTaps:2}),this._zoomOut=new Qo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,l){this._zoomIn.touchstart(e,s,l),this._zoomOut.touchstart(e,s,l)}touchmove(e,s,l){this._zoomIn.touchmove(e,s,l),this._zoomOut.touchmove(e,s,l)}touchend(e,s,l){const u=this._zoomIn.touchend(e,s,l),p=this._zoomOut.touchend(e,s,l),v=this._tr;return u?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(u)},{originalEvent:e})}):p?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(p)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zn{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const s=this._moveFunction(...e);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(e,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,s){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const u=s.length?s[0]:s;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&W.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Eu={0:1,2:2};class el{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const s=W.mouseButton(e);this._eventButton=s}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(s,l){const u=Eu[l];return s.buttons===void 0||(s.buttons&u)!==u}(e,this._eventButton)}isValidEndEvent(e){return W.mouseButton(e)===this._eventButton}}class Pu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const tl=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=e=>{e.preventDefault()}},Cu=({enable:f,clickTolerance:e,bearingDegreesPerPixelMoved:s=.8})=>{const l=new el({checkCorrectEvent:u=>W.mouseButton(u)===0&&u.ctrlKey||W.mouseButton(u)===2});return new Zn({clickTolerance:e,move:(u,p)=>({bearingDelta:(p.x-u.x)*s}),moveStateManager:l,enable:f,assignEvents:tl})},Mu=({enable:f,clickTolerance:e,pitchDegreesPerPixelMoved:s=-.5})=>{const l=new el({checkCorrectEvent:u=>W.mouseButton(u)===0&&u.ctrlKey||W.mouseButton(u)===2});return new Zn({clickTolerance:e,move:(u,p)=>({pitchDelta:(p.y-u.y)*s}),moveStateManager:l,enable:f,assignEvents:tl})};class Ps{constructor(e,s){this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,s,l){return this._calculateTransform(e,s,l)}touchmove(e,s,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,s,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,s,l){this._calculateTransform(e,s,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,l){l.length>0&&(this._active=!0);const u=io(l,s),p=new d.P(0,0),v=new d.P(0,0);let w=0;for(const P in u){const M=u[P],z=this._touches[P];z&&(p._add(M),v._add(M.sub(z)),w++,u[P]=M)}if(this._touches=u,this._shouldBePrevented(w)||!v.mag())return;const T=v.div(w);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(w),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,s,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,l){if(!this._firstTwoTouches)return;e.preventDefault();const[u,p]=this._firstTwoTouches,v=no(l,s,u),w=no(l,s,p);if(!v||!w)return;const T=this._aroundCenter?null:v.add(w).div(2);return this._move([v,w],T,e)}touchend(e,s,l){if(!this._firstTwoTouches)return;const[u,p]=this._firstTwoTouches,v=no(l,s,u),w=no(l,s,p);v&&w||(this._active&&W.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function no(f,e,s){for(let l=0;l<f.length;l++)if(f[l].identifier===s)return e[l]}function zu(f,e){return Math.log(f/e)/Math.LN2}class Au extends rl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(zu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zu(this._distance,l),pinchAround:s}}}function Du(f,e){return 180*f.angleWith(e)/Math.PI}class Lu extends rl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s,l){const u=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Du(this._vector,u),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,l=Du(e,this._startVector);return Math.abs(l)<s}}function il(f){return Math.abs(f.y)>Math.abs(f.x)}class so extends rl{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,l){super.touchstart(e,s,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,il(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const u=e[0].sub(this._lastPoints[0]),p=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,p,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(u.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,l){if(this._valid!==void 0)return this._valid;const u=e.mag()>=2,p=s.mag()>=2;if(!u&&!p)return;if(!u||!p)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=e.y>0==s.y>0;return il(e)&&il(s)&&v}}const Th={panStep:100,bearingStep:15,pitchStep:10};class Wi{constructor(e){this._tr=new cn(e);const s=Th;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,l=0,u=0,p=0,v=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),p=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),p=1);break;case 38:e.shiftKey?u=1:(e.preventDefault(),v=-1);break;case 40:e.shiftKey?u=-1:(e.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:w=>{const T=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Cn,zoom:s?Math.round(T.zoom)+s*(e.shiftKey?2:1):T.zoom,bearing:T.bearing+l*this._bearingStep,pitch:T.pitch+u*this._pitchStep,offset:[-p*this._panStep,-v*this._panStep],center:T.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Cn(f){return f*(2-f)}const Ru=4.000244140625;class hn{constructor(e,s){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new cn(e),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=Q.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,s!==0&&s%Ru==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(u*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=W.mousePos(this._map.getCanvas(),e),l=this._tr;this._around=s.y>l.transform.height/2-l.transform.getHorizon()?d.N.convert(this._aroundCenter?l.center:l.unproject(s)):d.N.convert(l.center),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>Ru?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&P!==0&&(P=1/P);const M=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(M*P))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,l=this._startZoom,u=this._easing;let p,v=!1;const w=Q.now()-this._lastWheelEventTime;if(this._type==="wheel"&&l&&u&&w){const T=Math.min(w/200,1),P=u(T);p=d.y.number(l,s,P),T<1?this._frameId||(this._frameId=!0):v=!0}else p=s,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:p-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=d.b9;if(this._prevEase){const l=this._prevEase,u=(Q.now()-l.start)/l.duration,p=l.easing(u+.01)-l.easing(u),v=.27/Math.sqrt(p*p+1e-4)*.01,w=Math.sqrt(.0729-v*v);s=d.b8(v,w,.25,1)}return this._prevEase={start:Q.now(),duration:e,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Cs{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Lp{constructor(e){this._tr=new cn(e),this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rp{constructor(){this._tap=new Qo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,s,l){if(!this._swipePoint)if(this._tapTime){const u=s[0],p=e.timeStamp-this._tapTime<500,v=this._tapPoint.dist(u)<30;p&&v?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,s,l)}touchmove(e,s,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=s[0],p=u.y-this._swipePoint.y;return this._swipePoint=u,e.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(e,s,l)}touchend(e,s,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(e,s,l);u&&(this._tapTime=e.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kh{constructor(e,s,l){this._el=e,this._mousePan=s,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ih{constructor(e,s,l){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Fu{constructor(e,s,l,u){this._el=e,this._touchZoom=s,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class oa{constructor(e,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=W.create("div","maplibregl-cooperative-gesture-screen",e);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),u=document.createElement("div");u.className="maplibregl-desktop-message",u.textContent=s,this._container.appendChild(u);const p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=l,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(W.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,s){this._enabled&&(this._map.fire(new d.k("cooperativegestureprevented",{gestureType:e,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Xi=f=>f.zoom||f.drag||f.pitch||f.rotate;class qe extends d.k{}function nl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Bu{constructor(e,s){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,p)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=u.type==="renderFrame"?void 0:u,w={needsRenderFrame:!1},T={},P={},M=u.touches,z=M?this._getMapTouches(M):void 0,F=z?W.touchPos(this._map.getCanvas(),z):W.mousePos(this._map.getCanvas(),u);for(const{handlerName:H,handler:K,allowed:J}of this._handlers){if(!K.isEnabled())continue;let re;this._blockedByActive(P,J,H)?K.reset():K[p||u.type]&&(re=K[p||u.type](u,F,z),this.mergeHandlerResult(w,T,re,H,v),re&&re.needsRenderFrame&&this._triggerRenderFrame()),(re||K.isActive())&&(P[H]=K)}const j={};for(const H in this._previousActiveHandlers)P[H]||(j[H]=v);this._previousActiveHandlers=P,(Object.keys(j).length||nl(w))&&(this._changes.push([w,T,j]),this._triggerRenderFrame()),(Object.keys(P).length||nl(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=w;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ku(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,p,v]of this._listeners)W.addEventListener(u,p,u===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[e,s,l]of this._listeners)W.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const s=this._map,l=s.getCanvasContainer();this._add("mapEvent",new Sh(s,e));const u=s.boxZoom=new Fi(s,e);this._add("boxZoom",u),e.interactive&&e.boxZoom&&u.enable();const p=s.cooperativeGestures=new oa(s,e.cooperativeGestures);this._add("cooperativeGestures",p),e.cooperativeGestures&&p.enable();const v=new aa(s),w=new Lp(s);s.doubleClickZoom=new Cs(w,v),this._add("tapZoom",v),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&s.doubleClickZoom.enable();const T=new Rp;this._add("tapDragZoom",T);const P=s.touchPitch=new so(s);this._add("touchPitch",P),e.interactive&&e.touchPitch&&s.touchPitch.enable(e.touchPitch);const M=Cu(e),z=Mu(e);s.dragRotate=new Ih(e,M,z),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]),e.interactive&&e.dragRotate&&s.dragRotate.enable();const F=(({enable:re,clickTolerance:q})=>{const ae=new el({checkCorrectEvent:le=>W.mouseButton(le)===0&&!le.ctrlKey});return new Zn({clickTolerance:q,move:(le,pe)=>({around:pe,panDelta:pe.sub(le)}),activateOnStart:!0,moveStateManager:ae,enable:re,assignEvents:tl})})(e),j=new Ps(e,s);s.dragPan=new kh(l,F,j),this._add("mousePan",F),this._add("touchPan",j,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&s.dragPan.enable(e.dragPan);const V=new Lu,H=new Au;s.touchZoomRotate=new Fu(l,H,V,T),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&s.touchZoomRotate.enable(e.touchZoomRotate);const K=s.scrollZoom=new hn(s,()=>this._triggerRenderFrame());this._add("scrollZoom",K,["mousePan"]),e.interactive&&e.scrollZoom&&s.scrollZoom.enable(e.scrollZoom);const J=s.keyboard=new Wi(s);this._add("keyboard",J),e.interactive&&e.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new mr(s))}_add(e,s,l){this._handlers.push({handlerName:e,handler:s,allowed:l}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Xi(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,s,l){for(const u in e)if(u!==l&&(!s||s.indexOf(u)<0))return!0;return!1}_getMapTouches(e){const s=[];for(const l of e)this._el.contains(l.target)&&s.push(l);return s}mergeHandlerResult(e,s,l,u,p){if(!l)return;d.e(e,l);const v={handlerName:u,originalEvent:l.originalEvent||p};l.zoomDelta!==void 0&&(s.zoom=v),l.panDelta!==void 0&&(s.drag=v),l.pitchDelta!==void 0&&(s.pitch=v),l.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const e={},s={},l={};for(const[u,p,v]of this._changes)u.panDelta&&(e.panDelta=(e.panDelta||new d.P(0,0))._add(u.panDelta)),u.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(e.around=u.around),u.pinchAround!==void 0&&(e.pinchAround=u.pinchAround),u.noInertia&&(e.noInertia=u.noInertia),d.e(s,p),d.e(l,v);this._updateMapTransform(e,s,l),this._changes=[]}_updateMapTransform(e,s,l){const u=this._map,p=u._getTransformForUpdate(),v=u.terrain;if(!(nl(e)||v&&this._terrainMovement))return this._fireEvents(s,l,!0);let{panDelta:w,zoomDelta:T,bearingDelta:P,pitchDelta:M,around:z,pinchAround:F}=e;F!==void 0&&(z=F),u._stop(!0),z=z||u.transform.centerPoint;const j=p.pointLocation(w?z.sub(w):z);P&&(p.bearing+=P),M&&(p.pitch+=M),T&&(p.zoom+=T),v?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?p.center=p.pointLocation(p.centerPoint.sub(w)):p.setLocationAtPoint(j,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,p.setLocationAtPoint(j,z)):p.setLocationAtPoint(j,z),u._applyUpdatedTransform(p),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,l,!0)}_fireEvents(e,s,l){const u=Xi(this._eventsInProgress),p=Xi(e),v={};for(const z in e){const{originalEvent:F}=e[z];this._eventsInProgress[z]||(v[`${z}start`]=F),this._eventsInProgress[z]=e[z]}!u&&p&&this._fireEvent("movestart",p.originalEvent);for(const z in v)this._fireEvent(z,v[z]);p&&this._fireEvent("move",p.originalEvent);for(const z in e){const{originalEvent:F}=e[z];this._fireEvent(z,F)}const w={};let T;for(const z in this._eventsInProgress){const{handlerName:F,originalEvent:j}=this._eventsInProgress[z];this._handlersById[F].isActive()||(delete this._eventsInProgress[z],T=s[F]||j,w[`${z}end`]=T)}for(const z in w)this._fireEvent(z,w[z]);const P=Xi(this._eventsInProgress),M=(u||p)&&!P;if(M&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const z=this._map._getTransformForUpdate();z.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(z)}if(l&&M){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;!z||!z.essential&&Q.prefersReducedMotion?(this._map.fire(new d.k("moveend",{originalEvent:T})),F(this._map.getBearing())&&this._map.resetNorth()):(F(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new d.k(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new qe("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Eh extends d.E{constructor(e,s){super(),this._renderFrameCallback=()=>{const l=Math.min((Q.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new d.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,l){return e=d.P.convert(e).mult(-1),this.panTo(this.transform.center,d.e({offset:e},s),l)}panTo(e,s,l){return this.easeTo(d.e({center:e},s),l)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,l){return this.easeTo(d.e({zoom:e},s),l)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,l){return this.easeTo(d.e({bearing:e},s),l)}resetNorth(e,s){return this.rotateTo(0,d.e({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(d.e({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=me.convert(e).adjustAntiMeridian();const l=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,s)}_cameraForBoxAndBearing(e,s,l,u){const p={top:0,bottom:0,right:0,left:0};if(typeof(u=d.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const Le=u.padding;u.padding={top:Le,bottom:Le,right:Le,left:Le}}u.padding=d.e(p,u.padding);const v=this.transform,w=v.padding,T=new me(e,s),P=v.project(T.getNorthWest()),M=v.project(T.getNorthEast()),z=v.project(T.getSouthEast()),F=v.project(T.getSouthWest()),j=d.ba(-l),V=P.rotate(j),H=M.rotate(j),K=z.rotate(j),J=F.rotate(j),re=new d.P(Math.max(V.x,H.x,J.x,K.x),Math.max(V.y,H.y,J.y,K.y)),q=new d.P(Math.min(V.x,H.x,J.x,K.x),Math.min(V.y,H.y,J.y,K.y)),ae=re.sub(q),le=(v.width-(w.left+w.right+u.padding.left+u.padding.right))/ae.x,pe=(v.height-(w.top+w.bottom+u.padding.top+u.padding.bottom))/ae.y;if(pe<0||le<0)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const xe=Math.min(v.scaleZoom(v.scale*Math.min(le,pe)),u.maxZoom),Te=d.P.convert(u.offset),Oe=new d.P((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(d.ba(l)),$e=Te.add(Oe).mult(v.scale/v.zoomScale(xe));return{center:v.unproject(P.add(z).div(2).sub($e)),zoom:xe,bearing:l}}fitBounds(e,s,l){return this._fitInternal(this.cameraForBounds(e,s),s,l)}fitScreenCoordinates(e,s,l,u,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.P.convert(e)),this.transform.pointLocation(d.P.convert(s)),l,u),u,p)}_fitInternal(e,s,l){return e?(delete(s=d.e(e,s)).padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}jumpTo(e,s){this.stop();const l=this._getTransformForUpdate();let u=!1,p=!1,v=!1;return"zoom"in e&&l.zoom!==+e.zoom&&(u=!0,l.zoom=+e.zoom),e.center!==void 0&&(l.center=d.N.convert(e.center)),"bearing"in e&&l.bearing!==+e.bearing&&(p=!0,l.bearing=+e.bearing),"pitch"in e&&l.pitch!==+e.pitch&&(v=!0,l.pitch=+e.pitch),e.padding==null||l.isPaddingEqual(e.padding)||(l.padding=e.padding),this._applyUpdatedTransform(l),this.fire(new d.k("movestart",s)).fire(new d.k("move",s)),u&&this.fire(new d.k("zoomstart",s)).fire(new d.k("zoom",s)).fire(new d.k("zoomend",s)),p&&this.fire(new d.k("rotatestart",s)).fire(new d.k("rotate",s)).fire(new d.k("rotateend",s)),v&&this.fire(new d.k("pitchstart",s)).fire(new d.k("pitch",s)).fire(new d.k("pitchend",s)),this.fire(new d.k("moveend",s))}calculateCameraOptionsFromTo(e,s,l,u=0){const p=d.Z.fromLngLat(e,s),v=d.Z.fromLngLat(l,u),w=v.x-p.x,T=v.y-p.y,P=v.z-p.z,M=Math.hypot(w,T,P);if(M===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(w,T),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/M/this.transform.tileSize),j=180*Math.atan2(w,-T)/Math.PI;let V=180*Math.acos(z/M)/Math.PI;return V=P<0?90-V:90+V,{center:v.toLngLat(),zoom:F,pitch:V,bearing:j}}easeTo(e,s){var l;this._stop(!1,e.easeId),((e=d.e({offset:[0,0],duration:500,easing:d.b9},e)).animate===!1||!e.essential&&Q.prefersReducedMotion)&&(e.duration=0);const u=this._getTransformForUpdate(),p=u.zoom,v=u.bearing,w=u.pitch,T=u.padding,P="bearing"in e?this._normalizeBearing(e.bearing,v):v,M="pitch"in e?+e.pitch:w,z="padding"in e?e.padding:u.padding,F=d.P.convert(e.offset);let j=u.centerPoint.add(F);const V=u.pointLocation(j),{center:H,zoom:K}=u.getConstrained(d.N.convert(e.center||V),(l=e.zoom)!==null&&l!==void 0?l:p);this._normalizeCenter(H,u);const J=u.project(V),re=u.project(H).sub(J),q=u.zoomScale(K-p);let ae,le;e.around&&(ae=d.N.convert(e.around),le=u.locationPoint(ae));const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||K!==p,this._rotating=this._rotating||v!==P,this._pitching=this._pitching||M!==w,this._padding=!u.isPaddingEqual(z),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,pe),this.terrain&&this._prepareElevation(H),this._ease(xe=>{if(this._zooming&&(u.zoom=d.y.number(p,K,xe)),this._rotating&&(u.bearing=d.y.number(v,P,xe)),this._pitching&&(u.pitch=d.y.number(w,M,xe)),this._padding&&(u.interpolatePadding(T,z,xe),j=u.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(xe),ae)u.setLocationAtPoint(ae,le);else{const Te=u.zoomScale(u.zoom-p),Oe=K>p?Math.min(2,q):Math.max(.5,q),$e=Math.pow(Oe,1-xe),Le=u.unproject(J.add(re.mult(xe*$e)).mult(Te));u.setLocationAtPoint(u.renderWorldCopies?Le.wrap():Le,j)}this._applyUpdatedTransform(u),this._fireMoveEvents(s)},xe=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s,xe)},e),this}_prepareEase(e,s,l={}){this._moving=!0,s||l.moving||this.fire(new d.k("movestart",e)),this._zooming&&!l.zooming&&this.fire(new d.k("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new d.k("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new d.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&s!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(s-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=s}this.transform.elevation=d.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const s=e.getCameraPosition(),l=this.terrain.getElevationForLngLatZoom(s.lngLat,e.zoom);if(s.altitude<l){const u=this.calculateCameraOptionsFromTo(s.lngLat,l,e.center,e.elevation);return{pitch:u.pitch,zoom:u.zoom}}return{}}_applyUpdatedTransform(e){const s=[];if(this.terrain&&s.push(u=>this._elevateCameraIfInsideTerrain(u)),this.transformCameraUpdate&&s.push(u=>this.transformCameraUpdate(u)),!s.length)return;const l=e.clone();for(const u of s){const p=l.clone(),{center:v,zoom:w,pitch:T,bearing:P,elevation:M}=u(p);v&&(p.center=v),w!==void 0&&(p.zoom=w),T!==void 0&&(p.pitch=T),P!==void 0&&(p.bearing=P),M!==void 0&&(p.elevation=M),l.apply(p)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new d.k("move",e)),this._zooming&&this.fire(new d.k("zoom",e)),this._rotating&&this.fire(new d.k("rotate",e)),this._pitching&&this.fire(new d.k("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const l=this._zooming,u=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new d.k("zoomend",e)),u&&this.fire(new d.k("rotateend",e)),p&&this.fire(new d.k("pitchend",e)),this.fire(new d.k("moveend",e))}flyTo(e,s){var l;if(!e.essential&&Q.prefersReducedMotion){const je=d.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(je,s)}this.stop(),e=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.b9},e);const u=this._getTransformForUpdate(),p=u.zoom,v=u.bearing,w=u.pitch,T=u.padding,P="bearing"in e?this._normalizeBearing(e.bearing,v):v,M="pitch"in e?+e.pitch:w,z="padding"in e?e.padding:u.padding,F=d.P.convert(e.offset);let j=u.centerPoint.add(F);const V=u.pointLocation(j),{center:H,zoom:K}=u.getConstrained(d.N.convert(e.center||V),(l=e.zoom)!==null&&l!==void 0?l:p);this._normalizeCenter(H,u);const J=u.zoomScale(K-p),re=u.project(V),q=u.project(H).sub(re);let ae=e.curve;const le=Math.max(u.width,u.height),pe=le/J,xe=q.mag();if("minZoom"in e){const je=d.ac(Math.min(e.minZoom,p,K),u.minZoom,u.maxZoom),dt=le/u.zoomScale(je-p);ae=Math.sqrt(dt/xe*2)}const Te=ae*ae;function Oe(je){const dt=(pe*pe-le*le+(je?-1:1)*Te*Te*xe*xe)/(2*(je?pe:le)*Te*xe);return Math.log(Math.sqrt(dt*dt+1)-dt)}function $e(je){return(Math.exp(je)-Math.exp(-je))/2}function Le(je){return(Math.exp(je)+Math.exp(-je))/2}const Ae=Oe(!1);let Je=function(je){return Le(Ae)/Le(Ae+ae*je)},ft=function(je){return le*((Le(Ae)*($e(dt=Ae+ae*je)/Le(dt))-$e(Ae))/Te)/xe;var dt},Fe=(Oe(!0)-Ae)/ae;if(Math.abs(xe)<1e-6||!isFinite(Fe)){if(Math.abs(le-pe)<1e-6)return this.easeTo(e,s);const je=pe<le?-1:1;Fe=Math.abs(Math.log(pe/le))/ae,ft=()=>0,Je=dt=>Math.exp(je*ae*dt)}return e.duration="duration"in e?+e.duration:1e3*Fe/("screenSpeed"in e?+e.screenSpeed/ae:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=v!==P,this._pitching=M!==w,this._padding=!u.isPaddingEqual(z),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(H),this._ease(je=>{const dt=je*Fe,ir=1/Je(dt);u.zoom=je===1?K:p+u.scaleZoom(ir),this._rotating&&(u.bearing=d.y.number(v,P,je)),this._pitching&&(u.pitch=d.y.number(w,M,je)),this._padding&&(u.interpolatePadding(T,z,je),j=u.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(je);const xt=je===1?H:u.unproject(re.add(q.mult(ft(dt))).mult(ir));u.setLocationAtPoint(u.renderWorldCopies?xt.wrap():xt,j),this._applyUpdatedTransform(u),this._fireMoveEvents(s)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,s)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,s,l){l.animate===!1||l.duration===0?(e(1),s()):(this._easeStart=Q.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,s){e=d.b3(e,-180,180);const l=Math.abs(e-s);return Math.abs(e-360-s)<l&&(e-=360),Math.abs(e+360-s)<l&&(e+=360),e}_normalizeCenter(e,s){if(!s.renderWorldCopies||s.lngRange)return;const l=e.lng-s.center.lng;e.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(d.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const la={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ua{constructor(e=la){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=W.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=W.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=W.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){W.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const l=this._map._getUIString(`AttributionControl.${s}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const s=this._map.style.sourceCaches;for(const u in s){const p=s[u];if(p.used||p.usedForTerrain){const v=p.getSource();v.attribution&&e.indexOf(v.attribution)<0&&e.push(v.attribution)}}e=e.filter(u=>String(u).trim()),e.sort((u,p)=>u.length-p.length),e=e.filter((u,p)=>{for(let v=p+1;v<e.length;v++)if(e[v].indexOf(u)>=0)return!1;return!0});const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ou{constructor(e={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const l=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=W.create("div","maplibregl-ctrl");const s=W.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){W.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Mt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,l=s?this._queue.concat(s):this._queue;for(const u of l)if(u.id===e)return void(u.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const l of s)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Nu=d.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Fp extends d.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];const l={};for(const u of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),d.aP(u.posMatrix,0,d.X,0,d.X,0,1),this._tiles[u.key]=new gi(u,this.tileSize));for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(e){for(const s in this._tiles){const l=this._tiles[s];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID;if(u.canonical.equals(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16),d.aP(p.posMatrix,0,d.X,0,d.X,0,1),s[l]=p}else if(u.canonical.isChildOf(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const v=u.canonical.z-e.canonical.z,w=u.canonical.x-(u.canonical.x>>v<<v),T=u.canonical.y-(u.canonical.y>>v<<v),P=d.X>>v;d.aP(p.posMatrix,0,P,0,P,0,1),d.J(p.posMatrix,p.posMatrix,[-w*P,-T*P,0]),s[l]=p}else if(e.canonical.isChildOf(u.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const v=e.canonical.z-u.canonical.z,w=e.canonical.x-(e.canonical.x>>v<<v),T=e.canonical.y-(e.canonical.y>>v<<v),P=d.X>>v;d.aP(p.posMatrix,0,d.X,0,d.X,0,1),d.J(p.posMatrix,p.posMatrix,[w*P,T*P,0]),d.K(p.posMatrix,p.posMatrix,[1/2**v,1/2**v,0]),s[l]=p}}return s}getSourceTile(e,s){const l=this.sourceCache._source;let u=e.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(u).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!p||!p.dem)&&s)for(;u>=l.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(e.scaledTo(u--).key);return p}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=e)}}class ju{constructor(e,s,l){this.painter=e,this.sourceCache=new Fp(s),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,s,l,u=d.X){var p;if(!(s>=0&&s<u&&l>=0&&l<u))return 0;const v=this.getTerrainData(e),w=(p=v.tile)===null||p===void 0?void 0:p.dem;if(!w)return 0;const T=function(V,H,K){var J=H[0],re=H[1];return V[0]=K[0]*J+K[4]*re+K[12],V[1]=K[1]*J+K[5]*re+K[13],V}([],[s/u*d.X,l/u*d.X],v.u_terrain_matrix),P=[T[0]*w.dim,T[1]*w.dim],M=Math.floor(P[0]),z=Math.floor(P[1]),F=P[0]-M,j=P[1]-z;return w.get(M,z)*(1-F)*(1-j)+w.get(M+1,z)*F*(1-j)+w.get(M,z+1)*(1-F)*j+w.get(M+1,z+1)*F*j}getElevationForLngLatZoom(e,s){if(!d.bb(s,e.wrap()))return 0;const{tileID:l,mercatorX:u,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(e,s);return this.getElevation(l,u%d.X,p%d.X,d.X)}getElevation(e,s,l,u=d.X){return this.getDEMElevation(e,s,l,u)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const u=this.painter.context,p=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new wt(u,p,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new wt(u,new d.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.an([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const u=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new wt(u,s.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),s.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const l=s&&s+s.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let p=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=u?p=e.canonical.z-u:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=e.canonical.x-(e.canonical.x>>p<<p),w=e.canonical.y-(e.canonical.y>>p<<p),T=d.bc(new Float64Array(16),[1/(d.X<<p),1/(d.X<<p),0]);d.J(T,T,[v*d.X,w*d.X,0]),this._demMatrixCache[e.key]={matrix:T,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(e){const s=this.painter,l=s.width/devicePixelRatio,u=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new wt(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new wt(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,v=0;p<this._coordsTextureSize;p++)for(let w=0;w<this._coordsTextureSize;w++,v+=4)s[v+0]=255&w,s[v+1]=255&p,s[v+2]=w>>8<<4|p>>8,s[v+3]=0;const l=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),u=new wt(e,l,e.gl.RGBA,{premultiply:!1});return u.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),l=this.painter.context,u=l.gl,p=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(p,w-v-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null);const T=s[0]+(s[2]>>4<<8),P=s[1]+((15&s[2])<<8),M=this.coordsIndex[255-s[3]],z=M&&this.sourceCache.getTileByID(M);if(!z)return null;const F=this._coordsTextureSize,j=(1<<z.tileID.canonical.z)*F;return new d.Z((z.tileID.canonical.x*F+T)/j+z.tileID.wrap,(z.tileID.canonical.y*F+P)/j,this.getElevation(z.tileID,T,P,F))}depthAtPoint(e){const s=new Uint8Array(4),l=this.painter.context,u=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),u.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,s=new d.bd,l=new d.aY,u=this.meshSize,p=d.X/u,v=u*u;for(let z=0;z<=u;z++)for(let F=0;F<=u;F++)s.emplaceBack(F*p,z*p,0);for(let z=0;z<v;z+=u+1)for(let F=0;F<u;F++)l.emplaceBack(F+z,u+F+z+1,u+F+z+2),l.emplaceBack(F+z,u+F+z+2,F+z+1);const w=s.length,T=w+2*(u+1);for(const z of[0,1])for(let F=0;F<=u;F++)for(const j of[0,1])s.emplaceBack(F*p,z*d.X,j);for(let z=0;z<2*u;z+=2)l.emplaceBack(T+z,T+z+1,T+z+3),l.emplaceBack(T+z,T+z+3,T+z+2),l.emplaceBack(w+z,w+z+3,w+z+1),l.emplaceBack(w+z,w+z+2,w+z+3);const P=s.length,M=P+2*(u+1);for(const z of[0,1])for(let F=0;F<=u;F++)for(const j of[0,1])s.emplaceBack(z*d.X,F*p,j);for(let z=0;z<2*u;z+=2)l.emplaceBack(P+z,P+z+1,P+z+3),l.emplaceBack(P+z,P+z+3,P+z+2),l.emplaceBack(M+z,M+z+3,M+z+1),l.emplaceBack(M+z,M+z+2,M+z+3);return this._mesh=new Wo(e.createVertexBuffer(s,Nu.members),e.createIndexBuffer(l),d.a0.simpleSegment(0,0,s.length,l.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*d.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,s){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(e,s);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return s&&s.dem&&(l.minElevation=s.dem.min*this.exaggeration,l.maxElevation=s.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,s){const l=d.Z.fromLngLat(e.wrap()),u=(1<<s)*d.X,p=l.x*u,v=l.y*u,w=Math.floor(p/d.X),T=Math.floor(v/d.X);return{tileID:new d.S(s,0,s,w,T),mercatorX:p,mercatorY:v}}}class Bp{constructor(e,s,l){this._context=e,this._size=s,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new wt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(l.texture),{id:e,fbo:s,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>e.id!==s),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const ca={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Ph{constructor(e,s){this.painter=e,this.terrain=s,this.pool=new Bp(e.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(l=>!e._layers[l].isHidden(s)),this._coordsDescendingInv={};for(const l in e.sourceCaches){this._coordsDescendingInv[l]={};const u=e.sourceCaches[l].getVisibleCoordinates();for(const p of u){const v=this.terrain.sourceCache.getTerrainCoords(p);for(const w in v)this._coordsDescendingInv[l][w]||(this._coordsDescendingInv[l][w]=[]),this._coordsDescendingInv[l][w].push(v[w])}}this._coordsDescendingInvStr={};for(const l of e._order){const u=e._layers[l],p=u.source;if(ca[u.type]&&!this._coordsDescendingInvStr[p]){this._coordsDescendingInvStr[p]={};for(const v in this._coordsDescendingInv[p])this._coordsDescendingInvStr[p][v]=this._coordsDescendingInv[p][v].map(w=>w.key).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const p=this._coordsDescendingInvStr[u][l.tileID.key];p&&p!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const s=e.type,l=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(ca[s]&&(this._prevType&&ca[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(e.id),!u))return!0;if(ca[this._prevType]||ca[s]&&u){this._prevType=s;const p=this._stacks.length-1,v=this._stacks[p]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(xh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[p]){const P=this.pool.getObjectForId(w.rtt[p].id);if(P.stamp===w.rtt[p].stamp){this.pool.useObject(P);continue}}const T=this.pool.getOrCreateFreeObject();this.pool.useObject(T),this.pool.stampObject(T),w.rtt[p]={id:T.id,stamp:T.stamp},l.context.bindFramebuffer.set(T.fbo.framebuffer),l.context.clear({color:d.aM.transparent,stencil:0}),l.currentStencilSource=void 0;for(let P=0;P<v.length;P++){const M=l.style._layers[v[P]],z=M.source?this._coordsDescendingInv[M.source][w.tileID.key]:[w.tileID];l.context.viewport.set([0,0,T.fbo.width,T.fbo.height]),l._renderTileClippingMasks(M,z),l.renderLayer(l,l.style.sourceCaches[M.source],M,z),M.source&&(w.rttCoords[M.source]=this._coordsDescendingInvStr[M.source][w.tileID.key])}}return xh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ca[s]}return!1}}const Vu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ch=U,Op={hash:!1,interactive:!0,bearingSnap:7,attributionControl:la,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Uu=f=>{f.touchstart=f.dragStart,f.touchmoveWindow=f.dragMove,f.touchend=f.dragEnd},Np={showCompass:!0,showZoom:!0,visualizePitch:!1};class jp{constructor(e,s,l=!1){this.mousedown=v=>{this.startMouse(d.e({},v,{ctrlKey:!0,preventDefault:()=>v.preventDefault()}),W.mousePos(this.element,v)),W.addEventListener(window,"mousemove",this.mousemove),W.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.moveMouse(v,W.mousePos(this.element,v))},this.mouseup=v=>{this.mouseRotate.dragEnd(v),this.mousePitch&&this.mousePitch.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=W.touchPos(this.element,v.targetTouches)[0],this.startTouch(v,this._startPos),W.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),W.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=W.touchPos(this.element,v.targetTouches)[0],this.moveTouch(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const u=e.dragRotate._mouseRotate.getClickTolerance(),p=e.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=Cu({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:v,clickTolerance:w,bearingDegreesPerPixelMoved:T=.8})=>{const P=new Pu;return new Zn({clickTolerance:w,move:(M,z)=>({bearingDelta:(z.x-M.x)*T}),moveStateManager:P,enable:v,assignEvents:Uu})})({clickTolerance:u,enable:!0}),this.map=e,l&&(this.mousePitch=Mu({clickTolerance:p,enable:!0}),this.touchPitch=(({enable:v,clickTolerance:w,pitchDegreesPerPixelMoved:T=-.5})=>{const P=new Pu;return new Zn({clickTolerance:w,move:(M,z)=>({pitchDelta:(z.y-M.y)*T}),moveStateManager:P,enable:v,assignEvents:Uu})})({clickTolerance:p,enable:!0})),W.addEventListener(s,"mousedown",this.mousedown),W.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),W.addEventListener(s,"touchcancel",this.reset)}startMouse(e,s){this.mouseRotate.dragStart(e,s),this.mousePitch&&this.mousePitch.dragStart(e,s),W.disableDrag()}startTouch(e,s){this.touchRotate.dragStart(e,s),this.touchPitch&&this.touchPitch.dragStart(e,s),W.disableDrag()}moveMouse(e,s){const l=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.mousePitch){const{pitchDelta:p}=this.mousePitch.dragMove(e,s)||{};p&&l.setPitch(l.getPitch()+p)}}moveTouch(e,s){const l=this.map,{bearingDelta:u}=this.touchRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.touchPitch){const{pitchDelta:p}=this.touchPitch.dragMove(e,s)||{};p&&l.setPitch(l.getPitch()+p)}}off(){const e=this.element;W.removeEventListener(e,"mousedown",this.mousedown),W.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),W.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),W.removeEventListener(window,"touchend",this.touchend),W.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){W.enableDrag(),W.removeEventListener(window,"mousemove",this.mousemove),W.removeEventListener(window,"mouseup",this.mouseup),W.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),W.removeEventListener(window,"touchend",this.touchend)}}let Bi;function rr(f,e,s){const l=new d.N(f.lng,f.lat);if(f=new d.N(f.lng,f.lat),e){const u=new d.N(f.lng-360,f.lat),p=new d.N(f.lng+360,f.lat),v=s.locationPoint(f).distSqr(e);s.locationPoint(u).distSqr(e)<v?f=u:s.locationPoint(p).distSqr(e)<v&&(f=p)}for(;Math.abs(f.lng-s.center.lng)>180;){const u=s.locationPoint(f);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;f.lng>s.center.lng?f.lng-=360:f.lng+=360}return f.lng!==l.lng&&s.locationPoint(f).y>s.height/2-s.getHorizon()?f:l}const ha={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function sl(f,e,s){const l=f.classList;for(const u in ha)l.remove(`maplibregl-${s}-anchor-${u}`);l.add(`maplibregl-${s}-anchor-${e}`)}class al extends d.E{constructor(e){if(super(),this._onKeyPress=s=>{const l=s.code,u=s.charCode||s.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=s=>{const l=s.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=s=>{var l;if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?rr(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),W.setTransform(this._element,`${ha[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${p}`),Q.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.k("dragstart"))),this.fire(new d.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=d.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=W.create("div");const s=W.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${l}px`),s.setAttributeNS(null,"width",`${u}px`),s.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const p=W.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");const v=W.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const w=W.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const J of T){const re=W.createNS("http://www.w3.org/2000/svg","ellipse");re.setAttributeNS(null,"opacity","0.04"),re.setAttributeNS(null,"cx","10.5"),re.setAttributeNS(null,"cy","5.80029008"),re.setAttributeNS(null,"rx",J.rx),re.setAttributeNS(null,"ry",J.ry),w.appendChild(re)}const P=W.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill",this._color);const M=W.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),P.appendChild(M);const z=W.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const F=W.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(F);const j=W.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const V=W.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(8.0, 8.0)");const H=W.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#000000"),H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962");const K=W.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#FFFFFF"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962"),V.appendChild(H),V.appendChild(K),v.appendChild(w),v.appendChild(P),v.appendChild(z),v.appendChild(j),v.appendChild(V),s.appendChild(v),s.setAttributeNS(null,"height",l*this._scale+"px"),s.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(s),this._offset=d.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),sl(this._element,this._anchor,"marker"),e&&e.className)for(const s of e.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),W.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=d.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const u=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var s,l;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const u=this._map,p=u.terrain.depthAtPoint(this._pos),v=u.terrain.getElevationForLngLatZoom(this._lngLat,u.transform.tileZoom);if(u.transform.lngLatToCameraDepth(this._lngLat,v)-p<.006)return void(this._element.style.opacity=this._opacity);const w=-this._offset.y/u.transform._pixelPerMeter,T=Math.sin(u.getPitch()*Math.PI/180)*w,P=u.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),M=u.transform.lngLatToCameraDepth(this._lngLat,v+T)-P>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&M&&this._popup.remove(),this._element.style.opacity=M?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=d.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,s){return e===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const Mh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ao=0,oo=!1;const Mn={maxWidth:100,unit:"metric"};function lo(f,e,s){const l=s&&s.maxWidth||100,u=f._container.clientHeight/2,p=f.unproject([0,u]),v=f.unproject([l,u]),w=p.distanceTo(v);if(s&&s.unit==="imperial"){const T=3.2808*w;T>5280?Ke(e,l,T/5280,f._getUIString("ScaleControl.Miles")):Ke(e,l,T,f._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?Ke(e,l,w/1852,f._getUIString("ScaleControl.NauticalMiles")):w>=1e3?Ke(e,l,w/1e3,f._getUIString("ScaleControl.Kilometers")):Ke(e,l,w,f._getUIString("ScaleControl.Meters"))}function Ke(f,e,s,l){const u=function(p){const v=Math.pow(10,`${Math.floor(p)}`.length-1);let w=p/v;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(T){const P=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*P)/P}(w),v*w}(s);f.style.width=e*(u/s)+"px",f.innerHTML=`${u}&nbsp;${l}`}const ot={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},ol=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ll(f){if(f){if(typeof f=="number"){const e=Math.round(Math.abs(f)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,f),"top-left":new d.P(e,e),"top-right":new d.P(-e,e),bottom:new d.P(0,-f),"bottom-left":new d.P(e,-e),"bottom-right":new d.P(-e,-e),left:new d.P(f,0),right:new d.P(-f,0)}}if(f instanceof d.P||Array.isArray(f)){const e=d.P.convert(f);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:d.P.convert(f.center||[0,0]),top:d.P.convert(f.top||[0,0]),"top-left":d.P.convert(f["top-left"]||[0,0]),"top-right":d.P.convert(f["top-right"]||[0,0]),bottom:d.P.convert(f.bottom||[0,0]),"bottom-left":d.P.convert(f["bottom-left"]||[0,0]),"bottom-right":d.P.convert(f["bottom-right"]||[0,0]),left:d.P.convert(f.left||[0,0]),right:d.P.convert(f.right||[0,0])}}return ll(new d.P(0,0))}const $u=U;S.AJAXError=d.bh,S.Evented=d.E,S.LngLat=d.N,S.MercatorCoordinate=d.Z,S.Point=d.P,S.addProtocol=d.bi,S.config=d.a,S.removeProtocol=d.bj,S.AttributionControl=ua,S.BoxZoomHandler=Fi,S.CanvasSource=Mr,S.CooperativeGesturesHandler=oa,S.DoubleClickZoomHandler=Cs,S.DragPanHandler=kh,S.DragRotateHandler=Ih,S.EdgeInsets=na,S.FullscreenControl=class extends d.E{constructor(f={}){super(),this._onFullscreenChange=()=>{var e;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=s==null?void 0:s.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){W.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const f=this._fullscreenButton=W.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);W.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},S.GeoJSONSource=En,S.GeolocateControl=class extends d.E{constructor(f){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new d.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const s=new d.N(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,u=this._map.getBearing(),p=d.e({bearing:u},this.options.fitBoundsOptions),v=me.fromLngLat(s,l);this._map.fitBounds(v,p,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const s=new d.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&oo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=W.create("button","maplibregl-ctrl-geolocate",this._container),W.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new al({element:this._dotElement}),this._circleElement=W.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new al({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.k("trackuserlocationend")),this.fire(new d.k("userlocationlostfocus")))})}},this.options=d.e({},Mh,f)}onAdd(f){return this._map=f,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return d._(this,arguments,void 0,function*(e=!1){if(Bi!==void 0&&!e)return Bi;if(window.navigator.permissions===void 0)return Bi=!!window.navigator.geolocation,Bi;try{Bi=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Bi=!!window.navigator.geolocation}return Bi})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),W.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ao=0,oo=!1}_isOutOfMapMaxBounds(f){const e=this._map.getMaxBounds(),s=f.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const f=this._map.getBounds(),e=f.getSouthEast(),s=f.getNorthEast(),l=e.distanceTo(s),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ao--,oo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.k("trackuserlocationstart")),this.fire(new d.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ao++,ao>1?(f={maximumAge:6e5,timeout:0},oo=!0):(f=this.options.positionOptions,oo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},S.Hash=Ko,S.ImageSource=Wr,S.KeyboardHandler=Wi,S.LngLatBounds=me,S.LogoControl=Ou,S.Map=class extends Eh{constructor(f){d.bf.mark(d.bg.create);const e=Object.assign(Object.assign({},Op),f);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new sa(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Mt,this._controls=[],this._mapId=d.a4(),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Vu),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=he.addThrottleControl(()=>this.isMoving()),this._requestManager=new Se(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const l=eo(u=>{this._trackResize&&!this._removed&&(this.resize(u),this.redraw())},50);this._resizeObserver=new ResizeObserver(u=>{s?l(u):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Bu(this,e),this._hash=e.hash&&new Ko(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,d.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new ua(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Ou,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new d.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new d.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new d.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(f,e){if(e===void 0&&(e=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new d.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=f.onAdd(this);this._controls.push(f);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(s,l.firstChild):l.appendChild(s),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new d.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(f);return e>-1&&this._controls.splice(e,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,e,s,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,e,s,l)}resize(f){var e;const s=this._containerDimensions(),l=s[0],u=s[1],p=this._getClampedPixelRatio(l,u);if(this._resizeCanvas(l,u,p),this.painter.resize(l,u,p),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const T=this._getClampedPixelRatio(l,u);this._resizeCanvas(l,u,T),this.painter.resize(l,u,T)}this.transform.resize(l,u),(e=this._requestedCameraState)===null||e===void 0||e.resize(l,u);const v=!this._moving;return v&&(this.stop(),this.fire(new d.k("movestart",f)).fire(new d.k("move",f))),this.fire(new d.k("resize",f)),v&&this.fire(new d.k("moveend",f)),this}_getClampedPixelRatio(f,e){const{0:s,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),p=f*u,v=e*u;return Math.min(p>s?s/p:1,v>l?l/v:1)*u}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(me.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}project(f){return this.transform.locationPoint(d.N.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.pointLocation(d.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,e,s){if(f==="mouseenter"||f==="mouseover"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:p=>{const v=e.filter(T=>this.getLayer(T)),w=v.length!==0?this.queryRenderedFeatures(p.point,{layers:v}):[];w.length?l||(l=!0,s.call(this,new Xr(f,this,p.originalEvent,{features:w}))):l=!1},mouseout:()=>{l=!1}}}}if(f==="mouseleave"||f==="mouseout"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:v=>{const w=e.filter(T=>this.getLayer(T));(w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[]).length?l=!0:l&&(l=!1,s.call(this,new Xr(f,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,s.call(this,new Xr(f,this,v.originalEvent)))}}}}{const l=u=>{const p=e.filter(w=>this.getLayer(w)),v=p.length!==0?this.queryRenderedFeatures(u.point,{layers:p}):[];v.length&&(u.features=v,s.call(this,u),delete u.features)};return{layers:e,listener:s,delegates:{[f]:l}}}}_saveDelegatedListener(f,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(e)}_removeDelegatedListener(f,e,s){if(!this._delegatedListeners||!this._delegatedListeners[f])return;const l=this._delegatedListeners[f];for(let u=0;u<l.length;u++){const p=l[u];if(p.listener===s&&p.layers.length===e.length&&p.layers.every(v=>e.includes(v))){for(const v in p.delegates)this.off(v,p.delegates[v]);return void l.splice(u,1)}}}on(f,e,s){if(s===void 0)return super.on(f,e);const l=this._createDelegatedListener(f,typeof e=="string"?[e]:e,s);this._saveDelegatedListener(f,l);for(const u in l.delegates)this.on(u,l.delegates[u]);return this}once(f,e,s){if(s===void 0)return super.once(f,e);const l=typeof e=="string"?[e]:e,u=this._createDelegatedListener(f,l,s);for(const p in u.delegates){const v=u.delegates[p];u.delegates[p]=(...w)=>{this._removeDelegatedListener(f,l,s),v(...w)}}this._saveDelegatedListener(f,u);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(f,e,s){return s===void 0?super.off(f,e):(this._removeDelegatedListener(f,typeof e=="string"?[e]:e,s),this)}queryRenderedFeatures(f,e){if(!this.style)return[];let s;const l=f instanceof d.P||Array.isArray(f),u=l?f:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:f)||{},u instanceof d.P||typeof u[0]=="number")s=[d.P.convert(u)];else{const p=d.P.convert(u[0]),v=d.P.convert(u[1]);s=[p,new d.P(v.x,p.y),v,new d.P(p.x,v.y),p]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(f,e){return this.style.querySourceFeatures(f,e)}setStyle(f,e){return(e=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(f,e))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const e=this._locale[f];if(e==null)throw new Error(`Missing UI string '${f}'`);return e}_updateStyle(f,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(f,e));const s=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new Do(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,e,s):this.style.loadJSON(f,e,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Do(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,e){if(typeof f=="string"){const s=this._requestManager.transformRequest(f,"Style");d.h(s,new AbortController).then(l=>{this._updateDiff(l.data,e)}).catch(l=>{l&&this.fire(new d.j(l))})}else typeof f=="object"&&this._updateDiff(f,e)}_updateDiff(f,e){try{this.style.setState(f,e)&&this._update(!0)}catch(s){d.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(f,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(f,e){return this._lazyInitEmptyStyle(),this.style.addSource(f,e),this._update(!0)}isSourceLoaded(f){const e=this.style&&this.style.sourceCaches[f];if(e!==void 0)return e.loaded();this.fire(new d.j(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){const e=this.style.sourceCaches[f.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);this.terrain===null&&e.reload();for(const s in this.style._layers){const l=this.style._layers[s];l.type==="hillshade"&&l.source===f.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ju(this.painter,e,f),this.painter.renderToTexture=new Ph(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==f.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new d.k("terrain",{terrain:f})),this}getTerrain(){var f,e;return(e=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const e in f){const s=f[e]._tiles;for(const l in s){const u=s[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,e,s={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:p,stretchY:v,content:w,textFitWidth:T,textFitHeight:P}=s;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||d.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:z,data:F}=e,j=e;return this.style.addImage(f,{data:new d.R({width:M,height:z},new Uint8Array(F)),pixelRatio:l,stretchX:p,stretchY:v,content:w,textFitWidth:T,textFitHeight:P,sdf:u,version:0,userImage:j}),j.onAdd&&j.onAdd(this,f),this}}{const{width:M,height:z,data:F}=Q.getImageData(e);this.style.addImage(f,{data:new d.R({width:M,height:z},F),pixelRatio:l,stretchX:p,stretchY:v,content:w,textFitWidth:T,textFitHeight:P,sdf:u,version:0})}}updateImage(f,e){const s=this.style.getImage(f);if(!s)return this.fire(new d.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||d.b(e)?Q.getImageData(e):e,{width:u,height:p,data:v}=l;if(u===void 0||p===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==s.data.width||p!==s.data.height)return this.fire(new d.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||d.b(e));return s.data.replace(v,w),this.style.updateImage(f,s),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new d.j(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f){return he.getImage(this._requestManager.transformRequest(f,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(f,e){return this._lazyInitEmptyStyle(),this.style.addLayer(f,e),this._update(!0)}moveLayer(f,e){return this.style.moveLayer(f,e),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,e,s){return this.style.setLayerZoomRange(f,e,s),this._update(!0)}setFilter(f,e,s={}){return this.style.setFilter(f,e,s),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,e,s,l={}){return this.style.setPaintProperty(f,e,s,l),this._update(!0)}getPaintProperty(f,e){return this.style.getPaintProperty(f,e)}setLayoutProperty(f,e,s,l={}){return this.style.setLayoutProperty(f,e,s,l),this._update(!0)}getLayoutProperty(f,e){return this.style.getLayoutProperty(f,e)}setGlyphs(f,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,e,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,e,s,l=>{l||this._update(!0)}),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,e,s=>{s||this._update(!0)}),this}setLight(f,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(f){return this._lazyInitEmptyStyle(),this.style.setSky(f),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(f,e){return this.style.setFeatureState(f,e),this._update()}removeFeatureState(f,e){return this.style.removeFeatureState(f,e),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,e=0;return this._container&&(f=this._container.clientWidth||400,e=this._container.clientHeight||300),[f,e]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map");const e=this._canvasContainer=W.create("div","maplibregl-canvas-container",f);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=W.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),l=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],l);const u=this._controlContainer=W.create("div","maplibregl-control-container",f),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{p[v]=W.create("div",`maplibregl-ctrl-${v} `,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,e,s){this._canvas.width=Math.floor(s*f),this._canvas.height=Math.floor(s*e),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const f={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{e={requestedAttributes:f},l&&(e.statusMessage=l.statusMessage,e.type=l.type)},{once:!0});const s=this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f);if(!s){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new Xo(s,this.transform),De.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,p=Q.now();this.style.zoomHistory.update(u,p);const v=new d.z(u,{now:p,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=v.crossFadingFactor();w===1&&w===this._crossFadingFactor||(s=!0,this._crossFadingFactor=w),this.style.update(v)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new d.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.bf.mark(d.bg.load),this.fire(new d.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,d.bf.mark(d.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),he.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),W.remove(this._canvasContainer),W.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),d.bf.clearMetrics(),this._removed=!0,this.fire(new d.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Q.frameAsync(this._frameRequest).then(f=>{d.bf.frame(f),this._frameRequest=null,this._render(f)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return Ch}getCameraTargetElevation(){return this.transform.elevation}},S.MapMouseEvent=Xr,S.MapTouchEvent=Es,S.MapWheelEvent=bh,S.Marker=al,S.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{const e=this._map.getZoom(),s=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,s)=>{const l=this._map._getUIString(`NavigationControl.${s}`);e.title=l,e.setAttribute("aria-label",l)},this.options=d.e({},Np,f),this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),W.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),W.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=W.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new jp(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){W.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,e){const s=W.create("button",f,this._container);return s.type="button",s.addEventListener("click",e),s}},S.Popup=class extends d.E{constructor(f){super(),this.remove=()=>(this._content&&W.remove(this._content),this._container&&(W.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=W.create("div","maplibregl-popup",this._map.getContainer()),this._tip=W.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?rr(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!e)return;const l=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let u=this.options.anchor;const p=ll(this.options.offset);if(!u){const w=this._container.offsetWidth,T=this._container.offsetHeight;let P;P=l.y+p.bottom.y<T?["top"]:l.y>this._map.transform.height-T?["bottom"]:[],l.x<w/2?P.push("left"):l.x>this._map.transform.width-w/2&&P.push("right"),u=P.length===0?"bottom":P.join("-")}let v=l.add(p[u]);this.options.subpixelPositioning||(v=v.round()),W.setTransform(this._container,`${ha[u]} translate(${v.x}px,${v.y}px)`),sl(this._container,u,"popup")},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(ot),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=d.N.convert(f),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const e=document.createDocumentFragment(),s=document.createElement("body");let l;for(s.innerHTML=f;l=s.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=W.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._container&&this._container.classList.add(f),this}removeClassName(f){return this._container&&this._container.classList.remove(f),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}setSubpixelPositioning(f){this.options.subpixelPositioning=f}_createCloseButton(){this.options.closeButton&&(this._closeButton=W.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(ol);f&&f.focus()}},S.RasterDEMTileSource=tr,S.RasterTileSource=Ct,S.ScaleControl=class{constructor(f){this._onMove=()=>{lo(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,lo(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Mn),f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){W.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},S.ScrollZoomHandler=hn,S.Style=Do,S.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=f}onAdd(f){return this._map=f,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=W.create("button","maplibregl-ctrl-terrain",this._container),W.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){W.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},S.TwoFingersTouchPitchHandler=so,S.TwoFingersTouchRotateHandler=Lu,S.TwoFingersTouchZoomHandler=Au,S.TwoFingersTouchZoomRotateHandler=Fu,S.VectorTileSource=Vn,S.VideoSource=Un,S.addSourceType=(f,e)=>d._(void 0,void 0,void 0,function*(){if(_s(f))throw new Error(`A source type called "${f}" already exists.`);((s,l)=>{gs[s]=l})(f,e)}),S.clearPrewarmedResources=function(){const f=ur;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(er),ur=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},S.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},S.getRTLTextPluginStatus=function(){return yr().getRTLTextPluginStatus()},S.getVersion=function(){return $u},S.getWorkerCount=function(){return Dr.workerCount},S.getWorkerUrl=function(){return d.a.WORKER_URL},S.importScriptInWorkers=function(f){return ms().broadcast("IS",f)},S.prewarm=function(){at().acquire(er)},S.setMaxParallelImageRequests=function(f){d.a.MAX_PARALLEL_IMAGE_REQUESTS=f},S.setRTLTextPlugin=function(f,e){return yr().setRTLTextPlugin(f,e)},S.setWorkerCount=function(f){Dr.workerCount=f},S.setWorkerUrl=function(f){d.a.WORKER_URL=f}});var I=h;return I})})(e1);var IS=e1.exports;const im=Vv(IS),ES=300;function PS(i){let a=i?{lat:i.lat,lng:i.lng}:null,h=null,_=performance.now();return{setTarget:S=>{h={lat:S.lat,lng:S.lng},a||(a={lat:S.lat,lng:S.lng})},update:S=>{if(!a||!h)return _=S,a;const d=Math.max(0,S-_);_=S;const U=Math.min(d/ES,1);return a={lat:a.lat+(h.lat-a.lat)*U,lng:a.lng+(h.lng-a.lng)*U},a}}}const Ov=[-122.4194,37.7749],Nv=250;function CS({fix:i,follow:a,status:h,debugMode:_,landmarks:b}){const I=kt.useRef(null),S=kt.useRef(null),d=kt.useRef(null),U=kt.useRef([]),ne=kt.useRef(PS()),ye=kt.useRef(a),Q=kt.useRef(h),W=kt.useRef(null),De=kt.useRef(0);return kt.useEffect(()=>{ye.current=a},[a]),kt.useEffect(()=>{Q.current=h},[h]),kt.useEffect(()=>{if(!I.current||S.current)return;const Me="https://tile.openstreetmap.org/{z}/{x}/{y}.png";let Pe;try{Pe=new im.Map({container:I.current,style:{version:8,sources:{osm:{type:"raster",tiles:[Me],tileSize:256,attribution:" OpenStreetMap contributors"}},layers:[{id:"osm",type:"raster",source:"osm"}]},center:Ov,zoom:15,pitch:0,bearing:0})}catch(ee){console.error("MapLibre init failed",ee);return}const _t=document.createElement("div");_t.className="map-marker";const oe=new im.Marker({element:_t,anchor:"center"}).setLngLat(Ov).addTo(Pe);return S.current=Pe,d.current=oe,()=>{oe.remove(),U.current.forEach(ee=>ee.remove()),U.current=[],Pe.remove(),d.current=null,S.current=null}},[]),kt.useEffect(()=>{i&&ne.current.setTarget(i)},[i]),kt.useEffect(()=>{const Me=S.current;if(!Me||(U.current.forEach(_t=>_t.remove()),U.current=[],!_))return;const Pe=b.map(_t=>{const oe=document.createElement("div");return oe.className="landmark-marker",oe.title=_t.name,new im.Marker({element:oe,anchor:"center"}).setLngLat([_t.lng,_t.lat]).addTo(Me)});U.current=Pe},[_,b]),kt.useEffect(()=>{const Me=Pe=>{const _t=S.current,oe=d.current,ee=ne.current.update(Pe);_t&&oe&&ee&&(oe.setLngLat([ee.lng,ee.lat]),ye.current&&Q.current==="watching"&&Pe-De.current>Nv&&(_t.easeTo({center:[ee.lng,ee.lat],duration:Nv,essential:!0}),De.current=Pe)),W.current=requestAnimationFrame(Me)};return W.current=requestAnimationFrame(Me),()=>{W.current!==null&&cancelAnimationFrame(W.current)}},[]),Re.jsx("div",{ref:I,className:"map-container"})}const MS=[{id:"louvre-puzzle",name:"Louvre Museum",lat:48.860611,lng:2.337644,radiusMeters:3500,task:{app:"askFifteen",title:"Glass Pyramid Puzzle",payload:"/hint/1973_Simca_1000_GL.JPG",hint:{type:"text",value:"Seek the pyramid of glass at the grand museum courtyard."}}},{id:"StartPoint0",name:"Welcome",lat:48.85358485204833,lng:2.348039397246975,radiusMeters:3500,task:{app:"askWordle",title:"Welcome to Paris 0 !",payload:"fixer",hint:{type:"text",value:"Go to the infernal place."}}},{id:"StartPoint",name:"Welcome",lat:48.85358485204833,lng:2.348039397246975,radiusMeters:3500,task:{app:"showMessage",title:"Welcome to Paris!",payload:{prompt:"See your first hint.",reward:50},hint:{type:"text",value:"Find the square of the old lady of the Parisians."}}},{id:"Notre-Dame",name:"Notre-Dame de Paris hint",lat:48.85360701161425,lng:2.3480388257029783,radiusMeters:50,task:{app:"showMessage",title:"Notre-Dame de Paris",payload:{prompt:"See your first hint.",reward:50},hint:{type:"image",value:"/hint/sacre-coeur-paris-1.jpg"}}},{id:"sacre-coeur",name:"Sacr-Cur Basilica",lat:48.88671,lng:2.343031,radiusMeters:90,task:{app:"askPuzzle",title:"Fox Riddle",payload:{question:"What is a female fox",answer:"vixen"},hint:{type:"text",value:"Hint: now find the tower errected for universal exhibition"}}},{id:"eiffel-tower",name:"Eiffel Tower",lat:48.85837,lng:2.294481,radiusMeters:100,task:{app:"askPuzzle",title:"Math Riddle",payload:{question:"What is 7 multiplied by 6?",answer:"42"},hint:{type:"text",value:"Hint: Congratulations! You have completed the tour of Paris!"}}}],zS={photoPrompt:i=>(console.info("[app:photoPrompt] payload",i),{success:!1}),triviaCard:i=>(console.info("[app:triviaCard] payload",i),{success:!1}),audioPing:i=>(console.info("[app:audioPing] payload",i),{success:!1}),showMessage:i=>({success:!1,message:typeof i=="string"?i:JSON.stringify(i,null,2)}),askPuzzle:i=>({success:!1,message:typeof i=="string"?i:JSON.stringify(i,null,2)}),askWordle:i=>({success:!1,message:typeof i=="string"?i:JSON.stringify(i,null,2)}),askFifteen:i=>({success:!1,message:typeof i=="string"?i:JSON.stringify(i,null,2)})},AS=async(i,a)=>{const h=zS[i];if(!h){const _=`[app-registry] Missing app "${i}"`;return console.warn(_,a),{success:!1,message:_}}return h(a)},DS=50,LS={enableHighAccuracy:!0,maximumAge:1e3,timeout:1e4};function RS(i=LS){let a=null,h=!1;const _=new Set,b=U=>{_.forEach(ne=>ne(U))},I=()=>{a!==null&&navigator.geolocation.clearWatch(a),a=null,h=!1,b({type:"status",status:"idle"})};return{start:()=>{if(!h){if(!("geolocation"in navigator)){b({type:"status",status:"unavailable",message:"Geolocation unavailable"});return}h=!0,b({type:"status",status:"waiting",message:"Waiting for GPS"}),a=navigator.geolocation.watchPosition(U=>{const ne={lat:U.coords.latitude,lng:U.coords.longitude,accuracy:U.coords.accuracy,timestamp:U.timestamp};if(ne.accuracy>DS){b({type:"status",status:"waiting",message:`Low accuracy (${Math.round(ne.accuracy)}m)`});return}b({type:"fix",fix:ne}),b({type:"status",status:"watching",message:"GPS OK"})},U=>{let ne="error",ye=U.message;U.code===U.PERMISSION_DENIED?(ne="denied",ye="Permission denied"):U.code===U.POSITION_UNAVAILABLE?(ne="unavailable",ye="Position unavailable"):U.code===U.TIMEOUT&&(ne="timeout",ye="GPS timeout"),b({type:"status",status:ne,message:ye}),(ne==="denied"||ne==="unavailable")&&I()},i)}},stop:I,subscribe:U=>(_.add(U),()=>_.delete(U))}}const vn=MS,jv={idle:"Idle",waiting:"Waiting",watching:"GPS OK",denied:"Permission denied",unavailable:"Unavailable",timeout:"Timeout",error:"Error"},FS={idle:"waiting",waiting:"waiting",watching:"ok",denied:"denied",unavailable:"error",timeout:"error",error:"error"};function BS(){const a=kt.useMemo(()=>RS(),[]),[h,_]=kt.useState("idle"),[b,I]=kt.useState(""),[S,d]=kt.useState(null),[U,ne]=kt.useState(!0),[ye,Q]=kt.useState(!1),[W,De]=kt.useState("37.7749"),[Me,Pe]=kt.useState("-122.4194"),[_t,oe]=kt.useState("10"),[ee,he]=kt.useState(0),[Se,Ue]=kt.useState(()=>new Set),[Xe,Ge]=kt.useState(null),[it,Rt]=kt.useState(()=>new Set([0])),[vt,wt]=kt.useState(null),[Mi,Qt]=kt.useState(""),[Ot,Tr]=kt.useState(null),[zi,jr]=kt.useState(""),[He,ht]=kt.useState(""),[ut,It]=kt.useState([]),[Nt,si]=kt.useState(""),[er,Dr]=kt.useState([]);kt.useEffect(()=>{const Ie=bt=>{bt.type==="fix"?(d(bt.fix),I("")):(_(bt.status),I(bt.message??""))},ct=a.subscribe(Ie);return a.start(),()=>{ct(),a.stop()}},[a,ye,!1]);const Gr=()=>{a.stop(),a.start()},ur=Ie=>Ie*Math.PI/180,mi=(Ie,ct)=>{const Ut=ur(ct.lat-Ie.lat),$=ur(ct.lng-Ie.lng),D=ur(Ie.lat),L=ur(ct.lat),O=Math.sin(Ut/2),Z=Math.sin($/2),te=O*O+Math.cos(D)*Math.cos(L)*Z*Z;return 2*6371e3*Math.asin(Math.min(1,Math.sqrt(te)))},at=ee<vn.length?vn[ee]:null,qi=S&&at?mi(S,at):null,ms=qi!==null&&at?qi<=at.radiusMeters:!1,Hr=()=>{if(!at)return;Ue(ct=>{const bt=new Set(ct);return bt.add(ee),bt}),Ge(null);const Ie=ee+1;Ie<vn.length?(he(Ie),Rt(ct=>{const bt=new Set(ct);return bt.add(Ie),bt}),Qt(`Hint unlocked: ${vn[Ie].task.title}`)):(he(vn.length),Qt("All tasks completed."))},ai=Ie=>Ie.type==="image"?Re.jsx("img",{className:"hint-image",src:Ie.value,alt:"Task hint"}):Re.jsx("div",{className:"hint-text",children:Ie.value}),In=S?S.lat.toFixed(6):"--",ts=S?S.lng.toFixed(6):"--",me=S?`${Math.round(S.accuracy)} m`:"--",jn=b?`${jv[h]}  ${b}`:jv[h],Vn=[...it].filter(Ie=>Se.has(Ie)).sort((Ie,ct)=>Ie-ct),Ct=vt!==null?vt:Vn[0]??null,tr=(at==null?void 0:at.task.app)==="showMessage",En=(at==null?void 0:at.task.app)==="askPuzzle",Ai=(at==null?void 0:at.task.app)==="askWordle",Wr=(at==null?void 0:at.task.app)==="askFifteen";kt.useEffect(()=>{jr(""),ht(""),It([]),si(""),Dr([])},[ee,Ot]);const Un=Ie=>Ie.trim().toLowerCase().split(/\s+/).join(" "),Mr=En&&at&&typeof at.task.payload=="object"?at.task.payload:null,gs=(Mr==null?void 0:Mr.question)??"",_s=(Mr==null?void 0:Mr.answer)??"",ke=Un(zi)===Un(_s),kr=(()=>{if(!Ai||!at)return"";const Ie=at.task.payload;if(typeof Ie=="string")return Ie;if(Ie&&typeof Ie=="object"&&"word"in Ie){const ct=Ie.word;return typeof ct=="string"?ct:""}return""})().trim().toLowerCase(),yr=kr.length,gi=ut.some(Ie=>Ie.toLowerCase()===kr),Ee=6,yt=(Ie,ct)=>{const bt=Array(Ie.length).fill("absent"),Ut=ct.split(""),$=Array(ct.length).fill(!1),D=Ie.split("");return D.forEach((L,O)=>{L===Ut[O]&&(bt[O]="correct",$[O]=!0)}),D.forEach((L,O)=>{if(bt[O]==="correct")return;const Z=Ut.findIndex((te,se)=>!$[se]&&te===L);Z>=0&&(bt[O]="present",$[Z]=!0)}),bt},lt=()=>{if(!kr||ut.length>=Ee||gi)return;const Ie=He.trim().toLowerCase();if(Ie.length!==yr){si(`Enter a ${yr}-letter word.`);return}si(""),It(ct=>[...ct,Ie]),ht("")},Lr=(()=>{if(!Wr||!at)return"";const Ie=at.task.payload;if(typeof Ie=="string")return Ie;if(Ie&&typeof Ie=="object"&&"imageUrl"in Ie){const ct=Ie.imageUrl;return typeof ct=="string"?ct:""}return""})();kt.useEffect(()=>{if(!Wr||Ot!=="task")return;const Ie=[...Array(15).keys()].map($=>$+1).concat(0),ct=100,bt=$=>{const D=[],L=Math.floor($/4),O=$%4;return L>0&&D.push($-4),L<3&&D.push($+4),O>0&&D.push($-1),O<3&&D.push($+1),D};let Ut=Ie.indexOf(0);for(let $=0;$<ct;$+=1){const D=bt(Ut),L=D[Math.floor(Math.random()*D.length)];[Ie[Ut],Ie[L]]=[Ie[L],Ie[Ut]],Ut=L}Dr(Ie)},[Wr,Ot,ee]);const _i=er.length===16&&er.every((Ie,ct)=>ct===15?Ie===0:Ie===ct+1),mt=Ie=>{if(er.length!==16)return;const ct=er.indexOf(0),bt=Math.floor(Ie/4),Ut=Ie%4,$=Math.floor(ct/4),D=ct%4;if(!(Math.abs(bt-$)+Math.abs(Ut-D)===1))return;const O=[...er];[O[ct],O[Ie]]=[O[Ie],O[ct]],Dr(O)};return Re.jsxs("div",{className:"app",children:[Re.jsx(CS,{fix:S,follow:U,status:h,debugMode:!1,landmarks:vn}),Re.jsxs("div",{className:"overlay-actions",children:[at&&ms&&!Se.has(ee)&&Re.jsx("button",{className:"button overlay-button",type:"button",onClick:async()=>{const Ie=await AS(at.task.app,at.task.payload);Ge(ee),Qt(Ie.message??`Opened: ${at.task.title}`),Tr("task"),Ie.success&&Hr()},children:at.task.title}),Re.jsxs("div",{className:"overlay-row",children:[Re.jsx("button",{className:"button secondary overlay-button past-hints-button",type:"button",onClick:()=>Tr("hints"),disabled:it.size===0,children:"Past hints"}),!1]})]}),Re.jsxs("div",{className:"hud",children:[Re.jsxs("div",{className:"hud-row",children:[Re.jsxs("div",{children:[Re.jsx("div",{className:"hud-label",children:"Latitude"}),Re.jsx("div",{className:"hud-value",children:In})]}),Re.jsxs("div",{children:[Re.jsx("div",{className:"hud-label",children:"Longitude"}),Re.jsx("div",{className:"hud-value",children:ts})]}),Re.jsxs("div",{children:[Re.jsx("div",{className:"hud-label",children:"Accuracy"}),Re.jsx("div",{className:"hud-value",children:me})]})]}),Re.jsxs("div",{className:"hud-row",children:[Re.jsxs("div",{className:`status ${FS[h]}`,children:[Re.jsx("span",{className:"status-dot"}),jn]}),Re.jsxs("div",{className:"hud-row",children:[Re.jsxs("button",{className:`button ${U?"":"secondary"}`,onClick:()=>ne(Ie=>!Ie),type:"button",children:["Follow player: ",U?"On":"Off"]}),(h==="denied"||h==="unavailable"||h==="timeout")&&Re.jsx("button",{className:"button secondary",onClick:Gr,type:"button",children:"Retry GPS"})]})]}),!1,!1]}),Ot&&Re.jsx("div",{className:"modal-backdrop",onClick:()=>{(Ot!=="task"||En&&!ke||Ai||Wr)&&Tr(null)},children:Re.jsxs("div",{className:"modal",onClick:Ie=>Ie.stopPropagation(),children:[Re.jsx("div",{className:"modal-header",children:Re.jsx("div",{className:"hud-label",children:Ot==="task"&&tr&&at||Ot==="task"&&En&&at||Ot==="task"&&Ai&&at||Ot==="task"&&Wr&&at?at.task.title:Ot==="task"?"Task":Ot==="hints"?"Past hints":"Landmarks"})}),Ot==="task"&&at&&Re.jsx("div",{className:"modal-body",children:tr?Re.jsxs(Re.Fragment,{children:[Re.jsx("div",{className:"task-hint",children:ai(at.task.hint)}),Re.jsx("button",{className:"button",type:"button",disabled:Xe!==ee,onClick:()=>{Hr(),Tr(null)},children:"OK"})]}):En?Re.jsxs(Re.Fragment,{children:[Re.jsx("div",{className:"modal-title",children:at.task.title}),Re.jsx("div",{className:"task-hint",children:Re.jsx("div",{className:"hint-text",children:gs})}),Re.jsx("input",{className:"input",value:zi,onChange:Ie=>jr(Ie.target.value),placeholder:"Your answer"}),ke&&Re.jsx("div",{className:"task-hint",children:ai(at.task.hint)}),Re.jsx("button",{className:"button",type:"button",disabled:!ke,onClick:()=>{Hr(),Tr(null)},children:"OK"})]}):Ai?Re.jsxs(Re.Fragment,{children:[Re.jsx("div",{className:"modal-title",children:at.task.title}),Re.jsx("div",{className:"wordle-grid",children:Array.from({length:Ee}).map((Ie,ct)=>{const bt=ut[ct]??"",Ut=Math.max(yr,1),$=bt.padEnd(Ut," ").split(""),D=yr>0&&bt.length===yr?yt(bt,kr):Array(Ut).fill("absent");return Re.jsx("div",{className:"wordle-row",style:{gridTemplateColumns:`repeat(${Ut}, 1fr)`},children:$.map((L,O)=>Re.jsx("div",{className:`wordle-tile ${bt?D[O]:""}`,children:L.trim().toUpperCase()},`tile-${ct}-${O}`))},`row-${ct}`)})}),Re.jsxs("div",{className:"wordle-input",children:[Re.jsx("input",{className:"input",value:He,onChange:Ie=>{const ct=Ie.target.value.replace(/\s+/g,"");ht(ct.slice(0,yr))},placeholder:`Guess (${yr} letters)`,disabled:yr===0||gi||ut.length>=Ee}),Re.jsx("button",{className:"button secondary",type:"button",onClick:lt,disabled:yr===0||gi||ut.length>=Ee||He.trim().length!==yr,children:"Submit"})]}),Nt&&Re.jsx("div",{className:"task-message",children:Nt}),gi&&Re.jsx("div",{className:"task-hint",children:ai(at.task.hint)}),Re.jsx("button",{className:"button",type:"button",disabled:!gi,onClick:()=>{Hr(),Tr(null)},children:"OK"}),Re.jsx("button",{className:"button secondary",type:"button",onClick:()=>Tr(null),children:"Abandon"})]}):Wr?Re.jsxs(Re.Fragment,{children:[Re.jsx("div",{className:"modal-title",children:at.task.title}),Re.jsx("div",{className:"fifteen-grid",children:(er.length===16?er:[...Array(15).keys()].map(Ie=>Ie+1).concat(0)).map((Ie,ct)=>{const bt=Ie===0,Ut=(()=>{if(bt||er.length!==16)return!1;const O=er.indexOf(0),Z=Math.floor(ct/4),te=ct%4,se=Math.floor(O/4),ce=O%4;return Math.abs(Z-se)+Math.abs(te-ce)===1})(),$=Ie-1,D=Math.floor($/4),L=$%4;return Re.jsx("button",{type:"button",className:`fifteen-tile ${bt?"empty":Ut?"movable":""}`,onClick:()=>mt(ct),disabled:bt,style:bt?void 0:{backgroundImage:Lr?`url(${Lr})`:"none",backgroundSize:"400% 400%",backgroundPosition:`${L/3*100}% ${D/3*100}%`},children:!Lr&&Ie!==0?Ie:null},`tile-${Ie}-${ct}`)})}),_i&&Re.jsx("div",{className:"task-hint",children:ai(at.task.hint)}),Re.jsx("button",{className:"button",type:"button",disabled:!_i,onClick:()=>{Hr(),Tr(null)},children:"OK"})]}):Re.jsxs(Re.Fragment,{children:[Re.jsx("div",{className:"modal-title",children:at.task.title}),Mi&&Re.jsx("div",{className:"task-message",children:Mi}),Re.jsx("div",{className:"task-hint",children:ai(at.task.hint)}),Re.jsxs("div",{className:"task-meta",children:["App: ",at.task.app,qi!==null?`  ${Math.round(qi)}m`:""]}),Re.jsx("pre",{className:"task-payload",children:JSON.stringify(at.task.payload,null,2)}),Re.jsx("button",{className:"button secondary",type:"button",disabled:Xe!==ee,onClick:Hr,children:"Mark resolved"})]})}),Ot==="hints"&&Re.jsx("div",{className:"modal-body",children:Vn.length===0?Re.jsx("div",{className:"task-meta",children:"No hints available yet."}):Re.jsxs(Re.Fragment,{children:[Re.jsx("div",{className:"hint-list",children:Vn.map(Ie=>Re.jsxs("button",{className:`hint-item ${Ct===Ie?"active":""}`,type:"button",onClick:()=>wt(Ie),children:[Ie+1,". ",vn[Ie].task.title]},vn[Ie].id))}),Ct!==null&&vn[Ct]&&Re.jsx("div",{className:"hint-detail",children:ai(vn[Ct].task.hint)})]})}),Ot==="landmarks"&&Re.jsx("div",{className:"modal-body",children:Re.jsxs("div",{className:"landmark-list",children:[Re.jsx("div",{className:"hud-label",children:"Landmarks (within 1km)"}),(()=>{const bt=(S?vn.map($=>({landmark:$,distance:mi(S,$)})):[]).filter($=>$.distance<=1e3).sort(($,D)=>$.distance-D.distance),Ut=vn.length-bt.length;return S?Re.jsxs(Re.Fragment,{children:[bt.length===0?Re.jsx("div",{className:"landmark-item",children:"No nearby landmarks."}):bt.map(({landmark:$,distance:D})=>{const L=vn.findIndex(te=>te.id===$.id),O=Se.has(L),Z=L===ee;return Re.jsxs("div",{className:`landmark-item ${Z?"active":""}`,children:[Re.jsx("span",{children:$.name}),Re.jsxs("span",{className:"landmark-meta",children:[Math.round(D),"m",O?"  triggered":""]})]},$.id)}),Re.jsxs("div",{className:"landmark-summary",children:[Ut," other landmark",Ut===1?"":"s"," ","outside 1km."]})]}):Re.jsx("div",{className:"landmark-item",children:"Waiting for position..."})})()]})})]})})]})}kS({immediate:!0});nm.createRoot(document.getElementById("root")).render(Re.jsx(cb.StrictMode,{children:Re.jsx(BS,{})}));
